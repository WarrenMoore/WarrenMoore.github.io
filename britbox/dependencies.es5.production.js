!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},check=function(t){return t&&t.Math==Math&&t},e=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),r={},fails$11=function(t){try{return!!t()}catch(t){return!0}},i=!fails$11((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),n={},s={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,u=o&&!s.call({1:2},1);n.f=u?function propertyIsEnumerable(t){var e=o(this,t);return!!e&&e.enumerable}:s;var h,l,createPropertyDescriptor$9=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},f={}.toString,classofRaw$1=function(t){return f.call(t).slice(8,-1)},d=classofRaw$1,_="".split,g=fails$11((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==d(t)?_.call(t,""):Object(t)}:Object,requireObjectCoercible$i=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},p=g,v=requireObjectCoercible$i,toIndexedObject$d=function(t){return p(v(t))},isObject$C=function(t){return"object"==typeof t?null!==t:"function"==typeof t},y=e,aFunction$T=function(t){return"function"==typeof t?t:void 0},getBuiltIn$u=function(t,e){return arguments.length<2?aFunction$T(y[t]):y[t]&&y[t][e]},x=getBuiltIn$u("navigator","userAgent")||"",m=e,S=x,b=m.process,k=m.Deno,T=b&&b.versions||k&&k.version,C=T&&T.v8;C?l=(h=C.split("."))[0]<4?1:h[0]+h[1]:S&&(!(h=S.match(/Edge\/(\d+)/))||h[1]>=74)&&(h=S.match(/Chrome\/(\d+)/))&&(l=h[1]);var w=l&&+l,A=w,R=fails$11,E=!!Object.getOwnPropertySymbols&&!R((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&A&&A<41})),L=E&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,I=getBuiltIn$u,O=L?function(t){return"symbol"==typeof t}:function(t){var e=I("Symbol");return"function"==typeof e&&Object(t)instanceof e},P=isObject$C,ordinaryToPrimitive$2=function(t,e){var r,i;if("string"===e&&"function"==typeof(r=t.toString)&&!P(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!P(i=r.call(t)))return i;if("string"!==e&&"function"==typeof(r=t.toString)&&!P(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")},M={exports:{}},z=e,setGlobal$3=function(t,e){try{Object.defineProperty(z,t,{value:e,configurable:!0,writable:!0})}catch(r){z[t]=e}return e},U=setGlobal$3,B="__core-js_shared__",D=e[B]||U(B,{}),j=D;(M.exports=function(t,e){return j[t]||(j[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.16.0",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var N=requireObjectCoercible$i,toObject$x=function(t){return Object(N(t))},W=toObject$x,H={}.hasOwnProperty,G=Object.hasOwn||function hasOwn(t,e){return H.call(W(t),e)},V=0,Y=Math.random(),uid$5=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++V+Y).toString(36)},X=e,q=M.exports,$=G,Z=uid$5,K=E,Q=L,J=q("wks"),tt=X.Symbol,et=Q?tt:tt&&tt.withoutSetter||Z,wellKnownSymbol$E=function(t){return $(J,t)&&(K||"string"==typeof J[t])||(K&&$(tt,t)?J[t]=tt[t]:J[t]=et("Symbol."+t)),J[t]},rt=isObject$C,it=O,nt=ordinaryToPrimitive$2,st=wellKnownSymbol$E("toPrimitive"),toPrimitive$3=function(t,e){if(!rt(t)||it(t))return t;var r,i=t[st];if(void 0!==i){if(void 0===e&&(e="default"),r=i.call(t,e),!rt(r)||it(r))return r;throw TypeError("Can't convert object to primitive value")}return void 0===e&&(e="number"),nt(t,e)},ot=toPrimitive$3,ut=O,toPropertyKey$9=function(t){var e=ot(t,"string");return ut(e)?e:String(e)},ht=isObject$C,lt=e.document,ct=ht(lt)&&ht(lt.createElement),documentCreateElement$1=function(t){return ct?lt.createElement(t):{}},ft=documentCreateElement$1,dt=!i&&!fails$11((function(){return 7!=Object.defineProperty(ft("div"),"a",{get:function(){return 7}}).a})),_t=i,gt=n,pt=createPropertyDescriptor$9,vt=toIndexedObject$d,yt=toPropertyKey$9,xt=G,mt=dt,St=Object.getOwnPropertyDescriptor;r.f=_t?St:function getOwnPropertyDescriptor(t,e){if(t=vt(t),e=yt(e),mt)try{return St(t,e)}catch(t){}if(xt(t,e))return pt(!gt.f.call(t,e),t[e])};var bt={},kt=isObject$C,anObject$1z=function(t){if(!kt(t))throw TypeError(String(t)+" is not an object");return t},Tt=i,Ct=dt,wt=anObject$1z,At=toPropertyKey$9,Rt=Object.defineProperty;bt.f=Tt?Rt:function defineProperty(t,e,r){if(wt(t),e=At(e),wt(r),Ct)try{return Rt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var Et=bt,Lt=createPropertyDescriptor$9,It=i?function(t,e,r){return Et.f(t,e,Lt(1,r))}:function(t,e,r){return t[e]=r,t},Ot={exports:{}},Pt=D,Mt=Function.toString;"function"!=typeof Pt.inspectSource&&(Pt.inspectSource=function(t){return Mt.call(t)});var Ft,zt,Ut,Bt=Pt.inspectSource,Dt=Bt,jt=e.WeakMap,Nt="function"==typeof jt&&/native code/.test(Dt(jt)),Wt=M.exports,Ht=uid$5,Gt=Wt("keys"),sharedKey$4=function(t){return Gt[t]||(Gt[t]=Ht(t))},Vt={},Yt=Nt,Xt=isObject$C,qt=It,$t=G,Zt=D,Kt=sharedKey$4,Qt=Vt,Jt="Object already initialized",te=e.WeakMap;if(Yt||Zt.state){var ee=Zt.state||(Zt.state=new te),re=ee.get,ie=ee.has,ne=ee.set;Ft=function(t,e){if(ie.call(ee,t))throw new TypeError(Jt);return e.facade=t,ne.call(ee,t,e),e},zt=function(t){return re.call(ee,t)||{}},Ut=function(t){return ie.call(ee,t)}}else{var se=Kt("state");Qt[se]=!0,Ft=function(t,e){if($t(t,se))throw new TypeError(Jt);return e.facade=t,qt(t,se,e),e},zt=function(t){return $t(t,se)?t[se]:{}},Ut=function(t){return $t(t,se)}}var oe={set:Ft,get:zt,has:Ut,enforce:function(t){return Ut(t)?zt(t):Ft(t,{})},getterFor:function(t){return function(e){var r;if(!Xt(e)||(r=zt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},ae=e,ue=It,he=G,le=setGlobal$3,ce=Bt,fe=oe.get,de=oe.enforce,_e=String(String).split("String");(Ot.exports=function(t,e,r,i){var n,s=!!i&&!!i.unsafe,o=!!i&&!!i.enumerable,u=!!i&&!!i.noTargetGet;"function"==typeof r&&("string"!=typeof e||he(r,"name")||ue(r,"name",e),(n=de(r)).source||(n.source=_e.join("string"==typeof e?e:""))),t!==ae?(s?!u&&t[e]&&(o=!0):delete t[e],o?t[e]=r:ue(t,e,r)):o?t[e]=r:le(e,r)})(Function.prototype,"toString",(function toString(){return"function"==typeof this&&fe(this).source||ce(this)}));var ge={},pe=Math.ceil,ve=Math.floor,toInteger$h=function(t){return isNaN(t=+t)?0:(t>0?ve:pe)(t)},ye=toInteger$h,xe=Math.min,toLength$C=function(t){return t>0?xe(ye(t),9007199254740991):0},me=toInteger$h,Se=Math.max,be=Math.min,toAbsoluteIndex$8=function(t,e){var r=me(t);return r<0?Se(r+e,0):be(r,e)},ke=toIndexedObject$d,Te=toLength$C,Ce=toAbsoluteIndex$8,createMethod$8=function(t){return function(e,r,i){var n,s=ke(e),o=Te(s.length),u=Ce(i,o);if(t&&r!=r){for(;o>u;)if((n=s[u++])!=n)return!0}else for(;o>u;u++)if((t||u in s)&&s[u]===r)return t||u||0;return!t&&-1}},we={includes:createMethod$8(!0),indexOf:createMethod$8(!1)},Ae=G,Re=toIndexedObject$d,Ee=we.indexOf,Le=Vt,objectKeysInternal=function(t,e){var r,i=Re(t),n=0,s=[];for(r in i)!Ae(Le,r)&&Ae(i,r)&&s.push(r);for(;e.length>n;)Ae(i,r=e[n++])&&(~Ee(s,r)||s.push(r));return s},Ie=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Oe=objectKeysInternal,Pe=Ie.concat("length","prototype");ge.f=Object.getOwnPropertyNames||function getOwnPropertyNames(t){return Oe(t,Pe)};var Me={};Me.f=Object.getOwnPropertySymbols;var Fe,ze=ge,Ue=Me,Be=anObject$1z,De=getBuiltIn$u("Reflect","ownKeys")||function ownKeys(t){var e=ze.f(Be(t)),r=Ue.f;return r?e.concat(r(t)):e},je=G,Ne=De,We=r,He=bt,copyConstructorProperties$2=function(t,e){for(var r=Ne(e),i=He.f,n=We.f,s=0;s<r.length;s++){var o=r[s];je(t,o)||i(t,o,n(e,o))}},Ge=fails$11,Ve=/#|\.prototype\./,isForced$5=function(t,e){var r=Xe[Ye(t)];return r==$e||r!=qe&&("function"==typeof e?Ge(e):!!e)},Ye=isForced$5.normalize=function(t){return String(t).replace(Ve,".").toLowerCase()},Xe=isForced$5.data={},qe=isForced$5.NATIVE="N",$e=isForced$5.POLYFILL="P",Ze=isForced$5,Ke=e,Qe=r.f,Je=It,tr=Ot.exports,er=setGlobal$3,rr=copyConstructorProperties$2,ir=Ze,_export=function(t,e){var r,i,n,s,o,u=t.target,h=t.global,l=t.stat;if(r=h?Ke:l?Ke[u]||er(u,{}):(Ke[u]||{}).prototype)for(i in e){if(s=e[i],n=t.noTargetGet?(o=Qe(r,i))&&o.value:r[i],!ir(h?i:u+(l?".":"#")+i,t.forced)&&void 0!==n){if(typeof s==typeof n)continue;rr(s,n)}(t.sham||n&&n.sham)&&Je(s,"sham",!0),tr(r,i,s,t)}},nr=classofRaw$1,sr=Array.isArray||function isArray(t){return"Array"==nr(t)},or=O,toString$s=function(t){if(or(t))throw TypeError("Cannot convert a Symbol value to a string");return String(t)},ar=objectKeysInternal,ur=Ie,hr=Object.keys||function keys(t){return ar(t,ur)},lr=bt,cr=anObject$1z,fr=hr,dr=i?Object.defineProperties:function defineProperties(t,e){cr(t);for(var r,i=fr(e),n=i.length,s=0;n>s;)lr.f(t,r=i[s++],e[r]);return t},_r=getBuiltIn$u("document","documentElement"),gr=anObject$1z,pr=dr,vr=Ie,yr=Vt,xr=_r,mr=documentCreateElement$1,Sr=sharedKey$4("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var e=t.parentWindow.Object;return t=null,e},NullProtoObject=function(){try{Fe=new ActiveXObject("htmlfile")}catch(t){}NullProtoObject=document.domain&&Fe?NullProtoObjectViaActiveX(Fe):function(){var t,e=mr("iframe");if(e.style)return e.style.display="none",xr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F}()||NullProtoObjectViaActiveX(Fe);for(var t=vr.length;t--;)delete NullProtoObject.prototype[vr[t]];return NullProtoObject()};yr[Sr]=!0;var br=Object.create||function create(t,e){var r;return null!==t?(EmptyConstructor.prototype=gr(t),r=new EmptyConstructor,EmptyConstructor.prototype=null,r[Sr]=t):r=NullProtoObject(),void 0===e?r:pr(r,e)},kr={},Tr=toIndexedObject$d,Cr=ge.f,wr={}.toString,Ar="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];kr.f=function getOwnPropertyNames(t){return Ar&&"[object Window]"==wr.call(t)?function(t){try{return Cr(t)}catch(t){return Ar.slice()}}(t):Cr(Tr(t))};var Rr={},Er=wellKnownSymbol$E;Rr.f=Er;var Lr=e,Ir=Lr,Or=G,Pr=Rr,Mr=bt.f,defineWellKnownSymbol$l=function(t){var e=Ir.Symbol||(Ir.Symbol={});Or(e,t)||Mr(e,t,{value:Pr.f(t)})},Fr=bt.f,zr=G,Ur=wellKnownSymbol$E("toStringTag"),setToStringTag$b=function(t,e,r){t&&!zr(t=r?t:t.prototype,Ur)&&Fr(t,Ur,{configurable:!0,value:e})},aFunction$S=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Br=aFunction$S,functionBindContext=function(t,e,r){if(Br(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,i){return t.call(e,r,i)};case 3:return function(r,i,n){return t.call(e,r,i,n)}}return function(){return t.apply(e,arguments)}},Dr=isObject$C,jr=sr,Nr=wellKnownSymbol$E("species"),arraySpeciesConstructor$2=function(t){var e;return jr(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!jr(e.prototype)?Dr(e)&&null===(e=e[Nr])&&(e=void 0):e=void 0),void 0===e?Array:e},Wr=arraySpeciesConstructor$2,arraySpeciesCreate$6=function(t,e){return new(Wr(t))(0===e?0:e)},Hr=functionBindContext,Gr=g,Vr=toObject$x,Yr=toLength$C,Xr=arraySpeciesCreate$6,qr=[].push,createMethod$7=function(t){var e=1==t,r=2==t,i=3==t,n=4==t,s=6==t,o=7==t,u=5==t||s;return function(h,l,f,d){for(var _,g,p=Vr(h),v=Gr(p),y=Hr(l,f,3),x=Yr(v.length),m=0,S=d||Xr,b=e?S(h,x):r||o?S(h,0):void 0;x>m;m++)if((u||m in v)&&(g=y(_=v[m],m,p),t))if(e)b[m]=g;else if(g)switch(t){case 3:return!0;case 5:return _;case 6:return m;case 2:qr.call(b,_)}else switch(t){case 4:return!1;case 7:qr.call(b,_)}return s?-1:i||n?n:b}},$r={forEach:createMethod$7(0),map:createMethod$7(1),filter:createMethod$7(2),some:createMethod$7(3),every:createMethod$7(4),find:createMethod$7(5),findIndex:createMethod$7(6),filterReject:createMethod$7(7)},Zr=_export,Kr=e,Qr=getBuiltIn$u,Jr=i,ti=E,ei=fails$11,ri=G,ii=sr,ni=isObject$C,si=O,oi=anObject$1z,ai=toObject$x,ui=toIndexedObject$d,hi=toPropertyKey$9,li=toString$s,ci=createPropertyDescriptor$9,fi=br,di=hr,_i=ge,gi=kr,pi=Me,vi=r,yi=bt,xi=n,mi=It,Si=Ot.exports,bi=M.exports,ki=Vt,Ti=uid$5,Ci=wellKnownSymbol$E,wi=Rr,Ai=defineWellKnownSymbol$l,Ri=setToStringTag$b,Ei=oe,Li=$r.forEach,Ii=sharedKey$4("hidden"),Oi="Symbol",Pi=Ci("toPrimitive"),Mi=Ei.set,Fi=Ei.getterFor(Oi),zi=Object.prototype,Ui=Kr.Symbol,Bi=Qr("JSON","stringify"),Di=vi.f,ji=yi.f,Ni=gi.f,Wi=xi.f,Hi=bi("symbols"),Gi=bi("op-symbols"),Vi=bi("string-to-symbol-registry"),Yi=bi("symbol-to-string-registry"),Xi=bi("wks"),qi=Kr.QObject,$i=!qi||!qi.prototype||!qi.prototype.findChild,Zi=Jr&&ei((function(){return 7!=fi(ji({},"a",{get:function(){return ji(this,"a",{value:7}).a}})).a}))?function(t,e,r){var i=Di(zi,e);i&&delete zi[e],ji(t,e,r),i&&t!==zi&&ji(zi,e,i)}:ji,wrap$1=function(t,e){var r=Hi[t]=fi(Ui.prototype);return Mi(r,{type:Oi,tag:t,description:e}),Jr||(r.description=e),r},Ki=function defineProperty(t,e,r){t===zi&&Ki(Gi,e,r),oi(t);var i=hi(e);return oi(r),ri(Hi,i)?(r.enumerable?(ri(t,Ii)&&t[Ii][i]&&(t[Ii][i]=!1),r=fi(r,{enumerable:ci(0,!1)})):(ri(t,Ii)||ji(t,Ii,ci(1,{})),t[Ii][i]=!0),Zi(t,i,r)):ji(t,i,r)},Qi=function defineProperties(t,e){oi(t);var r=ui(e),i=di(r).concat(rn(r));return Li(i,(function(e){Jr&&!Ji.call(r,e)||Ki(t,e,r[e])})),t},Ji=function propertyIsEnumerable(t){var e=hi(t),r=Wi.call(this,e);return!(this===zi&&ri(Hi,e)&&!ri(Gi,e))&&(!(r||!ri(this,e)||!ri(Hi,e)||ri(this,Ii)&&this[Ii][e])||r)},tn=function getOwnPropertyDescriptor(t,e){var r=ui(t),i=hi(e);if(r!==zi||!ri(Hi,i)||ri(Gi,i)){var n=Di(r,i);return!n||!ri(Hi,i)||ri(r,Ii)&&r[Ii][i]||(n.enumerable=!0),n}},en=function getOwnPropertyNames(t){var e=Ni(ui(t)),r=[];return Li(e,(function(t){ri(Hi,t)||ri(ki,t)||r.push(t)})),r},rn=function getOwnPropertySymbols(t){var e=t===zi,r=Ni(e?Gi:ui(t)),i=[];return Li(r,(function(t){!ri(Hi,t)||e&&!ri(zi,t)||i.push(Hi[t])})),i};(ti||(Si((Ui=function Symbol(){if(this instanceof Ui)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?li(arguments[0]):void 0,e=Ti(t),setter=function(t){this===zi&&setter.call(Gi,t),ri(this,Ii)&&ri(this[Ii],e)&&(this[Ii][e]=!1),Zi(this,e,ci(1,t))};return Jr&&$i&&Zi(zi,e,{configurable:!0,set:setter}),wrap$1(e,t)}).prototype,"toString",(function toString(){return Fi(this).tag})),Si(Ui,"withoutSetter",(function(t){return wrap$1(Ti(t),t)})),xi.f=Ji,yi.f=Ki,vi.f=tn,_i.f=gi.f=en,pi.f=rn,wi.f=function(t){return wrap$1(Ci(t),t)},Jr&&(ji(Ui.prototype,"description",{configurable:!0,get:function description(){return Fi(this).description}}),Si(zi,"propertyIsEnumerable",Ji,{unsafe:!0}))),Zr({global:!0,wrap:!0,forced:!ti,sham:!ti},{Symbol:Ui}),Li(di(Xi),(function(t){Ai(t)})),Zr({target:Oi,stat:!0,forced:!ti},{for:function(t){var e=li(t);if(ri(Vi,e))return Vi[e];var r=Ui(e);return Vi[e]=r,Yi[r]=e,r},keyFor:function keyFor(t){if(!si(t))throw TypeError(t+" is not a symbol");if(ri(Yi,t))return Yi[t]},useSetter:function(){$i=!0},useSimple:function(){$i=!1}}),Zr({target:"Object",stat:!0,forced:!ti,sham:!Jr},{create:function create(t,e){return void 0===e?fi(t):Qi(fi(t),e)},defineProperty:Ki,defineProperties:Qi,getOwnPropertyDescriptor:tn}),Zr({target:"Object",stat:!0,forced:!ti},{getOwnPropertyNames:en,getOwnPropertySymbols:rn}),Zr({target:"Object",stat:!0,forced:ei((function(){pi.f(1)}))},{getOwnPropertySymbols:function getOwnPropertySymbols(t){return pi.f(ai(t))}}),Bi)&&Zr({target:"JSON",stat:!0,forced:!ti||ei((function(){var t=Ui();return"[null]"!=Bi([t])||"{}"!=Bi({a:t})||"{}"!=Bi(Object(t))}))},{stringify:function stringify(t,e,r){for(var i,n=[t],s=1;arguments.length>s;)n.push(arguments[s++]);if(i=e,(ni(e)||void 0!==t)&&!si(t))return ii(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!si(e))return e}),n[1]=e,Bi.apply(null,n)}});Ui.prototype[Pi]||mi(Ui.prototype,Pi,Ui.prototype.valueOf),Ri(Ui,Oi),ki[Ii]=!0;var nn=_export,sn=i,an=e,un=G,hn=isObject$C,ln=bt.f,cn=copyConstructorProperties$2,fn=an.Symbol;if(sn&&"function"==typeof fn&&(!("description"in fn.prototype)||void 0!==fn().description)){var dn={},_n=function Symbol(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof _n?new fn(t):void 0===t?fn():fn(t);return""===t&&(dn[e]=!0),e};cn(_n,fn);var gn=_n.prototype=fn.prototype;gn.constructor=_n;var pn=gn.toString,vn="Symbol(test)"==String(fn("test")),yn=/^Symbol\((.*)\)[^)]+$/;ln(gn,"description",{configurable:!0,get:function description(){var t=hn(this)?this.valueOf():this,e=pn.call(t);if(un(dn,t))return"";var r=vn?e.slice(7,-1):e.replace(yn,"$1");return""===r?void 0:r}}),nn({global:!0,forced:!0},{Symbol:_n})}defineWellKnownSymbol$l("asyncIterator"),defineWellKnownSymbol$l("hasInstance"),defineWellKnownSymbol$l("isConcatSpreadable"),defineWellKnownSymbol$l("iterator"),defineWellKnownSymbol$l("match"),defineWellKnownSymbol$l("matchAll"),defineWellKnownSymbol$l("replace"),defineWellKnownSymbol$l("search"),defineWellKnownSymbol$l("species"),defineWellKnownSymbol$l("split"),defineWellKnownSymbol$l("toPrimitive"),defineWellKnownSymbol$l("toStringTag"),defineWellKnownSymbol$l("unscopables");var xn=!fails$11((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),mn=G,Sn=toObject$x,bn=xn,kn=sharedKey$4("IE_PROTO"),Tn=Object.prototype,Cn=bn?Object.getPrototypeOf:function(t){return t=Sn(t),mn(t,kn)?t[kn]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Tn:null},wn=isObject$C,aPossiblePrototype$2=function(t){if(!wn(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},An=anObject$1z,Rn=aPossiblePrototype$2,En=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array}catch(t){}return function setPrototypeOf(r,i){return An(r),Rn(i),e?t.call(r,i):r.__proto__=i,r}}():void 0),Ln={},In=Ln,On=wellKnownSymbol$E("iterator"),Pn=Array.prototype,isArrayIteratorMethod$3=function(t){return void 0!==t&&(In.Array===t||Pn[On]===t)},Mn={};Mn[wellKnownSymbol$E("toStringTag")]="z";var Fn="[object z]"===String(Mn),zn=Fn,Un=classofRaw$1,Bn=wellKnownSymbol$E("toStringTag"),Dn="Arguments"==Un(function(){return arguments}()),jn=zn?Un:function(t){var e,r,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Bn))?r:Dn?Un(e):"Object"==(i=Un(e))&&"function"==typeof e.callee?"Arguments":i},Nn=jn,Wn=Ln,Hn=wellKnownSymbol$E("iterator"),getIteratorMethod$8=function(t){if(null!=t)return t[Hn]||t["@@iterator"]||Wn[Nn(t)]},Gn=anObject$1z,iteratorClose$4=function(t){var e=t.return;if(void 0!==e)return Gn(e.call(t)).value},Vn=anObject$1z,Yn=isArrayIteratorMethod$3,Xn=toLength$C,qn=functionBindContext,$n=getIteratorMethod$8,Zn=iteratorClose$4,Result=function(t,e){this.stopped=t,this.result=e},iterate$I=function(t,e,r){var i,n,s,o,u,h,l,f=r&&r.that,d=!(!r||!r.AS_ENTRIES),_=!(!r||!r.IS_ITERATOR),g=!(!r||!r.INTERRUPTED),p=qn(e,f,1+d+g),stop=function(t){return i&&Zn(i),new Result(!0,t)},callFn=function(t){return d?(Vn(t),g?p(t[0],t[1],stop):p(t[0],t[1])):g?p(t,stop):p(t)};if(_)i=t;else{if("function"!=typeof(n=$n(t)))throw TypeError("Target is not iterable");if(Yn(n)){for(s=0,o=Xn(t.length);o>s;s++)if((u=callFn(t[s]))&&u instanceof Result)return u;return new Result(!1)}i=n.call(t)}for(h=i.next;!(l=h.call(i)).done;){try{u=callFn(l.value)}catch(t){throw Zn(i),t}if("object"==typeof u&&u&&u instanceof Result)return u}return new Result(!1)},Kn=_export,Qn=Cn,Jn=En,ts=br,es=It,rs=createPropertyDescriptor$9,ns=iterate$I,ss=toString$s,os=function AggregateError(t,e){var r=this;if(!(r instanceof os))return new os(t,e);Jn&&(r=Jn(new Error(void 0),Qn(r))),void 0!==e&&es(r,"message",ss(e));var i=[];return ns(t,i.push,{that:i}),es(r,"errors",i),r};os.prototype=ts(Error.prototype,{constructor:rs(5,os),message:rs(5,""),name:rs(5,"AggregateError")}),Kn({global:!0},{AggregateError:os});var as=toPropertyKey$9,us=bt,hs=createPropertyDescriptor$9,createProperty$7=function(t,e,r){var i=as(e);i in t?us.f(t,i,hs(0,r)):t[i]=r},ls=fails$11,cs=w,fs=wellKnownSymbol$E("species"),arrayMethodHasSpeciesSupport$5=function(t){return cs>=51||!ls((function(){var e=[];return(e.constructor={})[fs]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},ds=_export,_s=fails$11,gs=sr,ps=isObject$C,vs=toObject$x,ys=toLength$C,xs=createProperty$7,ms=arraySpeciesCreate$6,Ss=arrayMethodHasSpeciesSupport$5,bs=w,ks=wellKnownSymbol$E("isConcatSpreadable"),Ts=9007199254740991,Cs="Maximum allowed index exceeded",ws=bs>=51||!_s((function(){var t=[];return t[ks]=!1,t.concat()[0]!==t})),As=Ss("concat"),isConcatSpreadable=function(t){if(!ps(t))return!1;var e=t[ks];return void 0!==e?!!e:gs(t)};ds({target:"Array",proto:!0,forced:!ws||!As},{concat:function concat(t){var e,r,i,n,s,o=vs(this),u=ms(o,0),h=0;for(e=-1,i=arguments.length;e<i;e++)if(isConcatSpreadable(s=-1===e?o:arguments[e])){if(h+(n=ys(s.length))>Ts)throw TypeError(Cs);for(r=0;r<n;r++,h++)r in s&&xs(u,h,s[r])}else{if(h>=Ts)throw TypeError(Cs);xs(u,h++,s)}return u.length=h,u}});var Rs=toObject$x,Es=toAbsoluteIndex$8,Ls=toLength$C,Is=Math.min,Os=[].copyWithin||function copyWithin(t,e){var r=Rs(this),i=Ls(r.length),n=Es(t,i),s=Es(e,i),o=arguments.length>2?arguments[2]:void 0,u=Is((void 0===o?i:Es(o,i))-s,i-n),h=1;for(s<n&&n<s+u&&(h=-1,s+=u-1,n+=u-1);u-- >0;)s in r?r[n]=r[s]:delete r[n],n+=h,s+=h;return r},Ps=br,Ms=bt,Fs=wellKnownSymbol$E("unscopables"),zs=Array.prototype;null==zs[Fs]&&Ms.f(zs,Fs,{configurable:!0,value:Ps(null)});var addToUnscopables$h=function(t){zs[Fs][t]=!0},Us=addToUnscopables$h;_export({target:"Array",proto:!0},{copyWithin:Os}),Us("copyWithin");var Bs=fails$11,arrayMethodIsStrict$9=function(t,e){var r=[][t];return!!r&&Bs((function(){r.call(null,e||function(){throw 1},1)}))},Ds=$r.every;_export({target:"Array",proto:!0,forced:!arrayMethodIsStrict$9("every")},{every:function every(t){return Ds(this,t,arguments.length>1?arguments[1]:void 0)}});var js=toObject$x,Ns=toAbsoluteIndex$8,Ws=toLength$C,Hs=function fill(t){for(var e=js(this),r=Ws(e.length),i=arguments.length,n=Ns(i>1?arguments[1]:void 0,r),s=i>2?arguments[2]:void 0,o=void 0===s?r:Ns(s,r);o>n;)e[n++]=t;return e},Gs=addToUnscopables$h;_export({target:"Array",proto:!0},{fill:Hs}),Gs("fill");var Vs=$r.filter;_export({target:"Array",proto:!0,forced:!arrayMethodHasSpeciesSupport$5("filter")},{filter:function filter(t){return Vs(this,t,arguments.length>1?arguments[1]:void 0)}});var Ys=_export,Xs=$r.find,qs=addToUnscopables$h,$s="find",Zs=!0;$s in[]&&Array(1).find((function(){Zs=!1})),Ys({target:"Array",proto:!0,forced:Zs},{find:function find(t){return Xs(this,t,arguments.length>1?arguments[1]:void 0)}}),qs($s);var Ks=_export,Qs=$r.findIndex,Js=addToUnscopables$h,to="findIndex",eo=!0;to in[]&&Array(1).findIndex((function(){eo=!1})),Ks({target:"Array",proto:!0,forced:eo},{findIndex:function findIndex(t){return Qs(this,t,arguments.length>1?arguments[1]:void 0)}}),Js(to);var ro=sr,io=toLength$C,no=functionBindContext,flattenIntoArray$2=function(t,e,r,i,n,s,o,u){for(var h,l=n,f=0,d=!!o&&no(o,u,3);f<i;){if(f in r){if(h=d?d(r[f],f,e):r[f],s>0&&ro(h))l=flattenIntoArray$2(t,e,h,io(h.length),l,s-1)-1;else{if(l>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[l]=h}l++}f++}return l},so=flattenIntoArray$2,oo=so,ao=toObject$x,uo=toLength$C,ho=toInteger$h,lo=arraySpeciesCreate$6;_export({target:"Array",proto:!0},{flat:function flat(){var t=arguments.length?arguments[0]:void 0,e=ao(this),r=uo(e.length),i=lo(e,0);return i.length=oo(i,e,e,r,0,void 0===t?1:ho(t)),i}});var co=so,fo=toObject$x,_o=toLength$C,go=aFunction$S,po=arraySpeciesCreate$6;_export({target:"Array",proto:!0},{flatMap:function flatMap(t){var e,r=fo(this),i=_o(r.length);return go(t),(e=po(r,0)).length=co(e,r,r,i,0,1,t,arguments.length>1?arguments[1]:void 0),e}});var vo=$r.forEach,yo=arrayMethodIsStrict$9("forEach")?[].forEach:function forEach(t){return vo(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=yo},{forEach:yo});var xo=anObject$1z,mo=iteratorClose$4,callWithSafeIterationClosing$3=function(t,e,r,i){try{return i?e(xo(r)[0],r[1]):e(r)}catch(e){throw mo(t),e}},So=functionBindContext,bo=toObject$x,ko=callWithSafeIterationClosing$3,To=isArrayIteratorMethod$3,Co=toLength$C,wo=createProperty$7,Ao=getIteratorMethod$8,Ro=function from(t){var e,r,i,n,s,o,u=bo(t),h="function"==typeof this?this:Array,l=arguments.length,f=l>1?arguments[1]:void 0,d=void 0!==f,_=Ao(u),g=0;if(d&&(f=So(f,l>2?arguments[2]:void 0,2)),null==_||h==Array&&To(_))for(r=new h(e=Co(u.length));e>g;g++)o=d?f(u[g],g):u[g],wo(r,g,o);else for(s=(n=_.call(u)).next,r=new h;!(i=s.call(n)).done;g++)o=d?ko(n,f,[i.value,g],!0):i.value,wo(r,g,o);return r.length=g,r},Eo=wellKnownSymbol$E("iterator"),Lo=!1;try{var Io=0,Oo={next:function(){return{done:!!Io++}},return:function(){Lo=!0}};Oo[Eo]=function(){return this},Array.from(Oo,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration$4=function(t,e){if(!e&&!Lo)return!1;var r=!1;try{var i={};i[Eo]=function(){return{next:function(){return{done:r=!0}}}},t(i)}catch(t){}return r},Po=Ro;_export({target:"Array",stat:!0,forced:!checkCorrectnessOfIteration$4((function(t){Array.from(t)}))},{from:Po});var Mo=we.includes,Fo=addToUnscopables$h;_export({target:"Array",proto:!0},{includes:function includes(t){return Mo(this,t,arguments.length>1?arguments[1]:void 0)}}),Fo("includes");var zo=_export,Uo=we.indexOf,Bo=arrayMethodIsStrict$9,Do=[].indexOf,jo=!!Do&&1/[1].indexOf(1,-0)<0,No=Bo("indexOf");zo({target:"Array",proto:!0,forced:jo||!No},{indexOf:function indexOf(t){return jo?Do.apply(this,arguments)||0:Uo(this,t,arguments.length>1?arguments[1]:void 0)}}),_export({target:"Array",stat:!0},{isArray:sr});var Wo,Ho,Go,Vo=fails$11,Yo=Cn,Xo=It,qo=G,$o=wellKnownSymbol$E("iterator"),Zo=!1;[].keys&&("next"in(Go=[].keys())?(Ho=Yo(Yo(Go)))!==Object.prototype&&(Wo=Ho):Zo=!0),(null==Wo||Vo((function(){var t={};return Wo[$o].call(t)!==t})))&&(Wo={}),qo(Wo,$o)||Xo(Wo,$o,(function(){return this}));var Ko={IteratorPrototype:Wo,BUGGY_SAFARI_ITERATORS:Zo},Qo=Ko.IteratorPrototype,Jo=br,ta=createPropertyDescriptor$9,ea=setToStringTag$b,ra=Ln,returnThis$1=function(){return this},createIteratorConstructor$7=function(t,e,r){var i=e+" Iterator";return t.prototype=Jo(Qo,{next:ta(1,r)}),ea(t,i,!1),ra[i]=returnThis$1,t},ia=_export,na=createIteratorConstructor$7,sa=Cn,oa=En,aa=setToStringTag$b,ua=It,ha=Ot.exports,la=Ln,ca=Ko.IteratorPrototype,fa=Ko.BUGGY_SAFARI_ITERATORS,da=wellKnownSymbol$E("iterator"),_a="keys",ga="values",pa="entries",returnThis=function(){return this},defineIterator$3=function(t,e,r,i,n,s,o){na(r,e,i);var u,h,l,getIterationMethod=function(t){if(t===n&&p)return p;if(!fa&&t in _)return _[t];switch(t){case _a:return function keys(){return new r(this,t)};case ga:return function values(){return new r(this,t)};case pa:return function entries(){return new r(this,t)}}return function(){return new r(this)}},f=e+" Iterator",d=!1,_=t.prototype,g=_[da]||_["@@iterator"]||n&&_[n],p=!fa&&g||getIterationMethod(n),v="Array"==e&&_.entries||g;if(v&&(u=sa(v.call(new t)),ca!==Object.prototype&&u.next&&(sa(u)!==ca&&(oa?oa(u,ca):"function"!=typeof u[da]&&ua(u,da,returnThis)),aa(u,f,!0))),n==ga&&g&&g.name!==ga&&(d=!0,p=function values(){return g.call(this)}),_[da]!==p&&ua(_,da,p),la[e]=p,n)if(h={values:getIterationMethod(ga),keys:s?p:getIterationMethod(_a),entries:getIterationMethod(pa)},o)for(l in h)(fa||d||!(l in _))&&ha(_,l,h[l]);else ia({target:e,proto:!0,forced:fa||d},h);return h},va=toIndexedObject$d,ya=addToUnscopables$h,xa=Ln,ma=oe,Sa=defineIterator$3,ba="Array Iterator",ka=ma.set,Ta=ma.getterFor(ba),Ca=Sa(Array,"Array",(function(t,e){ka(this,{type:ba,target:va(t),index:0,kind:e})}),(function(){var t=Ta(this),e=t.target,r=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values");xa.Arguments=xa.Array,ya("keys"),ya("values"),ya("entries");var wa=_export,Aa=toIndexedObject$d,Ra=[].join,Ea=g!=Object,La=arrayMethodIsStrict$9("join",",");wa({target:"Array",proto:!0,forced:Ea||!La},{join:function join(t){return Ra.call(Aa(this),void 0===t?",":t)}});var Ia=toIndexedObject$d,Oa=toInteger$h,Pa=toLength$C,Ma=arrayMethodIsStrict$9,Fa=Math.min,za=[].lastIndexOf,Ua=!!za&&1/[1].lastIndexOf(1,-0)<0,Ba=Ma("lastIndexOf"),Da=Ua||!Ba?function lastIndexOf(t){if(Ua)return za.apply(this,arguments)||0;var e=Ia(this),r=Pa(e.length),i=r-1;for(arguments.length>1&&(i=Fa(i,Oa(arguments[1]))),i<0&&(i=r+i);i>=0;i--)if(i in e&&e[i]===t)return i||0;return-1}:za;_export({target:"Array",proto:!0,forced:Da!==[].lastIndexOf},{lastIndexOf:Da});var ja=$r.map;_export({target:"Array",proto:!0,forced:!arrayMethodHasSpeciesSupport$5("map")},{map:function map(t){return ja(this,t,arguments.length>1?arguments[1]:void 0)}});var Na=createProperty$7;_export({target:"Array",stat:!0,forced:fails$11((function(){function F(){}return!(Array.of.call(F)instanceof F)}))},{of:function of(){for(var t=0,e=arguments.length,r=new("function"==typeof this?this:Array)(e);e>t;)Na(r,t,arguments[t++]);return r.length=e,r}});var Wa=aFunction$S,Ha=toObject$x,Ga=g,Va=toLength$C,createMethod$6=function(t){return function(e,r,i,n){Wa(r);var s=Ha(e),o=Ga(s),u=Va(s.length),h=t?u-1:0,l=t?-1:1;if(i<2)for(;;){if(h in o){n=o[h],h+=l;break}if(h+=l,t?h<0:u<=h)throw TypeError("Reduce of empty array with no initial value")}for(;t?h>=0:u>h;h+=l)h in o&&(n=r(n,o[h],h,s));return n}},Ya={left:createMethod$6(!1),right:createMethod$6(!0)},Xa="process"==classofRaw$1(e.process),qa=Ya.left,$a=w,Za=Xa;_export({target:"Array",proto:!0,forced:!arrayMethodIsStrict$9("reduce")||!Za&&$a>79&&$a<83},{reduce:function reduce(t){return qa(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Ka=Ya.right,Qa=w,Ja=Xa;_export({target:"Array",proto:!0,forced:!arrayMethodIsStrict$9("reduceRight")||!Ja&&Qa>79&&Qa<83},{reduceRight:function reduceRight(t){return Ka(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var tu=sr,eu=[].reverse,ru=[1,2];_export({target:"Array",proto:!0,forced:String(ru)===String(ru.reverse())},{reverse:function reverse(){return tu(this)&&(this.length=this.length),eu.call(this)}});var iu=_export,nu=isObject$C,su=sr,ou=toAbsoluteIndex$8,au=toLength$C,uu=toIndexedObject$d,hu=createProperty$7,lu=wellKnownSymbol$E,cu=arrayMethodHasSpeciesSupport$5("slice"),fu=lu("species"),du=[].slice,_u=Math.max;iu({target:"Array",proto:!0,forced:!cu},{slice:function slice(t,e){var r,i,n,s=uu(this),o=au(s.length),u=ou(t,o),h=ou(void 0===e?o:e,o);if(su(s)&&("function"!=typeof(r=s.constructor)||r!==Array&&!su(r.prototype)?nu(r)&&null===(r=r[fu])&&(r=void 0):r=void 0,r===Array||void 0===r))return du.call(s,u,h);for(i=new(void 0===r?Array:r)(_u(h-u,0)),n=0;u<h;u++,n++)u in s&&hu(i,n,s[u]);return i.length=n,i}});var gu=$r.some;_export({target:"Array",proto:!0,forced:!arrayMethodIsStrict$9("some")},{some:function some(t){return gu(this,t,arguments.length>1?arguments[1]:void 0)}});var pu=Math.floor,mergeSort=function(t,e){var r=t.length,i=pu(r/2);return r<8?insertionSort(t,e):merge(mergeSort(t.slice(0,i),e),mergeSort(t.slice(i),e),e)},insertionSort=function(t,e){for(var r,i,n=t.length,s=1;s<n;){for(i=s,r=t[s];i&&e(t[i-1],r)>0;)t[i]=t[--i];i!==s++&&(t[i]=r)}return t},merge=function(t,e,r){for(var i=t.length,n=e.length,s=0,o=0,u=[];s<i||o<n;)s<i&&o<n?u.push(r(t[s],e[o])<=0?t[s++]:e[o++]):u.push(s<i?t[s++]:e[o++]);return u},vu=mergeSort,yu=x.match(/firefox\/(\d+)/i),xu=!!yu&&+yu[1],mu=/MSIE|Trident/.test(x),Su=x.match(/AppleWebKit\/(\d+)\./),bu=!!Su&&+Su[1],ku=_export,Tu=aFunction$S,Cu=toObject$x,wu=toLength$C,Au=toString$s,Ru=fails$11,Eu=vu,Lu=arrayMethodIsStrict$9,Iu=xu,Ou=mu,Pu=w,Mu=bu,Fu=[],zu=Fu.sort,Uu=Ru((function(){Fu.sort(void 0)})),Bu=Ru((function(){Fu.sort(null)})),Du=Lu("sort"),ju=!Ru((function(){if(Pu)return Pu<70;if(!(Iu&&Iu>3)){if(Ou)return!0;if(Mu)return Mu<603;var t,e,r,i,n="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)Fu.push({k:e+i,v:r})}for(Fu.sort((function(t,e){return e.v-t.v})),i=0;i<Fu.length;i++)e=Fu[i].k.charAt(0),n.charAt(n.length-1)!==e&&(n+=e);return"DGBEFHACIJK"!==n}}));ku({target:"Array",proto:!0,forced:Uu||!Bu||!Du||!ju},{sort:function sort(t){void 0!==t&&Tu(t);var e=Cu(this);if(ju)return void 0===t?zu.call(e):zu.call(e,t);var r,i,n=[],s=wu(e.length);for(i=0;i<s;i++)i in e&&n.push(e[i]);for(r=(n=Eu(n,function(t){return function(e,r){return void 0===r?-1:void 0===e?1:void 0!==t?+t(e,r)||0:Au(e)>Au(r)?1:-1}}(t))).length,i=0;i<r;)e[i]=n[i++];for(;i<s;)delete e[i++];return e}});var Nu=getBuiltIn$u,Wu=bt,Hu=i,Gu=wellKnownSymbol$E("species"),setSpecies$7=function(t){var e=Nu(t),r=Wu.f;Hu&&e&&!e[Gu]&&r(e,Gu,{configurable:!0,get:function(){return this}})};setSpecies$7("Array");var Vu=_export,Yu=toAbsoluteIndex$8,Xu=toInteger$h,qu=toLength$C,$u=toObject$x,Zu=arraySpeciesCreate$6,Ku=createProperty$7,Qu=arrayMethodHasSpeciesSupport$5("splice"),Ju=Math.max,th=Math.min,eh=9007199254740991,rh="Maximum allowed length exceeded";Vu({target:"Array",proto:!0,forced:!Qu},{splice:function splice(t,e){var r,i,n,s,o,u,h=$u(this),l=qu(h.length),f=Yu(t,l),d=arguments.length;if(0===d?r=i=0:1===d?(r=0,i=l-f):(r=d-2,i=th(Ju(Xu(e),0),l-f)),l+r-i>eh)throw TypeError(rh);for(n=Zu(h,i),s=0;s<i;s++)(o=f+s)in h&&Ku(n,s,h[o]);if(n.length=i,r<i){for(s=f;s<l-i;s++)u=s+r,(o=s+i)in h?h[u]=h[o]:delete h[u];for(s=l;s>l-i+r;s--)delete h[s-1]}else if(r>i)for(s=l-i;s>f;s--)u=s+r-1,(o=s+i-1)in h?h[u]=h[o]:delete h[u];for(s=0;s<r;s++)h[s+f]=arguments[s+2];return h.length=l-i+r,n}}),addToUnscopables$h("flat"),addToUnscopables$h("flatMap");var ih="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,nh=Ot.exports,redefineAll$9=function(t,e,r){for(var i in e)nh(t,i,e[i],r);return t},anInstance$b=function(t,e,r){if(!(t instanceof e))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return t},sh=toInteger$h,oh=toLength$C,toIndex$2=function(t){if(void 0===t)return 0;var e=sh(t),r=oh(e);if(e!==r)throw RangeError("Wrong length or index");return r},ah=Math.abs,uh=Math.pow,hh=Math.floor,lh=Math.log,ch=Math.LN2,fh=e,dh=i,_h=ih,gh=It,ph=redefineAll$9,vh=fails$11,yh=anInstance$b,xh=toInteger$h,mh=toLength$C,Sh=toIndex$2,bh={pack:function(t,e,r){var i,n,s,o=new Array(r),u=8*r-e-1,h=(1<<u)-1,l=h>>1,f=23===e?uh(2,-24)-uh(2,-77):0,d=t<0||0===t&&1/t<0?1:0,_=0;for((t=ah(t))!=t||t===1/0?(n=t!=t?1:0,i=h):(i=hh(lh(t)/ch),t*(s=uh(2,-i))<1&&(i--,s*=2),(t+=i+l>=1?f/s:f*uh(2,1-l))*s>=2&&(i++,s/=2),i+l>=h?(n=0,i=h):i+l>=1?(n=(t*s-1)*uh(2,e),i+=l):(n=t*uh(2,l-1)*uh(2,e),i=0));e>=8;o[_++]=255&n,n/=256,e-=8);for(i=i<<e|n,u+=e;u>0;o[_++]=255&i,i/=256,u-=8);return o[--_]|=128*d,o},unpack:function(t,e){var r,i=t.length,n=8*i-e-1,s=(1<<n)-1,o=s>>1,u=n-7,h=i-1,l=t[h--],f=127&l;for(l>>=7;u>0;f=256*f+t[h],h--,u-=8);for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;r=256*r+t[h],h--,u-=8);if(0===f)f=1-o;else{if(f===s)return r?NaN:l?-1/0:1/0;r+=uh(2,e),f-=o}return(l?-1:1)*r*uh(2,f-e)}},kh=Cn,Th=En,Ch=ge.f,wh=bt.f,Ah=Hs,Rh=setToStringTag$b,Eh=oe.get,Lh=oe.set,Ih="ArrayBuffer",Oh="DataView",Ph="Wrong index",Mh=fh.ArrayBuffer,Fh=Mh,zh=fh.DataView,Uh=zh&&zh.prototype,Bh=Object.prototype,Dh=fh.RangeError,jh=bh.pack,Nh=bh.unpack,packInt8=function(t){return[255&t]},packInt16=function(t){return[255&t,t>>8&255]},packInt32=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},unpackInt32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},packFloat32=function(t){return jh(t,23,4)},packFloat64=function(t){return jh(t,52,8)},addGetter$1=function(t,e){wh(t.prototype,e,{get:function(){return Eh(this)[e]}})},get$1=function(t,e,r,i){var n=Sh(r),s=Eh(t);if(n+e>s.byteLength)throw Dh(Ph);var o=Eh(s.buffer).bytes,u=n+s.byteOffset,h=o.slice(u,u+e);return i?h:h.reverse()},set$2=function(t,e,r,i,n,s){var o=Sh(r),u=Eh(t);if(o+e>u.byteLength)throw Dh(Ph);for(var h=Eh(u.buffer).bytes,l=o+u.byteOffset,f=i(+n),d=0;d<e;d++)h[l+d]=f[s?d:e-d-1]};if(_h){if(!vh((function(){Mh(1)}))||!vh((function(){new Mh(-1)}))||vh((function(){return new Mh,new Mh(1.5),new Mh(NaN),Mh.name!=Ih}))){for(var Wh,Hh=(Fh=function ArrayBuffer(t){return yh(this,Fh),new Mh(Sh(t))}).prototype=Mh.prototype,Gh=Ch(Mh),Vh=0;Gh.length>Vh;)(Wh=Gh[Vh++])in Fh||gh(Fh,Wh,Mh[Wh]);Hh.constructor=Fh}Th&&kh(Uh)!==Bh&&Th(Uh,Bh);var Yh=new zh(new Fh(2)),Xh=Uh.setInt8;Yh.setInt8(0,2147483648),Yh.setInt8(1,2147483649),!Yh.getInt8(0)&&Yh.getInt8(1)||ph(Uh,{setInt8:function setInt8(t,e){Xh.call(this,t,e<<24>>24)},setUint8:function setUint8(t,e){Xh.call(this,t,e<<24>>24)}},{unsafe:!0})}else Fh=function ArrayBuffer(t){yh(this,Fh,Ih);var e=Sh(t);Lh(this,{bytes:Ah.call(new Array(e),0),byteLength:e}),dh||(this.byteLength=e)},zh=function DataView(t,e,r){yh(this,zh,Oh),yh(t,Fh,Oh);var i=Eh(t).byteLength,n=xh(e);if(n<0||n>i)throw Dh("Wrong offset");if(n+(r=void 0===r?i-n:mh(r))>i)throw Dh("Wrong length");Lh(this,{buffer:t,byteLength:r,byteOffset:n}),dh||(this.buffer=t,this.byteLength=r,this.byteOffset=n)},dh&&(addGetter$1(Fh,"byteLength"),addGetter$1(zh,"buffer"),addGetter$1(zh,"byteLength"),addGetter$1(zh,"byteOffset")),ph(zh.prototype,{getInt8:function getInt8(t){return get$1(this,1,t)[0]<<24>>24},getUint8:function getUint8(t){return get$1(this,1,t)[0]},getInt16:function getInt16(t){var e=get$1(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function getUint16(t){var e=get$1(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function getInt32(t){return unpackInt32(get$1(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function getUint32(t){return unpackInt32(get$1(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function getFloat32(t){return Nh(get$1(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function getFloat64(t){return Nh(get$1(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function setInt8(t,e){set$2(this,1,t,packInt8,e)},setUint8:function setUint8(t,e){set$2(this,1,t,packInt8,e)},setInt16:function setInt16(t,e){set$2(this,2,t,packInt16,e,arguments.length>2?arguments[2]:void 0)},setUint16:function setUint16(t,e){set$2(this,2,t,packInt16,e,arguments.length>2?arguments[2]:void 0)},setInt32:function setInt32(t,e){set$2(this,4,t,packInt32,e,arguments.length>2?arguments[2]:void 0)},setUint32:function setUint32(t,e){set$2(this,4,t,packInt32,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function setFloat32(t,e){set$2(this,4,t,packFloat32,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function setFloat64(t,e){set$2(this,8,t,packFloat64,e,arguments.length>2?arguments[2]:void 0)}});Rh(Fh,Ih),Rh(zh,Oh);var qh={ArrayBuffer:Fh,DataView:zh},$h=setSpecies$7,Zh="ArrayBuffer",Kh=qh.ArrayBuffer;_export({global:!0,forced:e.ArrayBuffer!==Kh},{ArrayBuffer:Kh}),$h(Zh);var Qh,Jh,tl,el=ih,rl=i,il=e,nl=isObject$C,sl=G,ol=jn,al=It,ul=Ot.exports,hl=bt.f,ll=Cn,cl=En,fl=wellKnownSymbol$E,dl=uid$5,_l=il.Int8Array,gl=_l&&_l.prototype,pl=il.Uint8ClampedArray,vl=pl&&pl.prototype,yl=_l&&ll(_l),xl=gl&&ll(gl),ml=Object.prototype,Sl=ml.isPrototypeOf,bl=fl("toStringTag"),kl=dl("TYPED_ARRAY_TAG"),Tl=dl("TYPED_ARRAY_CONSTRUCTOR"),Cl=el&&!!cl&&"Opera"!==ol(il.opera),wl=!1,Al={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Rl={BigInt64Array:8,BigUint64Array:8},isTypedArray$1=function(t){if(!nl(t))return!1;var e=ol(t);return sl(Al,e)||sl(Rl,e)};for(Qh in Al)(tl=(Jh=il[Qh])&&Jh.prototype)?al(tl,Tl,Jh):Cl=!1;for(Qh in Rl)(tl=(Jh=il[Qh])&&Jh.prototype)&&al(tl,Tl,Jh);if((!Cl||"function"!=typeof yl||yl===Function.prototype)&&(yl=function TypedArray(){throw TypeError("Incorrect invocation")},Cl))for(Qh in Al)il[Qh]&&cl(il[Qh],yl);if((!Cl||!xl||xl===ml)&&(xl=yl.prototype,Cl))for(Qh in Al)il[Qh]&&cl(il[Qh].prototype,xl);if(Cl&&ll(vl)!==xl&&cl(vl,xl),rl&&!sl(xl,bl))for(Qh in wl=!0,hl(xl,bl,{get:function(){return nl(this)?this[kl]:void 0}}),Al)il[Qh]&&al(il[Qh],kl,Qh);var El={NATIVE_ARRAY_BUFFER_VIEWS:Cl,TYPED_ARRAY_CONSTRUCTOR:Tl,TYPED_ARRAY_TAG:wl&&kl,aTypedArray:function(t){if(isTypedArray$1(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(cl&&!Sl.call(yl,t))throw TypeError("Target is not a typed array constructor");return t},exportTypedArrayMethod:function(t,e,r){if(rl){if(r)for(var i in Al){var n=il[i];if(n&&sl(n.prototype,t))try{delete n.prototype[t]}catch(t){}}xl[t]&&!r||ul(xl,t,r?e:Cl&&gl[t]||e)}},exportTypedArrayStaticMethod:function(t,e,r){var i,n;if(rl){if(cl){if(r)for(i in Al)if((n=il[i])&&sl(n,t))try{delete n[t]}catch(t){}if(yl[t]&&!r)return;try{return ul(yl,t,r?e:Cl&&yl[t]||e)}catch(t){}}for(i in Al)!(n=il[i])||n[t]&&!r||ul(n,t,e)}},isView:function isView(t){if(!nl(t))return!1;var e=ol(t);return"DataView"===e||sl(Al,e)||sl(Rl,e)},isTypedArray:isTypedArray$1,TypedArray:yl,TypedArrayPrototype:xl};_export({target:"ArrayBuffer",stat:!0,forced:!El.NATIVE_ARRAY_BUFFER_VIEWS},{isView:El.isView});var Ll=anObject$1z,Il=aFunction$S,Ol=wellKnownSymbol$E("species"),speciesConstructor$f=function(t,e){var r,i=Ll(t).constructor;return void 0===i||null==(r=Ll(i)[Ol])?e:Il(r)},Pl=_export,Ml=fails$11,Fl=anObject$1z,zl=toAbsoluteIndex$8,Ul=toLength$C,Bl=speciesConstructor$f,Dl=qh.ArrayBuffer,jl=qh.DataView,Nl=Dl.prototype.slice;Pl({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Ml((function(){return!new Dl(2).slice(1,void 0).byteLength}))},{slice:function slice(t,e){if(void 0!==Nl&&void 0===e)return Nl.call(Fl(this),t);for(var r=Fl(this).byteLength,i=zl(t,r),n=zl(void 0===e?r:e,r),s=new(Bl(this,Dl))(Ul(n-i)),o=new jl(this),u=new jl(s),h=0;i<n;)u.setUint8(h++,o.getUint8(i++));return s}}),_export({global:!0,forced:!ih},{DataView:qh.DataView});var Wl=_export,Hl=fails$11((function(){return 120!==new Date(16e11).getYear()})),Gl=Date.prototype.getFullYear;Wl({target:"Date",proto:!0,forced:Hl},{getYear:function getYear(){return Gl.call(this)-1900}}),_export({target:"Date",stat:!0},{now:function now(){return(new Date).getTime()}});var Vl=_export,Yl=toInteger$h,Xl=Date.prototype.getTime,ql=Date.prototype.setFullYear;Vl({target:"Date",proto:!0},{setYear:function setYear(t){Xl.call(this);var e=Yl(t),r=0<=e&&e<=99?e+1900:e;return ql.call(this,r)}}),_export({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString});var $l=toInteger$h,Zl=toString$s,Kl=requireObjectCoercible$i,Ql=function repeat(t){var e=Zl(Kl(this)),r="",i=$l(t);if(i<0||i==1/0)throw RangeError("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(e+=e))1&i&&(r+=e);return r},Jl=toLength$C,tc=toString$s,ec=Ql,rc=requireObjectCoercible$i,ic=Math.ceil,createMethod$5=function(t){return function(e,r,i){var n,s,o=tc(rc(e)),u=o.length,h=void 0===i?" ":tc(i),l=Jl(r);return l<=u||""==h?o:(n=l-u,(s=ec.call(h,ic(n/h.length))).length>n&&(s=s.slice(0,n)),t?o+s:s+o)}},nc={start:createMethod$5(!1),end:createMethod$5(!0)},sc=fails$11,oc=nc.start,ac=Math.abs,uc=Date.prototype,hc=uc.getTime,lc=uc.toISOString,cc=sc((function(){return"0385-07-25T07:06:39.999Z"!=lc.call(new Date(-50000000000001))}))||!sc((function(){lc.call(new Date(NaN))}))?function toISOString(){if(!isFinite(hc.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),r=t.getUTCMilliseconds(),i=e<0?"-":e>9999?"+":"";return i+oc(ac(e),i?6:4,0)+"-"+oc(t.getUTCMonth()+1,2,0)+"-"+oc(t.getUTCDate(),2,0)+"T"+oc(t.getUTCHours(),2,0)+":"+oc(t.getUTCMinutes(),2,0)+":"+oc(t.getUTCSeconds(),2,0)+"."+oc(r,3,0)+"Z"}:lc;_export({target:"Date",proto:!0,forced:Date.prototype.toISOString!==cc},{toISOString:cc});var fc=toObject$x,dc=toPrimitive$3;_export({target:"Date",proto:!0,forced:fails$11((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function toJSON(t){var e=fc(this),r=dc(e,"number");return"number"!=typeof r||isFinite(r)?e.toISOString():null}});var _c=anObject$1z,pc=ordinaryToPrimitive$2,vc=It,dateToPrimitive=function(t){if(_c(this),"string"===t||"default"===t)t="string";else if("number"!==t)throw TypeError("Incorrect hint");return pc(this,t)},yc=wellKnownSymbol$E("toPrimitive"),xc=Date.prototype;yc in xc||vc(xc,yc,dateToPrimitive);var mc=Ot.exports,Sc=Date.prototype,bc="Invalid Date",kc="toString",Tc=Sc.toString,Cc=Sc.getTime;String(new Date(NaN))!=bc&&mc(Sc,kc,(function toString(){var t=Cc.call(this);return t==t?Tc.call(this):bc}));var wc=toString$s,Ac=/[\w*+\-./@]/,hex$1=function(t,e){for(var r=t.toString(16);r.length<e;)r="0"+r;return r};_export({global:!0},{escape:function escape(t){for(var e,r,i=wc(t),n="",s=i.length,o=0;o<s;)e=i.charAt(o++),Ac.test(e)?n+=e:n+=(r=e.charCodeAt(0))<256?"%"+hex$1(r,2):"%u"+hex$1(r,4).toUpperCase();return n}});var Rc=aFunction$S,Ec=isObject$C,Lc=[].slice,Ic={},construct=function(t,e,r){if(!(e in Ic)){for(var i=[],n=0;n<e;n++)i[n]="a["+n+"]";Ic[e]=Function("C,a","return new C("+i.join(",")+")")}return Ic[e](t,r)},Oc=Function.bind||function bind(t){var e=Rc(this),r=Lc.call(arguments,1),i=function bound(){var n=r.concat(Lc.call(arguments));return this instanceof i?construct(e,n.length,n):e.apply(t,n)};return Ec(e.prototype)&&(i.prototype=e.prototype),i};_export({target:"Function",proto:!0},{bind:Oc});var Pc=isObject$C,Mc=bt,Fc=Cn,zc=wellKnownSymbol$E("hasInstance"),Uc=Function.prototype;zc in Uc||Mc.f(Uc,zc,{value:function(t){if("function"!=typeof this||!Pc(t))return!1;if(!Pc(this.prototype))return t instanceof this;for(;t=Fc(t);)if(this.prototype===t)return!0;return!1}});var Bc=i,Dc=bt.f,jc=Function.prototype,Nc=jc.toString,Wc=/^\s*function ([^ (]*)/,Hc="name";Bc&&!(Hc in jc)&&Dc(jc,Hc,{configurable:!0,get:function(){try{return Nc.call(this).match(Wc)[1]}catch(t){return""}}}),_export({global:!0},{globalThis:e});var Gc=_export,Vc=fails$11,Yc=getBuiltIn$u("JSON","stringify"),Xc=/[\uD800-\uDFFF]/g,qc=/^[\uD800-\uDBFF]$/,$c=/^[\uDC00-\uDFFF]$/,fix=function(t,e,r){var i=r.charAt(e-1),n=r.charAt(e+1);return qc.test(t)&&!$c.test(n)||$c.test(t)&&!qc.test(i)?"\\u"+t.charCodeAt(0).toString(16):t},Zc=Vc((function(){return'"\\udf06\\ud834"'!==Yc("\udf06\ud834")||'"\\udead"'!==Yc("\udead")}));Yc&&Gc({target:"JSON",stat:!0,forced:Zc},{stringify:function stringify(t,e,r){var i=Yc.apply(null,arguments);return"string"==typeof i?i.replace(Xc,fix):i}}),setToStringTag$b(e.JSON,"JSON",!0);var Kc={exports:{}},Qc=!fails$11((function(){return Object.isExtensible(Object.preventExtensions({}))})),Jc=_export,tf=Vt,ef=isObject$C,rf=G,nf=bt.f,sf=ge,af=kr,uf=Qc,hf=!1,lf=uid$5("meta"),cf=0,ff=Object.isExtensible||function(){return!0},setMetadata=function(t){nf(t,lf,{value:{objectID:"O"+cf++,weakData:{}}})},df=Kc.exports={enable:function(){df.enable=function(){},hf=!0;var t=sf.f,e=[].splice,r={};r[lf]=1,t(r).length&&(sf.f=function(r){for(var i=t(r),n=0,s=i.length;n<s;n++)if(i[n]===lf){e.call(i,n,1);break}return i},Jc({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:af.f}))},fastKey:function(t,e){if(!ef(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!rf(t,lf)){if(!ff(t))return"F";if(!e)return"E";setMetadata(t)}return t[lf].objectID},getWeakData:function(t,e){if(!rf(t,lf)){if(!ff(t))return!0;if(!e)return!1;setMetadata(t)}return t[lf].weakData},onFreeze:function(t){return uf&&hf&&ff(t)&&!rf(t,lf)&&setMetadata(t),t}};tf[lf]=!0;var _f=isObject$C,gf=En,inheritIfRequired$4=function(t,e,r){var i,n;return gf&&"function"==typeof(i=e.constructor)&&i!==r&&_f(n=i.prototype)&&n!==r.prototype&&gf(t,n),t},pf=_export,vf=e,yf=Ze,xf=Ot.exports,Sf=Kc.exports,bf=iterate$I,kf=anInstance$b,Tf=isObject$C,Cf=fails$11,wf=checkCorrectnessOfIteration$4,Af=setToStringTag$b,Rf=inheritIfRequired$4,collection$4=function(t,e,r){var i=-1!==t.indexOf("Map"),n=-1!==t.indexOf("Weak"),s=i?"set":"add",o=vf[t],u=o&&o.prototype,h=o,l={},fixMethod=function(t){var e=u[t];xf(u,t,"add"==t?function add(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(n&&!Tf(t))&&e.call(this,0===t?0:t)}:"get"==t?function get(t){return n&&!Tf(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function has(t){return!(n&&!Tf(t))&&e.call(this,0===t?0:t)}:function set(t,r){return e.call(this,0===t?0:t,r),this})};if(yf(t,"function"!=typeof o||!(n||u.forEach&&!Cf((function(){(new o).entries().next()})))))h=r.getConstructor(e,t,i,s),Sf.enable();else if(yf(t,!0)){var f=new h,d=f[s](n?{}:-0,1)!=f,_=Cf((function(){f.has(1)})),g=wf((function(t){new o(t)})),p=!n&&Cf((function(){for(var t=new o,e=5;e--;)t[s](e,e);return!t.has(-0)}));g||((h=e((function(e,r){kf(e,h,t);var n=Rf(new o,e,h);return null!=r&&bf(r,n[s],{that:n,AS_ENTRIES:i}),n}))).prototype=u,u.constructor=h),(_||p)&&(fixMethod("delete"),fixMethod("has"),i&&fixMethod("get")),(p||d)&&fixMethod(s),n&&u.clear&&delete u.clear}return l[t]=h,pf({global:!0,forced:h!=o},l),Af(h,t),n||r.setStrong(h,t,i),h},Ef=bt.f,Lf=br,If=redefineAll$9,Of=functionBindContext,Pf=anInstance$b,Mf=iterate$I,Ff=defineIterator$3,zf=setSpecies$7,Uf=i,Bf=Kc.exports.fastKey,Df=oe.set,jf=oe.getterFor,Nf={getConstructor:function(t,e,r,i){var n=t((function(t,s){Pf(t,n,e),Df(t,{type:e,index:Lf(null),first:void 0,last:void 0,size:0}),Uf||(t.size=0),null!=s&&Mf(s,t[i],{that:t,AS_ENTRIES:r})})),s=jf(e),define=function(t,e,r){var i,n,o=s(t),u=getEntry(t,e);return u?u.value=r:(o.last=u={index:n=Bf(e,!0),key:e,value:r,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=u),i&&(i.next=u),Uf?o.size++:t.size++,"F"!==n&&(o.index[n]=u)),t},getEntry=function(t,e){var r,i=s(t),n=Bf(e);if("F"!==n)return i.index[n];for(r=i.first;r;r=r.next)if(r.key==e)return r};return If(n.prototype,{clear:function clear(){for(var t=s(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,Uf?t.size=0:this.size=0},delete:function(t){var e=this,r=s(e),i=getEntry(e,t);if(i){var n=i.next,o=i.previous;delete r.index[i.index],i.removed=!0,o&&(o.next=n),n&&(n.previous=o),r.first==i&&(r.first=n),r.last==i&&(r.last=o),Uf?r.size--:e.size--}return!!i},forEach:function forEach(t){for(var e,r=s(this),i=Of(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.next:r.first;)for(i(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function has(t){return!!getEntry(this,t)}}),If(n.prototype,r?{get:function get(t){var e=getEntry(this,t);return e&&e.value},set:function set(t,e){return define(this,0===t?0:t,e)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),Uf&&Ef(n.prototype,"size",{get:function(){return s(this).size}}),n},setStrong:function(t,e,r){var i=e+" Iterator",n=jf(e),s=jf(i);Ff(t,e,(function(t,e){Df(this,{type:i,target:t,state:n(t),kind:e,last:void 0})}),(function(){for(var t=s(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?"keys"==e?{value:r.key,done:!1}:"values"==e?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),zf(e)}},Wf=collection$4("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),Nf),Hf=Math.log,Gf=Math.log1p||function log1p(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Hf(1+t)},Vf=_export,Yf=Gf,Xf=Math.acosh,qf=Math.log,$f=Math.sqrt,Zf=Math.LN2;Vf({target:"Math",stat:!0,forced:!Xf||710!=Math.floor(Xf(Number.MAX_VALUE))||Xf(1/0)!=1/0},{acosh:function acosh(t){return(t=+t)<1?NaN:t>94906265.62425156?qf(t)+Zf:Yf(t-1+$f(t-1)*$f(t+1))}});var Kf=_export,Qf=Math.asinh,Jf=Math.log,td=Math.sqrt;Kf({target:"Math",stat:!0,forced:!(Qf&&1/Qf(0)>0)},{asinh:function asinh(t){return isFinite(t=+t)&&0!=t?t<0?-asinh(-t):Jf(t+td(t*t+1)):t}});var ed=_export,rd=Math.atanh,id=Math.log;ed({target:"Math",stat:!0,forced:!(rd&&1/rd(-0)<0)},{atanh:function atanh(t){return 0==(t=+t)?t:id((1+t)/(1-t))/2}});var nd=Math.sign||function sign(t){return 0==(t=+t)||t!=t?t:t<0?-1:1},sd=_export,od=nd,ad=Math.abs,ud=Math.pow;sd({target:"Math",stat:!0},{cbrt:function cbrt(t){return od(t=+t)*ud(ad(t),1/3)}});var hd=_export,ld=Math.floor,cd=Math.log,fd=Math.LOG2E;hd({target:"Math",stat:!0},{clz32:function clz32(t){return(t>>>=0)?31-ld(cd(t+.5)*fd):32}});var dd=Math.expm1,_d=Math.exp,gd=!dd||dd(10)>22025.465794806718||dd(10)<22025.465794806718||-2e-17!=dd(-2e-17)?function expm1(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:_d(t)-1}:dd,pd=_export,vd=gd,yd=Math.cosh,xd=Math.abs,md=Math.E;pd({target:"Math",stat:!0,forced:!yd||yd(710)===1/0},{cosh:function cosh(t){var e=vd(xd(t)-1)+1;return(e+1/(e*md*md))*(md/2)}});var Sd=gd;_export({target:"Math",stat:!0,forced:Sd!=Math.expm1},{expm1:Sd});var bd=nd,kd=Math.abs,Td=Math.pow,Cd=Td(2,-52),wd=Td(2,-23),Ad=Td(2,127)*(2-wd),Rd=Td(2,-126),Ed=Math.fround||function fround(t){var e,r,i=kd(t),n=bd(t);return i<Rd?n*(i/Rd/wd+1/Cd-1/Cd)*Rd*wd:(r=(e=(1+wd/Cd)*i)-(e-i))>Ad||r!=r?n*(1/0):n*r};_export({target:"Math",stat:!0},{fround:Ed});var Ld=_export,Id=Math.hypot,Od=Math.abs,Pd=Math.sqrt;Ld({target:"Math",stat:!0,forced:!!Id&&Id(1/0,NaN)!==1/0},{hypot:function hypot(t,e){for(var r,i,n=0,s=0,o=arguments.length,u=0;s<o;)u<(r=Od(arguments[s++]))?(n=n*(i=u/r)*i+1,u=r):n+=r>0?(i=r/u)*i:r;return u===1/0?1/0:u*Pd(n)}});var Md=_export,Fd=fails$11,zd=Math.imul;Md({target:"Math",stat:!0,forced:Fd((function(){return-5!=zd(4294967295,5)||2!=zd.length}))},{imul:function imul(t,e){var r=65535,i=+t,n=+e,s=r&i,o=r&n;return 0|s*o+((r&i>>>16)*o+s*(r&n>>>16)<<16>>>0)}});var Ud=_export,Bd=Math.log,Dd=Math.LOG10E;Ud({target:"Math",stat:!0},{log10:function log10(t){return Bd(t)*Dd}}),_export({target:"Math",stat:!0},{log1p:Gf});var jd=_export,Nd=Math.log,Wd=Math.LN2;jd({target:"Math",stat:!0},{log2:function log2(t){return Nd(t)/Wd}}),_export({target:"Math",stat:!0},{sign:nd});var Hd=_export,Gd=fails$11,Vd=gd,Yd=Math.abs,Xd=Math.exp,qd=Math.E;Hd({target:"Math",stat:!0,forced:Gd((function(){return-2e-17!=Math.sinh(-2e-17)}))},{sinh:function sinh(t){return Yd(t=+t)<1?(Vd(t)-Vd(-t))/2:(Xd(t-1)-Xd(-t-1))*(qd/2)}});var $d=_export,Zd=gd,Kd=Math.exp;$d({target:"Math",stat:!0},{tanh:function tanh(t){var e=Zd(t=+t),r=Zd(-t);return e==1/0?1:r==1/0?-1:(e-r)/(Kd(t)+Kd(-t))}}),setToStringTag$b(Math,"Math",!0);var Qd=_export,Jd=Math.ceil,t_=Math.floor;Qd({target:"Math",stat:!0},{trunc:function trunc(t){return(t>0?t_:Jd)(t)}});var e_="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",r_=requireObjectCoercible$i,i_=toString$s,n_="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",s_=RegExp("^"+n_+n_+"*"),o_=RegExp(n_+n_+"*$"),createMethod$4=function(t){return function(e){var r=i_(r_(e));return 1&t&&(r=r.replace(s_,"")),2&t&&(r=r.replace(o_,"")),r}},a_={start:createMethod$4(1),end:createMethod$4(2),trim:createMethod$4(3)},u_=i,h_=e,l_=Ze,c_=Ot.exports,f_=G,d_=classofRaw$1,__=inheritIfRequired$4,g_=O,p_=toPrimitive$3,v_=fails$11,y_=br,x_=ge.f,m_=r.f,S_=bt.f,b_=a_.trim,k_="Number",T_=h_.Number,C_=T_.prototype,w_=d_(y_(C_))==k_,toNumber=function(t){if(g_(t))throw TypeError("Cannot convert a Symbol value to a number");var e,r,i,n,s,o,u,h,l=p_(t,"number");if("string"==typeof l&&l.length>2)if(43===(e=(l=b_(l)).charCodeAt(0))||45===e){if(88===(r=l.charCodeAt(2))||120===r)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:i=2,n=49;break;case 79:case 111:i=8,n=55;break;default:return+l}for(o=(s=l.slice(2)).length,u=0;u<o;u++)if((h=s.charCodeAt(u))<48||h>n)return NaN;return parseInt(s,i)}return+l};if(l_(k_,!T_(" 0o1")||!T_("0b1")||T_("+0x1"))){for(var A_,R_=function Number(t){var e=arguments.length<1?0:t,r=this;return r instanceof R_&&(w_?v_((function(){C_.valueOf.call(r)})):d_(r)!=k_)?__(new T_(toNumber(e)),r,R_):toNumber(e)},E_=u_?x_(T_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),L_=0;E_.length>L_;L_++)f_(T_,A_=E_[L_])&&!f_(R_,A_)&&S_(R_,A_,m_(T_,A_));R_.prototype=C_,C_.constructor=R_,c_(h_,k_,R_)}_export({target:"Number",stat:!0},{EPSILON:Math.pow(2,-52)});var I_=e.isFinite,O_=Number.isFinite||function isFinite(t){return"number"==typeof t&&I_(t)};_export({target:"Number",stat:!0},{isFinite:O_});var P_=isObject$C,M_=Math.floor,F_=function isInteger(t){return!P_(t)&&isFinite(t)&&M_(t)===t};_export({target:"Number",stat:!0},{isInteger:F_}),_export({target:"Number",stat:!0},{isNaN:function isNaN(t){return t!=t}});var z_=_export,U_=F_,B_=Math.abs;z_({target:"Number",stat:!0},{isSafeInteger:function isSafeInteger(t){return U_(t)&&B_(t)<=9007199254740991}}),_export({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),_export({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var D_=toString$s,j_=a_.trim,N_=e.parseFloat,W_=1/N_("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff-0")!=-1/0?function parseFloat(t){var e=j_(D_(t)),r=N_(e);return 0===r&&"-"==e.charAt(0)?-0:r}:N_,H_=W_;_export({target:"Number",stat:!0,forced:Number.parseFloat!=H_},{parseFloat:H_});var G_=toString$s,V_=a_.trim,Y_=e_,X_=e.parseInt,q_=/^[+-]?0[Xx]/,$_=8!==X_(Y_+"08")||22!==X_(Y_+"0x16")?function parseInt(t,e){var r=V_(G_(t));return X_(r,e>>>0||(q_.test(r)?16:10))}:X_,Z_=$_;_export({target:"Number",stat:!0,forced:Number.parseInt!=Z_},{parseInt:Z_});var K_=classofRaw$1,thisNumberValue$2=function(t){if("number"!=typeof t&&"Number"!=K_(t))throw TypeError("Incorrect invocation");return+t},Q_=_export,J_=toInteger$h,tg=thisNumberValue$2,eg=Ql,rg=fails$11,ig=1..toFixed,ng=Math.floor,pow$1=function(t,e,r){return 0===e?r:e%2==1?pow$1(t,e-1,r*t):pow$1(t*t,e/2,r)},multiply=function(t,e,r){for(var i=-1,n=r;++i<6;)n+=e*t[i],t[i]=n%1e7,n=ng(n/1e7)},divide=function(t,e){for(var r=6,i=0;--r>=0;)i+=t[r],t[r]=ng(i/e),i=i%e*1e7},dataToString=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var i=String(t[e]);r=""===r?i:r+eg.call("0",7-i.length)+i}return r};Q_({target:"Number",proto:!0,forced:ig&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!rg((function(){ig.call({})}))},{toFixed:function toFixed(t){var e,r,i,n,s=tg(this),o=J_(t),u=[0,0,0,0,0,0],h="",l="0";if(o<0||o>20)throw RangeError("Incorrect fraction digits");if(s!=s)return"NaN";if(s<=-1e21||s>=1e21)return String(s);if(s<0&&(h="-",s=-s),s>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(s*pow$1(2,69,1))-69)<0?s*pow$1(2,-e,1):s/pow$1(2,e,1),r*=4503599627370496,(e=52-e)>0){for(multiply(u,0,r),i=o;i>=7;)multiply(u,1e7,0),i-=7;for(multiply(u,pow$1(10,i,1),0),i=e-1;i>=23;)divide(u,1<<23),i-=23;divide(u,1<<i),multiply(u,1,1),divide(u,2),l=dataToString(u)}else multiply(u,0,r),multiply(u,1<<-e,0),l=dataToString(u)+eg.call("0",o);return l=o>0?h+((n=l.length)<=o?"0."+eg.call("0",o-n)+l:l.slice(0,n-o)+"."+l.slice(n-o)):h+l}});var sg=fails$11,og=thisNumberValue$2,ag=1..toPrecision;_export({target:"Number",proto:!0,forced:sg((function(){return"1"!==ag.call(1,void 0)}))||!sg((function(){ag.call({})}))},{toPrecision:function toPrecision(t){return void 0===t?ag.call(og(this)):ag.call(og(this),t)}});var ug=i,hg=fails$11,lg=hr,cg=Me,fg=n,dg=toObject$x,_g=g,gg=Object.assign,pg=Object.defineProperty,vg=!gg||hg((function(){if(ug&&1!==gg({b:1},gg(pg({},"a",{enumerable:!0,get:function(){pg(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol(),i="abcdefghijklmnopqrst";return t[r]=7,i.split("").forEach((function(t){e[t]=t})),7!=gg({},t)[r]||lg(gg({},e)).join("")!=i}))?function assign(t,e){for(var r=dg(t),i=arguments.length,n=1,s=cg.f,o=fg.f;i>n;)for(var u,h=_g(arguments[n++]),l=s?lg(h).concat(s(h)):lg(h),f=l.length,d=0;f>d;)u=l[d++],ug&&!o.call(h,u)||(r[u]=h[u]);return r}:gg,yg=vg;_export({target:"Object",stat:!0,forced:Object.assign!==yg},{assign:yg}),_export({target:"Object",stat:!0,sham:!i},{create:br});var xg=e,mg=bu,Sg=!fails$11((function(){if(!(mg&&mg<535)){var t=Math.random();__defineSetter__.call(null,t,(function(){})),delete xg[t]}})),bg=toObject$x,kg=aFunction$S,Tg=bt;i&&_export({target:"Object",proto:!0,forced:Sg},{__defineGetter__:function __defineGetter__(t,e){Tg.f(bg(this),t,{get:kg(e),enumerable:!0,configurable:!0})}});_export({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:dr});_export({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:bt.f});var Cg=toObject$x,wg=aFunction$S,Ag=bt;i&&_export({target:"Object",proto:!0,forced:Sg},{__defineSetter__:function __defineSetter__(t,e){Ag.f(Cg(this),t,{set:wg(e),enumerable:!0,configurable:!0})}});var Rg=i,Eg=hr,Lg=toIndexedObject$d,Ig=n.f,createMethod$3=function(t){return function(e){for(var r,i=Lg(e),n=Eg(i),s=n.length,o=0,u=[];s>o;)r=n[o++],Rg&&!Ig.call(i,r)||u.push(t?[r,i[r]]:i[r]);return u}},Og={entries:createMethod$3(!0),values:createMethod$3(!1)},Pg=Og.entries;_export({target:"Object",stat:!0},{entries:function entries(t){return Pg(t)}});var Mg=_export,Fg=Qc,zg=fails$11,Ug=isObject$C,Bg=Kc.exports.onFreeze,Dg=Object.freeze;Mg({target:"Object",stat:!0,forced:zg((function(){Dg(1)})),sham:!Fg},{freeze:function freeze(t){return Dg&&Ug(t)?Dg(Bg(t)):t}});var jg=iterate$I,Ng=createProperty$7;_export({target:"Object",stat:!0},{fromEntries:function fromEntries(t){var e={};return jg(t,(function(t,r){Ng(e,t,r)}),{AS_ENTRIES:!0}),e}});var Wg=_export,Hg=fails$11,Gg=toIndexedObject$d,Vg=r.f,Yg=i,Xg=Hg((function(){Vg(1)}));Wg({target:"Object",stat:!0,forced:!Yg||Xg,sham:!Yg},{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(t,e){return Vg(Gg(t),e)}});var qg=De,$g=toIndexedObject$d,Zg=r,Kg=createProperty$7;_export({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(t){for(var e,r,i=$g(t),n=Zg.f,s=qg(i),o={},u=0;s.length>u;)void 0!==(r=n(i,e=s[u++]))&&Kg(o,e,r);return o}});var Qg=_export,Jg=fails$11,tp=kr.f;Qg({target:"Object",stat:!0,forced:Jg((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:tp});var ep=toObject$x,rp=Cn,ip=xn;_export({target:"Object",stat:!0,forced:fails$11((function(){rp(1)})),sham:!ip},{getPrototypeOf:function getPrototypeOf(t){return rp(ep(t))}});var np=Object.is||function is(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};_export({target:"Object",stat:!0},{is:np});var sp=_export,op=fails$11,ap=isObject$C,up=Object.isExtensible;sp({target:"Object",stat:!0,forced:op((function(){up(1)}))},{isExtensible:function isExtensible(t){return!!ap(t)&&(!up||up(t))}});var hp=_export,cp=fails$11,fp=isObject$C,dp=Object.isFrozen;hp({target:"Object",stat:!0,forced:cp((function(){dp(1)}))},{isFrozen:function isFrozen(t){return!fp(t)||!!dp&&dp(t)}});var _p=_export,gp=fails$11,pp=isObject$C,vp=Object.isSealed;_p({target:"Object",stat:!0,forced:gp((function(){vp(1)}))},{isSealed:function isSealed(t){return!pp(t)||!!vp&&vp(t)}});var yp=toObject$x,xp=hr;_export({target:"Object",stat:!0,forced:fails$11((function(){xp(1)}))},{keys:function keys(t){return xp(yp(t))}});var mp=_export,Sp=i,bp=Sg,kp=toObject$x,Tp=toPropertyKey$9,Cp=Cn,wp=r.f;Sp&&mp({target:"Object",proto:!0,forced:bp},{__lookupGetter__:function __lookupGetter__(t){var e,r=kp(this),i=Tp(t);do{if(e=wp(r,i))return e.get}while(r=Cp(r))}});var Ap=_export,Rp=i,Ep=Sg,Lp=toObject$x,Ip=toPropertyKey$9,Op=Cn,Pp=r.f;Rp&&Ap({target:"Object",proto:!0,forced:Ep},{__lookupSetter__:function __lookupSetter__(t){var e,r=Lp(this),i=Ip(t);do{if(e=Pp(r,i))return e.set}while(r=Op(r))}});var Mp=_export,Fp=isObject$C,zp=Kc.exports.onFreeze,Up=Qc,Bp=fails$11,Dp=Object.preventExtensions;Mp({target:"Object",stat:!0,forced:Bp((function(){Dp(1)})),sham:!Up},{preventExtensions:function preventExtensions(t){return Dp&&Fp(t)?Dp(zp(t)):t}});var jp=_export,Np=isObject$C,Wp=Kc.exports.onFreeze,Hp=Qc,Gp=fails$11,Vp=Object.seal;jp({target:"Object",stat:!0,forced:Gp((function(){Vp(1)})),sham:!Hp},{seal:function seal(t){return Vp&&Np(t)?Vp(Wp(t)):t}}),_export({target:"Object",stat:!0},{setPrototypeOf:En});var Yp=jn,Xp=Fn?{}.toString:function toString(){return"[object "+Yp(this)+"]"},qp=Fn,$p=Ot.exports,Zp=Xp;qp||$p(Object.prototype,"toString",Zp,{unsafe:!0});var Kp=Og.values;_export({target:"Object",stat:!0},{values:function values(t){return Kp(t)}});_export({global:!0,forced:parseFloat!=W_},{parseFloat:W_});_export({global:!0,forced:parseInt!=$_},{parseInt:$_});var Qp,Jp,tv,ev,rv=e.Promise,iv=/(?:iphone|ipod|ipad).*applewebkit/i.test(x),nv=e,sv=fails$11,ov=functionBindContext,av=_r,uv=documentCreateElement$1,hv=iv,lv=Xa,cv=nv.setImmediate,fv=nv.clearImmediate,dv=nv.process,_v=nv.MessageChannel,gv=nv.Dispatch,pv=0,vv={},yv="onreadystatechange";try{Qp=nv.location}catch(t){}var run=function(t){if(vv.hasOwnProperty(t)){var e=vv[t];delete vv[t],e()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){nv.postMessage(String(t),Qp.protocol+"//"+Qp.host)};cv&&fv||(cv=function setImmediate(t){for(var e=[],r=arguments.length,i=1;r>i;)e.push(arguments[i++]);return vv[++pv]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},Jp(pv),pv},fv=function clearImmediate(t){delete vv[t]},lv?Jp=function(t){dv.nextTick(runner(t))}:gv&&gv.now?Jp=function(t){gv.now(runner(t))}:_v&&!hv?(ev=(tv=new _v).port2,tv.port1.onmessage=listener,Jp=ov(ev.postMessage,ev,1)):nv.addEventListener&&"function"==typeof postMessage&&!nv.importScripts&&Qp&&"file:"!==Qp.protocol&&!sv(post)?(Jp=post,nv.addEventListener("message",listener,!1)):Jp=yv in uv("script")?function(t){av.appendChild(uv("script")).onreadystatechange=function(){av.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var xv,mv,Sv,bv,kv,Tv,Cv,wv,Av={set:cv,clear:fv},Rv=/web0s(?!.*chrome)/i.test(x),Ev=e,Lv=r.f,Iv=Av.set,Ov=iv,Pv=Rv,Mv=Xa,Fv=Ev.MutationObserver||Ev.WebKitMutationObserver,zv=Ev.document,Uv=Ev.process,Bv=Ev.Promise,Dv=Lv(Ev,"queueMicrotask"),jv=Dv&&Dv.value;jv||(xv=function(){var t,e;for(Mv&&(t=Uv.domain)&&t.exit();mv;){e=mv.fn,mv=mv.next;try{e()}catch(t){throw mv?bv():Sv=void 0,t}}Sv=void 0,t&&t.enter()},Ov||Mv||Pv||!Fv||!zv?Bv&&Bv.resolve?((Cv=Bv.resolve(void 0)).constructor=Bv,wv=Cv.then,bv=function(){wv.call(Cv,xv)}):bv=Mv?function(){Uv.nextTick(xv)}:function(){Iv.call(Ev,xv)}:(kv=!0,Tv=zv.createTextNode(""),new Fv(xv).observe(Tv,{characterData:!0}),bv=function(){Tv.data=kv=!kv}));var Nv=jv||function(t){var e={fn:t,next:void 0};Sv&&(Sv.next=e),mv||(mv=e,bv()),Sv=e},Wv={},Hv=aFunction$S,PromiseCapability=function(t){var e,r;this.promise=new t((function(t,i){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=i})),this.resolve=Hv(e),this.reject=Hv(r)};Wv.f=function(t){return new PromiseCapability(t)};var Gv,Vv,Yv,Xv,qv=anObject$1z,$v=isObject$C,Zv=Wv,promiseResolve$2=function(t,e){if(qv(t),$v(e)&&e.constructor===t)return e;var r=Zv.f(t);return(0,r.resolve)(e),r.promise},Kv=e,hostReportErrors$2=function(t,e){var r=Kv.console;r&&r.error&&(1===arguments.length?r.error(t):r.error(t,e))},perform$4=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Qv="object"==typeof window,Jv=_export,ty=e,ey=getBuiltIn$u,ry=rv,iy=Ot.exports,ny=redefineAll$9,sy=En,oy=setToStringTag$b,ay=setSpecies$7,uy=isObject$C,hy=aFunction$S,ly=anInstance$b,cy=Bt,fy=iterate$I,dy=checkCorrectnessOfIteration$4,_y=speciesConstructor$f,gy=Av.set,py=Nv,vy=promiseResolve$2,yy=hostReportErrors$2,xy=Wv,my=perform$4,Sy=oe,by=Ze,ky=Qv,Ty=Xa,Cy=w,wy=wellKnownSymbol$E("species"),Ay="Promise",Ry=Sy.get,Ey=Sy.set,Ly=Sy.getterFor(Ay),Iy=ry&&ry.prototype,Oy=ry,Py=Iy,My=ty.TypeError,Fy=ty.document,zy=ty.process,Uy=xy.f,By=Uy,Dy=!!(Fy&&Fy.createEvent&&ty.dispatchEvent),jy="function"==typeof PromiseRejectionEvent,Ny="unhandledrejection",Wy=!1,Hy=by(Ay,(function(){var t=cy(Oy),e=t!==String(Oy);if(!e&&66===Cy)return!0;if(Cy>=51&&/native code/.test(t))return!1;var r=new Oy((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};return(r.constructor={})[wy]=FakePromise,!(Wy=r.then((function(){}))instanceof FakePromise)||!e&&ky&&!jy})),Gy=Hy||!dy((function(t){Oy.all(t).catch((function(){}))})),isThenable=function(t){var e;return!(!uy(t)||"function"!=typeof(e=t.then))&&e},notify=function(t,e){if(!t.notified){t.notified=!0;var r=t.reactions;py((function(){for(var i=t.value,n=1==t.state,s=0;r.length>s;){var o,u,h,l=r[s++],f=n?l.ok:l.fail,d=l.resolve,_=l.reject,g=l.domain;try{f?(n||(2===t.rejection&&onHandleUnhandled(t),t.rejection=1),!0===f?o=i:(g&&g.enter(),o=f(i),g&&(g.exit(),h=!0)),o===l.promise?_(My("Promise-chain cycle")):(u=isThenable(o))?u.call(o,d,_):d(o)):_(i)}catch(t){g&&!h&&g.exit(),_(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&onUnhandled(t)}))}},dispatchEvent=function(t,e,r){var i,n;Dy?((i=Fy.createEvent("Event")).promise=e,i.reason=r,i.initEvent(t,!1,!0),ty.dispatchEvent(i)):i={promise:e,reason:r},!jy&&(n=ty["on"+t])?n(i):t===Ny&&yy("Unhandled promise rejection",r)},onUnhandled=function(t){gy.call(ty,(function(){var e,r=t.facade,i=t.value;if(isUnhandled(t)&&(e=my((function(){Ty?zy.emit("unhandledRejection",i,r):dispatchEvent(Ny,r,i)})),t.rejection=Ty||isUnhandled(t)?2:1,e.error))throw e.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){gy.call(ty,(function(){var e=t.facade;Ty?zy.emit("rejectionHandled",e):dispatchEvent("rejectionhandled",e,t.value)}))},bind$i=function(t,e,r){return function(i){t(e,i,r)}},internalReject=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,notify(t,!0))},internalResolve=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw My("Promise can't be resolved itself");var i=isThenable(e);i?py((function(){var r={done:!1};try{i.call(e,bind$i(internalResolve,r,t),bind$i(internalReject,r,t))}catch(e){internalReject(r,e,t)}})):(t.value=e,t.state=1,notify(t,!1))}catch(e){internalReject({done:!1},e,t)}}};if(Hy&&(Py=(Oy=function Promise(t){ly(this,Oy,Ay),hy(t),Gv.call(this);var e=Ry(this);try{t(bind$i(internalResolve,e),bind$i(internalReject,e))}catch(t){internalReject(e,t)}}).prototype,(Gv=function Promise(t){Ey(this,{type:Ay,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=ny(Py,{then:function then(t,e){var r=Ly(this),i=Uy(_y(this,Oy));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=Ty?zy.domain:void 0,r.parent=!0,r.reactions.push(i),0!=r.state&&notify(r,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),Vv=function(){var t=new Gv,e=Ry(t);this.promise=t,this.resolve=bind$i(internalResolve,e),this.reject=bind$i(internalReject,e)},xy.f=Uy=function(t){return t===Oy||t===Yv?new Vv(t):By(t)},"function"==typeof ry&&Iy!==Object.prototype)){Xv=Iy.then,Wy||(iy(Iy,"then",(function then(t,e){var r=this;return new Oy((function(t,e){Xv.call(r,t,e)})).then(t,e)}),{unsafe:!0}),iy(Iy,"catch",Py.catch,{unsafe:!0}));try{delete Iy.constructor}catch(t){}sy&&sy(Iy,Py)}Jv({global:!0,wrap:!0,forced:Hy},{Promise:Oy}),oy(Oy,Ay,!1),ay(Ay),Yv=ey(Ay),Jv({target:Ay,stat:!0,forced:Hy},{reject:function reject(t){var e=Uy(this);return e.reject.call(void 0,t),e.promise}}),Jv({target:Ay,stat:!0,forced:Hy},{resolve:function resolve(t){return vy(this,t)}}),Jv({target:Ay,stat:!0,forced:Gy},{all:function all(t){var e=this,r=Uy(e),i=r.resolve,n=r.reject,s=my((function(){var r=hy(e.resolve),s=[],o=0,u=1;fy(t,(function(t){var h=o++,l=!1;s.push(void 0),u++,r.call(e,t).then((function(t){l||(l=!0,s[h]=t,--u||i(s))}),n)})),--u||i(s)}));return s.error&&n(s.value),r.promise},race:function race(t){var e=this,r=Uy(e),i=r.reject,n=my((function(){var n=hy(e.resolve);fy(t,(function(t){n.call(e,t).then(r.resolve,i)}))}));return n.error&&i(n.value),r.promise}});var Vy=aFunction$S,Yy=Wv,Xy=perform$4,qy=iterate$I;_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var e=this,r=Yy.f(e),i=r.resolve,n=r.reject,s=Xy((function(){var r=Vy(e.resolve),n=[],s=0,o=1;qy(t,(function(t){var u=s++,h=!1;n.push(void 0),o++,r.call(e,t).then((function(t){h||(h=!0,n[u]={status:"fulfilled",value:t},--o||i(n))}),(function(t){h||(h=!0,n[u]={status:"rejected",reason:t},--o||i(n))}))})),--o||i(n)}));return s.error&&n(s.value),r.promise}});var $y=aFunction$S,Zy=getBuiltIn$u,Ky=Wv,Qy=perform$4,Jy=iterate$I,tx="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var e=this,r=Ky.f(e),i=r.resolve,n=r.reject,s=Qy((function(){var r=$y(e.resolve),s=[],o=0,u=1,h=!1;Jy(t,(function(t){var l=o++,f=!1;s.push(void 0),u++,r.call(e,t).then((function(t){f||h||(h=!0,i(t))}),(function(t){f||h||(f=!0,s[l]=t,--u||n(new(Zy("AggregateError"))(s,tx)))}))})),--u||n(new(Zy("AggregateError"))(s,tx))}));return s.error&&n(s.value),r.promise}});var ex=_export,rx=rv,ix=fails$11,nx=getBuiltIn$u,sx=speciesConstructor$f,ox=promiseResolve$2,ax=Ot.exports;if(ex({target:"Promise",proto:!0,real:!0,forced:!!rx&&ix((function(){rx.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=sx(this,nx("Promise")),r="function"==typeof t;return this.then(r?function(r){return ox(e,t()).then((function(){return r}))}:t,r?function(r){return ox(e,t()).then((function(){throw r}))}:t)}}),"function"==typeof rx){var ux=nx("Promise").prototype.finally;rx.prototype.finally!==ux&&ax(rx.prototype,"finally",ux,{unsafe:!0})}var hx=_export,lx=aFunction$S,cx=anObject$1z,fx=fails$11,dx=getBuiltIn$u("Reflect","apply"),_x=Function.apply;hx({target:"Reflect",stat:!0,forced:!fx((function(){dx((function(){}))}))},{apply:function apply(t,e,r){return lx(t),cx(r),dx?dx(t,e,r):_x.call(t,e,r)}});var gx=_export,px=aFunction$S,vx=anObject$1z,yx=isObject$C,xx=br,mx=Oc,Sx=fails$11,bx=getBuiltIn$u("Reflect","construct"),kx=Sx((function(){function F(){}return!(bx((function(){}),[],F)instanceof F)})),Tx=!Sx((function(){bx((function(){}))})),Cx=kx||Tx;gx({target:"Reflect",stat:!0,forced:Cx,sham:Cx},{construct:function construct(t,e){px(t),vx(e);var r=arguments.length<3?t:px(arguments[2]);if(Tx&&!kx)return bx(t,e,r);if(t==r){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var i=[null];return i.push.apply(i,e),new(mx.apply(t,i))}var n=r.prototype,s=xx(yx(n)?n:Object.prototype),o=Function.apply.call(t,s,e);return yx(o)?o:s}});var wx=i,Ax=anObject$1z,Rx=toPropertyKey$9,Ex=bt;_export({target:"Reflect",stat:!0,forced:fails$11((function(){Reflect.defineProperty(Ex.f({},1,{value:1}),1,{value:2})})),sham:!wx},{defineProperty:function defineProperty(t,e,r){Ax(t);var i=Rx(e);Ax(r);try{return Ex.f(t,i,r),!0}catch(t){return!1}}});var Lx=_export,Ix=anObject$1z,Ox=r.f;Lx({target:"Reflect",stat:!0},{deleteProperty:function deleteProperty(t,e){var r=Ox(Ix(t),e);return!(r&&!r.configurable)&&delete t[e]}});var Px=isObject$C,Mx=anObject$1z,Fx=G,zx=r,Ux=Cn;_export({target:"Reflect",stat:!0},{get:function get(t,e){var r,i,n=arguments.length<3?t:arguments[2];return Mx(t)===n?t[e]:(r=zx.f(t,e))?Fx(r,"value")?r.value:void 0===r.get?void 0:r.get.call(n):Px(i=Ux(t))?get(i,e,n):void 0}});var Bx=anObject$1z,Dx=r;_export({target:"Reflect",stat:!0,sham:!i},{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(t,e){return Dx.f(Bx(t),e)}});var jx=anObject$1z,Nx=Cn;_export({target:"Reflect",stat:!0,sham:!xn},{getPrototypeOf:function getPrototypeOf(t){return Nx(jx(t))}}),_export({target:"Reflect",stat:!0},{has:function has(t,e){return e in t}});var Wx=_export,Hx=anObject$1z,Gx=Object.isExtensible;Wx({target:"Reflect",stat:!0},{isExtensible:function isExtensible(t){return Hx(t),!Gx||Gx(t)}}),_export({target:"Reflect",stat:!0},{ownKeys:De});var Vx=getBuiltIn$u,Yx=anObject$1z;_export({target:"Reflect",stat:!0,sham:!Qc},{preventExtensions:function preventExtensions(t){Yx(t);try{var e=Vx("Object","preventExtensions");return e&&e(t),!0}catch(t){return!1}}});var Xx=anObject$1z,qx=isObject$C,$x=G,Zx=bt,Kx=r,Qx=Cn,Jx=createPropertyDescriptor$9;_export({target:"Reflect",stat:!0,forced:fails$11((function(){var Constructor=function(){},t=Zx.f(new Constructor,"a",{configurable:!0});return!1!==Reflect.set(Constructor.prototype,"a",1,t)}))},{set:function set(t,e,r){var i,n,s=arguments.length<4?t:arguments[3],o=Kx.f(Xx(t),e);if(!o){if(qx(n=Qx(t)))return set(n,e,r,s);o=Jx(0)}if($x(o,"value")){if(!1===o.writable||!qx(s))return!1;if(i=Kx.f(s,e)){if(i.get||i.set||!1===i.writable)return!1;i.value=r,Zx.f(s,e,i)}else Zx.f(s,e,Jx(0,r));return!0}return void 0!==o.set&&(o.set.call(s,r),!0)}});var tm=anObject$1z,em=aPossiblePrototype$2,rm=En;rm&&_export({target:"Reflect",stat:!0},{setPrototypeOf:function setPrototypeOf(t,e){tm(t),em(e);try{return rm(t,e),!0}catch(t){return!1}}});var im=e,nm=setToStringTag$b;_export({global:!0},{Reflect:{}}),nm(im.Reflect,"Reflect",!0);var sm=isObject$C,om=classofRaw$1,am=wellKnownSymbol$E("match"),isRegexp=function(t){var e;return sm(t)&&(void 0!==(e=t[am])?!!e:"RegExp"==om(t))},um=anObject$1z,regexpFlags$1=function(){var t=um(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},hm={},lm=fails$11,RE=function(t,e){return RegExp(t,e)};hm.UNSUPPORTED_Y=lm((function(){var t=RE("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),hm.BROKEN_CARET=lm((function(){var t=RE("^r","gy");return t.lastIndex=2,null!=t.exec("str")}));var cm=fails$11((function(){var t=RegExp(".","string".charAt(0));return!(t.dotAll&&t.exec("\n")&&"s"===t.flags)})),fm=fails$11((function(){var t=RegExp("(?<a>b)","string".charAt(5));return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),dm=i,_m=e,gm=Ze,pm=inheritIfRequired$4,vm=It,ym=bt.f,xm=ge.f,mm=isRegexp,Sm=toString$s,bm=regexpFlags$1,km=hm,Tm=Ot.exports,Cm=fails$11,wm=G,Am=oe.enforce,Rm=setSpecies$7,Em=cm,Lm=fm,Im=wellKnownSymbol$E("match"),Om=_m.RegExp,Pm=Om.prototype,Mm=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Fm=/a/g,zm=/a/g,Um=new Om(Fm)!==Fm,Bm=km.UNSUPPORTED_Y,Dm=dm&&(!Um||Bm||Em||Lm||Cm((function(){return zm[Im]=!1,Om(Fm)!=Fm||Om(zm)==zm||"/a/i"!=Om(Fm,"i")})));if(gm("RegExp",Dm)){for(var jm=function RegExp(t,e){var r,i,n,s,o,u,h=this instanceof jm,l=mm(t),f=void 0===e,d=[],_=t;if(!h&&l&&f&&t.constructor===jm)return t;if((l||t instanceof jm)&&(t=t.source,f&&(e="flags"in _?_.flags:bm.call(_))),t=void 0===t?"":Sm(t),e=void 0===e?"":Sm(e),_=t,Em&&"dotAll"in Fm&&(i=!!e&&e.indexOf("s")>-1)&&(e=e.replace(/s/g,"")),r=e,Bm&&"sticky"in Fm&&(n=!!e&&e.indexOf("y")>-1)&&(e=e.replace(/y/g,"")),Lm&&(t=(s=function(t){for(var e,r=t.length,i=0,n="",s=[],o={},u=!1,h=!1,l=0,f="";i<=r;i++){if("\\"===(e=t.charAt(i)))e+=t.charAt(++i);else if("]"===e)u=!1;else if(!u)switch(!0){case"["===e:u=!0;break;case"("===e:Mm.test(t.slice(i+1))&&(i+=2,h=!0),n+=e,l++;continue;case">"===e&&h:if(""===f||wm(o,f))throw new SyntaxError("Invalid capture group name");o[f]=!0,s.push([f,l]),h=!1,f="";continue}h?f+=e:n+=e}return[n,s]}(t))[0],d=s[1]),o=pm(Om(t,e),h?this:Pm,jm),(i||n||d.length)&&(u=Am(o),i&&(u.dotAll=!0,u.raw=jm(function(t){for(var e,r=t.length,i=0,n="",s=!1;i<=r;i++)"\\"!==(e=t.charAt(i))?s||"."!==e?("["===e?s=!0:"]"===e&&(s=!1),n+=e):n+="[\\s\\S]":n+=e+t.charAt(++i);return n}(t),r)),n&&(u.sticky=!0),d.length&&(u.groups=d)),t!==_)try{vm(o,"source",""===_?"(?:)":_)}catch(t){}return o},proxy=function(t){t in jm||ym(jm,t,{configurable:!0,get:function(){return Om[t]},set:function(e){Om[t]=e}})},Nm=xm(Om),Wm=0;Nm.length>Wm;)proxy(Nm[Wm++]);Pm.constructor=jm,jm.prototype=Pm,Tm(_m,"RegExp",jm)}Rm("RegExp");var Hm=i,Gm=cm,Vm=bt.f,Ym=oe.get,Xm=RegExp.prototype;Hm&&Gm&&Vm(Xm,"dotAll",{configurable:!0,get:function(){if(this!==Xm){if(this instanceof RegExp)return!!Ym(this).dotAll;throw TypeError("Incompatible receiver, RegExp required")}}});var qm=toString$s,$m=regexpFlags$1,Zm=hm,Km=M.exports,Qm=br,Jm=oe.get,tS=cm,eS=fm,rS=RegExp.prototype.exec,iS=Km("native-string-replace",String.prototype.replace),nS=rS,sS=function(){var t=/a/,e=/b*/g;return rS.call(t,"a"),rS.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),oS=Zm.UNSUPPORTED_Y||Zm.BROKEN_CARET,aS=void 0!==/()??/.exec("")[1];(sS||aS||oS||tS||eS)&&(nS=function exec(t){var e,r,i,n,s,o,u,h=this,l=Jm(h),f=qm(t),d=l.raw;if(d)return d.lastIndex=h.lastIndex,e=nS.call(d,f),h.lastIndex=d.lastIndex,e;var _=l.groups,g=oS&&h.sticky,p=$m.call(h),v=h.source,y=0,x=f;if(g&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),x=f.slice(h.lastIndex),h.lastIndex>0&&(!h.multiline||h.multiline&&"\n"!==f.charAt(h.lastIndex-1))&&(v="(?: "+v+")",x=" "+x,y++),r=new RegExp("^(?:"+v+")",p)),aS&&(r=new RegExp("^"+v+"$(?!\\s)",p)),sS&&(i=h.lastIndex),n=rS.call(g?r:h,x),g?n?(n.input=n.input.slice(y),n[0]=n[0].slice(y),n.index=h.lastIndex,h.lastIndex+=n[0].length):h.lastIndex=0:sS&&n&&(h.lastIndex=h.global?n.index+n[0].length:i),aS&&n&&n.length>1&&iS.call(n[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(n[s]=void 0)})),n&&_)for(n.groups=o=Qm(null),s=0;s<_.length;s++)o[(u=_[s])[0]]=n[u[1]];return n});var uS=nS;_export({target:"RegExp",proto:!0,forced:/./.exec!==uS},{exec:uS});var hS=bt,lS=regexpFlags$1;i&&fails$11((function(){return"sy"!==Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get.call({dotAll:!0,sticky:!0})}))&&hS.f(RegExp.prototype,"flags",{configurable:!0,get:lS});var cS=i,fS=hm.UNSUPPORTED_Y,dS=bt.f,_S=oe.get,gS=RegExp.prototype;cS&&fS&&dS(gS,"sticky",{configurable:!0,get:function(){if(this!==gS){if(this instanceof RegExp)return!!_S(this).sticky;throw TypeError("Incompatible receiver, RegExp required")}}});var pS=_export,vS=isObject$C,yS=function(){var t=!1,e=/[ac]/;return e.exec=function(){return t=!0,/./.exec.apply(this,arguments)},!0===e.test("abc")&&t}(),xS=/./.test;pS({target:"RegExp",proto:!0,forced:!yS},{test:function(t){if("function"!=typeof this.exec)return xS.call(this,t);var e=this.exec(t);if(null!==e&&!vS(e))throw new Error("RegExp exec method returned something other than an Object or null");return!!e}});var mS=Ot.exports,SS=anObject$1z,bS=toString$s,kS=fails$11,TS=regexpFlags$1,CS="toString",wS=RegExp.prototype,AS=wS.toString,RS=kS((function(){return"/a/b"!=AS.call({source:"a",flags:"b"})})),ES=AS.name!=CS;(RS||ES)&&mS(RegExp.prototype,CS,(function toString(){var t=SS(this),e=bS(t.source),r=t.flags;return"/"+e+"/"+bS(void 0===r&&t instanceof RegExp&&!("flags"in wS)?TS.call(t):r)}),{unsafe:!0});var LS=collection$4("Set",(function(t){return function Set(){return t(this,arguments.length?arguments[0]:void 0)}}),Nf),IS=toInteger$h,OS=toString$s,PS=requireObjectCoercible$i,createMethod$2=function(t){return function(e,r){var i,n,s=OS(PS(e)),o=IS(r),u=s.length;return o<0||o>=u?t?"":void 0:(i=s.charCodeAt(o))<55296||i>56319||o+1===u||(n=s.charCodeAt(o+1))<56320||n>57343?t?s.charAt(o):i:t?s.slice(o,o+2):n-56320+(i-55296<<10)+65536}},MS={codeAt:createMethod$2(!1),charAt:createMethod$2(!0)},FS=MS.codeAt;_export({target:"String",proto:!0},{codePointAt:function codePointAt(t){return FS(this,t)}});var zS,US=isRegexp,notARegexp=function(t){if(US(t))throw TypeError("The method doesn't accept regular expressions");return t},BS=wellKnownSymbol$E("match"),correctIsRegexpLogic=function(t){var e=/./;try{"/./"[t](e)}catch(r){try{return e[BS]=!1,"/./"[t](e)}catch(t){}}return!1},DS=_export,jS=r.f,NS=toLength$C,WS=toString$s,HS=notARegexp,GS=requireObjectCoercible$i,VS=correctIsRegexpLogic,YS="".endsWith,XS=Math.min,qS=VS("endsWith");DS({target:"String",proto:!0,forced:!!(qS||(zS=jS(String.prototype,"endsWith"),!zS||zS.writable))&&!qS},{endsWith:function endsWith(t){var e=WS(GS(this));HS(t);var r=arguments.length>1?arguments[1]:void 0,i=NS(e.length),n=void 0===r?i:XS(NS(r),i),s=WS(t);return YS?YS.call(e,s,n):e.slice(n-s.length,n)===s}});var $S=_export,ZS=toAbsoluteIndex$8,KS=String.fromCharCode,QS=String.fromCodePoint;$S({target:"String",stat:!0,forced:!!QS&&1!=QS.length},{fromCodePoint:function fromCodePoint(t){for(var e,r=[],i=arguments.length,n=0;i>n;){if(e=+arguments[n++],ZS(e,1114111)!==e)throw RangeError(e+" is not a valid code point");r.push(e<65536?KS(e):KS(55296+((e-=65536)>>10),e%1024+56320))}return r.join("")}});var JS=notARegexp,tb=requireObjectCoercible$i,eb=toString$s;_export({target:"String",proto:!0,forced:!correctIsRegexpLogic("includes")},{includes:function includes(t){return!!~eb(tb(this)).indexOf(eb(JS(t)),arguments.length>1?arguments[1]:void 0)}});var rb=MS.charAt,ib=toString$s,nb=oe,sb=defineIterator$3,ob="String Iterator",ab=nb.set,ub=nb.getterFor(ob);sb(String,"String",(function(t){ab(this,{type:ob,string:ib(t),index:0})}),(function next(){var t,e=ub(this),r=e.string,i=e.index;return i>=r.length?{value:void 0,done:!0}:(t=rb(r,i),e.index+=t.length,{value:t,done:!1})}));var hb=Ot.exports,lb=uS,cb=fails$11,fb=wellKnownSymbol$E,db=It,_b=fb("species"),gb=RegExp.prototype,fixRegexpWellKnownSymbolLogic=function(t,e,r,i){var n=fb(t),s=!cb((function(){var e={};return e[n]=function(){return 7},7!=""[t](e)})),o=s&&!cb((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[_b]=function(){return r},r.flags="",r[n]=/./[n]),r.exec=function(){return e=!0,null},r[n](""),!e}));if(!s||!o||r){var u=/./[n],h=e(n,""[t],(function(t,e,r,i,n){var o=e.exec;return o===lb||o===gb.exec?s&&!n?{done:!0,value:u.call(e,r,i)}:{done:!0,value:t.call(r,e,i)}:{done:!1}}));hb(String.prototype,t,h[0]),hb(gb,n,h[1])}i&&db(gb[n],"sham",!0)},pb=MS.charAt,advanceStringIndex$4=function(t,e,r){return e+(r?pb(t,e).length:1)},vb=classofRaw$1,yb=uS,regexpExecAbstract=function(t,e){var r=t.exec;if("function"==typeof r){var i=r.call(t,e);if("object"!=typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==vb(t))throw TypeError("RegExp#exec called on incompatible receiver");return yb.call(t,e)},xb=anObject$1z,mb=toLength$C,Sb=toString$s,bb=requireObjectCoercible$i,kb=advanceStringIndex$4,Tb=regexpExecAbstract;fixRegexpWellKnownSymbolLogic("match",(function(t,e,r){return[function match(e){var r=bb(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,r):new RegExp(e)[t](Sb(r))},function(t){var i=xb(this),n=Sb(t),s=r(e,i,n);if(s.done)return s.value;if(!i.global)return Tb(i,n);var o=i.unicode;i.lastIndex=0;for(var u,h=[],l=0;null!==(u=Tb(i,n));){var f=Sb(u[0]);h[l]=f,""===f&&(i.lastIndex=kb(n,mb(i.lastIndex),o)),l++}return 0===l?null:h}]}));var Cb=_export,wb=createIteratorConstructor$7,Ab=requireObjectCoercible$i,Rb=toLength$C,Eb=toString$s,Lb=aFunction$S,Ib=anObject$1z,Ob=isRegexp,Pb=regexpFlags$1,Mb=It,Fb=fails$11,zb=speciesConstructor$f,Ub=advanceStringIndex$4,Bb=oe,Db=wellKnownSymbol$E("matchAll"),jb="RegExp String",Nb="RegExp String Iterator",Wb=Bb.set,Hb=Bb.getterFor(Nb),Gb=RegExp.prototype,Vb=Gb.exec,Yb="".matchAll,Xb=!!Yb&&!Fb((function(){"a".matchAll(/./)})),qb=wb((function RegExpStringIterator(t,e,r,i){Wb(this,{type:Nb,regexp:t,string:e,global:r,unicode:i,done:!1})}),jb,(function next(){var t=Hb(this);if(t.done)return{value:void 0,done:!0};var e=t.regexp,r=t.string,i=function(t,e){var r,i=t.exec;if("function"==typeof i){if("object"!=typeof(r=i.call(t,e)))throw TypeError("Incorrect exec result");return r}return Vb.call(t,e)}(e,r);return null===i?{value:void 0,done:t.done=!0}:t.global?(""===Eb(i[0])&&(e.lastIndex=Ub(r,Rb(e.lastIndex),t.unicode)),{value:i,done:!1}):(t.done=!0,{value:i,done:!1})})),$matchAll=function(t){var e,r,i,n,s,o,u=Ib(this),h=Eb(t);return e=zb(u,RegExp),void 0===(r=u.flags)&&u instanceof RegExp&&!("flags"in Gb)&&(r=Pb.call(u)),i=void 0===r?"":Eb(r),n=new e(e===RegExp?u.source:u,i),s=!!~i.indexOf("g"),o=!!~i.indexOf("u"),n.lastIndex=Rb(u.lastIndex),new qb(n,h,s,o)};Cb({target:"String",proto:!0,forced:Xb},{matchAll:function matchAll(t){var e,r,i=Ab(this);if(null!=t){if(Ob(t)&&!~Eb(Ab("flags"in Gb?t.flags:Pb.call(t))).indexOf("g"))throw TypeError("`.matchAll` does not allow non-global regexes");if(Xb)return Yb.apply(i,arguments);if(null!=(r=t[Db]))return Lb(r).call(t,i)}else if(Xb)return Yb.apply(i,arguments);return e=Eb(i),new RegExp(t,"g")[Db](e)}}),Db in Gb||Mb(Gb,Db,$matchAll);var $b=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(x),Zb=nc.end;_export({target:"String",proto:!0,forced:$b},{padEnd:function padEnd(t){return Zb(this,t,arguments.length>1?arguments[1]:void 0)}});var Kb=nc.start;_export({target:"String",proto:!0,forced:$b},{padStart:function padStart(t){return Kb(this,t,arguments.length>1?arguments[1]:void 0)}});var Qb=toIndexedObject$d,Jb=toLength$C,tk=toString$s;_export({target:"String",stat:!0},{raw:function raw(t){for(var e=Qb(t.raw),r=Jb(e.length),i=arguments.length,n=[],s=0;r>s;)n.push(tk(e[s++])),s<i&&n.push(tk(arguments[s]));return n.join("")}}),_export({target:"String",proto:!0},{repeat:Ql});var ek=toObject$x,rk=Math.floor,ik="".replace,nk=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,sk=/\$([$&'`]|\d{1,2})/g,getSubstitution$2=function(t,e,r,i,n,s){var o=r+t.length,u=i.length,h=sk;return void 0!==n&&(n=ek(n),h=nk),ik.call(s,h,(function(s,h){var l;switch(h.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(o);case"<":l=n[h.slice(1,-1)];break;default:var f=+h;if(0===f)return s;if(f>u){var d=rk(f/10);return 0===d?s:d<=u?void 0===i[d-1]?h.charAt(1):i[d-1]+h.charAt(1):s}l=i[f-1]}return void 0===l?"":l}))},ok=fixRegexpWellKnownSymbolLogic,ak=fails$11,uk=anObject$1z,hk=toInteger$h,lk=toLength$C,ck=toString$s,fk=requireObjectCoercible$i,dk=advanceStringIndex$4,_k=getSubstitution$2,gk=regexpExecAbstract,pk=wellKnownSymbol$E("replace"),vk=Math.max,yk=Math.min,xk="$0"==="a".replace(/./,"$0"),mk=!!/./[pk]&&""===/./[pk]("a","$0");ok("replace",(function(t,e,r){var i=mk?"$":"$0";return[function replace(t,r){var i=fk(this),n=null==t?void 0:t[pk];return void 0!==n?n.call(t,i,r):e.call(ck(i),t,r)},function(t,n){var s=uk(this),o=ck(t);if("string"==typeof n&&-1===n.indexOf(i)&&-1===n.indexOf("$<")){var u=r(e,s,o,n);if(u.done)return u.value}var h="function"==typeof n;h||(n=ck(n));var l=s.global;if(l){var f=s.unicode;s.lastIndex=0}for(var d=[];;){var _=gk(s,o);if(null===_)break;if(d.push(_),!l)break;""===ck(_[0])&&(s.lastIndex=dk(o,lk(s.lastIndex),f))}for(var g,p="",v=0,y=0;y<d.length;y++){_=d[y];for(var x=ck(_[0]),m=vk(yk(hk(_.index),o.length),0),S=[],b=1;b<_.length;b++)S.push(void 0===(g=_[b])?g:String(g));var k=_.groups;if(h){var T=[x].concat(S,m,o);void 0!==k&&T.push(k);var C=ck(n.apply(void 0,T))}else C=_k(x,o,m,S,k,n);m>=v&&(p+=o.slice(v,m)+C,v=m+x.length)}return p+o.slice(v)}]}),!!ak((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!xk||mk);var Sk=_export,bk=requireObjectCoercible$i,kk=isRegexp,Tk=toString$s,Ck=regexpFlags$1,wk=getSubstitution$2,Ak=wellKnownSymbol$E("replace"),Rk=RegExp.prototype,Ek=Math.max,stringIndexOf=function(t,e,r){return r>t.length?-1:""===e?r:t.indexOf(e,r)};Sk({target:"String",proto:!0},{replaceAll:function replaceAll(t,e){var r,i,n,s,o,u,h,l=bk(this),f=0,d=0,_="";if(null!=t){if(kk(t)&&!~Tk(bk("flags"in Rk?t.flags:Ck.call(t))).indexOf("g"))throw TypeError("`.replaceAll` does not allow non-global regexes");if(void 0!==(r=t[Ak]))return r.call(t,l,e)}for(i=Tk(l),n=Tk(t),(s="function"==typeof e)||(e=Tk(e)),o=n.length,u=Ek(1,o),f=stringIndexOf(i,n,0);-1!==f;)h=s?Tk(e(n,f,i)):wk(n,i,f,[],void 0,e),_+=i.slice(d,f)+h,d=f+o,f=stringIndexOf(i,n,f+u);return d<i.length&&(_+=i.slice(d)),_}});var Lk=anObject$1z,Ik=requireObjectCoercible$i,Ok=np,Pk=toString$s,Mk=regexpExecAbstract;fixRegexpWellKnownSymbolLogic("search",(function(t,e,r){return[function search(e){var r=Ik(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,r):new RegExp(e)[t](Pk(r))},function(t){var i=Lk(this),n=Pk(t),s=r(e,i,n);if(s.done)return s.value;var o=i.lastIndex;Ok(o,0)||(i.lastIndex=0);var u=Mk(i,n);return Ok(i.lastIndex,o)||(i.lastIndex=o),null===u?-1:u.index}]}));var Fk=fixRegexpWellKnownSymbolLogic,zk=isRegexp,Uk=anObject$1z,Bk=requireObjectCoercible$i,Dk=speciesConstructor$f,jk=advanceStringIndex$4,Nk=toLength$C,Wk=toString$s,Hk=regexpExecAbstract,Gk=uS,Vk=fails$11,Yk=hm.UNSUPPORTED_Y,Xk=[].push,qk=Math.min,$k=4294967295;Fk("split",(function(t,e,r){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,r){var i=Wk(Bk(this)),n=void 0===r?$k:r>>>0;if(0===n)return[];if(void 0===t)return[i];if(!zk(t))return e.call(i,t,n);for(var s,o,u,h=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,d=new RegExp(t.source,l+"g");(s=Gk.call(d,i))&&!((o=d.lastIndex)>f&&(h.push(i.slice(f,s.index)),s.length>1&&s.index<i.length&&Xk.apply(h,s.slice(1)),u=s[0].length,f=o,h.length>=n));)d.lastIndex===s.index&&d.lastIndex++;return f===i.length?!u&&d.test("")||h.push(""):h.push(i.slice(f)),h.length>n?h.slice(0,n):h}:"0".split(void 0,0).length?function(t,r){return void 0===t&&0===r?[]:e.call(this,t,r)}:e,[function split(e,r){var n=Bk(this),s=null==e?void 0:e[t];return void 0!==s?s.call(e,n,r):i.call(Wk(n),e,r)},function(t,n){var s=Uk(this),o=Wk(t),u=r(i,s,o,n,i!==e);if(u.done)return u.value;var h=Dk(s,RegExp),l=s.unicode,f=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Yk?"g":"y"),d=new h(Yk?"^(?:"+s.source+")":s,f),_=void 0===n?$k:n>>>0;if(0===_)return[];if(0===o.length)return null===Hk(d,o)?[o]:[];for(var g=0,p=0,v=[];p<o.length;){d.lastIndex=Yk?0:p;var y,x=Hk(d,Yk?o.slice(p):o);if(null===x||(y=qk(Nk(d.lastIndex+(Yk?p:0)),o.length))===g)p=jk(o,p,l);else{if(v.push(o.slice(g,p)),v.length===_)return v;for(var m=1;m<=x.length-1;m++)if(v.push(x[m]),v.length===_)return v;p=g=y}}return v.push(o.slice(g)),v}]}),!!Vk((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var r="ab".split(t);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),Yk);var Zk=_export,Kk=r.f,Qk=toLength$C,Jk=toString$s,tT=notARegexp,eT=requireObjectCoercible$i,rT=correctIsRegexpLogic,iT="".startsWith,nT=Math.min,sT=rT("startsWith");Zk({target:"String",proto:!0,forced:!(!sT&&!!function(){var t=Kk(String.prototype,"startsWith");return t&&!t.writable}())&&!sT},{startsWith:function startsWith(t){var e=Jk(eT(this));tT(t);var r=Qk(nT(arguments.length>1?arguments[1]:void 0,e.length)),i=Jk(t);return iT?iT.call(e,i,r):e.slice(r,r+i.length)===i}});var oT=_export,aT=requireObjectCoercible$i,uT=toInteger$h,hT=toString$s,lT="".slice,cT=Math.max,fT=Math.min;oT({target:"String",proto:!0},{substr:function substr(t,e){var r,i,n=hT(aT(this)),s=n.length,o=uT(t);return o===1/0&&(o=0),o<0&&(o=cT(s+o,0)),(r=void 0===e?s:uT(e))<=0||r===1/0||o>=(i=fT(o+r,s))?"":lT.call(n,o,i)}});var dT=fails$11,_T=e_,stringTrimForced=function(t){return dT((function(){return!!_T[t]()||"âÂá "!="âÂá "[t]()||_T[t].name!==t}))},gT=a_.trim;_export({target:"String",proto:!0,forced:stringTrimForced("trim")},{trim:function trim(){return gT(this)}});var pT=_export,vT=a_.end,yT=stringTrimForced("trimEnd"),xT=yT?function trimEnd(){return vT(this)}:"".trimEnd;pT({target:"String",proto:!0,forced:yT},{trimEnd:xT,trimRight:xT});var mT=_export,ST=a_.start,bT=stringTrimForced("trimStart"),kT=bT?function trimStart(){return ST(this)}:"".trimStart;mT({target:"String",proto:!0,forced:bT},{trimStart:kT,trimLeft:kT});var TT=requireObjectCoercible$i,CT=toString$s,wT=/"/g,createHtml=function(t,e,r,i){var n=CT(TT(t)),s="<"+e;return""!==r&&(s+=" "+r+'="'+CT(i).replace(wT,"&quot;")+'"'),s+">"+n+"</"+e+">"},AT=fails$11,stringHtmlForced=function(t){return AT((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))},RT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("anchor")},{anchor:function anchor(t){return RT(this,"a","name",t)}});var ET=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("big")},{big:function big(){return ET(this,"big","","")}});var LT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("blink")},{blink:function blink(){return LT(this,"blink","","")}});var IT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("bold")},{bold:function bold(){return IT(this,"b","","")}});var OT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("fixed")},{fixed:function fixed(){return OT(this,"tt","","")}});var PT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("fontcolor")},{fontcolor:function fontcolor(t){return PT(this,"font","color",t)}});var MT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("fontsize")},{fontsize:function fontsize(t){return MT(this,"font","size",t)}});var FT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("italics")},{italics:function italics(){return FT(this,"i","","")}});var zT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("link")},{link:function link(t){return zT(this,"a","href",t)}});var UT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("small")},{small:function small(){return UT(this,"small","","")}});var BT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("strike")},{strike:function strike(){return BT(this,"strike","","")}});var DT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("sub")},{sub:function sub(){return DT(this,"sub","","")}});var jT=createHtml;_export({target:"String",proto:!0,forced:stringHtmlForced("sup")},{sup:function sup(){return jT(this,"sup","","")}});var NT={exports:{}},WT=e,HT=fails$11,GT=checkCorrectnessOfIteration$4,VT=El.NATIVE_ARRAY_BUFFER_VIEWS,YT=WT.ArrayBuffer,XT=WT.Int8Array,qT=!VT||!HT((function(){XT(1)}))||!HT((function(){new XT(-1)}))||!GT((function(t){new XT,new XT(null),new XT(1.5),new XT(t)}),!0)||HT((function(){return 1!==new XT(new YT(2),1,void 0).length})),$T=toInteger$h,toPositiveInteger$5=function(t){var e=$T(t);if(e<0)throw RangeError("The argument can't be less than 0");return e},ZT=toPositiveInteger$5,toOffset$2=function(t,e){var r=ZT(t);if(r%e)throw RangeError("Wrong offset");return r},KT=toObject$x,QT=toLength$C,JT=getIteratorMethod$8,tC=isArrayIteratorMethod$3,eC=functionBindContext,rC=El.aTypedArrayConstructor,iC=function from(t){var e,r,i,n,s,o,u=KT(t),h=arguments.length,l=h>1?arguments[1]:void 0,f=void 0!==l,d=JT(u);if(null!=d&&!tC(d))for(o=(s=d.call(u)).next,u=[];!(n=o.call(s)).done;)u.push(n.value);for(f&&h>2&&(l=eC(l,arguments[2],2)),r=QT(u.length),i=new(rC(this))(r),e=0;r>e;e++)i[e]=f?l(u[e],e):u[e];return i},nC=_export,sC=e,oC=i,aC=qT,uC=El,hC=qh,lC=anInstance$b,cC=createPropertyDescriptor$9,fC=It,dC=F_,_C=toLength$C,gC=toIndex$2,pC=toOffset$2,vC=toPropertyKey$9,yC=G,xC=jn,mC=isObject$C,SC=O,bC=br,kC=En,TC=ge.f,CC=iC,wC=$r.forEach,AC=setSpecies$7,RC=bt,EC=r,LC=inheritIfRequired$4,IC=oe.get,OC=oe.set,PC=RC.f,MC=EC.f,FC=Math.round,zC=sC.RangeError,UC=hC.ArrayBuffer,BC=hC.DataView,DC=uC.NATIVE_ARRAY_BUFFER_VIEWS,jC=uC.TYPED_ARRAY_CONSTRUCTOR,NC=uC.TYPED_ARRAY_TAG,WC=uC.TypedArray,HC=uC.TypedArrayPrototype,GC=uC.aTypedArrayConstructor,VC=uC.isTypedArray,YC="BYTES_PER_ELEMENT",XC="Wrong length",fromList=function(t,e){for(var r=0,i=e.length,n=new(GC(t))(i);i>r;)n[r]=e[r++];return n},addGetter=function(t,e){PC(t,e,{get:function(){return IC(this)[e]}})},isArrayBuffer=function(t){var e;return t instanceof UC||"ArrayBuffer"==(e=xC(t))||"SharedArrayBuffer"==e},isTypedArrayIndex=function(t,e){return VC(t)&&!SC(e)&&e in t&&dC(+e)&&e>=0},qC=function getOwnPropertyDescriptor(t,e){return e=vC(e),isTypedArrayIndex(t,e)?cC(2,t[e]):MC(t,e)},$C=function defineProperty(t,e,r){return e=vC(e),!(isTypedArrayIndex(t,e)&&mC(r)&&yC(r,"value"))||yC(r,"get")||yC(r,"set")||r.configurable||yC(r,"writable")&&!r.writable||yC(r,"enumerable")&&!r.enumerable?PC(t,e,r):(t[e]=r.value,t)};oC?(DC||(EC.f=qC,RC.f=$C,addGetter(HC,"buffer"),addGetter(HC,"byteOffset"),addGetter(HC,"byteLength"),addGetter(HC,"length")),nC({target:"Object",stat:!0,forced:!DC},{getOwnPropertyDescriptor:qC,defineProperty:$C}),NT.exports=function(t,e,r){var i=t.match(/\d+$/)[0]/8,n=t+(r?"Clamped":"")+"Array",s="get"+t,o="set"+t,u=sC[n],h=u,l=h&&h.prototype,f={},addElement=function(t,e){PC(t,e,{get:function(){return function(t,e){var r=IC(t);return r.view[s](e*i+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,n){var s=IC(t);r&&(n=(n=FC(n))<0?0:n>255?255:255&n),s.view[o](e*i+s.byteOffset,n,!0)}(this,e,t)},enumerable:!0})};DC?aC&&(h=e((function(t,e,r,s){return lC(t,h,n),LC(mC(e)?isArrayBuffer(e)?void 0!==s?new u(e,pC(r,i),s):void 0!==r?new u(e,pC(r,i)):new u(e):VC(e)?fromList(h,e):CC.call(h,e):new u(gC(e)),t,h)})),kC&&kC(h,WC),wC(TC(u),(function(t){t in h||fC(h,t,u[t])})),h.prototype=l):(h=e((function(t,e,r,s){lC(t,h,n);var o,u,l,f=0,d=0;if(mC(e)){if(!isArrayBuffer(e))return VC(e)?fromList(h,e):CC.call(h,e);o=e,d=pC(r,i);var _=e.byteLength;if(void 0===s){if(_%i)throw zC(XC);if((u=_-d)<0)throw zC(XC)}else if((u=_C(s)*i)+d>_)throw zC(XC);l=u/i}else l=gC(e),o=new UC(u=l*i);for(OC(t,{buffer:o,byteOffset:d,byteLength:u,length:l,view:new BC(o)});f<l;)addElement(t,f++)})),kC&&kC(h,WC),l=h.prototype=bC(HC)),l.constructor!==h&&fC(l,"constructor",h),fC(l,jC,h),NC&&fC(l,NC,n),f[n]=h,nC({global:!0,forced:h!=u,sham:!DC},f),YC in h||fC(h,YC,i),YC in l||fC(l,YC,i),AC(n)}):NT.exports=function(){},(0,NT.exports)("Float32",(function(t){return function Float32Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Float64",(function(t){return function Float64Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Int8",(function(t){return function Int8Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Int16",(function(t){return function Int16Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Int32",(function(t){return function Int32Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Uint8",(function(t){return function Uint8Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Uint8",(function(t){return function Uint8ClampedArray(e,r,i){return t(this,e,r,i)}}),!0),(0,NT.exports)("Uint16",(function(t){return function Uint16Array(e,r,i){return t(this,e,r,i)}})),(0,NT.exports)("Uint32",(function(t){return function Uint32Array(e,r,i){return t(this,e,r,i)}}));var ZC=Os,KC=El.aTypedArray;(0,El.exportTypedArrayMethod)("copyWithin",(function copyWithin(t,e){return ZC.call(KC(this),t,e,arguments.length>2?arguments[2]:void 0)}));var QC=$r.every,JC=El.aTypedArray;(0,El.exportTypedArrayMethod)("every",(function every(t){return QC(JC(this),t,arguments.length>1?arguments[1]:void 0)}));var tw=Hs,ew=El.aTypedArray;(0,El.exportTypedArrayMethod)("fill",(function fill(t){return tw.apply(ew(this),arguments)}));var arrayFromConstructorAndList$2=function(t,e){for(var r=0,i=e.length,n=new t(i);i>r;)n[r]=e[r++];return n},rw=speciesConstructor$f,iw=El.TYPED_ARRAY_CONSTRUCTOR,nw=El.aTypedArrayConstructor,typedArraySpeciesConstructor$5=function(t){return nw(rw(t,t[iw]))},sw=arrayFromConstructorAndList$2,ow=typedArraySpeciesConstructor$5,typedArrayFromSpeciesAndList=function(t,e){return sw(ow(t),e)},aw=$r.filter,uw=typedArrayFromSpeciesAndList,hw=El.aTypedArray;(0,El.exportTypedArrayMethod)("filter",(function filter(t){var e=aw(hw(this),t,arguments.length>1?arguments[1]:void 0);return uw(this,e)}));var lw=$r.find,cw=El.aTypedArray;(0,El.exportTypedArrayMethod)("find",(function find(t){return lw(cw(this),t,arguments.length>1?arguments[1]:void 0)}));var fw=$r.findIndex,dw=El.aTypedArray;(0,El.exportTypedArrayMethod)("findIndex",(function findIndex(t){return fw(dw(this),t,arguments.length>1?arguments[1]:void 0)}));var _w=$r.forEach,gw=El.aTypedArray;(0,El.exportTypedArrayMethod)("forEach",(function forEach(t){_w(gw(this),t,arguments.length>1?arguments[1]:void 0)})),(0,El.exportTypedArrayStaticMethod)("from",iC,qT);var pw=we.includes,vw=El.aTypedArray;(0,El.exportTypedArrayMethod)("includes",(function includes(t){return pw(vw(this),t,arguments.length>1?arguments[1]:void 0)}));var yw=we.indexOf,xw=El.aTypedArray;(0,El.exportTypedArrayMethod)("indexOf",(function indexOf(t){return yw(xw(this),t,arguments.length>1?arguments[1]:void 0)}));var mw=e,Sw=El,bw=Ca,kw=wellKnownSymbol$E("iterator"),Tw=mw.Uint8Array,Cw=bw.values,ww=bw.keys,Aw=bw.entries,Rw=Sw.aTypedArray,Ew=Sw.exportTypedArrayMethod,Lw=Tw&&Tw.prototype[kw],Iw=!!Lw&&("values"==Lw.name||null==Lw.name),Ow=function values(){return Cw.call(Rw(this))};Ew("entries",(function entries(){return Aw.call(Rw(this))})),Ew("keys",(function keys(){return ww.call(Rw(this))})),Ew("values",Ow,!Iw),Ew(kw,Ow,!Iw);var Pw=El.aTypedArray,Mw=[].join;(0,El.exportTypedArrayMethod)("join",(function join(t){return Mw.apply(Pw(this),arguments)}));var Fw=Da,zw=El.aTypedArray;(0,El.exportTypedArrayMethod)("lastIndexOf",(function lastIndexOf(t){return Fw.apply(zw(this),arguments)}));var Uw=$r.map,Bw=typedArraySpeciesConstructor$5,Dw=El.aTypedArray;(0,El.exportTypedArrayMethod)("map",(function map(t){return Uw(Dw(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Bw(t))(e)}))}));var jw=El.aTypedArrayConstructor;(0,El.exportTypedArrayStaticMethod)("of",(function of(){for(var t=0,e=arguments.length,r=new(jw(this))(e);e>t;)r[t]=arguments[t++];return r}),qT);var Nw=Ya.left,Ww=El.aTypedArray;(0,El.exportTypedArrayMethod)("reduce",(function reduce(t){return Nw(Ww(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Hw=Ya.right,Gw=El.aTypedArray;(0,El.exportTypedArrayMethod)("reduceRight",(function reduceRight(t){return Hw(Gw(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Vw=El.aTypedArray,Yw=El.exportTypedArrayMethod,Xw=Math.floor;Yw("reverse",(function reverse(){for(var t,e=this,r=Vw(e).length,i=Xw(r/2),n=0;n<i;)t=e[n],e[n++]=e[--r],e[r]=t;return e}));var qw=toLength$C,$w=toOffset$2,Zw=toObject$x,Kw=El.aTypedArray;(0,El.exportTypedArrayMethod)("set",(function set(t){Kw(this);var e=$w(arguments.length>1?arguments[1]:void 0,1),r=this.length,i=Zw(t),n=qw(i.length),s=0;if(n+e>r)throw RangeError("Wrong length");for(;s<n;)this[e+s]=i[s++]}),fails$11((function(){new Int8Array(1).set({})})));var Qw=typedArraySpeciesConstructor$5,Jw=El.aTypedArray,tA=[].slice;(0,El.exportTypedArrayMethod)("slice",(function slice(t,e){for(var r=tA.call(Jw(this),t,e),i=Qw(this),n=0,s=r.length,o=new i(s);s>n;)o[n]=r[n++];return o}),fails$11((function(){new Int8Array(1).slice()})));var eA=$r.some,rA=El.aTypedArray;(0,El.exportTypedArrayMethod)("some",(function some(t){return eA(rA(this),t,arguments.length>1?arguments[1]:void 0)}));var iA=fails$11,nA=aFunction$S,sA=toLength$C,oA=vu,aA=xu,uA=mu,hA=w,lA=bu,cA=El.aTypedArray,fA=El.exportTypedArrayMethod,dA=e.Uint16Array,_A=dA&&dA.prototype.sort,gA=!!_A&&!iA((function(){var t=new dA(2);t.sort(null),t.sort({})})),pA=!!_A&&!iA((function(){if(hA)return hA<74;if(aA)return aA<67;if(uA)return!0;if(lA)return lA<602;var t,e,r=new dA(516),i=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,i[t]=t-2*e+3;for(r.sort((function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==i[t])return!0}));fA("sort",(function sort(t){var e=this;if(void 0!==t&&nA(t),pA)return _A.call(e,t);cA(e);var r,i=sA(e.length),n=Array(i);for(r=0;r<i;r++)n[r]=e[r];for(n=oA(e,function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t)),r=0;r<i;r++)e[r]=n[r];return e}),!pA||gA);var vA=toLength$C,yA=toAbsoluteIndex$8,xA=typedArraySpeciesConstructor$5,mA=El.aTypedArray;(0,El.exportTypedArrayMethod)("subarray",(function subarray(t,e){var r=mA(this),i=r.length,n=yA(t,i);return new(xA(r))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,vA((void 0===e?i:yA(e,i))-n))}));var SA=El,bA=fails$11,kA=e.Int8Array,TA=SA.aTypedArray,CA=SA.exportTypedArrayMethod,wA=[].toLocaleString,AA=[].slice,RA=!!kA&&bA((function(){wA.call(new kA(1))}));CA("toLocaleString",(function toLocaleString(){return wA.apply(RA?AA.call(TA(this)):TA(this),arguments)}),bA((function(){return[1,2].toLocaleString()!=new kA([1,2]).toLocaleString()}))||!bA((function(){kA.prototype.toLocaleString.call([1,2])})));var EA=El.exportTypedArrayMethod,LA=fails$11,IA=e.Uint8Array,OA=IA&&IA.prototype||{},PA=[].toString,MA=[].join;LA((function(){PA.call({})}))&&(PA=function toString(){return MA.call(this)});var FA=OA.toString!=PA;EA("toString",PA,FA);var zA=_export,UA=toString$s,BA=String.fromCharCode,DA=/^[\da-f]{2}$/i,jA=/^[\da-f]{4}$/i;zA({global:!0},{unescape:function unescape(t){for(var e,r,i=UA(t),n="",s=i.length,o=0;o<s;){if("%"===(e=i.charAt(o++)))if("u"===i.charAt(o)){if(r=i.slice(o+1,o+5),jA.test(r)){n+=BA(parseInt(r,16)),o+=5;continue}}else if(r=i.slice(o,o+2),DA.test(r)){n+=BA(parseInt(r,16)),o+=2;continue}n+=e}return n}});var NA={exports:{}},WA=redefineAll$9,HA=Kc.exports.getWeakData,GA=anObject$1z,VA=isObject$C,YA=anInstance$b,XA=iterate$I,qA=G,$A=oe.set,ZA=oe.getterFor,KA=$r.find,QA=$r.findIndex,JA=0,uncaughtFrozenStore=function(t){return t.frozen||(t.frozen=new UncaughtFrozenStore)},UncaughtFrozenStore=function(){this.entries=[]},findUncaughtFrozen=function(t,e){return KA(t.entries,(function(t){return t[0]===e}))};UncaughtFrozenStore.prototype={get:function(t){var e=findUncaughtFrozen(this,t);if(e)return e[1]},has:function(t){return!!findUncaughtFrozen(this,t)},set:function(t,e){var r=findUncaughtFrozen(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=QA(this.entries,(function(e){return e[0]===t}));return~e&&this.entries.splice(e,1),!!~e}};var tR,eR={getConstructor:function(t,e,r,i){var n=t((function(t,s){YA(t,n,e),$A(t,{type:e,id:JA++,frozen:void 0}),null!=s&&XA(s,t[i],{that:t,AS_ENTRIES:r})})),s=ZA(e),define=function(t,e,r){var i=s(t),n=HA(GA(e),!0);return!0===n?uncaughtFrozenStore(i).set(e,r):n[i.id]=r,t};return WA(n.prototype,{delete:function(t){var e=s(this);if(!VA(t))return!1;var r=HA(t);return!0===r?uncaughtFrozenStore(e).delete(t):r&&qA(r,e.id)&&delete r[e.id]},has:function has(t){var e=s(this);if(!VA(t))return!1;var r=HA(t);return!0===r?uncaughtFrozenStore(e).has(t):r&&qA(r,e.id)}}),WA(n.prototype,r?{get:function get(t){var e=s(this);if(VA(t)){var r=HA(t);return!0===r?uncaughtFrozenStore(e).get(t):r?r[e.id]:void 0}},set:function set(t,e){return define(this,t,e)}}:{add:function add(t){return define(this,t,!0)}}),n}},rR=e,iR=redefineAll$9,nR=Kc.exports,sR=collection$4,oR=eR,aR=isObject$C,uR=oe.enforce,hR=Nt,lR=!rR.ActiveXObject&&"ActiveXObject"in rR,cR=Object.isExtensible,wrapper=function(t){return function WeakMap(){return t(this,arguments.length?arguments[0]:void 0)}},fR=NA.exports=sR("WeakMap",wrapper,oR);if(hR&&lR){tR=oR.getConstructor(wrapper,"WeakMap",!0),nR.enable();var dR=fR.prototype,_R=dR.delete,gR=dR.has,pR=dR.get,vR=dR.set;iR(dR,{delete:function(t){if(aR(t)&&!cR(t)){var e=uR(this);return e.frozen||(e.frozen=new tR),_R.call(this,t)||e.frozen.delete(t)}return _R.call(this,t)},has:function has(t){if(aR(t)&&!cR(t)){var e=uR(this);return e.frozen||(e.frozen=new tR),gR.call(this,t)||e.frozen.has(t)}return gR.call(this,t)},get:function get(t){if(aR(t)&&!cR(t)){var e=uR(this);return e.frozen||(e.frozen=new tR),gR.call(this,t)?pR.call(this,t):e.frozen.get(t)}return pR.call(this,t)},set:function set(t,e){if(aR(t)&&!cR(t)){var r=uR(this);r.frozen||(r.frozen=new tR),gR.call(this,t)?vR.call(this,t,e):r.frozen.set(t,e)}else vR.call(this,t,e);return this}})}collection$4("WeakSet",(function(t){return function WeakSet(){return t(this,arguments.length?arguments[0]:void 0)}}),eR);var yR=toObject$x,xR=toLength$C,mR=toInteger$h,SR=addToUnscopables$h;_export({target:"Array",proto:!0},{at:function at(t){var e=yR(this),r=xR(e.length),i=mR(t),n=i>=0?i:r+i;return n<0||n>=r?void 0:e[n]}}),SR("at");var bR=$r.filterReject,kR=addToUnscopables$h;_export({target:"Array",proto:!0},{filterOut:function filterOut(t){return bR(this,t,arguments.length>1?arguments[1]:void 0)}}),kR("filterOut");var TR=$r.filterReject,CR=addToUnscopables$h;_export({target:"Array",proto:!0},{filterReject:function filterReject(t){return TR(this,t,arguments.length>1?arguments[1]:void 0)}}),CR("filterReject");var wR=functionBindContext,AR=g,RR=toObject$x,ER=toLength$C,createMethod$1=function(t){var e=1==t;return function(r,i,n){for(var s,o=RR(r),u=AR(o),h=wR(i,n,3),l=ER(u.length);l-- >0;)if(h(s=u[l],l,o))switch(t){case 0:return s;case 1:return l}return e?-1:void 0}},LR={findLast:createMethod$1(0),findLastIndex:createMethod$1(1)},IR=LR.findLast,OR=addToUnscopables$h;_export({target:"Array",proto:!0},{findLast:function findLast(t){return IR(this,t,arguments.length>1?arguments[1]:void 0)}}),OR("findLast");var PR=LR.findLastIndex,MR=addToUnscopables$h;_export({target:"Array",proto:!0},{findLastIndex:function findLastIndex(t){return PR(this,t,arguments.length>1?arguments[1]:void 0)}}),MR("findLastIndex");var FR=functionBindContext,zR=g,UR=toObject$x,BR=toLength$C,DR=toPropertyKey$9,jR=br,NR=arrayFromConstructorAndList$2,WR=[].push,arrayGroupBy=function(t,e,r,i){for(var n,s,o,u=UR(t),h=zR(u),l=FR(e,r,3),f=jR(null),d=BR(h.length),_=0;d>_;_++)o=h[_],(s=DR(l(o,_,u)))in f?WR.call(f[s],o):f[s]=[o];if(i&&(n=i(u))!==Array)for(s in f)f[s]=NR(n,f[s]);return f},HR=arrayGroupBy,GR=arraySpeciesConstructor$2,VR=addToUnscopables$h;_export({target:"Array",proto:!0},{groupBy:function groupBy(t){var e=arguments.length>1?arguments[1]:void 0;return HR(this,t,e,GR)}}),VR("groupBy");var YR=_export,XR=sr,qR=Object.isFrozen,isFrozenStringArray=function(t,e){if(!qR||!XR(t)||!qR(t))return!1;for(var r,i=0,n=t.length;i<n;)if(!("string"==typeof(r=t[i++])||e&&void 0===r))return!1;return 0!==n};YR({target:"Array",stat:!0},{isTemplateObject:function isTemplateObject(t){if(!isFrozenStringArray(t,!0))return!1;var e=t.raw;return!(e.length!==t.length||!isFrozenStringArray(e,!1))}});var $R=i,ZR=addToUnscopables$h,KR=toObject$x,QR=toLength$C,JR=bt.f;$R&&!("lastIndex"in[])&&(JR(Array.prototype,"lastIndex",{configurable:!0,get:function lastIndex(){var t=KR(this),e=QR(t.length);return 0==e?0:e-1}}),ZR("lastIndex"));var tE=i,eE=addToUnscopables$h,rE=toObject$x,iE=toLength$C,nE=bt.f;tE&&!("lastItem"in[])&&(nE(Array.prototype,"lastItem",{configurable:!0,get:function lastItem(){var t=rE(this),e=iE(t.length);return 0==e?void 0:t[e-1]},set:function lastItem(t){var e=rE(this),r=iE(e.length);return e[0==r?0:r-1]=t}}),eE("lastItem"));var sE=toLength$C,oE=toObject$x,aE=getBuiltIn$u,uE=arraySpeciesCreate$6,hE=[].push,lE=function uniqueBy(t){var e,r,i,n,s=oE(this),o=sE(s.length),u=uE(s,0),h=new(aE("Map"));if("function"==typeof t)e=t;else{if(null!=t)throw new TypeError("Incorrect resolver!");e=function(t){return t}}for(r=0;r<o;r++)n=e(i=s[r]),h.has(n)||h.set(n,i);return h.forEach((function(t){hE.call(u,t)})),u},cE=addToUnscopables$h;_export({target:"Array",proto:!0},{uniqueBy:lE}),cE("uniqueBy");var fE,dE,_E=e,gE=D,pE=Cn,vE=G,yE=It,xE=wellKnownSymbol$E("asyncIterator"),mE=_E.AsyncIterator,SE=gE.AsyncIteratorPrototype;if(SE)fE=SE;else if("function"==typeof mE)fE=mE.prototype;else if(gE.USE_FUNCTION_CONSTRUCTOR||_E.USE_FUNCTION_CONSTRUCTOR)try{dE=pE(pE(pE(Function("return async function*(){}()")()))),pE(dE)===Object.prototype&&(fE=dE)}catch(t){}fE||(fE={}),vE(fE,xE)||yE(fE,xE,(function(){return this}));var bE=_export,kE=anInstance$b,TE=It,CE=G,wE=fE,AE=wellKnownSymbol$E("toStringTag"),EE=function AsyncIterator(){kE(this,EE)};EE.prototype=wE,CE(wE,AE)||TE(wE,AE,"AsyncIterator"),CE(wE,"constructor")&&wE.constructor!==Object||TE(wE,"constructor",EE),bE({global:!0,forced:false},{AsyncIterator:EE});var LE=Lr,IE=aFunction$S,OE=anObject$1z,PE=br,ME=It,FE=redefineAll$9,zE=wellKnownSymbol$E,UE=oe,BE=getBuiltIn$u("Promise"),DE=UE.set,jE=UE.get,NE=zE("toStringTag"),$return$1=function(t){var e=jE(this).iterator,r=e.return;return void 0===r?BE.resolve({done:!0,value:t}):OE(r.call(e,t))},$throw$1=function(t){var e=jE(this).iterator,r=e.throw;return void 0===r?BE.reject(t):r.call(e,t)},asyncIteratorCreateProxy=function(t,e){var r=function AsyncIterator(t){t.next=IE(t.iterator.next),t.done=!1,DE(this,t)};return r.prototype=FE(PE(LE.AsyncIterator.prototype),{next:function next(e){var r=jE(this);if(r.done)return BE.resolve({done:!0,value:void 0});try{return BE.resolve(OE(t.call(r,e,BE)))}catch(t){return BE.reject(t)}},return:$return$1,throw:$throw$1}),e||ME(r.prototype,NE,"Generator"),r},WE=_export,HE=anObject$1z,GE=asyncIteratorCreateProxy((function(t,e){var r=this,i=r.iterator;return e.resolve(HE(r.next.call(i,t))).then((function(t){return HE(t).done?(r.done=!0,{done:!0,value:void 0}):{done:!1,value:[r.index++,t.value]}}))}));WE({target:"AsyncIterator",proto:!0,real:!0},{asIndexedPairs:function asIndexedPairs(){return new GE({iterator:HE(this),index:0})}});var VE=_export,YE=anObject$1z,XE=toPositiveInteger$5,qE=asyncIteratorCreateProxy((function(t,e){var r=this;return new e((function(i,n){var loop=function(){try{e.resolve(YE(r.next.call(r.iterator,r.remaining?void 0:t))).then((function(t){try{YE(t).done?(r.done=!0,i({done:!0,value:void 0})):r.remaining?(r.remaining--,loop()):i({done:!1,value:t.value})}catch(t){n(t)}}),n)}catch(t){n(t)}};loop()}))}));VE({target:"AsyncIterator",proto:!0,real:!0},{drop:function drop(t){return new qE({iterator:YE(this),remaining:XE(t)})}});var $E=aFunction$S,ZE=anObject$1z,KE=getBuiltIn$u("Promise"),QE=[].push,createMethod=function(t){var e=0==t,r=1==t,i=2==t,n=3==t;return function(t,s){ZE(t);var o=$E(t.next),u=e?[]:void 0;return e||$E(s),new KE((function(h,l){var closeIteration=function(e,r){try{var i=t.return;if(void 0!==i)return KE.resolve(i.call(t)).then((function(){e(r)}),(function(t){l(t)}))}catch(t){return l(t)}e(r)},onError=function(t){closeIteration(l,t)},loop=function(){try{KE.resolve(ZE(o.call(t))).then((function(t){try{if(ZE(t).done)h(e?u:!n&&(i||void 0));else{var o=t.value;e?(QE.call(u,o),loop()):KE.resolve(s(o)).then((function(t){r?loop():i?t?loop():closeIteration(h,!1):t?closeIteration(h,n||o):loop()}),onError)}}catch(t){onError(t)}}),onError)}catch(t){onError(t)}};loop()}))}},JE={toArray:createMethod(0),forEach:createMethod(1),every:createMethod(2),some:createMethod(3),find:createMethod(4)},tL=JE.every;_export({target:"AsyncIterator",proto:!0,real:!0},{every:function every(t){return tL(this,t)}});var eL=_export,rL=aFunction$S,iL=anObject$1z,nL=asyncIteratorCreateProxy((function(t,e){var r=this,i=r.filterer;return new e((function(n,s){var loop=function(){try{e.resolve(iL(r.next.call(r.iterator,t))).then((function(t){try{if(iL(t).done)r.done=!0,n({done:!0,value:void 0});else{var o=t.value;e.resolve(i(o)).then((function(t){t?n({done:!1,value:o}):loop()}),s)}}catch(t){s(t)}}),s)}catch(t){s(t)}};loop()}))}));eL({target:"AsyncIterator",proto:!0,real:!0},{filter:function filter(t){return new nL({iterator:iL(this),filterer:rL(t)})}});var sL=JE.find;_export({target:"AsyncIterator",proto:!0,real:!0},{find:function find(t){return sL(this,t)}});var oL=getIteratorMethod$8,aL=wellKnownSymbol$E("asyncIterator"),getAsyncIteratorMethod$2=function(t){var e=t[aL];return void 0===e?oL(t):e},uL=_export,hL=aFunction$S,lL=anObject$1z,cL=getAsyncIteratorMethod$2,fL=asyncIteratorCreateProxy((function(t,e){var r,i,n=this,s=n.mapper;return new e((function(o,u){var outerLoop=function(){try{e.resolve(lL(n.next.call(n.iterator,t))).then((function(t){try{lL(t).done?(n.done=!0,o({done:!0,value:void 0})):e.resolve(s(t.value)).then((function(t){try{if(void 0!==(i=cL(t)))return n.innerIterator=r=lL(i.call(t)),n.innerNext=hL(r.next),innerLoop();u(TypeError(".flatMap callback should return an iterable object"))}catch(t){u(t)}}),u)}catch(t){u(t)}}),u)}catch(t){u(t)}},innerLoop=function(){if(r=n.innerIterator)try{e.resolve(lL(n.innerNext.call(r))).then((function(t){try{lL(t).done?(n.innerIterator=n.innerNext=null,outerLoop()):o({done:!1,value:t.value})}catch(t){u(t)}}),u)}catch(t){u(t)}else outerLoop()};innerLoop()}))}));uL({target:"AsyncIterator",proto:!0,real:!0},{flatMap:function flatMap(t){return new fL({iterator:lL(this),mapper:hL(t),innerIterator:null,innerNext:null})}});var dL=JE.forEach;_export({target:"AsyncIterator",proto:!0,real:!0},{forEach:function forEach(t){return dL(this,t)}});var _L=_export,gL=aFunction$S,pL=anObject$1z,vL=toObject$x,yL=asyncIteratorCreateProxy,xL=getAsyncIteratorMethod$2,mL=Lr.AsyncIterator,SL=yL((function(t){return pL(this.next.call(this.iterator,t))}),!0);_L({target:"AsyncIterator",stat:!0},{from:function from(t){var e,r=vL(t),i=xL(r);if(null!=i){if((e=gL(i).call(r))instanceof mL)return e}else e=r;return new SL({iterator:e})}});var bL=_export,kL=aFunction$S,TL=anObject$1z,CL=asyncIteratorCreateProxy((function(t,e){var r=this,i=r.mapper;return e.resolve(TL(r.next.call(r.iterator,t))).then((function(t){return TL(t).done?(r.done=!0,{done:!0,value:void 0}):e.resolve(i(t.value)).then((function(t){return{done:!1,value:t}}))}))}));bL({target:"AsyncIterator",proto:!0,real:!0},{map:function map(t){return new CL({iterator:TL(this),mapper:kL(t)})}});var wL=_export,AL=aFunction$S,RL=anObject$1z,EL=getBuiltIn$u("Promise");wL({target:"AsyncIterator",proto:!0,real:!0},{reduce:function reduce(t){var e=RL(this),r=AL(e.next),i=arguments.length<2,n=i?void 0:arguments[1];return AL(t),new EL((function(s,o){var loop=function(){try{EL.resolve(RL(r.call(e))).then((function(e){try{if(RL(e).done)i?o(TypeError("Reduce of empty iterator with no initial value")):s(n);else{var r=e.value;i?(i=!1,n=r,loop()):EL.resolve(t(n,r)).then((function(t){n=t,loop()}),o)}}catch(t){o(t)}}),o)}catch(t){o(t)}};loop()}))}});var LL=JE.some;_export({target:"AsyncIterator",proto:!0,real:!0},{some:function some(t){return LL(this,t)}});var IL=_export,OL=anObject$1z,PL=toPositiveInteger$5,ML=asyncIteratorCreateProxy((function(t,e){var r,i,n=this.iterator;return this.remaining--?this.next.call(n,t):(i={done:!0,value:void 0},this.done=!0,void 0!==(r=n.return)?e.resolve(r.call(n)).then((function(){return i})):i)}));IL({target:"AsyncIterator",proto:!0,real:!0},{take:function take(t){return new ML({iterator:OL(this),remaining:PL(t)})}});var FL=JE.toArray;_export({target:"AsyncIterator",proto:!0,real:!0},{toArray:function toArray(){return FL(this)}});var zL=oe,UL=createIteratorConstructor$7,BL=isObject$C,DL=dr,jL=i,NL="Incorrect Number.range arguments",WL="NumericRangeIterator",HL=zL.set,GL=zL.getterFor(WL),VL=UL((function NumericRangeIterator(t,e,r,i,n,s){if(typeof t!=i||e!==1/0&&e!==-1/0&&typeof e!=i)throw new TypeError(NL);if(t===1/0||t===-1/0)throw new RangeError(NL);var o,u=e>t,h=!1;if(void 0===r)o=void 0;else if(BL(r))o=r.step,h=!!r.inclusive;else{if(typeof r!=i)throw new TypeError(NL);o=r}if(null==o&&(o=u?s:-s),typeof o!=i)throw new TypeError(NL);if(o===1/0||o===-1/0||o===n&&t!==e)throw new RangeError(NL);HL(this,{type:WL,start:t,end:e,step:o,inclusiveEnd:h,hitsEnd:t!=t||e!=e||o!=o||e>t!=o>n,currentCount:n,zero:n}),jL||(this.start=t,this.end=e,this.step=o,this.inclusive=h)}),WL,(function next(){var t=GL(this);if(t.hitsEnd)return{value:void 0,done:!0};var e=t.start,r=t.end,i=e+t.step*t.currentCount++;i===r&&(t.hitsEnd=!0);var n=t.inclusiveEnd;return(r>e?n?i>r:i>=r:n?r>i:r>=i)?{value:void 0,done:t.hitsEnd=!0}:{value:i,done:!1}})),getter=function(t){return{get:t,set:function(){},configurable:!0,enumerable:!1}};jL&&DL(VL.prototype,{start:getter((function(){return GL(this).start})),end:getter((function(){return GL(this).end})),inclusive:getter((function(){return GL(this).inclusiveEnd})),step:getter((function(){return GL(this).step}))});var YL=VL,XL=YL;"function"==typeof BigInt&&_export({target:"BigInt",stat:!0},{range:function range(t,e,r){return new XL(t,e,r,"bigint",BigInt(0),BigInt(1))}});var qL=Wf,$L=NA.exports,ZL=br,KL=isObject$C,Node=function(){this.object=null,this.symbol=null,this.primitives=null,this.objectsByIndex=ZL(null)};Node.prototype.get=function(t,e){return this[t]||(this[t]=e())},Node.prototype.next=function(t,e,r){var i=r?this.objectsByIndex[t]||(this.objectsByIndex[t]=new $L):this.primitives||(this.primitives=new qL),n=i.get(e);return n||i.set(e,n=new Node),n};var QL=new Node,compositeKey=function(){var t,e,r=QL,i=arguments.length;for(t=0;t<i;t++)KL(e=arguments[t])&&(r=r.next(t,e,!0));if(this===Object&&r===QL)throw TypeError("Composite keys must contain a non-primitive component");for(t=0;t<i;t++)KL(e=arguments[t])||(r=r.next(t,e,!1));return r},JL=compositeKey,tI=getBuiltIn$u,eI=br,initializer=function(){var t=tI("Object","freeze");return t?t(eI(null)):eI(null)};_export({global:!0},{compositeKey:function compositeKey(){return JL.apply(Object,arguments).get("object",initializer)}});var rI=compositeKey,iI=getBuiltIn$u;_export({global:!0},{compositeSymbol:function compositeSymbol(){return 1===arguments.length&&"string"==typeof arguments[0]?iI("Symbol").for(arguments[0]):rI.apply(null,arguments).get("symbol",iI("Symbol"))}});var nI=_export,sI=e,oI=anInstance$b,aI=It,uI=fails$11,hI=G,lI=wellKnownSymbol$E,cI=Ko.IteratorPrototype;lI("iterator");var fI=lI("toStringTag"),dI=sI.Iterator,_I="function"!=typeof dI||dI.prototype!==cI||!uI((function(){dI({})})),gI=function Iterator(){oI(this,gI)};hI(cI,fI)||aI(cI,fI,"Iterator"),!_I&&hI(cI,"constructor")&&cI.constructor!==Object||aI(cI,"constructor",gI),gI.prototype=cI,nI({global:!0,forced:_I},{Iterator:gI});var pI=Lr,vI=aFunction$S,yI=anObject$1z,xI=br,mI=It,SI=redefineAll$9,bI=oe.set,kI=oe.get,TI=wellKnownSymbol$E("toStringTag"),$return=function(t){var e=kI(this).iterator,r=e.return;return void 0===r?{done:!0,value:t}:yI(r.call(e,t))},$throw=function(t){var e=kI(this).iterator,r=e.throw;if(void 0===r)throw t;return r.call(e,t)},iteratorCreateProxy=function(t,e){var r=function Iterator(t){t.next=vI(t.iterator.next),t.done=!1,bI(this,t)};return r.prototype=SI(xI(pI.Iterator.prototype),{next:function next(){var e=kI(this),r=e.done?void 0:t.apply(e,arguments);return{done:e.done,value:r}},return:$return,throw:$throw}),e||mI(r.prototype,TI,"Generator"),r},CI=_export,wI=anObject$1z,AI=iteratorCreateProxy((function(t){var e=wI(this.next.call(this.iterator,t));if(!(this.done=!!e.done))return[this.index++,e.value]}));CI({target:"Iterator",proto:!0,real:!0},{asIndexedPairs:function asIndexedPairs(){return new AI({iterator:wI(this),index:0})}});var RI=_export,EI=anObject$1z,LI=toPositiveInteger$5,II=iteratorCreateProxy((function(t){for(var e,r=this.iterator,i=this.next;this.remaining;)if(this.remaining--,e=EI(i.call(r)),this.done=!!e.done)return;if(e=EI(i.call(r,t)),!(this.done=!!e.done))return e.value}));RI({target:"Iterator",proto:!0,real:!0},{drop:function drop(t){return new II({iterator:EI(this),remaining:LI(t)})}});var OI=iterate$I,PI=aFunction$S,MI=anObject$1z;_export({target:"Iterator",proto:!0,real:!0},{every:function every(t){return MI(this),PI(t),!OI(this,(function(e,r){if(!t(e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var FI=_export,zI=aFunction$S,UI=anObject$1z,BI=callWithSafeIterationClosing$3,DI=iteratorCreateProxy((function(t){for(var e,r,i=this.iterator,n=this.filterer,s=this.next;;){if(e=UI(s.call(i,t)),this.done=!!e.done)return;if(r=e.value,BI(i,n,r))return r}}));FI({target:"Iterator",proto:!0,real:!0},{filter:function filter(t){return new DI({iterator:UI(this),filterer:zI(t)})}});var jI=iterate$I,NI=aFunction$S,WI=anObject$1z;_export({target:"Iterator",proto:!0,real:!0},{find:function find(t){return WI(this),NI(t),jI(this,(function(e,r){if(t(e))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var HI=_export,GI=aFunction$S,VI=anObject$1z,YI=getIteratorMethod$8,XI=iteratorClose$4,qI=iteratorCreateProxy((function(t){for(var e,r,i,n,s=this.iterator,o=this.mapper;;)try{if(n=this.innerIterator){if(!(e=VI(this.innerNext.call(n))).done)return e.value;this.innerIterator=this.innerNext=null}if(e=VI(this.next.call(s,t)),this.done=!!e.done)return;if(r=o(e.value),void 0===(i=YI(r)))throw TypeError(".flatMap callback should return an iterable object");this.innerIterator=n=VI(i.call(r)),this.innerNext=GI(n.next)}catch(t){throw XI(s),t}}));HI({target:"Iterator",proto:!0,real:!0},{flatMap:function flatMap(t){return new qI({iterator:VI(this),mapper:GI(t),innerIterator:null,innerNext:null})}});var $I=iterate$I,ZI=anObject$1z;_export({target:"Iterator",proto:!0,real:!0},{forEach:function forEach(t){$I(ZI(this),t,{IS_ITERATOR:!0})}});var KI=_export,QI=aFunction$S,JI=anObject$1z,tO=toObject$x,eO=iteratorCreateProxy,rO=getIteratorMethod$8,iO=Lr.Iterator,nO=eO((function(t){var e=JI(this.next.call(this.iterator,t));if(!(this.done=!!e.done))return e.value}),!0);KI({target:"Iterator",stat:!0},{from:function from(t){var e,r=tO(t),i=rO(r);if(null!=i){if((e=QI(i).call(r))instanceof iO)return e}else e=r;return new nO({iterator:e})}});var sO=_export,oO=aFunction$S,aO=anObject$1z,uO=callWithSafeIterationClosing$3,hO=iteratorCreateProxy((function(t){var e=this.iterator,r=aO(this.next.call(e,t));if(!(this.done=!!r.done))return uO(e,this.mapper,r.value)}));sO({target:"Iterator",proto:!0,real:!0},{map:function map(t){return new hO({iterator:aO(this),mapper:oO(t)})}});var lO=iterate$I,cO=aFunction$S,fO=anObject$1z;_export({target:"Iterator",proto:!0,real:!0},{reduce:function reduce(t){fO(this),cO(t);var e=arguments.length<2,r=e?void 0:arguments[1];if(lO(this,(function(i){e?(e=!1,r=i):r=t(r,i)}),{IS_ITERATOR:!0}),e)throw TypeError("Reduce of empty iterator with no initial value");return r}});var dO=iterate$I,_O=aFunction$S,gO=anObject$1z;_export({target:"Iterator",proto:!0,real:!0},{some:function some(t){return gO(this),_O(t),dO(this,(function(e,r){if(t(e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var pO=_export,vO=anObject$1z,yO=toPositiveInteger$5,xO=iteratorClose$4,mO=iteratorCreateProxy((function(t){var e=this.iterator;if(!this.remaining--)return this.done=!0,xO(e);var r=vO(this.next.call(e,t));return(this.done=!!r.done)?void 0:r.value}));pO({target:"Iterator",proto:!0,real:!0},{take:function take(t){return new mO({iterator:vO(this),remaining:yO(t)})}});var SO=iterate$I,bO=anObject$1z,kO=[].push;_export({target:"Iterator",proto:!0,real:!0},{toArray:function toArray(){var t=[];return SO(bO(this),kO,{that:t,IS_ITERATOR:!0}),t}});var TO=anObject$1z,CO=aFunction$S,collectionDeleteAll$4=function(){for(var t,e=TO(this),r=CO(e.delete),i=!0,n=0,s=arguments.length;n<s;n++)t=r.call(e,arguments[n]),i=i&&t;return!!i},wO=collectionDeleteAll$4;_export({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function deleteAll(){return wO.apply(this,arguments)}});var AO=anObject$1z,RO=function emplace(t,e){var r=AO(this),i=r.has(t)&&"update"in e?e.update(r.get(t),t,r):e.insert(t,r);return r.set(t,i),i};_export({target:"Map",proto:!0,real:!0,forced:false},{emplace:RO});var getMapIterator$a=function(t){return Map.prototype.entries.call(t)},EO=anObject$1z,LO=functionBindContext,IO=getMapIterator$a,OO=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{every:function every(t){var e=EO(this),r=IO(e),i=LO(t,arguments.length>1?arguments[1]:void 0,3);return!OO(r,(function(t,r,n){if(!i(r,t,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var PO=getBuiltIn$u,MO=anObject$1z,FO=aFunction$S,zO=functionBindContext,UO=speciesConstructor$f,BO=getMapIterator$a,DO=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{filter:function filter(t){var e=MO(this),r=BO(e),i=zO(t,arguments.length>1?arguments[1]:void 0,3),n=new(UO(e,PO("Map"))),s=FO(n.set);return DO(r,(function(t,r){i(r,t,e)&&s.call(n,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var jO=anObject$1z,NO=functionBindContext,WO=getMapIterator$a,HO=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{find:function find(t){var e=jO(this),r=WO(e),i=NO(t,arguments.length>1?arguments[1]:void 0,3);return HO(r,(function(t,r,n){if(i(r,t,e))return n(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var GO=anObject$1z,VO=functionBindContext,YO=getMapIterator$a,XO=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{findKey:function findKey(t){var e=GO(this),r=YO(e),i=VO(t,arguments.length>1?arguments[1]:void 0,3);return XO(r,(function(t,r,n){if(i(r,t,e))return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var qO=aFunction$S,$O=functionBindContext,ZO=iterate$I,KO=function from(t){var e,r,i,n,s=arguments.length,o=s>1?arguments[1]:void 0;return qO(this),(e=void 0!==o)&&qO(o),null==t?new this:(r=[],e?(i=0,n=$O(o,s>2?arguments[2]:void 0,2),ZO(t,(function(t){r.push(n(t,i++))}))):ZO(t,r.push,{that:r}),new this(r))};_export({target:"Map",stat:!0},{from:KO});var QO=iterate$I,JO=aFunction$S;_export({target:"Map",stat:!0},{groupBy:function groupBy(t,e){var r=new this;JO(e);var i=JO(r.has),n=JO(r.get),s=JO(r.set);return QO(t,(function(t){var o=e(t);i.call(r,o)?n.call(r,o).push(t):s.call(r,o,[t])})),r}});var tP=anObject$1z,eP=getMapIterator$a,sameValueZero=function(t,e){return t===e||t!=t&&e!=e},rP=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{includes:function includes(t){return rP(eP(tP(this)),(function(e,r,i){if(sameValueZero(r,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var iP=iterate$I,nP=aFunction$S;_export({target:"Map",stat:!0},{keyBy:function keyBy(t,e){var r=new this;nP(e);var i=nP(r.set);return iP(t,(function(t){i.call(r,e(t),t)})),r}});var sP=anObject$1z,oP=getMapIterator$a,aP=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function keyOf(t){return aP(oP(sP(this)),(function(e,r,i){if(r===t)return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var uP=getBuiltIn$u,hP=anObject$1z,lP=aFunction$S,cP=functionBindContext,fP=speciesConstructor$f,dP=getMapIterator$a,_P=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function mapKeys(t){var e=hP(this),r=dP(e),i=cP(t,arguments.length>1?arguments[1]:void 0,3),n=new(fP(e,uP("Map"))),s=lP(n.set);return _P(r,(function(t,r){s.call(n,i(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var gP=getBuiltIn$u,pP=anObject$1z,vP=aFunction$S,yP=functionBindContext,xP=speciesConstructor$f,mP=getMapIterator$a,SP=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function mapValues(t){var e=pP(this),r=mP(e),i=yP(t,arguments.length>1?arguments[1]:void 0,3),n=new(xP(e,gP("Map"))),s=vP(n.set);return SP(r,(function(t,r){s.call(n,t,i(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n}});var bP=anObject$1z,kP=aFunction$S,TP=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{merge:function merge(t){for(var e=bP(this),r=kP(e.set),i=arguments.length,n=0;n<i;)TP(arguments[n++],r,{that:e,AS_ENTRIES:!0});return e}});var CP=function of(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)};_export({target:"Map",stat:!0},{of:CP});var wP=anObject$1z,AP=aFunction$S,RP=getMapIterator$a,EP=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{reduce:function reduce(t){var e=wP(this),r=RP(e),i=arguments.length<2,n=i?void 0:arguments[1];if(AP(t),EP(r,(function(r,s){i?(i=!1,n=s):n=t(n,s,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i)throw TypeError("Reduce of empty map with no initial value");return n}});var LP=anObject$1z,IP=functionBindContext,OP=getMapIterator$a,PP=iterate$I;_export({target:"Map",proto:!0,real:!0,forced:false},{some:function some(t){var e=LP(this),r=OP(e),i=IP(t,arguments.length>1?arguments[1]:void 0,3);return PP(r,(function(t,r,n){if(i(r,t,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var MP=anObject$1z,FP=aFunction$S;_export({target:"Map",proto:!0,real:!0,forced:false},{update:function update(t,e){var r=MP(this),i=arguments.length;FP(e);var n=r.has(t);if(!n&&i<3)throw TypeError("Updating absent value");var s=n?r.get(t):FP(i>2?arguments[2]:void 0)(t,r);return r.set(t,e(s,t,r)),r}});var zP=anObject$1z,UP=function upsert(t,e){var r,i=zP(this),n=arguments.length>2?arguments[2]:void 0;if("function"!=typeof e&&"function"!=typeof n)throw TypeError("At least one callback required");return i.has(t)?(r=i.get(t),"function"==typeof e&&(r=e(r),i.set(t,r))):"function"==typeof n&&(r=n(),i.set(t,r)),r};_export({target:"Map",proto:!0,real:!0,forced:false},{updateOrInsert:UP});_export({target:"Map",proto:!0,real:!0,forced:false},{upsert:UP});var BP=_export,DP=Math.min,jP=Math.max;BP({target:"Math",stat:!0},{clamp:function clamp(t,e,r){return DP(r,jP(e,t))}}),_export({target:"Math",stat:!0},{DEG_PER_RAD:Math.PI/180});var NP=_export,WP=180/Math.PI;NP({target:"Math",stat:!0},{degrees:function degrees(t){return t*WP}});var HP=Math.scale||function scale(t,e,r,i,n){return 0===arguments.length||t!=t||e!=e||r!=r||i!=i||n!=n?NaN:t===1/0||t===-1/0?t:(t-e)*(n-i)/(r-e)+i},GP=HP,VP=Ed;_export({target:"Math",stat:!0},{fscale:function fscale(t,e,r,i,n){return VP(GP(t,e,r,i,n))}}),_export({target:"Math",stat:!0},{iaddh:function iaddh(t,e,r,i){var n=t>>>0,s=r>>>0;return(e>>>0)+(i>>>0)+((n&s|(n|s)&~(n+s>>>0))>>>31)|0}}),_export({target:"Math",stat:!0},{imulh:function imulh(t,e){var r=65535,i=+t,n=+e,s=i&r,o=n&r,u=i>>16,h=n>>16,l=(u*o>>>0)+(s*o>>>16);return u*h+(l>>16)+((s*h>>>0)+(l&r)>>16)}}),_export({target:"Math",stat:!0},{isubh:function isubh(t,e,r,i){var n=t>>>0,s=r>>>0;return(e>>>0)-(i>>>0)-((~n&s|~(n^s)&n-s>>>0)>>>31)|0}}),_export({target:"Math",stat:!0},{RAD_PER_DEG:180/Math.PI});var YP=_export,XP=Math.PI/180;YP({target:"Math",stat:!0},{radians:function radians(t){return t*XP}}),_export({target:"Math",stat:!0},{scale:HP});var qP=_export,$P=anObject$1z,ZP=O_,KP=createIteratorConstructor$7,QP=oe,JP="Seeded Random",tM="Seeded Random Generator",eM=QP.set,rM=QP.getterFor(tM),iM=KP((function SeededRandomGenerator(t){eM(this,{type:tM,seed:t%2147483647})}),JP,(function next(){var t=rM(this);return{value:(1073741823&(t.seed=(1103515245*t.seed+12345)%2147483647))/1073741823,done:!1}}));qP({target:"Math",stat:!0,forced:!0},{seededPRNG:function seededPRNG(t){var e=$P(t).seed;if(!ZP(e))throw TypeError('Math.seededPRNG() argument should have a "seed" field with a finite value.');return new iM(e)}}),_export({target:"Math",stat:!0},{signbit:function signbit(t){return(t=+t)==t&&0==t?1/t==-1/0:t<0}}),_export({target:"Math",stat:!0},{umulh:function umulh(t,e){var r=65535,i=+t,n=+e,s=i&r,o=n&r,u=i>>>16,h=n>>>16,l=(u*o>>>0)+(s*o>>>16);return u*h+(l>>>16)+((s*h>>>0)+(l&r)>>>16)}});var nM=toInteger$h,sM=$_,oM="Invalid number representation",aM=/^[\da-z]+$/;_export({target:"Number",stat:!0},{fromString:function fromString(t,e){var r,i,n=1;if("string"!=typeof t)throw TypeError(oM);if(!t.length)throw SyntaxError(oM);if("-"==t.charAt(0)&&(n=-1,!(t=t.slice(1)).length))throw SyntaxError(oM);if((r=void 0===e?10:nM(e))<2||r>36)throw RangeError("Invalid radix");if(!aM.test(t)||(i=sM(t,r)).toString(r)!==t)throw SyntaxError(oM);return n*i}});var uM=YL;_export({target:"Number",stat:!0},{range:function range(t,e,r){return new uM(t,e,r,"number",0,1)}}),_export({target:"Object",stat:!0},{hasOwn:G});var hM=oe,lM=createIteratorConstructor$7,cM=G,fM=hr,dM=toObject$x,_M="Object Iterator",gM=hM.set,pM=hM.getterFor(_M),vM=lM((function ObjectIterator(t,e){var r=dM(t);gM(this,{type:_M,mode:e,object:r,keys:fM(r),index:0})}),"Object",(function next(){for(var t=pM(this),e=t.keys;;){if(null===e||t.index>=e.length)return t.object=t.keys=null,{value:void 0,done:!0};var r=e[t.index++],i=t.object;if(cM(i,r)){switch(t.mode){case"keys":return{value:r,done:!1};case"values":return{value:i[r],done:!1}}return{value:[r,i[r]],done:!1}}}})),yM=vM;_export({target:"Object",stat:!0},{iterateEntries:function iterateEntries(t){return new yM(t,"entries")}});var xM=vM;_export({target:"Object",stat:!0},{iterateKeys:function iterateKeys(t){return new xM(t,"keys")}});var mM=vM;_export({target:"Object",stat:!0},{iterateValues:function iterateValues(t){return new mM(t,"values")}});var SM=anObject$1z,bM=getIteratorMethod$8,getIterator$3=function(t){var e=bM(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return SM(e.call(t))},kM=_export,TM=i,CM=setSpecies$7,wM=aFunction$S,AM=anObject$1z,RM=isObject$C,EM=anInstance$b,LM=bt.f,IM=It,OM=redefineAll$9,PM=getIterator$3,MM=iterate$I,FM=hostReportErrors$2,zM=oe,UM=wellKnownSymbol$E("observable"),BM=zM.get,DM=zM.set,getMethod=function(t){return null==t?void 0:wM(t)},cleanupSubscription=function(t){var e=t.cleanup;if(e){t.cleanup=void 0;try{e()}catch(t){FM(t)}}},subscriptionClosed=function(t){return void 0===t.observer},close=function(t){var e=t.facade;if(!TM){e.closed=!0;var r=t.subscriptionObserver;r&&(r.closed=!0)}t.observer=void 0},Subscription=function(t,e){var r,i=DM(this,{cleanup:void 0,observer:AM(t),subscriptionObserver:void 0});TM||(this.closed=!1);try{(r=getMethod(t.start))&&r.call(t,this)}catch(t){FM(t)}if(!subscriptionClosed(i)){var n=i.subscriptionObserver=new SubscriptionObserver(this);try{var s=e(n),o=s;null!=s&&(i.cleanup="function"==typeof s.unsubscribe?function(){o.unsubscribe()}:wM(s))}catch(t){return void n.error(t)}subscriptionClosed(i)&&cleanupSubscription(i)}};Subscription.prototype=OM({},{unsubscribe:function unsubscribe(){var t=BM(this);subscriptionClosed(t)||(close(t),cleanupSubscription(t))}}),TM&&LM(Subscription.prototype,"closed",{configurable:!0,get:function(){return subscriptionClosed(BM(this))}});var SubscriptionObserver=function(t){DM(this,{subscription:t}),TM||(this.closed=!1)};SubscriptionObserver.prototype=OM({},{next:function next(t){var e=BM(BM(this).subscription);if(!subscriptionClosed(e)){var r=e.observer;try{var i=getMethod(r.next);i&&i.call(r,t)}catch(t){FM(t)}}},error:function error(t){var e=BM(BM(this).subscription);if(!subscriptionClosed(e)){var r=e.observer;close(e);try{var i=getMethod(r.error);i?i.call(r,t):FM(t)}catch(t){FM(t)}cleanupSubscription(e)}},complete:function complete(){var t=BM(BM(this).subscription);if(!subscriptionClosed(t)){var e=t.observer;close(t);try{var r=getMethod(e.complete);r&&r.call(e)}catch(t){FM(t)}cleanupSubscription(t)}}}),TM&&LM(SubscriptionObserver.prototype,"closed",{configurable:!0,get:function(){return subscriptionClosed(BM(BM(this).subscription))}});var jM=function Observable(t){EM(this,jM,"Observable"),DM(this,{subscriber:wM(t)})};OM(jM.prototype,{subscribe:function subscribe(t){var e=arguments.length;return new Subscription("function"==typeof t?{next:t,error:e>1?arguments[1]:void 0,complete:e>2?arguments[2]:void 0}:RM(t)?t:{},BM(this).subscriber)}}),OM(jM,{from:function from(t){var e="function"==typeof this?this:jM,r=getMethod(AM(t)[UM]);if(r){var i=AM(r.call(t));return i.constructor===e?i:new e((function(t){return i.subscribe(t)}))}var n=PM(t);return new e((function(t){MM(n,(function(e,r){if(t.next(e),t.closed)return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),t.complete()}))},of:function of(){for(var t="function"==typeof this?this:jM,e=arguments.length,r=new Array(e),i=0;i<e;)r[i]=arguments[i++];return new t((function(t){for(var i=0;i<e;i++)if(t.next(r[i]),t.closed)return;t.complete()}))}}),IM(jM.prototype,UM,(function(){return this})),kM({global:!0},{Observable:jM}),CM("Observable");var NM=Wv,WM=perform$4;_export({target:"Promise",stat:!0},{try:function(t){var e=NM.f(this),r=WM(t);return(r.error?e.reject:e.resolve)(r.value),e.promise}});var HM=Wf,GM=NA.exports,VM=(0,M.exports)("metadata"),YM=VM.store||(VM.store=new GM),getOrCreateMetadataMap$1=function(t,e,r){var i=YM.get(t);if(!i){if(!r)return;YM.set(t,i=new HM)}var n=i.get(e);if(!n){if(!r)return;i.set(e,n=new HM)}return n},XM={store:YM,getMap:getOrCreateMetadataMap$1,has:function(t,e,r){var i=getOrCreateMetadataMap$1(e,r,!1);return void 0!==i&&i.has(t)},get:function(t,e,r){var i=getOrCreateMetadataMap$1(e,r,!1);return void 0===i?void 0:i.get(t)},set:function(t,e,r,i){getOrCreateMetadataMap$1(r,i,!0).set(t,e)},keys:function(t,e){var r=getOrCreateMetadataMap$1(t,e,!1),i=[];return r&&r.forEach((function(t,e){i.push(e)})),i},toKey:function(t){return void 0===t||"symbol"==typeof t?t:String(t)}},qM=anObject$1z,$M=XM.toKey,ZM=XM.set;_export({target:"Reflect",stat:!0},{defineMetadata:function defineMetadata(t,e,r){var i=arguments.length<4?void 0:$M(arguments[3]);ZM(t,e,qM(r),i)}});var KM=anObject$1z,QM=XM.toKey,JM=XM.getMap,tF=XM.store;_export({target:"Reflect",stat:!0},{deleteMetadata:function deleteMetadata(t,e){var r=arguments.length<3?void 0:QM(arguments[2]),i=JM(KM(e),r,!1);if(void 0===i||!i.delete(t))return!1;if(i.size)return!0;var n=tF.get(e);return n.delete(r),!!n.size||tF.delete(e)}});var eF=anObject$1z,rF=Cn,iF=XM.has,nF=XM.get,sF=XM.toKey,ordinaryGetMetadata=function(t,e,r){if(iF(t,e,r))return nF(t,e,r);var i=rF(e);return null!==i?ordinaryGetMetadata(t,i,r):void 0};_export({target:"Reflect",stat:!0},{getMetadata:function getMetadata(t,e){var r=arguments.length<3?void 0:sF(arguments[2]);return ordinaryGetMetadata(t,eF(e),r)}});var oF=LS,aF=anObject$1z,uF=Cn,hF=iterate$I,lF=XM.keys,cF=XM.toKey,ordinaryMetadataKeys=function(t,e){var r=lF(t,e),i=uF(t);if(null===i)return r;var n,s,o=ordinaryMetadataKeys(i,e);return o.length?r.length?(n=new oF(r.concat(o)),hF(n,(s=[]).push,{that:s}),s):o:r};_export({target:"Reflect",stat:!0},{getMetadataKeys:function getMetadataKeys(t){var e=arguments.length<2?void 0:cF(arguments[1]);return ordinaryMetadataKeys(aF(t),e)}});var fF=anObject$1z,dF=XM.get,_F=XM.toKey;_export({target:"Reflect",stat:!0},{getOwnMetadata:function getOwnMetadata(t,e){var r=arguments.length<3?void 0:_F(arguments[2]);return dF(t,fF(e),r)}});var gF=anObject$1z,pF=XM.keys,vF=XM.toKey;_export({target:"Reflect",stat:!0},{getOwnMetadataKeys:function getOwnMetadataKeys(t){var e=arguments.length<2?void 0:vF(arguments[1]);return pF(gF(t),e)}});var yF=anObject$1z,xF=Cn,mF=XM.has,SF=XM.toKey,ordinaryHasMetadata=function(t,e,r){if(mF(t,e,r))return!0;var i=xF(e);return null!==i&&ordinaryHasMetadata(t,i,r)};_export({target:"Reflect",stat:!0},{hasMetadata:function hasMetadata(t,e){var r=arguments.length<3?void 0:SF(arguments[2]);return ordinaryHasMetadata(t,yF(e),r)}});var bF=anObject$1z,kF=XM.has,TF=XM.toKey;_export({target:"Reflect",stat:!0},{hasOwnMetadata:function hasOwnMetadata(t,e){var r=arguments.length<3?void 0:TF(arguments[2]);return kF(t,bF(e),r)}});var CF=anObject$1z,wF=XM.toKey,AF=XM.set;_export({target:"Reflect",stat:!0},{metadata:function metadata(t,e){return function decorator(r,i){AF(t,e,CF(r),wF(i))}}});var RF=anObject$1z,EF=aFunction$S,collectionAddAll$2=function(){for(var t=RF(this),e=EF(t.add),r=0,i=arguments.length;r<i;r++)e.call(t,arguments[r]);return t},LF=collectionAddAll$2;_export({target:"Set",proto:!0,real:!0,forced:false},{addAll:function addAll(){return LF.apply(this,arguments)}});var IF=collectionDeleteAll$4;_export({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function deleteAll(){return IF.apply(this,arguments)}});var OF=getBuiltIn$u,PF=anObject$1z,MF=aFunction$S,FF=speciesConstructor$f,zF=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{difference:function difference(t){var e=PF(this),r=new(FF(e,OF("Set")))(e),i=MF(r.delete);return zF(t,(function(t){i.call(r,t)})),r}});var getSetIterator$7=function(t){return Set.prototype.values.call(t)},UF=anObject$1z,BF=functionBindContext,DF=getSetIterator$7,jF=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{every:function every(t){var e=UF(this),r=DF(e),i=BF(t,arguments.length>1?arguments[1]:void 0,3);return!jF(r,(function(t,r){if(!i(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var NF=getBuiltIn$u,WF=anObject$1z,HF=aFunction$S,GF=functionBindContext,VF=speciesConstructor$f,YF=getSetIterator$7,XF=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{filter:function filter(t){var e=WF(this),r=YF(e),i=GF(t,arguments.length>1?arguments[1]:void 0,3),n=new(VF(e,NF("Set"))),s=HF(n.add);return XF(r,(function(t){i(t,t,e)&&s.call(n,t)}),{IS_ITERATOR:!0}),n}});var qF=anObject$1z,$F=functionBindContext,ZF=getSetIterator$7,KF=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{find:function find(t){var e=qF(this),r=ZF(e),i=$F(t,arguments.length>1?arguments[1]:void 0,3);return KF(r,(function(t,r){if(i(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",stat:!0},{from:KO});var QF=getBuiltIn$u,JF=anObject$1z,tz=aFunction$S,ez=speciesConstructor$f,rz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{intersection:function intersection(t){var e=JF(this),r=new(ez(e,QF("Set"))),i=tz(e.has),n=tz(r.add);return rz(t,(function(t){i.call(e,t)&&n.call(r,t)})),r}});var iz=anObject$1z,nz=aFunction$S,sz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function isDisjointFrom(t){var e=iz(this),r=nz(e.has);return!sz(t,(function(t,i){if(!0===r.call(e,t))return i()}),{INTERRUPTED:!0}).stopped}});var oz=getBuiltIn$u,az=anObject$1z,uz=aFunction$S,hz=getIterator$3,lz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function isSubsetOf(t){var e=hz(this),r=az(t),i=r.has;return"function"!=typeof i&&(r=new(oz("Set"))(t),i=uz(r.has)),!lz(e,(function(t,e){if(!1===i.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var cz=anObject$1z,fz=aFunction$S,dz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function isSupersetOf(t){var e=cz(this),r=fz(e.has);return!dz(t,(function(t,i){if(!1===r.call(e,t))return i()}),{INTERRUPTED:!0}).stopped}});var _z=anObject$1z,gz=getSetIterator$7,pz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{join:function join(t){var e=_z(this),r=gz(e),i=void 0===t?",":String(t),n=[];return pz(r,n.push,{that:n,IS_ITERATOR:!0}),n.join(i)}});var vz=getBuiltIn$u,yz=anObject$1z,xz=aFunction$S,mz=functionBindContext,Sz=speciesConstructor$f,bz=getSetIterator$7,kz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{map:function map(t){var e=yz(this),r=bz(e),i=mz(t,arguments.length>1?arguments[1]:void 0,3),n=new(Sz(e,vz("Set"))),s=xz(n.add);return kz(r,(function(t){s.call(n,i(t,t,e))}),{IS_ITERATOR:!0}),n}}),_export({target:"Set",stat:!0},{of:CP});var Tz=anObject$1z,Cz=aFunction$S,wz=getSetIterator$7,Az=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{reduce:function reduce(t){var e=Tz(this),r=wz(e),i=arguments.length<2,n=i?void 0:arguments[1];if(Cz(t),Az(r,(function(r){i?(i=!1,n=r):n=t(n,r,r,e)}),{IS_ITERATOR:!0}),i)throw TypeError("Reduce of empty set with no initial value");return n}});var Rz=anObject$1z,Ez=functionBindContext,Lz=getSetIterator$7,Iz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{some:function some(t){var e=Rz(this),r=Lz(e),i=Ez(t,arguments.length>1?arguments[1]:void 0,3);return Iz(r,(function(t,r){if(i(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Oz=getBuiltIn$u,Pz=anObject$1z,Mz=aFunction$S,Fz=speciesConstructor$f,zz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function symmetricDifference(t){var e=Pz(this),r=new(Fz(e,Oz("Set")))(e),i=Mz(r.delete),n=Mz(r.add);return zz(t,(function(t){i.call(r,t)||n.call(r,t)})),r}});var Uz=getBuiltIn$u,Bz=anObject$1z,Dz=aFunction$S,jz=speciesConstructor$f,Nz=iterate$I;_export({target:"Set",proto:!0,real:!0,forced:false},{union:function union(t){var e=Bz(this),r=new(jz(e,Uz("Set")))(e);return Nz(t,Dz(r.add),{that:r}),r}});var Wz=MS.charAt;_export({target:"String",proto:!0,forced:fails$11((function(){return"ð ®·"!=="ð ®·".at(0)}))},{at:function at(t){return Wz(this,t)}});var Hz=_export,Gz=createIteratorConstructor$7,Vz=requireObjectCoercible$i,Yz=toString$s,Xz=oe,qz=MS.codeAt,$z=MS.charAt,Zz="String Iterator",Kz=Xz.set,Qz=Xz.getterFor(Zz),Jz=Gz((function StringIterator(t){Kz(this,{type:Zz,string:t,index:0})}),"String",(function next(){var t,e=Qz(this),r=e.string,i=e.index;return i>=r.length?{value:void 0,done:!0}:(t=$z(r,i),e.index+=t.length,{value:{codePoint:qz(t,0),position:i},done:!1})}));Hz({target:"String",proto:!0},{codePoints:function codePoints(){return new Jz(Yz(Vz(this)))}}),defineWellKnownSymbol$l("asyncDispose"),defineWellKnownSymbol$l("dispose"),defineWellKnownSymbol$l("matcher"),defineWellKnownSymbol$l("metadata"),defineWellKnownSymbol$l("observable"),defineWellKnownSymbol$l("patternMatch"),defineWellKnownSymbol$l("replaceAll");var tU=toLength$C,eU=toInteger$h,rU=El.aTypedArray;(0,El.exportTypedArrayMethod)("at",(function at(t){var e=rU(this),r=tU(e.length),i=eU(t),n=i>=0?i:r+i;return n<0||n>=r?void 0:e[n]}));var iU=$r.filterReject,nU=typedArrayFromSpeciesAndList,sU=El.aTypedArray;(0,El.exportTypedArrayMethod)("filterOut",(function filterOut(t){var e=iU(sU(this),t,arguments.length>1?arguments[1]:void 0);return nU(this,e)}));var oU=$r.filterReject,aU=typedArrayFromSpeciesAndList,uU=El.aTypedArray;(0,El.exportTypedArrayMethod)("filterReject",(function filterReject(t){var e=oU(uU(this),t,arguments.length>1?arguments[1]:void 0);return aU(this,e)}));var hU=LR.findLast,lU=El.aTypedArray;(0,El.exportTypedArrayMethod)("findLast",(function findLast(t){return hU(lU(this),t,arguments.length>1?arguments[1]:void 0)}));var cU=LR.findLastIndex,fU=El.aTypedArray;(0,El.exportTypedArrayMethod)("findLastIndex",(function findLastIndex(t){return cU(fU(this),t,arguments.length>1?arguments[1]:void 0)}));var dU=arrayGroupBy,_U=typedArraySpeciesConstructor$5,gU=El.aTypedArray;(0,El.exportTypedArrayMethod)("groupBy",(function groupBy(t){var e=arguments.length>1?arguments[1]:void 0;return dU(gU(this),t,e,_U)}));var pU=lE,vU=typedArrayFromSpeciesAndList,yU=El.aTypedArray;(0,El.exportTypedArrayMethod)("uniqueBy",(function uniqueBy(t){return vU(this,pU.call(yU(this),t))}));var xU=collectionDeleteAll$4;_export({target:"WeakMap",proto:!0,real:!0,forced:false},{deleteAll:function deleteAll(){return xU.apply(this,arguments)}}),_export({target:"WeakMap",stat:!0},{from:KO}),_export({target:"WeakMap",stat:!0},{of:CP});_export({target:"WeakMap",proto:!0,real:!0,forced:false},{emplace:RO});_export({target:"WeakMap",proto:!0,real:!0,forced:false},{upsert:UP});var mU=collectionAddAll$2;_export({target:"WeakSet",proto:!0,real:!0,forced:false},{addAll:function addAll(){return mU.apply(this,arguments)}});var SU=collectionDeleteAll$4;_export({target:"WeakSet",proto:!0,real:!0,forced:false},{deleteAll:function deleteAll(){return SU.apply(this,arguments)}}),_export({target:"WeakSet",stat:!0},{from:KO}),_export({target:"WeakSet",stat:!0},{of:CP});var bU={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},kU=e,TU=bU,CU=yo,wU=It;for(var AU in TU){var RU=kU[AU],EU=RU&&RU.prototype;if(EU&&EU.forEach!==CU)try{wU(EU,"forEach",CU)}catch(t){EU.forEach=CU}}var LU=e,IU=bU,OU=Ca,PU=It,MU=wellKnownSymbol$E,FU=MU("iterator"),zU=MU("toStringTag"),UU=OU.values;for(var BU in IU){var DU=LU[BU],jU=DU&&DU.prototype;if(jU){if(jU[FU]!==UU)try{PU(jU,FU,UU)}catch(t){jU[FU]=UU}if(jU[zU]||PU(jU,zU,BU),IU[BU])for(var NU in OU)if(jU[NU]!==OU[NU])try{PU(jU,NU,OU[NU])}catch(t){jU[NU]=OU[NU]}}}var WU=e,HU=Av;_export({global:!0,bind:!0,enumerable:!0,forced:!WU.setImmediate||!WU.clearImmediate},{setImmediate:HU.set,clearImmediate:HU.clear});var GU=_export,VU=Nv,YU=Xa,XU=e.process;GU({global:!0,enumerable:!0,noTargetGet:!0},{queueMicrotask:function queueMicrotask(t){var e=YU&&XU.domain;VU(e?e.bind(t):t)}});var qU=e,$U=[].slice,wrap=function(t){return function(e,r){var i=arguments.length>2,n=i?$U.call(arguments,2):void 0;return t(i?function(){("function"==typeof e?e:Function(e)).apply(this,n)}:e,r)}};_export({global:!0,bind:!0,forced:/MSIE .\./.test(x)},{setTimeout:wrap(qU.setTimeout),setInterval:wrap(qU.setInterval)});var ZU=fails$11,KU=wellKnownSymbol$E("iterator"),QU=!ZU((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,r="";return t.pathname="c%20d",e.forEach((function(t,i){e.delete("b"),r+=i+t})),!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[KU]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),JU=2147483647,tB=/[^\0-\u007E]/,eB=/[.\u3002\uFF0E\uFF61]/g,rB="Overflow: input needs wider integers to process",iB=Math.floor,nB=String.fromCharCode,digitToBasic=function(t){return t+22+75*(t<26)},adapt=function(t,e,r){var i=0;for(t=r?iB(t/700):t>>1,t+=iB(t/e);t>455;i+=36)t=iB(t/35);return iB(i+36*t/(t+38))},encode=function(t){var e,r,i=[],n=(t=function(t){for(var e=[],r=0,i=t.length;r<i;){var n=t.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){var s=t.charCodeAt(r++);56320==(64512&s)?e.push(((1023&n)<<10)+(1023&s)+65536):(e.push(n),r--)}else e.push(n)}return e}(t)).length,s=128,o=0,u=72;for(e=0;e<t.length;e++)(r=t[e])<128&&i.push(nB(r));var h=i.length,l=h;for(h&&i.push("-");l<n;){var f=JU;for(e=0;e<t.length;e++)(r=t[e])>=s&&r<f&&(f=r);var d=l+1;if(f-s>iB((JU-o)/d))throw RangeError(rB);for(o+=(f-s)*d,s=f,e=0;e<t.length;e++){if((r=t[e])<s&&++o>JU)throw RangeError(rB);if(r==s){for(var _=o,g=36;;g+=36){var p=g<=u?1:g>=u+26?26:g-u;if(_<p)break;var v=_-p,y=36-p;i.push(nB(digitToBasic(p+v%y))),_=iB(v/y)}i.push(nB(digitToBasic(_))),u=adapt(o,d,l==h),o=0,++l}}++o,++s}return i.join("")},sB=_export,oB=getBuiltIn$u,aB=QU,uB=Ot.exports,hB=redefineAll$9,lB=setToStringTag$b,cB=createIteratorConstructor$7,fB=oe,dB=anInstance$b,_B=G,gB=functionBindContext,pB=jn,vB=anObject$1z,yB=isObject$C,xB=toString$s,mB=br,SB=createPropertyDescriptor$9,bB=getIterator$3,kB=getIteratorMethod$8,TB=wellKnownSymbol$E,CB=oB("fetch"),wB=oB("Request"),AB=wB&&wB.prototype,RB=oB("Headers"),EB=TB("iterator"),LB="URLSearchParams",IB="URLSearchParamsIterator",OB=fB.set,PB=fB.getterFor(LB),MB=fB.getterFor(IB),FB=/\+/g,zB=Array(4),percentSequence=function(t){return zB[t-1]||(zB[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))},percentDecode=function(t){try{return decodeURIComponent(t)}catch(e){return t}},deserialize=function(t){var e=t.replace(FB," "),r=4;try{return decodeURIComponent(e)}catch(t){for(;r;)e=e.replace(percentSequence(r--),percentDecode);return e}},UB=/[!'()~]|%20/g,BB={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},replacer=function(t){return BB[t]},serialize=function(t){return encodeURIComponent(t).replace(UB,replacer)},parseSearchParams=function(t,e){if(e)for(var r,i,n=e.split("&"),s=0;s<n.length;)(r=n[s++]).length&&(i=r.split("="),t.push({key:deserialize(i.shift()),value:deserialize(i.join("="))}))},updateSearchParams=function(t){this.entries.length=0,parseSearchParams(this.entries,t)},validateArgumentsLength=function(t,e){if(t<e)throw TypeError("Not enough arguments")},DB=cB((function Iterator(t,e){OB(this,{type:IB,iterator:bB(PB(t).entries),kind:e})}),"Iterator",(function next(){var t=MB(this),e=t.kind,r=t.iterator.next(),i=r.value;return r.done||(r.value="keys"===e?i.key:"values"===e?i.value:[i.key,i.value]),r})),jB=function URLSearchParams(){dB(this,jB,LB);var t,e,r,i,n,s,o,u,h,l=arguments.length>0?arguments[0]:void 0,f=this,d=[];if(OB(f,{type:LB,entries:d,updateURL:function(){},updateSearchParams:updateSearchParams}),void 0!==l)if(yB(l))if("function"==typeof(t=kB(l)))for(r=(e=t.call(l)).next;!(i=r.call(e)).done;){if((o=(s=(n=bB(vB(i.value))).next).call(n)).done||(u=s.call(n)).done||!s.call(n).done)throw TypeError("Expected sequence with length 2");d.push({key:xB(o.value),value:xB(u.value)})}else for(h in l)_B(l,h)&&d.push({key:h,value:xB(l[h])});else parseSearchParams(d,"string"==typeof l?"?"===l.charAt(0)?l.slice(1):l:xB(l))},NB=jB.prototype;if(hB(NB,{append:function append(t,e){validateArgumentsLength(arguments.length,2);var r=PB(this);r.entries.push({key:xB(t),value:xB(e)}),r.updateURL()},delete:function(t){validateArgumentsLength(arguments.length,1);for(var e=PB(this),r=e.entries,i=xB(t),n=0;n<r.length;)r[n].key===i?r.splice(n,1):n++;e.updateURL()},get:function get(t){validateArgumentsLength(arguments.length,1);for(var e=PB(this).entries,r=xB(t),i=0;i<e.length;i++)if(e[i].key===r)return e[i].value;return null},getAll:function getAll(t){validateArgumentsLength(arguments.length,1);for(var e=PB(this).entries,r=xB(t),i=[],n=0;n<e.length;n++)e[n].key===r&&i.push(e[n].value);return i},has:function has(t){validateArgumentsLength(arguments.length,1);for(var e=PB(this).entries,r=xB(t),i=0;i<e.length;)if(e[i++].key===r)return!0;return!1},set:function set(t,e){validateArgumentsLength(arguments.length,1);for(var r,i=PB(this),n=i.entries,s=!1,o=xB(t),u=xB(e),h=0;h<n.length;h++)(r=n[h]).key===o&&(s?n.splice(h--,1):(s=!0,r.value=u));s||n.push({key:o,value:u}),i.updateURL()},sort:function sort(){var t,e,r,i=PB(this),n=i.entries,s=n.slice();for(n.length=0,r=0;r<s.length;r++){for(t=s[r],e=0;e<r;e++)if(n[e].key>t.key){n.splice(e,0,t);break}e===r&&n.push(t)}i.updateURL()},forEach:function forEach(t){for(var e,r=PB(this).entries,i=gB(t,arguments.length>1?arguments[1]:void 0,3),n=0;n<r.length;)i((e=r[n++]).value,e.key,this)},keys:function keys(){return new DB(this,"keys")},values:function values(){return new DB(this,"values")},entries:function entries(){return new DB(this,"entries")}},{enumerable:!0}),uB(NB,EB,NB.entries),uB(NB,"toString",(function toString(){for(var t,e=PB(this).entries,r=[],i=0;i<e.length;)t=e[i++],r.push(serialize(t.key)+"="+serialize(t.value));return r.join("&")}),{enumerable:!0}),lB(jB,LB),sB({global:!0,forced:!aB},{URLSearchParams:jB}),!aB&&"function"==typeof RB){var wrapRequestOptions=function(t){if(yB(t)){var e,r=t.body;if(pB(r)===LB)return(e=t.headers?new RB(t.headers):new RB).has("content-type")||e.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),mB(t,{body:SB(0,String(r)),headers:SB(0,e)})}return t};if("function"==typeof CB&&sB({global:!0,enumerable:!0,forced:!0},{fetch:function fetch(t){return CB(t,arguments.length>1?wrapRequestOptions(arguments[1]):{})}}),"function"==typeof wB){var WB=function Request(t){return dB(this,WB,"Request"),new wB(t,arguments.length>1?wrapRequestOptions(arguments[1]):{})};AB.constructor=WB,WB.prototype=AB,sB({global:!0,forced:!0},{Request:WB})}}var HB,GB={URLSearchParams:jB,getState:PB},VB=_export,YB=i,XB=QU,qB=e,$B=dr,ZB=Ot.exports,KB=anInstance$b,QB=G,JB=vg,tD=Ro,eD=MS.codeAt,toASCII=function(t){var e,r,i=[],n=t.toLowerCase().replace(eB,".").split(".");for(e=0;e<n.length;e++)r=n[e],i.push(tB.test(r)?"xn--"+encode(r):r);return i.join(".")},rD=toString$s,iD=setToStringTag$b,nD=GB,sD=oe,oD=qB.URL,aD=nD.URLSearchParams,uD=nD.getState,hD=sD.set,lD=sD.getterFor("URL"),cD=Math.floor,fD=Math.pow,dD="Invalid scheme",_D="Invalid host",gD="Invalid port",pD=/[A-Za-z]/,vD=/[\d+-.A-Za-z]/,yD=/\d/,xD=/^0x/i,mD=/^[0-7]+$/,SD=/^\d+$/,bD=/^[\dA-Fa-f]+$/,kD=/[\0\t\n\r #%/:<>?@[\\\]^|]/,TD=/[\0\t\n\r #/:<>?@[\\\]^|]/,CD=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,wD=/[\t\n\r]/g,parseHost=function(t,e){var r,i,n;if("["==e.charAt(0)){if("]"!=e.charAt(e.length-1))return _D;if(!(r=parseIPv6(e.slice(1,-1))))return _D;t.host=r}else if(isSpecial(t)){if(e=toASCII(e),kD.test(e))return _D;if(null===(r=parseIPv4(e)))return _D;t.host=r}else{if(TD.test(e))return _D;for(r="",i=tD(e),n=0;n<i.length;n++)r+=percentEncode(i[n],AD);t.host=r}},parseIPv4=function(t){var e,r,i,n,s,o,u,h=t.split(".");if(h.length&&""==h[h.length-1]&&h.pop(),(e=h.length)>4)return t;for(r=[],i=0;i<e;i++){if(""==(n=h[i]))return t;if(s=10,n.length>1&&"0"==n.charAt(0)&&(s=xD.test(n)?16:8,n=n.slice(8==s?1:2)),""===n)o=0;else{if(!(10==s?SD:8==s?mD:bD).test(n))return t;o=parseInt(n,s)}r.push(o)}for(i=0;i<e;i++)if(o=r[i],i==e-1){if(o>=fD(256,5-e))return null}else if(o>255)return null;for(u=r.pop(),i=0;i<r.length;i++)u+=r[i]*fD(256,3-i);return u},parseIPv6=function(t){var e,r,i,n,s,o,u,h=[0,0,0,0,0,0,0,0],l=0,f=null,d=0,char=function(){return t.charAt(d)};if(":"==char()){if(":"!=t.charAt(1))return;d+=2,f=++l}for(;char();){if(8==l)return;if(":"!=char()){for(e=r=0;r<4&&bD.test(char());)e=16*e+parseInt(char(),16),d++,r++;if("."==char()){if(0==r)return;if(d-=r,l>6)return;for(i=0;char();){if(n=null,i>0){if(!("."==char()&&i<4))return;d++}if(!yD.test(char()))return;for(;yD.test(char());){if(s=parseInt(char(),10),null===n)n=s;else{if(0==n)return;n=10*n+s}if(n>255)return;d++}h[l]=256*h[l]+n,2!=++i&&4!=i||l++}if(4!=i)return;break}if(":"==char()){if(d++,!char())return}else if(char())return;h[l++]=e}else{if(null!==f)return;d++,f=++l}}if(null!==f)for(o=l-f,l=7;0!=l&&o>0;)u=h[l],h[l--]=h[f+o-1],h[f+--o]=u;else if(8!=l)return;return h},serializeHost=function(t){var e,r,i,n;if("number"==typeof t){for(e=[],r=0;r<4;r++)e.unshift(t%256),t=cD(t/256);return e.join(".")}if("object"==typeof t){for(e="",i=function(t){for(var e=null,r=1,i=null,n=0,s=0;s<8;s++)0!==t[s]?(n>r&&(e=i,r=n),i=null,n=0):(null===i&&(i=s),++n);return n>r&&(e=i,r=n),e}(t),r=0;r<8;r++)n&&0===t[r]||(n&&(n=!1),i===r?(e+=r?":":"::",n=!0):(e+=t[r].toString(16),r<7&&(e+=":")));return"["+e+"]"}return t},AD={},RD=JB({},AD,{" ":1,'"':1,"<":1,">":1,"`":1}),ED=JB({},RD,{"#":1,"?":1,"{":1,"}":1}),LD=JB({},ED,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),percentEncode=function(t,e){var r=eD(t,0);return r>32&&r<127&&!QB(e,t)?t:encodeURIComponent(t)},ID={ftp:21,file:null,http:80,https:443,ws:80,wss:443},isSpecial=function(t){return QB(ID,t.scheme)},includesCredentials=function(t){return""!=t.username||""!=t.password},cannotHaveUsernamePasswordPort=function(t){return!t.host||t.cannotBeABaseURL||"file"==t.scheme},isWindowsDriveLetter=function(t,e){var r;return 2==t.length&&pD.test(t.charAt(0))&&(":"==(r=t.charAt(1))||!e&&"|"==r)},startsWithWindowsDriveLetter=function(t){var e;return t.length>1&&isWindowsDriveLetter(t.slice(0,2))&&(2==t.length||"/"===(e=t.charAt(2))||"\\"===e||"?"===e||"#"===e)},shortenURLsPath=function(t){var e=t.path,r=e.length;!r||"file"==t.scheme&&1==r&&isWindowsDriveLetter(e[0],!0)||e.pop()},isSingleDot=function(t){return"."===t||"%2e"===t.toLowerCase()},OD={},PD={},MD={},FD={},zD={},UD={},BD={},DD={},jD={},ND={},WD={},HD={},GD={},VD={},YD={},XD={},qD={},$D={},ZD={},KD={},QD={},parseURL=function(t,e,r,i){var n,s,o,u,h,l=r||OD,f=0,d="",_=!1,g=!1,p=!1;for(r||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(CD,"")),e=e.replace(wD,""),n=tD(e);f<=n.length;){switch(s=n[f],l){case OD:if(!s||!pD.test(s)){if(r)return dD;l=MD;continue}d+=s.toLowerCase(),l=PD;break;case PD:if(s&&(vD.test(s)||"+"==s||"-"==s||"."==s))d+=s.toLowerCase();else{if(":"!=s){if(r)return dD;d="",l=MD,f=0;continue}if(r&&(isSpecial(t)!=QB(ID,d)||"file"==d&&(includesCredentials(t)||null!==t.port)||"file"==t.scheme&&!t.host))return;if(t.scheme=d,r)return void(isSpecial(t)&&ID[t.scheme]==t.port&&(t.port=null));d="","file"==t.scheme?l=VD:isSpecial(t)&&i&&i.scheme==t.scheme?l=FD:isSpecial(t)?l=DD:"/"==n[f+1]?(l=zD,f++):(t.cannotBeABaseURL=!0,t.path.push(""),l=ZD)}break;case MD:if(!i||i.cannotBeABaseURL&&"#"!=s)return dD;if(i.cannotBeABaseURL&&"#"==s){t.scheme=i.scheme,t.path=i.path.slice(),t.query=i.query,t.fragment="",t.cannotBeABaseURL=!0,l=QD;break}l="file"==i.scheme?VD:UD;continue;case FD:if("/"!=s||"/"!=n[f+1]){l=UD;continue}l=jD,f++;break;case zD:if("/"==s){l=ND;break}l=$D;continue;case UD:if(t.scheme=i.scheme,s==HB)t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query=i.query;else if("/"==s||"\\"==s&&isSpecial(t))l=BD;else if("?"==s)t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query="",l=KD;else{if("#"!=s){t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.path.pop(),l=$D;continue}t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query=i.query,t.fragment="",l=QD}break;case BD:if(!isSpecial(t)||"/"!=s&&"\\"!=s){if("/"!=s){t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,l=$D;continue}l=ND}else l=jD;break;case DD:if(l=jD,"/"!=s||"/"!=d.charAt(f+1))continue;f++;break;case jD:if("/"!=s&&"\\"!=s){l=ND;continue}break;case ND:if("@"==s){_&&(d="%40"+d),_=!0,o=tD(d);for(var v=0;v<o.length;v++){var y=o[v];if(":"!=y||p){var x=percentEncode(y,LD);p?t.password+=x:t.username+=x}else p=!0}d=""}else if(s==HB||"/"==s||"?"==s||"#"==s||"\\"==s&&isSpecial(t)){if(_&&""==d)return"Invalid authority";f-=tD(d).length+1,d="",l=WD}else d+=s;break;case WD:case HD:if(r&&"file"==t.scheme){l=XD;continue}if(":"!=s||g){if(s==HB||"/"==s||"?"==s||"#"==s||"\\"==s&&isSpecial(t)){if(isSpecial(t)&&""==d)return _D;if(r&&""==d&&(includesCredentials(t)||null!==t.port))return;if(u=parseHost(t,d))return u;if(d="",l=qD,r)return;continue}"["==s?g=!0:"]"==s&&(g=!1),d+=s}else{if(""==d)return _D;if(u=parseHost(t,d))return u;if(d="",l=GD,r==HD)return}break;case GD:if(!yD.test(s)){if(s==HB||"/"==s||"?"==s||"#"==s||"\\"==s&&isSpecial(t)||r){if(""!=d){var m=parseInt(d,10);if(m>65535)return gD;t.port=isSpecial(t)&&m===ID[t.scheme]?null:m,d=""}if(r)return;l=qD;continue}return gD}d+=s;break;case VD:if(t.scheme="file","/"==s||"\\"==s)l=YD;else{if(!i||"file"!=i.scheme){l=$D;continue}if(s==HB)t.host=i.host,t.path=i.path.slice(),t.query=i.query;else if("?"==s)t.host=i.host,t.path=i.path.slice(),t.query="",l=KD;else{if("#"!=s){startsWithWindowsDriveLetter(n.slice(f).join(""))||(t.host=i.host,t.path=i.path.slice(),shortenURLsPath(t)),l=$D;continue}t.host=i.host,t.path=i.path.slice(),t.query=i.query,t.fragment="",l=QD}}break;case YD:if("/"==s||"\\"==s){l=XD;break}i&&"file"==i.scheme&&!startsWithWindowsDriveLetter(n.slice(f).join(""))&&(isWindowsDriveLetter(i.path[0],!0)?t.path.push(i.path[0]):t.host=i.host),l=$D;continue;case XD:if(s==HB||"/"==s||"\\"==s||"?"==s||"#"==s){if(!r&&isWindowsDriveLetter(d))l=$D;else if(""==d){if(t.host="",r)return;l=qD}else{if(u=parseHost(t,d))return u;if("localhost"==t.host&&(t.host=""),r)return;d="",l=qD}continue}d+=s;break;case qD:if(isSpecial(t)){if(l=$D,"/"!=s&&"\\"!=s)continue}else if(r||"?"!=s)if(r||"#"!=s){if(s!=HB&&(l=$D,"/"!=s))continue}else t.fragment="",l=QD;else t.query="",l=KD;break;case $D:if(s==HB||"/"==s||"\\"==s&&isSpecial(t)||!r&&("?"==s||"#"==s)){if(".."===(h=(h=d).toLowerCase())||"%2e."===h||".%2e"===h||"%2e%2e"===h?(shortenURLsPath(t),"/"==s||"\\"==s&&isSpecial(t)||t.path.push("")):isSingleDot(d)?"/"==s||"\\"==s&&isSpecial(t)||t.path.push(""):("file"==t.scheme&&!t.path.length&&isWindowsDriveLetter(d)&&(t.host&&(t.host=""),d=d.charAt(0)+":"),t.path.push(d)),d="","file"==t.scheme&&(s==HB||"?"==s||"#"==s))for(;t.path.length>1&&""===t.path[0];)t.path.shift();"?"==s?(t.query="",l=KD):"#"==s&&(t.fragment="",l=QD)}else d+=percentEncode(s,ED);break;case ZD:"?"==s?(t.query="",l=KD):"#"==s?(t.fragment="",l=QD):s!=HB&&(t.path[0]+=percentEncode(s,AD));break;case KD:r||"#"!=s?s!=HB&&("'"==s&&isSpecial(t)?t.query+="%27":t.query+="#"==s?"%23":percentEncode(s,AD)):(t.fragment="",l=QD);break;case QD:s!=HB&&(t.fragment+=percentEncode(s,RD))}f++}},JD=function URL(t){var e,r,i=KB(this,JD,"URL"),n=arguments.length>1?arguments[1]:void 0,s=rD(t),o=hD(i,{type:"URL"});if(void 0!==n)if(n instanceof JD)e=lD(n);else if(r=parseURL(e={},rD(n)))throw TypeError(r);if(r=parseURL(o,s,null,e))throw TypeError(r);var u=o.searchParams=new aD,h=uD(u);h.updateSearchParams(o.query),h.updateURL=function(){o.query=String(u)||null},YB||(i.href=serializeURL.call(i),i.origin=getOrigin.call(i),i.protocol=getProtocol.call(i),i.username=getUsername.call(i),i.password=getPassword.call(i),i.host=getHost.call(i),i.hostname=getHostname.call(i),i.port=getPort.call(i),i.pathname=getPathname.call(i),i.search=getSearch.call(i),i.searchParams=getSearchParams.call(i),i.hash=getHash.call(i))},tj=JD.prototype,serializeURL=function(){var t=lD(this),e=t.scheme,r=t.username,i=t.password,n=t.host,s=t.port,o=t.path,u=t.query,h=t.fragment,l=e+":";return null!==n?(l+="//",includesCredentials(t)&&(l+=r+(i?":"+i:"")+"@"),l+=serializeHost(n),null!==s&&(l+=":"+s)):"file"==e&&(l+="//"),l+=t.cannotBeABaseURL?o[0]:o.length?"/"+o.join("/"):"",null!==u&&(l+="?"+u),null!==h&&(l+="#"+h),l},getOrigin=function(){var t=lD(this),e=t.scheme,r=t.port;if("blob"==e)try{return new JD(e.path[0]).origin}catch(t){return"null"}return"file"!=e&&isSpecial(t)?e+"://"+serializeHost(t.host)+(null!==r?":"+r:""):"null"},getProtocol=function(){return lD(this).scheme+":"},getUsername=function(){return lD(this).username},getPassword=function(){return lD(this).password},getHost=function(){var t=lD(this),e=t.host,r=t.port;return null===e?"":null===r?serializeHost(e):serializeHost(e)+":"+r},getHostname=function(){var t=lD(this).host;return null===t?"":serializeHost(t)},getPort=function(){var t=lD(this).port;return null===t?"":String(t)},getPathname=function(){var t=lD(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},getSearch=function(){var t=lD(this).query;return t?"?"+t:""},getSearchParams=function(){return lD(this).searchParams},getHash=function(){var t=lD(this).fragment;return t?"#"+t:""},accessorDescriptor=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(YB&&$B(tj,{href:accessorDescriptor(serializeURL,(function(t){var e=lD(this),r=rD(t),i=parseURL(e,r);if(i)throw TypeError(i);uD(e.searchParams).updateSearchParams(e.query)})),origin:accessorDescriptor(getOrigin),protocol:accessorDescriptor(getProtocol,(function(t){var e=lD(this);parseURL(e,rD(t)+":",OD)})),username:accessorDescriptor(getUsername,(function(t){var e=lD(this),r=tD(rD(t));if(!cannotHaveUsernamePasswordPort(e)){e.username="";for(var i=0;i<r.length;i++)e.username+=percentEncode(r[i],LD)}})),password:accessorDescriptor(getPassword,(function(t){var e=lD(this),r=tD(rD(t));if(!cannotHaveUsernamePasswordPort(e)){e.password="";for(var i=0;i<r.length;i++)e.password+=percentEncode(r[i],LD)}})),host:accessorDescriptor(getHost,(function(t){var e=lD(this);e.cannotBeABaseURL||parseURL(e,rD(t),WD)})),hostname:accessorDescriptor(getHostname,(function(t){var e=lD(this);e.cannotBeABaseURL||parseURL(e,rD(t),HD)})),port:accessorDescriptor(getPort,(function(t){var e=lD(this);cannotHaveUsernamePasswordPort(e)||(""==(t=rD(t))?e.port=null:parseURL(e,t,GD))})),pathname:accessorDescriptor(getPathname,(function(t){var e=lD(this);e.cannotBeABaseURL||(e.path=[],parseURL(e,rD(t),qD))})),search:accessorDescriptor(getSearch,(function(t){var e=lD(this);""==(t=rD(t))?e.query=null:("?"==t.charAt(0)&&(t=t.slice(1)),e.query="",parseURL(e,t,KD)),uD(e.searchParams).updateSearchParams(e.query)})),searchParams:accessorDescriptor(getSearchParams),hash:accessorDescriptor(getHash,(function(t){var e=lD(this);""!=(t=rD(t))?("#"==t.charAt(0)&&(t=t.slice(1)),e.fragment="",parseURL(e,t,QD)):e.fragment=null}))}),ZB(tj,"toJSON",(function toJSON(){return serializeURL.call(this)}),{enumerable:!0}),ZB(tj,"toString",(function toString(){return serializeURL.call(this)}),{enumerable:!0}),oD){var ej=oD.createObjectURL,rj=oD.revokeObjectURL;ej&&ZB(JD,"createObjectURL",(function createObjectURL(t){return ej.apply(oD,arguments)})),rj&&ZB(JD,"revokeObjectURL",(function revokeObjectURL(t){return rj.apply(oD,arguments)}))}iD(JD,"URL"),VB({global:!0,forced:!XB,sham:!YB},{URL:JD}),_export({target:"URL",proto:!0,enumerable:!0},{toJSON:function toJSON(){return URL.prototype.toString.call(this)}});!function(t){var e=function(t){var e,r=Object.prototype,i=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",u=n.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}function wrap(t,e,r,i){var n=e&&e.prototype instanceof Generator?e:Generator,s=Object.create(n.prototype),o=new Context(i||[]);return s._invoke=function makeInvokeMethod(t,e,r){var i=h;return function invoke(n,s){if(i===f)throw new Error("Generator is already running");if(i===d){if("throw"===n)throw s;return doneResult()}for(r.method=n,r.arg=s;;){var o=r.delegate;if(o){var u=maybeInvokeDelegate(o,r);if(u){if(u===_)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var g=tryCatch(t,e,r);if("normal"===g.type){if(i=r.done?d:l,g.arg===_)continue;return{value:g.arg,done:r.done}}"throw"===g.type&&(i=d,r.method="throw",r.arg=g.arg)}}}(t,r,o),s}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",d="completed",_={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var g={};define(g,s,(function(){return this}));var p=Object.getPrototypeOf,v=p&&p(p(values([])));v&&v!==r&&i.call(v,s)&&(g=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(g);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,n,s,o){var u=tryCatch(t[r],t,n);if("throw"!==u.type){var h=u.arg,l=h.value;return l&&"object"==typeof l&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){invoke("next",t,s,o)}),(function(t){invoke("throw",t,s,o)})):e.resolve(l).then((function(t){h.value=t,s(h)}),(function(t){return invoke("throw",t,s,o)}))}o(u.arg)}var r;this._invoke=function enqueue(t,i){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,i,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,r){var i=t.iterator[r.method];if(i===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method))return _;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var n=tryCatch(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,_;var s=n.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,_):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,_)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function next(){for(;++n<t.length;)if(i.call(t,n))return next.value=t[n],next.done=!1,next;return next.value=e,next.done=!0,next};return o.next=o}}return{next:doneResult}}function doneResult(){return{value:e,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(y,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,o,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,i,n,s){void 0===s&&(s=Promise);var o=new AsyncIterator(wrap(e,r,i,n),s);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,s,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function next(){for(;e.length;){var r=e.pop();if(r in t)return next.value=r,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(i,n){return o.type="throw",o.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return handle("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(u&&h){if(this.prev<s.catchLoc)return handle(s.catchLoc,!0);if(this.prev<s.finallyLoc)return handle(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return handle(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return handle(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,_):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),_},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),_}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;resetTryEntry(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:values(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),_}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}({exports:{}});var ij="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==ij&&ij,nj="URLSearchParams"in ij,sj="Symbol"in ij&&"iterator"in Symbol,oj="FileReader"in ij&&"Blob"in ij&&function(){try{return new Blob,!0}catch(t){return!1}}(),aj="FormData"in ij,uj="ArrayBuffer"in ij;if(uj)var hj=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],lj=ArrayBuffer.isView||function(t){return t&&hj.indexOf(Object.prototype.toString.call(t))>-1};function normalizeName(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function normalizeValue(t){return"string"!=typeof t&&(t=String(t)),t}function iteratorFor(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return sj&&(e[Symbol.iterator]=function(){return e}),e}function Headers(t){this.map={},t instanceof Headers?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function consumed(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function fileReaderReady(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function readBlobAsArrayBuffer(t){var e=new FileReader,r=fileReaderReady(e);return e.readAsArrayBuffer(t),r}function bufferClone(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:oj&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:aj&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:nj&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():uj&&oj&&function isDataView(t){return t&&DataView.prototype.isPrototypeOf(t)}(t)?(this._bodyArrayBuffer=bufferClone(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):uj&&(ArrayBuffer.prototype.isPrototypeOf(t)||lj(t))?this._bodyArrayBuffer=bufferClone(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):nj&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},oj&&(this.blob=function(){var t=consumed(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=consumed(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var t=consumed(this);if(t)return t;if(this._bodyBlob)return function readBlobAsText(t){var e=new FileReader,r=fileReaderReady(e);return e.readAsText(t),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function readArrayBufferAsText(t){for(var e=new Uint8Array(t),r=new Array(e.length),i=0;i<e.length;i++)r[i]=String.fromCharCode(e[i]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},aj&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(t,e){t=normalizeName(t),e=normalizeValue(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},Headers.prototype.delete=function(t){delete this.map[normalizeName(t)]},Headers.prototype.get=function(t){return t=normalizeName(t),this.has(t)?this.map[t]:null},Headers.prototype.has=function(t){return this.map.hasOwnProperty(normalizeName(t))},Headers.prototype.set=function(t,e){this.map[normalizeName(t)]=normalizeValue(e)},Headers.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},Headers.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),iteratorFor(t)},Headers.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),iteratorFor(t)},Headers.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),iteratorFor(t)},sj&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var cj=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(t,e){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r=(e=e||{}).body;if(t instanceof Request){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new Headers(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new Headers(e.headers)),this.method=function normalizeMethod(t){var e=t.toUpperCase();return cj.indexOf(e)>-1?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function decode(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),i=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(n))}})),e}function Response(t,e){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===e.statusText?"":""+e.statusText,this.headers=new Headers(e.headers),this.url=e.url||"",this._initBody(t)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var t=new Response(null,{status:0,statusText:""});return t.type="error",t};var fj=[301,302,303,307,308];Response.redirect=function(t,e){if(-1===fj.indexOf(e))throw new RangeError("Invalid status code");return new Response(null,{status:e,headers:{location:t}})};var dj=ij.DOMException;try{new dj}catch(t){(dj=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack}).prototype=Object.create(Error.prototype),dj.prototype.constructor=dj}function fetch(t,e){return new Promise((function(r,i){var n=new Request(t,e);if(n.signal&&n.signal.aborted)return i(new dj("Aborted","AbortError"));var s=new XMLHttpRequest;function abortXhr(){s.abort()}s.onload=function(){var t,e,i={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new Headers,t.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(t){return 0===t.indexOf("\n")?t.substr(1,t.length):t})).forEach((function(t){var r=t.split(":"),i=r.shift().trim();if(i){var n=r.join(":").trim();e.append(i,n)}})),e)};i.url="responseURL"in s?s.responseURL:i.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;setTimeout((function(){r(new Response(n,i))}),0)},s.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},s.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},s.onabort=function(){setTimeout((function(){i(new dj("Aborted","AbortError"))}),0)},s.open(n.method,function fixUrl(t){try{return""===t&&ij.location.href?ij.location.href:t}catch(e){return t}}(n.url),!0),"include"===n.credentials?s.withCredentials=!0:"omit"===n.credentials&&(s.withCredentials=!1),"responseType"in s&&(oj?s.responseType="blob":uj&&n.headers.get("Content-Type")&&-1!==n.headers.get("Content-Type").indexOf("application/octet-stream")&&(s.responseType="arraybuffer")),!e||"object"!=typeof e.headers||e.headers instanceof Headers?n.headers.forEach((function(t,e){s.setRequestHeader(e,t)})):Object.getOwnPropertyNames(e.headers).forEach((function(t){s.setRequestHeader(t,normalizeValue(e.headers[t]))})),n.signal&&(n.signal.addEventListener("abort",abortXhr),s.onreadystatechange=function(){4===s.readyState&&n.signal.removeEventListener("abort",abortXhr)}),s.send(void 0===n._bodyInit?null:n._bodyInit)}))}fetch.polyfill=!0,ij.fetch||(ij.fetch=fetch,ij.Headers=Headers,ij.Request=Request,ij.Response=Response),function(t){var e=function(){try{return!!Symbol.iterator}catch(t){return!1}}(),createIterator=function(t){var r={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e&&(r[Symbol.iterator]=function(){return r}),r},serializeParam=function(t){return encodeURIComponent(t).replace(/%20/g,"+")},deserializeParam=function(t){return decodeURIComponent(String(t).replace(/\+/g," "))};(function(){try{var e=t.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries}catch(t){return!1}})()||function(){var URLSearchParams=function(t){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var e=typeof t;if("undefined"===e);else if("string"===e)""!==t&&this._fromString(t);else if(t instanceof URLSearchParams){var r=this;t.forEach((function(t,e){r.append(e,t)}))}else{if(null===t||"object"!==e)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(t))for(var i=0;i<t.length;i++){var n=t[i];if("[object Array]"!==Object.prototype.toString.call(n)&&2===n.length)throw new TypeError("Expected [string, any] as entry at index "+i+" of URLSearchParams's input");this.append(n[0],n[1])}else for(var s in t)t.hasOwnProperty(s)&&this.append(s,t[s])}},r=URLSearchParams.prototype;r.append=function(t,e){t in this._entries?this._entries[t].push(String(e)):this._entries[t]=[String(e)]},r.delete=function(t){delete this._entries[t]},r.get=function(t){return t in this._entries?this._entries[t][0]:null},r.getAll=function(t){return t in this._entries?this._entries[t].slice(0):[]},r.has=function(t){return t in this._entries},r.set=function(t,e){this._entries[t]=[String(e)]},r.forEach=function(t,e){var r;for(var i in this._entries)if(this._entries.hasOwnProperty(i)){r=this._entries[i];for(var n=0;n<r.length;n++)t.call(e,r[n],i,this)}},r.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),createIterator(t)},r.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),createIterator(t)},r.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),createIterator(t)},e&&(r[Symbol.iterator]=r.entries),r.toString=function(){var t=[];return this.forEach((function(e,r){t.push(serializeParam(r)+"="+serializeParam(e))})),t.join("&")},t.URLSearchParams=URLSearchParams}();var r=t.URLSearchParams.prototype;"function"!=typeof r.sort&&(r.sort=function(){var t=this,e=[];this.forEach((function(r,i){e.push([i,r]),t._entries||t.delete(i)})),e.sort((function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0})),t._entries&&(t._entries={});for(var r=0;r<e.length;r++)this.append(e[r][0],e[r][1])}),"function"!=typeof r._fromString&&Object.defineProperty(r,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(t){if(this._entries)this._entries={};else{var e=[];this.forEach((function(t,r){e.push(r)}));for(var r=0;r<e.length;r++)this.delete(e[r])}var i,n=(t=t.replace(/^\?/,"")).split("&");for(r=0;r<n.length;r++)i=n[r].split("="),this.append(deserializeParam(i[0]),i.length>1?deserializeParam(i[1]):"")}})}(void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:t),function(t){if(function(){try{var e=new t.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(t){return!1}}()||function(){var e=t.URL,URL=function(e,r){"string"!=typeof e&&(e=String(e)),r&&"string"!=typeof r&&(r=String(r));var i,n=document;if(r&&(void 0===t.location||r!==t.location.href)){r=r.toLowerCase(),(i=(n=document.implementation.createHTMLDocument("")).createElement("base")).href=r,n.head.appendChild(i);try{if(0!==i.href.indexOf(r))throw new Error(i.href)}catch(t){throw new Error("URL unable to set base "+r+" due to "+t)}}var s=n.createElement("a");s.href=e,i&&(n.body.appendChild(s),s.href=s.href);var o=n.createElement("input");if(o.type="url",o.value=e,":"===s.protocol||!/:/.test(s.href)||!o.checkValidity()&&!r)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:s});var u=new t.URLSearchParams(this.search),h=!0,l=!0,f=this;["append","delete","set"].forEach((function(t){var e=u[t];u[t]=function(){e.apply(u,arguments),h&&(l=!1,f.search=u.toString(),l=!0)}})),Object.defineProperty(this,"searchParams",{value:u,enumerable:!0});var d=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==d&&(d=this.search,l&&(h=!1,this.searchParams._fromString(this.search),h=!0))}})},r=URL.prototype;["hash","host","hostname","port","protocol"].forEach((function(t){!function(t){Object.defineProperty(r,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})}(t)})),Object.defineProperty(r,"search",{get:function(){return this._anchorElement.search},set:function(t){this._anchorElement.search=t,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(r,{toString:{get:function(){var t=this;return function(){return t.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(t){this._anchorElement.href=t,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(t){this._anchorElement.pathname=t},enumerable:!0},origin:{get:function(){var t={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],e=this._anchorElement.port!=t&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(e?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(t){},enumerable:!0},username:{get:function(){return""},set:function(t){},enumerable:!0}}),URL.createObjectURL=function(t){return e.createObjectURL.apply(e,arguments)},URL.revokeObjectURL=function(t){return e.revokeObjectURL.apply(e,arguments)},t.URL=URL}(),void 0!==t.location&&!("origin"in t.location)){var getOrigin=function(){return t.location.protocol+"//"+t.location.hostname+(t.location.port?":"+t.location.port:"")};try{Object.defineProperty(t.location,"origin",{get:getOrigin,enumerable:!0})}catch(e){setInterval((function(){t.location.origin=getOrigin()}),100)}}}(void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:t);try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1)}catch(t){window.ImageData=function(){var t=arguments;if(t.length<2)throw new TypeError("Failed to construct 'ImageData': 2 arguments required, but only "+t.length+" present.");if(t.length>2){if(!(t[0]instanceof Uint8ClampedArray))throw new TypeError("Failed to construct 'ImageData': 2 arguments required, but only "+t.length+" present.");if(t[0].length!==4*t[1]*t[2])throw new Error("Failed to construct 'ImageData': The input data byte length is not a multiple of (4 * width * height)")}var e=3===t.length?t[1]:t[0],r=3===t.length?t[2]:t[1],i=document.createElement("canvas"),n=i.getContext("2d"),s=n.createImageData(e,r);return 3===t.length&&s.data.set(t[0]),s}}(function(){function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _wrapRegExp(){_wrapRegExp=function(t,e){return new BabelRegExp(t,void 0,e)};var t=RegExp.prototype,e=new WeakMap;function BabelRegExp(t,r,i){var n=new RegExp(t,r);return e.set(n,i||e.get(t)),_setPrototypeOf(n,BabelRegExp.prototype)}function buildGroups(t,r){var i=e.get(r);return Object.keys(i).reduce((function(e,r){return e[r]=t[i[r]],e}),Object.create(null))}return _inherits(BabelRegExp,RegExp),BabelRegExp.prototype.exec=function(e){var r=t.exec.call(this,e);return r&&(r.groups=buildGroups(r,this)),r},BabelRegExp.prototype[Symbol.replace]=function(r,i){if("string"==typeof i){var n=e.get(this);return t[Symbol.replace].call(this,r,i.replace(/\$<([^>]+)>/g,(function(t,e){return"$"+n[e]})))}if("function"==typeof i){var s=this;return t[Symbol.replace].call(this,r,(function(){var t=arguments;return"object"!=typeof t[t.length-1]&&(t=[].slice.call(t)).push(buildGroups(t,s)),i.apply(this,t)}))}return t[Symbol.replace].call(this,r,i)},_wrapRegExp.apply(this,arguments)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,e){return t.__proto__=e,t})(t,e)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function _newArrowCheck(t,e){if(t!==e)throw new TypeError("Cannot instantiate an arrow function")}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _createSuper(t){var e=_isNativeReflectConstruct();return function _createSuperInternal(){var r,i=_getPrototypeOf(t);if(e){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,e,r){var i=_superPropBase(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function set(t,e,r,i){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function set(t,e,r,i){var n,s=_superPropBase(t,e);if(s){if((n=Object.getOwnPropertyDescriptor(s,e)).set)return n.set.call(i,r),!0;if(!n.writable)return!1}if(n=Object.getOwnPropertyDescriptor(i,e)){if(!n.writable)return!1;n.value=r,Object.defineProperty(i,e,n)}else _defineProperty(i,e,r);return!0})(t,e,r,i)}function _set(t,e,r,i,n){if(!set(t,e,r,i||t)&&n)throw new Error("failed to set property");return r}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,F=function(){};return{s:F,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){o=!0,n=t},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw n}}}}var e=function(){function StageUtils(){_classCallCheck(this,StageUtils)}return _createClass(StageUtils,null,[{key:"mergeNumbers",value:function mergeNumbers(t,e,r){return t*r+e*(1-r)}},{key:"rgb",value:function rgb(t,e,r){return(t<<16)+(e<<8)+r+4278190080}},{key:"rgba",value:function rgba(t,e,r,i){return(t<<16)+(e<<8)+r+16777216*(255*i|0)}},{key:"getRgbString",value:function getRgbString(t){return"rgb("+(t/65536|0)%256+","+(t/256|0)%256+","+t%256+")"}},{key:"getRgbaString",value:function getRgbaString(t){return"rgba("+(t/65536|0)%256+","+(t/256|0)%256+","+t%256+","+((t/16777216|0)/255).toFixed(4)+")"}},{key:"getRgbaStringFromArray",value:function getRgbaStringFromArray(t){return"rgba("+Math.floor(255*t[0])+","+Math.floor(255*t[1])+","+Math.floor(255*t[2])+","+(Math.floor(255*t[3])/255).toFixed(4)+")"}},{key:"getRgbaComponentsNormalized",value:function getRgbaComponentsNormalized(t){return[(t/65536|0)%256/255,(t/256|0)%256/255,t%256/255,(t/16777216|0)/255]}},{key:"getRgbComponentsNormalized",value:function getRgbComponentsNormalized(t){return[(t/65536|0)%256/255,(t/256|0)%256/255,t%256/255]}},{key:"getRgbaComponents",value:function getRgbaComponents(t){return[(t/65536|0)%256,(t/256|0)%256,t%256,t/16777216|0]}},{key:"getArgbNumber",value:function getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));var e=((0|t[3])<<24)+((0|t[0])<<16)+((0|t[1])<<8)+(0|t[2]);return e<0&&(e=4294967295+e+1),e}},{key:"mergeColors",value:function mergeColors(t,e,r){var i=(t/65536|0)%256*r+(e/65536|0)%256*(1-r),n=(t/256|0)%256*r+(e/256|0)%256*(1-r),s=t%256*r+e%256*(1-r),o=(t/16777216|0)*r+(e/16777216|0)*(1-r);return 16777216*Math.round(o)+65536*Math.round(i)+256*Math.round(n)+Math.round(s)}},{key:"mergeMultiColors",value:function mergeMultiColors(t,e){for(var r=0,i=0,n=0,s=0,o=0,u=t.length,h=0;h<u;h++){var l=(t[h]/65536|0)%256,f=(t[h]/256|0)%256,d=t[h]%256,_=t[h]/16777216|0;r+=l*e[h],i+=f*e[h],n+=d*e[h],s+=_*e[h],o+=e[h]}return o=1/o,16777216*Math.round(s*o)+65536*Math.round(r*o)+256*Math.round(i*o)+Math.round(n*o)}},{key:"mergeMultiColorsEqual",value:function mergeMultiColorsEqual(t){for(var e=0,r=0,i=0,n=0,s=0,o=t.length,u=0;u<o;u++)e+=(t[u]/65536|0)%256,r+=(t[u]/256|0)%256,i+=t[u]%256,n+=t[u]/16777216|0,s+=1;return s=1/s,16777216*Math.round(n*s)+65536*Math.round(e*s)+256*Math.round(r*s)+Math.round(i*s)}},{key:"mergeColorAlpha",value:function mergeColorAlpha(t,e){var r=(t/16777216|0)*e|0;return((t>>16&255)*r/255&255)+((65280&t)*r/255&65280)+(((255&t)<<16)*r/255&16711680)+(r<<24)}},{key:"rad",value:function rad(t){return t*(Math.PI/180)}},{key:"getTimingBezier",value:function getTimingBezier(t,e,r,i){var n=3*t,s=3*(r-t)-n,o=1-n-s,u=3*e,h=3*(i-e)-u,l=1-u-h;return function(t){if(t>=1)return 1;if(t<=0)return 0;for(var e,r,i=.5,f=0;f<20;f++){if((r=t-i*(i*(i*o+s)+n))>-1e-8&&r<1e-8)return i*(i*(i*l+h)+u);if((e=i*(i*(3*o)+2*s)+n)>1e-10&&e<1e-10)break;i+=r/e}for(var d=0,_=1,g=0;g<20;g++){if((r=t-(i=.5*(d+_))*(i*(i*o+s)+n))>-1e-8&&r<1e-8)return i*(i*(i*l+h)+u);r<0?_=i:d=i}}}},{key:"getTimingFunction",value:function getTimingFunction(t){switch(t){case"linear":return function(t){return t};case"ease":return StageUtils.getTimingBezier(.25,.1,.25,1);case"ease-in":return StageUtils.getTimingBezier(.42,0,1,1);case"ease-out":return StageUtils.getTimingBezier(0,0,.58,1);case"ease-in-out":return StageUtils.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(t){return 1===t?1:0};default:var e="cubic-bezier(";if(t&&0===t.indexOf(e)){var r=t.substr(e.length,t.length-e.length-1).split(",");if(4!==r.length)return console.warn("[Lightning] Unknown timing function: "+t),function(t){return t};var i=parseFloat(r[0]),n=parseFloat(r[1]),s=parseFloat(r[2]),o=parseFloat(r[3]);return isNaN(i)||isNaN(n)||isNaN(s)||isNaN(o)?(console.warn("[Lightning] Unknown timing function: "+t),function(t){return t}):StageUtils.getTimingBezier(i,n,s,o)}return console.warn("[Lightning] Unknown timing function: "+t),function(t){return t}}}}]),StageUtils}(),r=function(){function Utils(){_classCallCheck(this,Utils)}return _createClass(Utils,null,[{key:"isFunction",value:function isFunction(t){return"function"==typeof t}},{key:"isNumber",value:function isNumber(t){return"number"==typeof t}},{key:"isInteger",value:function isInteger(t){return"number"==typeof t&&t%1==0}},{key:"isBoolean",value:function isBoolean(t){return!0===t||!1===t}},{key:"isString",value:function isString(t){return"string"==typeof t}},{key:"clone",value:function clone(t){return Utils.isObjectLiteral(t)||Array.isArray(t)?Utils.getDeepClone(t):t}},{key:"cloneObjShallow",value:function cloneObjShallow(t){for(var e=Object.keys(t),r={},i=0;i<e.length;i++)r[e[i]]=t[e[i]];return r}},{key:"merge",value:function merge(t,e){for(var r=Object.keys(e),i=0;i<r.length;i++)t[r[i]]=e[r[i]];return t}},{key:"isObject",value:function isObject(t){var e=typeof t;return!!t&&("object"===e||"function"===e)}},{key:"isPlainObject",value:function isPlainObject(t){return!!t&&"object"==typeof t}},{key:"isObjectLiteral",value:function isObjectLiteral(t){return"object"==typeof t&&t&&t.constructor===Object}},{key:"getArrayIndex",value:function getArrayIndex(t,e){return Utils.getModuloIndex(t,e.length)}},{key:"getModuloIndex",value:function getModuloIndex(t,e){if(0===e)return t;for(;t<0;)t+=Math.ceil(-t/e)*e;return t%=e}},{key:"getDeepClone",value:function getDeepClone(t){var e,r;if(Utils.isFunction(t))return t;if(Array.isArray(t)){r=[];var i=Object.keys(t);for(e=0;e<i.length;e++)r[i[e]]=Utils.getDeepClone(t[i[e]]);return r}if(Utils.isObject(t)){r={};var n=Object.keys(t);for(e=0;e<n.length;e++)r[n[e]]=Utils.getDeepClone(t[n[e]]);return r}return t}},{key:"equalValues",value:function equalValues(t,e){return typeof t==typeof e&&(Utils.isObjectLiteral(t)?Utils.isObjectLiteral(e)&&Utils.equalObjectLiterals(t,e):Array.isArray(t)?Array.isArray(e)&&Utils.equalArrays(t,e):t===e)}},{key:"equalObjectLiterals",value:function equalObjectLiterals(t,e){var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(var n=0,s=r.length;n<s;n++){var o=r[n],u=i[n];if(o!==u)return!1;var h=t[o],l=e[u];if(!Utils.equalValues(h,l))return!1}return!0}},{key:"equalArrays",value:function equalArrays(t,e){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(!this.equalValues(t[r],e[r]))return!1;return!0}},{key:"setToArray",value:function setToArray(t){var e=[];return t.forEach((function(t){e.push(t)})),e}},{key:"iteratorToArray",value:function iteratorToArray(t){for(var e=[],r=t.next();!r.done;)e.push(r.value),r=t.next();return e}},{key:"isUcChar",value:function isUcChar(t){return t>=65&&t<=90}}]),Utils}();r.isWeb="undefined"!=typeof window&&"undefined"==typeof sparkscene,r.isWPE=r.isWeb&&-1!==navigator.userAgent.indexOf("WPE"),r.isSpark="undefined"!=typeof sparkscene,r.isNode="undefined"==typeof window||r.isSpark,r.isPS4=r.isWeb&&-1!==navigator.userAgent.indexOf("PlayStation 4");var i=function(){function Base(){_classCallCheck(this,Base)}return _createClass(Base,null,[{key:"defaultSetter",value:function defaultSetter(t,e,r){t[e]=r}},{key:"patchObject",value:function patchObject(t,e){if(r.isObjectLiteral(e))for(var i=Object.keys(e),n=0,s=i.length;n<s;n++){var o=i[n];this.patchObjectProperty(t,o,e[o])}else console.error("[Lightning] Settings must be object literal")}},{key:"patchObjectProperty",value:function patchObjectProperty(t,e,i){var n=t.setSetting||Base.defaultSetter;"_"===e.charAt(0)?"__create"!==e&&console.error("[Lightning] Patch of private property '"+e+"' is not allowed"):"type"!==e&&(r.isFunction(i)&&i.__local&&(i=i.__local(t)),n(t,e,i))}},{key:"local",value:function local(t){t.__local=!0}}]),Base}(),n=function(){function SpacingCalculator(){_classCallCheck(this,SpacingCalculator)}return _createClass(SpacingCalculator,null,[{key:"getSpacing",value:function getSpacing(t,e,r){var i,n,s,o=e-1;switch(t){case"flex-start":n=0,s=0;break;case"flex-end":n=r,s=0;break;case"center":n=r/2,s=0;break;case"space-between":n=0,s=Math.max(0,r)/o;break;case"space-around":if(r<0)return this.getSpacing("center",e,r);n=.5*(i=r/(o+1)),s=i;break;case"space-evenly":if(r<0)return this.getSpacing("center",e,r);n=i=r/(o+2),s=i;break;case"stretch":n=0,s=0;break;default:throw new Error("Unknown mode: "+t)}return{spacingBefore:n,spacingBetween:s}}}]),SpacingCalculator}(),s=function(){function ContentAligner(t){_classCallCheck(this,ContentAligner),this._layout=t,this._totalCrossAxisSize=0}return _createClass(ContentAligner,[{key:"_lines",get:function get(){return this._layout._lines}},{key:"init",value:function init(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}},{key:"align",value:function align(){var t=this._layout.crossAxisSize-this._totalCrossAxisSize,e=this._getSpacing(t),r=e.spacingBefore,i=e.spacingBetween,n=this._lines,s=0;"stretch"===this._layout._flexContainer.alignContent&&n.length&&t>0&&(s=t/n.length);for(var o=r,u=0,h=n.length;u<h;u++){var l=o,f=n[u].createItemAligner(),d=n[u].crossAxisLayoutSize+s;f.setCrossAxisLayoutSize(d),f.setCrossAxisLayoutOffset(l),f.align(),f.recursiveResizeOccured&&n[u].setItemPositions(),o+=d,o+=i}}},{key:"totalCrossAxisSize",get:function get(){return this._totalCrossAxisSize}},{key:"_getTotalCrossAxisSize",value:function _getTotalCrossAxisSize(){for(var t=this._lines,e=0,r=0,i=t.length;r<i;r++)e+=t[r].crossAxisLayoutSize;return e}},{key:"_getSpacing",value:function _getSpacing(t){var e=this._layout._flexContainer.alignContent,r=this._lines.length;return n.getSpacing(e,r,t)}}]),ContentAligner}(),o=function(){function FlexUtils(){_classCallCheck(this,FlexUtils)}return _createClass(FlexUtils,null,[{key:"getParentAxisSizeWithPadding",value:function getParentAxisSizeWithPadding(t,e){var r=t.target.getParent();if(r){var i=t.flexParent;return i?this.getAxisLayoutSize(i,e)+this.getTotalPadding(i,e):e?r.w:r.h}return 0}},{key:"getRelAxisSize",value:function getRelAxisSize(t,e){return e?t.funcW?this._allowRelAxisSizeFunction(t,!0)?t.funcW(this.getParentAxisSizeWithPadding(t,!0)):0:t.originalWidth:t.funcH?this._allowRelAxisSizeFunction(t,!1)?t.funcH(this.getParentAxisSizeWithPadding(t,!1)):0:t.originalHeight}},{key:"_allowRelAxisSizeFunction",value:function _allowRelAxisSizeFunction(t,e){var r=t.flexParent;return!r||!r._flex._layout.isAxisFitToContents(e)}},{key:"isZeroAxisSize",value:function isZeroAxisSize(t,e){return e?!t.originalWidth&&!t.funcW:!t.originalHeight&&!t.funcH}},{key:"getAxisLayoutPos",value:function getAxisLayoutPos(t,e){return e?t.x:t.y}},{key:"getAxisLayoutSize",value:function getAxisLayoutSize(t,e){return e?t.w:t.h}},{key:"setAxisLayoutPos",value:function setAxisLayoutPos(t,e,r){e?t.x=r:t.y=r}},{key:"setAxisLayoutSize",value:function setAxisLayoutSize(t,e,r){e?t.w=r:t.h=r}},{key:"getAxisMinSize",value:function getAxisMinSize(t,e){var r=this.getPlainAxisMinSize(t,e),i=0;return t.isFlexItemEnabled()&&(i=t._flexItem._getMinSizeSetting(e)),i>0&&(r=Math.max(r,i)),r}},{key:"getPlainAxisMinSize",value:function getPlainAxisMinSize(t,e){return t.isFlexEnabled()?t._flex._layout.getAxisMinSize(e):0!==t.flexItem.shrink?0:this.getRelAxisSize(t,e)}},{key:"resizeAxis",value:function resizeAxis(t,e,r){t.isFlexEnabled()?t._flex._horizontal===e?t._flex._layout.resizeMainAxis(r):t._flex._layout.resizeCrossAxis(r):this.setAxisLayoutSize(t,e,r)}},{key:"getPaddingOffset",value:function getPaddingOffset(t,e){if(t.isFlexEnabled()){var r=t._flex;return e?r.paddingLeft:r.paddingTop}return 0}},{key:"getTotalPadding",value:function getTotalPadding(t,e){if(t.isFlexEnabled()){var r=t._flex;return e?r.paddingRight+r.paddingLeft:r.paddingTop+r.paddingBottom}return 0}},{key:"getMarginOffset",value:function getMarginOffset(t,e){var r=t.flexItem;return r?e?r.marginLeft:r.marginTop:0}},{key:"getTotalMargin",value:function getTotalMargin(t,e){var r=t.flexItem;return r?e?r.marginRight+r.marginLeft:r.marginTop+r.marginBottom:0}}]),FlexUtils}(),u=function(){function SizeShrinker(t){_classCallCheck(this,SizeShrinker),this._line=t,this._amountRemaining=0,this._shrunkSize=0}return _createClass(SizeShrinker,[{key:"shrink",value:function shrink(t){this._shrunkSize=0,this._amountRemaining=t;var e=this._getTotalShrinkAmount();if(e){var r=this._line.items;do{for(var i=this._amountRemaining/e,n=this._line.startIndex;n<=this._line.endIndex;n++){var s=r[n].flexItem,o=s.shrink;if(o>0){var shrink=o*i,u=s._getMainAxisMinSize(),h=s._getMainAxisLayoutSize();if(h>u){var l=h-u;shrink>=l&&(shrink=l,e-=o);var f=h-shrink;if(s._resizeMainAxis(f),this._shrunkSize+=shrink,this._amountRemaining-=shrink,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}},{key:"_getTotalShrinkAmount",value:function _getTotalShrinkAmount(){for(var t=0,e=this._line.items,r=this._line.startIndex;r<=this._line.endIndex;r++){var i=e[r].flexItem;if(i.shrink){var n=i._getMainAxisMinSize();i._getMainAxisLayoutSize()>n&&(t+=i.shrink)}}return t}},{key:"getShrunkSize",value:function getShrunkSize(){return this._shrunkSize}}]),SizeShrinker}(),h=function(){function SizeGrower(t){_classCallCheck(this,SizeGrower),this._line=t,this._amountRemaining=0,this._grownSize=0}return _createClass(SizeGrower,[{key:"grow",value:function grow(t){this._grownSize=0,this._amountRemaining=t;var e=this._getTotalGrowAmount();if(e){var r=this._line.items;do{for(var i=this._amountRemaining/e,n=this._line.startIndex;n<=this._line.endIndex;n++){var s=r[n].flexItem,o=s.grow;if(o>0){var grow=o*i,u=s._getMainAxisMaxSizeSetting(),h=s._getMainAxisLayoutSize();if(u>0)if(h>=u)grow=0;else{var l=u-h;grow>=l&&(grow=l,e-=o)}if(grow>0){var f=h+grow;if(s._resizeMainAxis(f),this._grownSize+=grow,this._amountRemaining-=grow,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}},{key:"_getTotalGrowAmount",value:function _getTotalGrowAmount(){for(var t=0,e=this._line.items,r=this._line.startIndex;r<=this._line.endIndex;r++){var i=e[r].flexItem;if(i.grow){var n=i._getMainAxisMaxSizeSetting(),s=i._getMainAxisLayoutSize();(0===n||s<n)&&(t+=i.grow)}}return t}},{key:"getGrownSize",value:function getGrownSize(){return this._grownSize}}]),SizeGrower}(),l=function(){function ItemPositioner(t){_classCallCheck(this,ItemPositioner),this._line=t}return _createClass(ItemPositioner,[{key:"_layout",get:function get(){return this._line._layout}},{key:"position",value:function position(){for(var t=this._getSpacing(),e=t.spacingBefore,r=t.spacingBetween,i=e,n=this._line.items,s=this._line.startIndex;s<=this._line.endIndex;s++){var o=n[s];o.flexItem._setMainAxisLayoutPos(i),i+=o.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i+=r}}},{key:"_getSpacing",value:function _getSpacing(){var t=this._line._availableSpace,e=this._layout._flexContainer.justifyContent,r=this._line.numberOfItems;return n.getSpacing(e,r,t)}}]),ItemPositioner}(),f=function(){function ItemAligner(t){_classCallCheck(this,ItemAligner),this._line=t,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}return _createClass(ItemAligner,[{key:"_layout",get:function get(){return this._line._layout}},{key:"_flexContainer",get:function get(){return this._layout._flexContainer}},{key:"setCrossAxisLayoutSize",value:function setCrossAxisLayoutSize(t){this._crossAxisLayoutSize=t}},{key:"setCrossAxisLayoutOffset",value:function setCrossAxisLayoutOffset(t){this._crossAxisLayoutOffset=t}},{key:"align",value:function align(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;for(var t=this._line.items,e=this._line.startIndex;e<=this._line.endIndex;e++){var r=t[e];this._alignItem(r)}}},{key:"recursiveResizeOccured",get:function get(){return this._recursiveResizeOccured}},{key:"_alignItem",value:function _alignItem(t){var e=t.flexItem,r=e.alignSelf||this._alignItemsSetting;switch("stretch"===r&&this._preventStretch(e)&&(r="flex-start"),"stretch"===r||this._isCrossAxisFitToContents||e._hasRelCrossAxisSize()&&e._resetCrossAxisLayoutSize(),r){case"flex-start":this._alignItemFlexStart(e);break;case"flex-end":this._alignItemFlexEnd(e);break;case"center":this._alignItemFlexCenter(e);break;case"stretch":this._alignItemStretch(e)}}},{key:"_alignItemFlexStart",value:function _alignItemFlexStart(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}},{key:"_alignItemFlexEnd",value:function _alignItemFlexEnd(t){var e=t._getCrossAxisLayoutSizeWithPaddingAndMargin();t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-e))}},{key:"_alignItemFlexCenter",value:function _alignItemFlexCenter(t){var e=t._getCrossAxisLayoutSizeWithPaddingAndMargin(),r=(this._crossAxisLayoutSize-e)/2;t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+r)}},{key:"_alignItemStretch",value:function _alignItemStretch(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);var e=t._getMainAxisLayoutSize(),r=this._crossAxisLayoutSize-t._getCrossAxisMargin()-t._getCrossAxisPadding(),i=t._getCrossAxisMinSizeSetting();i>0&&(r=Math.max(r,i));var n=t._getCrossAxisMaxSizeSetting();n>0&&(r=Math.min(r,n)),t._resizeCrossAxis(r),t._getMainAxisLayoutSize()!==e&&(this._recursiveResizeOccured=!0)}},{key:"_preventStretch",value:function _preventStretch(t){var e=t._hasFixedCrossAxisSize(),r="stretch"===t.alignSelf;return e&&!r}}]),ItemAligner}(),d=function(){function LineLayout(t,e,r,i){_classCallCheck(this,LineLayout),this._layout=t,this.items=t.items,this.startIndex=e,this.endIndex=r,this._availableSpace=i}return _createClass(LineLayout,[{key:"performLayout",value:function performLayout(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}},{key:"_setItemSizes",value:function _setItemSizes(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}},{key:"_growItemSizes",value:function _growItemSizes(t){var e=new h(this);e.grow(t),this._availableSpace-=e.getGrownSize()}},{key:"_shrinkItemSizes",value:function _shrinkItemSizes(t){var e=new u(this);e.shrink(t),this._availableSpace+=e.getShrunkSize()}},{key:"setItemPositions",value:function setItemPositions(){new l(this).position()}},{key:"createItemAligner",value:function createItemAligner(){return new f(this)}},{key:"_calcLayoutInfo",value:function _calcLayoutInfo(){this._calcCrossAxisMaxLayoutSize()}},{key:"getMainAxisMinSize",value:function getMainAxisMinSize(){for(var t=0,e=this.startIndex;e<=this.endIndex;e++)t+=this.items[e].flexItem._getMainAxisMinSizeWithPaddingAndMargin();return t}},{key:"numberOfItems",get:function get(){return this.endIndex-this.startIndex+1}},{key:"crossAxisLayoutSize",get:function get(){var t=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||t?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}},{key:"_calcCrossAxisMaxLayoutSize",value:function _calcCrossAxisMaxLayoutSize(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}},{key:"_getCrossAxisMaxLayoutSize",value:function _getCrossAxisMaxLayoutSize(){for(var t=0,e=this.startIndex;e<=this.endIndex;e++){var r=this.items[e];t=Math.max(t,r.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return t}}]),LineLayout}(),_=function(){function LineLayouter(t){_classCallCheck(this,LineLayouter),this._layout=t,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}return _createClass(LineLayouter,[{key:"lines",get:function get(){return this._lines}},{key:"mainAxisMinSize",get:function get(){return-1===this._mainAxisMinSize&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}},{key:"crossAxisMinSize",get:function get(){return-1===this._crossAxisMinSize&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}},{key:"mainAxisContentSize",get:function get(){return this._mainAxisContentSize}},{key:"layoutLines",value:function layoutLines(){this._setup();var t,e=this._layout.items,r=this._layout.isWrapping(),i=0,n=e.length;for(t=0;t<n;t++){var s=e[t];this._layoutFlexItem(s);var o=s.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();r&&t>i&&this._curMainAxisPos+o>this._mainAxisSize&&(this._layoutLine(i,t-1),this._curMainAxisPos=0,i=t),this._addToMainAxisPos(o)}i<t&&this._layoutLine(i,t-1)}},{key:"_layoutFlexItem",value:function _layoutFlexItem(t){t.isFlexEnabled()?t.flexLayout.updateTreeLayout():t.flexItem._resetLayoutSize()}},{key:"_setup",value:function _setup(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}},{key:"_addToMainAxisPos",value:function _addToMainAxisPos(t){this._curMainAxisPos+=t,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}},{key:"_layoutLine",value:function _layoutLine(t,e){var r=this._getAvailableMainAxisLayoutSpace(),i=new d(this._layout,t,e,r);i.performLayout(),this._lines.push(i),(0===this._mainAxisContentSize||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}},{key:"_getAvailableMainAxisLayoutSpace",value:function _getAvailableMainAxisLayoutSpace(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}},{key:"_getCrossAxisMinSize",value:function _getCrossAxisMinSize(){for(var t=0,e=this._layout.items,r=0,i=e.length;r<i;r++){var n=e[r].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();t=Math.max(t,n)}return t}},{key:"_getMainAxisMinSize",value:function _getMainAxisMinSize(){return 1===this._lines.length?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}]),LineLayouter}(),g=function(){function ItemCoordinatesUpdater(t){_classCallCheck(this,ItemCoordinatesUpdater),this._layout=t,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}return _createClass(ItemCoordinatesUpdater,[{key:"_flexContainer",get:function get(){return this._layout._flexContainer}},{key:"finalize",value:function finalize(){var t=this._layout.getParentFlexContainer();t?new ItemCoordinatesUpdater(t._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}},{key:"_finalizeRoot",value:function _finalizeRoot(){var t=this._flexContainer.item,e=o.getAxisLayoutPos(t,!0),r=o.getAxisLayoutPos(t,!1),i=o.getAxisLayoutSize(t,!0),n=o.getAxisLayoutSize(t,!1);i+=this._layout._getHorizontalPadding(),n+=this._layout._getVerticalPadding(),t.clearRecalcFlag(),t.setLayout(e,r,i,n)}},{key:"_finalizeItems",value:function _finalizeItems(){for(var t=this._layout.items,e=0,r=t.length;e<r;e++){var i=t[e],n=this._validateItemCache(i);this._finalizeItem(i),n||this._finalizeItemChildren(i)}}},{key:"_validateItemCache",value:function _validateItemCache(t){if(0===t.recalc&&t.isFlexEnabled()){var e=t._flex._layout;if(t.w===t.target.w&&t.h===t.target.h)return!0;var r=e.crossAxisSize;e.performResizeMainAxis(e.mainAxisSize),e.performResizeCrossAxis(r)}return!1}},{key:"_finalizeItemAndChildren",value:function _finalizeItemAndChildren(t){this._finalizeItem(t),this._finalizeItemChildren(t)}},{key:"_finalizeItem",value:function _finalizeItem(t){this._isReverse&&this._reverseMainAxisLayoutPos(t);var e=o.getAxisLayoutPos(t,!0),r=o.getAxisLayoutPos(t,!1),i=o.getAxisLayoutSize(t,!0),n=o.getAxisLayoutSize(t,!1);e+=this._horizontalPaddingOffset,r+=this._verticalPaddingOffset,t.flex&&(i+=t._flex._layout._getHorizontalPadding(),n+=t._flex._layout._getVerticalPadding());var s=t.flexItem;s&&(e+=s._getHorizontalMarginOffset(),r+=s._getVerticalMarginOffset()),t.clearRecalcFlag(),t.setLayout(e,r,i,n)}},{key:"_finalizeItemChildren",value:function _finalizeItemChildren(t){var e=t._flex;e&&new ItemCoordinatesUpdater(e._layout)._finalizeItems()}},{key:"_reverseMainAxisLayoutPos",value:function _reverseMainAxisLayoutPos(t){var e=t.flexItem._getMainAxisLayoutPos()+t.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),r=this._layout.mainAxisSize-e;t.flexItem._setMainAxisLayoutPos(r)}}]),ItemCoordinatesUpdater}(),p=function(){function FlexLayout(t){_classCallCheck(this,FlexLayout),this._flexContainer=t,this._lineLayouter=new _(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}return _createClass(FlexLayout,[{key:"shrunk",get:function get(){return this._shrunk}},{key:"recalc",get:function get(){return this.item.recalc}},{key:"layoutTree",value:function layoutTree(){null!==this.item.flexParent?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}},{key:"updateTreeLayout",value:function updateTreeLayout(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}},{key:"_performUpdateLayoutTree",value:function _performUpdateLayoutTree(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}},{key:"_refreshLayoutCache",value:function _refreshLayoutCache(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}},{key:"_performUpdateLayoutTreeFromCache",value:function _performUpdateLayoutTreeFromCache(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}},{key:"updateItemCoords",value:function updateItemCoords(){new g(this).finalize()}},{key:"_updateSubTreeLayout",value:function _updateSubTreeLayout(){var t=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(t)}},{key:"_setInitialAxisSizes",value:function _setInitialAxisSizes(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}},{key:"_layoutAxes",value:function _layoutAxes(){this._layoutMainAxis(),this._layoutCrossAxis()}},{key:"_layoutMainAxis",value:function _layoutMainAxis(){this._layoutLines(),this._fitMainAxisSizeToContents()}},{key:"_layoutLines",value:function _layoutLines(){this._lineLayouter.layoutLines()}},{key:"_lines",get:function get(){return this._lineLayouter.lines}},{key:"_fitMainAxisSizeToContents",value:function _fitMainAxisSizeToContents(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}},{key:"_layoutCrossAxis",value:function _layoutCrossAxis(){var t=new s(this);t.init(),this._totalCrossAxisSize=t.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),t.align()}},{key:"_fitCrossAxisSizeToContents",value:function _fitCrossAxisSizeToContents(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}},{key:"isWrapping",value:function isWrapping(){return this._flexContainer.wrap}},{key:"isAxisFitToContents",value:function isAxisFitToContents(t){return this._horizontal===t?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}},{key:"isMainAxisFitToContents",value:function isMainAxisFitToContents(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}},{key:"isCrossAxisFitToContents",value:function isCrossAxisFitToContents(){return!this._hasFixedCrossAxisBasis()}},{key:"_hasFixedMainAxisBasis",value:function _hasFixedMainAxisBasis(){return!o.isZeroAxisSize(this.item,this._horizontal)}},{key:"_hasFixedCrossAxisBasis",value:function _hasFixedCrossAxisBasis(){return!o.isZeroAxisSize(this.item,!this._horizontal)}},{key:"getAxisMinSize",value:function getAxisMinSize(t){return this._horizontal===t?this._getMainAxisMinSize():this._getCrossAxisMinSize()}},{key:"_getMainAxisMinSize",value:function _getMainAxisMinSize(){return this._lineLayouter.mainAxisMinSize}},{key:"_getCrossAxisMinSize",value:function _getCrossAxisMinSize(){return this._lineLayouter.crossAxisMinSize}},{key:"resizeMainAxis",value:function resizeMainAxis(t){this.mainAxisSize!==t&&(this.recalc>0?this.performResizeMainAxis(t):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=t,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(t)))}},{key:"_checkValidCacheMainAxisResize",value:function _checkValidCacheMainAxisResize(t){return t===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}},{key:"performResizeMainAxis",value:function performResizeMainAxis(t){var e=t<this.mainAxisSize;this._shrunk=e,this.mainAxisSize=t,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}},{key:"resizeCrossAxis",value:function resizeCrossAxis(t){this.crossAxisSize!==t&&(this.recalc>0?this.performResizeCrossAxis(t):this.crossAxisSize=t)}},{key:"performResizeCrossAxis",value:function performResizeCrossAxis(t){this.crossAxisSize=t,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}},{key:"targetMainAxisSize",get:function get(){return this._horizontal?this.item.target.w:this.item.target.h}},{key:"targetCrossAxisSize",get:function get(){return this._horizontal?this.item.target.h:this.item.target.w}},{key:"getParentFlexContainer",value:function getParentFlexContainer(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}},{key:"_getHorizontalPadding",value:function _getHorizontalPadding(){return o.getTotalPadding(this.item,!0)}},{key:"_getVerticalPadding",value:function _getVerticalPadding(){return o.getTotalPadding(this.item,!1)}},{key:"_getHorizontalPaddingOffset",value:function _getHorizontalPaddingOffset(){return o.getPaddingOffset(this.item,!0)}},{key:"_getVerticalPaddingOffset",value:function _getVerticalPaddingOffset(){return o.getPaddingOffset(this.item,!1)}},{key:"_getMainAxisBasis",value:function _getMainAxisBasis(){return o.getRelAxisSize(this.item,this._horizontal)}},{key:"_getCrossAxisBasis",value:function _getCrossAxisBasis(){return o.getRelAxisSize(this.item,!this._horizontal)}},{key:"_horizontal",get:function get(){return this._flexContainer._horizontal}},{key:"_reverse",get:function get(){return this._flexContainer._reverse}},{key:"item",get:function get(){return this._flexContainer.item}},{key:"items",get:function get(){return this.item.items}},{key:"resizingMainAxis",get:function get(){return this._resizingMainAxis}},{key:"resizingCrossAxis",get:function get(){return this._resizingCrossAxis}},{key:"numberOfItems",get:function get(){return this.items.length}},{key:"mainAxisSize",get:function get(){return o.getAxisLayoutSize(this.item,this._horizontal)},set:function set(t){o.setAxisLayoutSize(this.item,this._horizontal,t)}},{key:"crossAxisSize",get:function get(){return o.getAxisLayoutSize(this.item,!this._horizontal)},set:function set(t){o.setAxisLayoutSize(this.item,!this._horizontal,t)}}]),FlexLayout}(),v=function(){function FlexContainer(t){_classCallCheck(this,FlexContainer),this._item=t,this._layout=new p(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}return _createClass(FlexContainer,[{key:"item",get:function get(){return this._item}},{key:"_changedDimensions",value:function _changedDimensions(){this._item.changedDimensions()}},{key:"_changedContents",value:function _changedContents(){this._item.changedContents()}},{key:"direction",get:function get(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")},set:function set(t){this.direction!==t&&(this._horizontal="row"===t||"row-reverse"===t,this._reverse="row-reverse"===t||"column-reverse"===t,this._changedContents())}},{key:"wrap",get:function get(){return this._wrap},set:function set(t){this._wrap=t,this._changedContents()}},{key:"alignItems",get:function get(){return this._alignItems},set:function set(t){if(this._alignItems!==t){if(-1===FlexContainer.ALIGN_ITEMS.indexOf(t))throw new Error("Unknown alignItems, options: "+FlexContainer.ALIGN_ITEMS.join(","));this._alignItems=t,this._changedContents()}}},{key:"alignContent",get:function get(){return this._alignContent},set:function set(t){if(this._alignContent!==t){if(-1===FlexContainer.ALIGN_CONTENT.indexOf(t))throw new Error("Unknown alignContent, options: "+FlexContainer.ALIGN_CONTENT.join(","));this._alignContent=t,this._changedContents()}}},{key:"justifyContent",get:function get(){return this._justifyContent},set:function set(t){if(this._justifyContent!==t){if(-1===FlexContainer.JUSTIFY_CONTENT.indexOf(t))throw new Error("Unknown justifyContent, options: "+FlexContainer.JUSTIFY_CONTENT.join(","));this._justifyContent=t,this._changedContents()}}},{key:"padding",get:function get(){return this.paddingLeft},set:function set(t){this.paddingLeft=t,this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t}},{key:"paddingLeft",get:function get(){return this._paddingLeft},set:function set(t){this._paddingLeft=t,this._changedDimensions()}},{key:"paddingTop",get:function get(){return this._paddingTop},set:function set(t){this._paddingTop=t,this._changedDimensions()}},{key:"paddingRight",get:function get(){return this._paddingRight},set:function set(t){this._paddingRight=t,this._changedDimensions()}},{key:"paddingBottom",get:function get(){return this._paddingBottom},set:function set(t){this._paddingBottom=t,this._changedDimensions()}},{key:"patch",value:function patch(t){i.patchObject(this,t)}}]),FlexContainer}();v.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"],v.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"],v.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];var y=function(){function FlexItem(t){_classCallCheck(this,FlexItem),this._ctr=null,this._item=t,this._grow=0,this._shrink=FlexItem.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}return _createClass(FlexItem,[{key:"item",get:function get(){return this._item}},{key:"grow",get:function get(){return this._grow},set:function set(t){this._grow!==t&&(this._grow=parseInt(t)||0,this._changed())}},{key:"shrink",get:function get(){return this._shrink===FlexItem.SHRINK_AUTO?this._getDefaultShrink():this._shrink},set:function set(t){this._shrink!==t&&(this._shrink=parseInt(t)||0,this._changed())}},{key:"_getDefaultShrink",value:function _getDefaultShrink(){return this.item.isFlexEnabled()?1:0}},{key:"alignSelf",get:function get(){return this._alignSelf},set:function set(t){if(this._alignSelf!==t){if(void 0===t)this._alignSelf=void 0;else{if(-1===v.ALIGN_ITEMS.indexOf(t))throw new Error("Unknown alignSelf, options: "+v.ALIGN_ITEMS.join(","));this._alignSelf=t}this._changed()}}},{key:"minWidth",get:function get(){return this._minWidth},set:function set(t){this._minWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}},{key:"minHeight",get:function get(){return this._minHeight},set:function set(t){this._minHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}},{key:"maxWidth",get:function get(){return this._maxWidth},set:function set(t){this._maxWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}},{key:"maxHeight",get:function get(){return this._maxHeight},set:function set(t){this._maxHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}},{key:"margin",get:function get(){return this.marginLeft},set:function set(t){this.marginLeft=t,this.marginTop=t,this.marginRight=t,this.marginBottom=t}},{key:"marginLeft",get:function get(){return this._marginLeft},set:function set(t){this._marginLeft=t,this._changed()}},{key:"marginTop",get:function get(){return this._marginTop},set:function set(t){this._marginTop=t,this._changed()}},{key:"marginRight",get:function get(){return this._marginRight},set:function set(t){this._marginRight=t,this._changed()}},{key:"marginBottom",get:function get(){return this._marginBottom},set:function set(t){this._marginBottom=t,this._changed()}},{key:"_changed",value:function _changed(){this.ctr&&this.ctr._changedContents()}},{key:"ctr",get:function get(){return this._ctr},set:function set(t){this._ctr=t}},{key:"patch",value:function patch(t){i.patchObject(this,t)}},{key:"_resetLayoutSize",value:function _resetLayoutSize(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}},{key:"_resetCrossAxisLayoutSize",value:function _resetCrossAxisLayoutSize(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}},{key:"_resetHorizontalAxisLayoutSize",value:function _resetHorizontalAxisLayoutSize(){var t=o.getRelAxisSize(this.item,!0);this._minWidth&&(t=Math.max(this._minWidth,t)),this._maxWidth&&(t=Math.min(this._maxWidth,t)),o.setAxisLayoutSize(this.item,!0,t)}},{key:"_resetVerticalAxisLayoutSize",value:function _resetVerticalAxisLayoutSize(){var t=o.getRelAxisSize(this.item,!1);this._minHeight&&(t=Math.max(this._minHeight,t)),this._maxHeight&&(t=Math.min(this._maxHeight,t)),o.setAxisLayoutSize(this.item,!1,t)}},{key:"_getCrossAxisMinSizeSetting",value:function _getCrossAxisMinSizeSetting(){return this._getMinSizeSetting(!this.ctr._horizontal)}},{key:"_getCrossAxisMaxSizeSetting",value:function _getCrossAxisMaxSizeSetting(){return this._getMaxSizeSetting(!this.ctr._horizontal)}},{key:"_getMainAxisMaxSizeSetting",value:function _getMainAxisMaxSizeSetting(){return this._getMaxSizeSetting(this.ctr._horizontal)}},{key:"_getMinSizeSetting",value:function _getMinSizeSetting(t){return t?this._minWidth:this._minHeight}},{key:"_getMaxSizeSetting",value:function _getMaxSizeSetting(t){return t?this._maxWidth:this._maxHeight}},{key:"_getMainAxisMinSize",value:function _getMainAxisMinSize(){return o.getAxisMinSize(this.item,this.ctr._horizontal)}},{key:"_getCrossAxisMinSize",value:function _getCrossAxisMinSize(){return o.getAxisMinSize(this.item,!this.ctr._horizontal)}},{key:"_getMainAxisLayoutSize",value:function _getMainAxisLayoutSize(){return o.getAxisLayoutSize(this.item,this.ctr._horizontal)}},{key:"_getMainAxisLayoutPos",value:function _getMainAxisLayoutPos(){return o.getAxisLayoutPos(this.item,this.ctr._horizontal)}},{key:"_setMainAxisLayoutPos",value:function _setMainAxisLayoutPos(t){return o.setAxisLayoutPos(this.item,this.ctr._horizontal,t)}},{key:"_setCrossAxisLayoutPos",value:function _setCrossAxisLayoutPos(t){return o.setAxisLayoutPos(this.item,!this.ctr._horizontal,t)}},{key:"_getCrossAxisLayoutSize",value:function _getCrossAxisLayoutSize(){return o.getAxisLayoutSize(this.item,!this.ctr._horizontal)}},{key:"_resizeCrossAxis",value:function _resizeCrossAxis(t){return o.resizeAxis(this.item,!this.ctr._horizontal,t)}},{key:"_resizeMainAxis",value:function _resizeMainAxis(t){return o.resizeAxis(this.item,this.ctr._horizontal,t)}},{key:"_getMainAxisPadding",value:function _getMainAxisPadding(){return o.getTotalPadding(this.item,this.ctr._horizontal)}},{key:"_getCrossAxisPadding",value:function _getCrossAxisPadding(){return o.getTotalPadding(this.item,!this.ctr._horizontal)}},{key:"_getMainAxisMargin",value:function _getMainAxisMargin(){return o.getTotalMargin(this.item,this.ctr._horizontal)}},{key:"_getCrossAxisMargin",value:function _getCrossAxisMargin(){return o.getTotalMargin(this.item,!this.ctr._horizontal)}},{key:"_getHorizontalMarginOffset",value:function _getHorizontalMarginOffset(){return o.getMarginOffset(this.item,!0)}},{key:"_getVerticalMarginOffset",value:function _getVerticalMarginOffset(){return o.getMarginOffset(this.item,!1)}},{key:"_getMainAxisMinSizeWithPaddingAndMargin",value:function _getMainAxisMinSizeWithPaddingAndMargin(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}},{key:"_getCrossAxisMinSizeWithPaddingAndMargin",value:function _getCrossAxisMinSizeWithPaddingAndMargin(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}},{key:"_getMainAxisLayoutSizeWithPaddingAndMargin",value:function _getMainAxisLayoutSizeWithPaddingAndMargin(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}},{key:"_getCrossAxisLayoutSizeWithPaddingAndMargin",value:function _getCrossAxisLayoutSizeWithPaddingAndMargin(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}},{key:"_hasFixedCrossAxisSize",value:function _hasFixedCrossAxisSize(){return!o.isZeroAxisSize(this.item,!this.ctr._horizontal)}},{key:"_hasRelCrossAxisSize",value:function _hasRelCrossAxisSize(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}]),FlexItem}();y.SHRINK_AUTO=-1;var x=function(){function FlexTarget(t){_classCallCheck(this,FlexTarget),this._target=t,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}return _createClass(FlexTarget,[{key:"flexLayout",get:function get(){return this.flex?this.flex._layout:null}},{key:"layoutFlexTree",value:function layoutFlexTree(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}},{key:"target",get:function get(){return this._target}},{key:"flex",get:function get(){return this._flex},set:function set(t){t?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(t)):this.isFlexEnabled()&&this._disableFlex()}},{key:"flexItem",get:function get(){return!this._flexItemDisabled&&(this._ensureFlexItem(),this._flexItem)},set:function set(t){if(!1===t){if(!this._flexItemDisabled){var e=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),e&&(e._clearFlexItemsCache(),e.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(t),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();var r=this.flexParent;r&&(r._clearFlexItemsCache(),r.changedContents())}}},{key:"_enableFlex",value:function _enableFlex(){this._flex=new v(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}},{key:"_disableFlex",value:function _disableFlex(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}},{key:"_enableChildrenAsFlexItems",value:function _enableChildrenAsFlexItems(){var t=this._target._children;if(t)for(var e=0,r=t.length;e<r;e++)t[e].layout._enableFlexItem()}},{key:"_disableChildrenAsFlexItems",value:function _disableChildrenAsFlexItems(){var t=this._target._children;if(t)for(var e=0,r=t.length;e<r;e++)t[e].layout._disableFlexItem()}},{key:"_enableFlexItem",value:function _enableFlexItem(){this._ensureFlexItem();var t=this._target._parent._layout;this._flexItem.ctr=t._flex,t.changedContents(),this._checkEnabled()}},{key:"_disableFlexItem",value:function _disableFlexItem(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}},{key:"_resetOffsets",value:function _resetOffsets(){this.x=0,this.y=0}},{key:"_ensureFlexItem",value:function _ensureFlexItem(){this._flexItem||(this._flexItem=new y(this))}},{key:"_checkEnabled",value:function _checkEnabled(){var t=this.isEnabled();this._enabled!==t&&(t?this._enable():this._disable(),this._enabled=t)}},{key:"_enable",value:function _enable(){this._setupTargetForFlex(),this._target.enableFlexLayout()}},{key:"_disable",value:function _disable(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}},{key:"isEnabled",value:function isEnabled(){return this.isFlexEnabled()||this.isFlexItemEnabled()}},{key:"isFlexEnabled",value:function isFlexEnabled(){return null!==this._flex}},{key:"isFlexItemEnabled",value:function isFlexItemEnabled(){return null!==this.flexParent}},{key:"_restoreTargetToNonFlex",value:function _restoreTargetToNonFlex(){var t=this._target;t.x=this._originalX,t.y=this._originalY,t.setDimensions(this._originalWidth,this._originalHeight)}},{key:"_setupTargetForFlex",value:function _setupTargetForFlex(){var t=this._target;this._originalX=t._x,this._originalY=t._y,this._originalWidth=t._w,this._originalHeight=t._h}},{key:"setParent",value:function setParent(t,e){t&&t.isFlexContainer()&&t._layout._changedChildren(),e&&e.isFlexContainer()&&(this._enableFlexItem(),e._layout._changedChildren()),this._checkEnabled()}},{key:"flexParent",get:function get(){if(this._flexItemDisabled)return null;var t=this._target._parent;return t&&t.isFlexContainer()?t._layout:null}},{key:"setVisible",value:function setVisible(t){var e=this.flexParent;e&&e._changedChildren()}},{key:"items",get:function get(){return this._items||(this._items=this._getFlexItems()),this._items}},{key:"_getFlexItems",value:function _getFlexItems(){var t=[],e=this._target._children;if(e)for(var r=0,i=e.length;r<i;r++){var n=e[r];n.visible&&n.isFlexItem()&&t.push(n.layout)}return t}},{key:"_changedChildren",value:function _changedChildren(){this._clearFlexItemsCache(),this.changedContents()}},{key:"_clearFlexItemsCache",value:function _clearFlexItemsCache(){this._items=null}},{key:"setLayout",value:function setLayout(t,e,r,i){var n=this._originalX,s=this._originalY;this.funcX&&(n=this.funcX(o.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(s=this.funcY(o.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(t+n,e+s,r,i):this.target.setLayout(n,s,r,i)}},{key:"changedDimensions",value:function changedDimensions(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._updateRecalc(t,e)}},{key:"changedContents",value:function changedContents(){this._updateRecalc()}},{key:"forceLayout",value:function forceLayout(){this._updateRecalc()}},{key:"isChanged",value:function isChanged(){return this._recalc>0}},{key:"_updateRecalc",value:function _updateRecalc(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isFlexEnabled()){var r=this._flex._layout;t=t||r.isAxisFitToContents(!0),e=e||r.isAxisFitToContents(!1)}var i=1+(t?2:0)+(e?4:0),n=this.getNewRecalcFlags(i);this._recalc|=i,n>1&&this.flexParent?this.flexParent._updateRecalcBottomUp(i):this._target.triggerLayout()}},{key:"getNewRecalcFlags",value:function getNewRecalcFlags(t){return 7-this._recalc&t}},{key:"_updateRecalcBottomUp",value:function _updateRecalcBottomUp(t){var e=this._getRecalcFromChangedChildRecalc(t),r=this.getNewRecalcFlags(e);if(this._recalc|=e,r>1){var i=this.flexParent;i?i._updateRecalcBottomUp(e):this._target.triggerLayout()}else this._target.triggerLayout()}},{key:"_getRecalcFromChangedChildRecalc",value:function _getRecalcFromChangedChildRecalc(t){var e=this._flex._layout,r=e._horizontal?1:2,i=e._horizontal?2:1;t&i||t&r&&e.isWrapping()&&e.isCrossAxisFitToContents()&&(t+=i);var n=e.isAxisFitToContents(!0),s=e.isAxisFitToContents(!1);return e.shrunk&&(e._horizontal?n=!0:s=!0),t&1+(n?2:0)+(s?4:0)}},{key:"recalc",get:function get(){return this._recalc}},{key:"clearRecalcFlag",value:function clearRecalcFlag(){this._recalc=0}},{key:"enableLocalRecalcFlag",value:function enableLocalRecalcFlag(){this._recalc=1}},{key:"originalX",get:function get(){return this._originalX}},{key:"setOriginalXWithoutUpdatingLayout",value:function setOriginalXWithoutUpdatingLayout(t){this._originalX=t}},{key:"originalY",get:function get(){return this._originalY}},{key:"setOriginalYWithoutUpdatingLayout",value:function setOriginalYWithoutUpdatingLayout(t){this._originalY=t}},{key:"originalWidth",get:function get(){return this._originalWidth},set:function set(t){this._originalWidth!==t&&(this._originalWidth=t,this.changedDimensions(!0,!1))}},{key:"originalHeight",get:function get(){return this._originalHeight},set:function set(t){this._originalHeight!==t&&(this._originalHeight=t,this.changedDimensions(!1,!0))}},{key:"funcX",get:function get(){return this._target.funcX}},{key:"funcY",get:function get(){return this._target.funcY}},{key:"funcW",get:function get(){return this._target.funcW}},{key:"funcH",get:function get(){return this._target.funcH}}]),FlexTarget}(),m=function(){function TextureSource(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,TextureSource),this.id=TextureSource.id++,this.manager=t,this.stage=t.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=e,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null}return _createClass(TextureSource,[{key:"loadError",get:function get(){return this._loadError}},{key:"addTexture",value:function addTexture(t){this.textures.has(t)||this.textures.add(t)}},{key:"removeTexture",value:function removeTexture(t){this.textures.delete(t)}},{key:"incActiveTextureCount",value:function incActiveTextureCount(){this._activeTextureCount++,1===this._activeTextureCount&&this.becomesUsed()}},{key:"decActiveTextureCount",value:function decActiveTextureCount(){this._activeTextureCount--,0===this._activeTextureCount&&this.becomesUnused()}},{key:"isResultTexture",get:function get(){return this._isResultTexture},set:function set(t){this._isResultTexture=t}},{key:"forEachEnabledElement",value:function forEachEnabledElement(t){var e=this;this.textures.forEach(function(r){_newArrowCheck(this,e),r.elements.forEach(t)}.bind(this))}},{key:"hasEnabledElements",value:function hasEnabledElements(){return this.textures.size>0}},{key:"forEachActiveElement",value:function forEachActiveElement(t){var e=this;this.textures.forEach(function(r){var i=this;_newArrowCheck(this,e),r.elements.forEach(function(e){_newArrowCheck(this,i),e.active&&t(e)}.bind(this))}.bind(this))}},{key:"getRenderWidth",value:function getRenderWidth(){return this.w}},{key:"getRenderHeight",value:function getRenderHeight(){return this.h}},{key:"allowCleanup",value:function allowCleanup(){return!this.permanent&&!this.isUsed()}},{key:"becomesUsed",value:function becomesUsed(){this.load()}},{key:"becomesUnused",value:function becomesUnused(){this.cancel()}},{key:"cancel",value:function cancel(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}},{key:"isLoaded",value:function isLoaded(){return!!this._nativeTexture}},{key:"isLoading",value:function isLoading(){return this.loadingSince>0}},{key:"isError",value:function isError(){return!!this._loadError}},{key:"reload",value:function reload(){this.free(),this.isUsed()&&this.load()}},{key:"load",value:function load(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isResultTexture||this._nativeTexture||this.isLoading()||(this.loadingSince=(new Date).getTime(),this._cancelCb=this.loader(function(r,i){if(_newArrowCheck(this,t),this.isLoading()){if(this._cancelCb=null,this.manager.stage.destroyed)return;if(r)this.onError(r);else if(i&&i.source)if(this.stage.isUpdatingFrame()||e||!1===i.throttle)this.processLoadedSource(i);else{var n=this.stage.textureThrottler;this._cancelCb=n.genericCancelCb,n.add(this,i)}}}.bind(this),this))}},{key:"processLoadedSource",value:function processLoadedSource(t){this.loadingSince=0,this.setSource(t)}},{key:"setSource",value:function setSource(t){var e=t.source;this.w=e.width||t&&t.w||0,this.h=e.height||t&&t.h||0,t&&t.renderInfo&&(this.renderInfo=t.renderInfo),this.permanent=!!t.permanent,t&&t.imageRef&&(this._imageRef=t.imageRef),t&&t.flipTextureY?this._flipTextureY=t.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(e)?(this._nativeTexture=e,this.w=this.w||e.w,this.h=this.h||e.h,this.permanent=!t.hasOwnProperty("permanent")||t.permanent):this.manager.uploadTextureSource(this,t),this._loadError=null,this.onLoad()}},{key:"isUsed",value:function isUsed(){return this._activeTextureCount>0}},{key:"onLoad",value:function onLoad(){var t=this;this.isUsed()&&this.textures.forEach(function(e){_newArrowCheck(this,t),e.onLoad()}.bind(this))}},{key:"forceRenderUpdate",value:function forceRenderUpdate(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement((function(t){t.forceRenderUpdate()}))}},{key:"forceUpdateRenderCoords",value:function forceUpdateRenderCoords(){this.forEachActiveElement((function(t){t._updateTextureCoords()}))}},{key:"nativeTexture",get:function get(){return this._nativeTexture}},{key:"clearNativeTexture",value:function clearNativeTexture(){this._nativeTexture=null,this._imageRef=null}},{key:"replaceNativeTexture",value:function replaceNativeTexture(t,e,r){var i=this,n=this._nativeTexture;this._nativeTexture=t,this.w=e,this.h=r,!n&&this._nativeTexture&&this.forEachActiveElement(function(t){return _newArrowCheck(this,i),t.onTextureSourceLoaded()}.bind(this)),this._nativeTexture||this.forEachActiveElement(function(t){return _newArrowCheck(this,i),t._setDisplayedTexture(null)}.bind(this)),this.forEachEnabledElement(function(t){return _newArrowCheck(this,i),t._updateDimensions()}.bind(this))}},{key:"onError",value:function onError(t){var e=this;this._loadError=t,this.loadingSince=0,console.error("[Lightning] texture load error",t,this.lookupId),this.forEachActiveElement(function(r){return _newArrowCheck(this,e),r.onTextureSourceLoadError(t)}.bind(this))}},{key:"free",value:function free(){this.isLoaded()&&this.manager.freeTextureSource(this)}},{key:"_isNativeTexture",value:function _isNativeTexture(t){return r.isNode?"WebGLTexture"===t.constructor.name:"WebGLTexture"in window&&t instanceof WebGLTexture}}]),TextureSource}();m.prototype.isTextureSource=!0,m.id=1;var S=function(){function ElementTexturizer(t){_classCallCheck(this,ElementTexturizer),this._element=t.element,this._core=t,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}return _createClass(ElementTexturizer,[{key:"enabled",get:function get(){return this._enabled},set:function set(t){this._enabled=t,this._core.updateRenderToTextureEnabled()}},{key:"renderOffscreen",get:function get(){return this._renderOffscreen},set:function set(t){this._renderOffscreen=t,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}},{key:"colorize",get:function get(){return this._colorize},set:function set(t){this._colorize!==t&&(this._colorize=t,this._core.setHasRenderUpdates(1))}},{key:"_getTextureSource",value:function _getTextureSource(){return this._resultTextureSource||(this._resultTextureSource=new m(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}},{key:"hasResultTexture",value:function hasResultTexture(){return!!this._resultTextureSource}},{key:"resultTextureInUse",value:function resultTextureInUse(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}},{key:"updateResultTexture",value:function updateResultTexture(){var t=this,e=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==e){var r=e?e.w:0,i=e?e.h:0;this._resultTextureSource.replaceNativeTexture(e,r,i)}this._resultTextureSource.forEachEnabledElement(function(e){_newArrowCheck(this,t),e._updateDimensions(),e.core.setHasRenderUpdates(3)}.bind(this))}}},{key:"mustRenderToTexture",value:function mustRenderToTexture(){return!(!this._enabled||this.lazy)||!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}},{key:"deactivate",value:function deactivate(){this.release()}},{key:"renderTextureReused",get:function get(){return this._renderTextureReused}},{key:"release",value:function release(){this.releaseRenderTexture()}},{key:"releaseRenderTexture",value:function releaseRenderTexture(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}},{key:"reuseTextureAsRenderTexture",value:function reuseTextureAsRenderTexture(t){this._renderTexture!==t&&(this.releaseRenderTexture(),this._renderTexture=t,this._renderTextureReused=!0)}},{key:"hasRenderTexture",value:function hasRenderTexture(){return!!this._renderTexture}},{key:"getRenderTexture",value:function getRenderTexture(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}},{key:"getResultTexture",value:function getResultTexture(){return this._renderTexture}}]),ElementTexturizer}(),b=function(){function ElementCore(t){_classCallCheck(this,ElementCore),this._element=t,this.ctx=t.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new k,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}return _createClass(ElementCore,[{key:"offsetX",get:function get(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x},set:function set(t){r.isFunction(t)?this.funcX=t:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=t-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(t)):this.x=t)}},{key:"x",get:function get(){return this._x},set:function set(t){t!==this._x&&(this._updateLocalTranslateDelta(t-this._x,0),this._x=t)}},{key:"funcX",get:function get(){return 1&this._optFlags?this._funcX:null},set:function set(t){this._funcX!==t&&(this._optFlags|=1,this._funcX=t,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}},{key:"_disableFuncX",value:function _disableFuncX(){this._optFlags=65534&this._optFlags,this._funcX=null}},{key:"offsetY",get:function get(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y},set:function set(t){r.isFunction(t)?this.funcY=t:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=t-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(t)):this.y=t)}},{key:"y",get:function get(){return this._y},set:function set(t){t!==this._y&&(this._updateLocalTranslateDelta(0,t-this._y),this._y=t)}},{key:"funcY",get:function get(){return 2&this._optFlags?this._funcY:null},set:function set(t){this._funcY!==t&&(this._optFlags|=2,this._funcY=t,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}},{key:"_disableFuncY",value:function _disableFuncY(){this._optFlags=65533&this._optFlags,this._funcY=null}},{key:"funcW",get:function get(){return 4&this._optFlags?this._funcW:null},set:function set(t){this._funcW!==t&&(this._optFlags|=4,this._funcW=t,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}},{key:"disableFuncW",value:function disableFuncW(){this._optFlags=65531&this._optFlags,this._funcW=null}},{key:"funcH",get:function get(){return 8&this._optFlags?this._funcH:null},set:function set(t){this._funcH!==t&&(this._optFlags|=8,this._funcH=t,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}},{key:"disableFuncH",value:function disableFuncH(){this._optFlags=65527&this._optFlags,this._funcH=null}},{key:"w",get:function get(){return this._w}},{key:"getRenderWidth",value:function getRenderWidth(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}},{key:"h",get:function get(){return this._h}},{key:"getRenderHeight",value:function getRenderHeight(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}},{key:"scaleX",get:function get(){return this._scaleX},set:function set(t){this._scaleX!==t&&(this._scaleX=t,this._updateLocalTransform())}},{key:"scaleY",get:function get(){return this._scaleY},set:function set(t){this._scaleY!==t&&(this._scaleY=t,this._updateLocalTransform())}},{key:"scale",get:function get(){return this.scaleX},set:function set(t){this._scaleX===t&&this._scaleY===t||(this._scaleX=t,this._scaleY=t,this._updateLocalTransform())}},{key:"pivotX",get:function get(){return this._pivotX},set:function set(t){this._pivotX!==t&&(this._pivotX=t,this._updateLocalTranslate())}},{key:"pivotY",get:function get(){return this._pivotY},set:function set(t){this._pivotY!==t&&(this._pivotY=t,this._updateLocalTranslate())}},{key:"pivot",get:function get(){return this._pivotX},set:function set(t){this._pivotX===t&&this._pivotY===t||(this._pivotX=t,this._pivotY=t,this._updateLocalTranslate())}},{key:"mountX",get:function get(){return this._mountX},set:function set(t){this._mountX!==t&&(this._mountX=t,this._updateLocalTranslate())}},{key:"mountY",get:function get(){return this._mountY},set:function set(t){this._mountY!==t&&(this._mountY=t,this._updateLocalTranslate())}},{key:"mount",get:function get(){return this._mountX},set:function set(t){this._mountX===t&&this._mountY===t||(this._mountX=t,this._mountY=t,this._updateLocalTranslate())}},{key:"rotation",get:function get(){return this._rotation},set:function set(t){this._rotation!==t&&(this._rotation=t,this._updateLocalTransform())}},{key:"alpha",get:function get(){return this._alpha},set:function set(t){if(t=t>1?1:t<1e-14?0:t,this._alpha!==t){var e=this._alpha;this._alpha=t,this._updateLocalAlpha(),0===e!=(0===t)&&this._element._updateEnabledFlag()}}},{key:"visible",get:function get(){return this._visible},set:function set(t){this._visible!==t&&(this._visible=t,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(t))}},{key:"_updateLocalTransform",value:function _updateLocalTransform(){if(0!==this._rotation&&this._rotation%(2*Math.PI)){var t=Math.sin(this._rotation),e=Math.cos(this._rotation);this._setLocalTransform(e*this._scaleX,-t*this._scaleY,t*this._scaleX,e*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}},{key:"_updateLocalTranslate",value:function _updateLocalTranslate(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}},{key:"_recalcLocalTranslate",value:function _recalcLocalTranslate(){var t=this._pivotX*this._w,e=this._pivotY*this._h,r=this._x-(t*this._localTa+e*this._localTb)+t,i=this._y-(t*this._localTc+e*this._localTd)+e;r-=this._mountX*this._w,i-=this._mountY*this._h,this._localPx=r,this._localPy=i}},{key:"_updateLocalTranslateDelta",value:function _updateLocalTranslateDelta(t,e){this._addLocalTranslate(t,e)}},{key:"_updateLocalAlpha",value:function _updateLocalAlpha(){this._setLocalAlpha(this._visible?this._alpha:0)}},{key:"setHasRenderUpdates",value:function setHasRenderUpdates(t){if(this._worldContext.alpha){var e=this;for(e._hasRenderUpdates=Math.max(t,e._hasRenderUpdates);(e=e._parent)&&3!==e._hasRenderUpdates;)e._hasRenderUpdates=3}}},{key:"_setRecalc",value:function _setRecalc(t){this._recalc|=t,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}},{key:"_setHasUpdates",value:function _setHasUpdates(){for(var t=this;t&&!t._hasUpdates;)t._hasUpdates=!0,t=t._parent}},{key:"getParent",value:function getParent(){return this._parent}},{key:"setParent",value:function setParent(t){if(t!==this._parent){var e=this.isZContext(),r=this._parent;if(this._parent=t,(this._layout||t&&t.isFlexContainer())&&this.layout.setParent(r,t),r&&r.setHasRenderUpdates(3),this._setRecalc(7),this._parent&&this._parent._setHasUpdates(),0===this._zIndex?this.setZParent(t):this.setZParent(t?t.findZContext():null),e!==this.isZContext()&&(this.isZContext()?this.enableZContext(r.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){var i=t&&!t._renderToTextureEnabled?t._shaderOwner:null;i!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(i))}}}},{key:"enableZSort",value:function enableZSort(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,t&&this.ctx.forceZSort(this))}},{key:"addChildAt",value:function addChildAt(t,e){this._children||(this._children=[]),this._children.splice(t,0,e),e.setParent(this)}},{key:"setChildAt",value:function setChildAt(t,e){this._children||(this._children=[]),this._children[t].setParent(null),this._children[t]=e,e.setParent(this)}},{key:"removeChildAt",value:function removeChildAt(t){var e=this._children[t];this._children.splice(t,1),e.setParent(null)}},{key:"removeChildren",value:function removeChildren(){if(this._children){for(var t=0,e=this._children.length;t<e;t++)this._children[t].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}},{key:"syncChildren",value:function syncChildren(t,e,r){this._children=r;for(var i=0,n=t.length;i<n;i++)t[i].setParent(null);for(var s=0,o=e.length;s<o;s++)e[s].setParent(this)}},{key:"moveChild",value:function moveChild(t,e){var r=this._children[t];this._children.splice(t,1),this._children.splice(e,0,r),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}},{key:"_setLocalTransform",value:function _setLocalTransform(t,e,r,i){this._setRecalc(4),this._localTa=t,this._localTb=e,this._localTc=r,this._localTd=i,this._isComplex=0!==e||0!==r||t<0||i<0}},{key:"_addLocalTranslate",value:function _addLocalTranslate(t,e){this._localPx+=t,this._localPy+=e,this._triggerRecalcTranslate()}},{key:"_setLocalAlpha",value:function _setLocalAlpha(t){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&t?this._setRecalc(129):this._setRecalc(1),t<1e-14&&(t=0),this._localAlpha=t}},{key:"setDimensions",value:function setDimensions(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dimsUnknown;if(this._dimsUnknown=r,this.hasFlexLayout())this._layout.originalWidth=t,this._layout.originalHeight=e;else if(this._w!==t||this._h!==e)return this._updateDimensions(t,e),!0;return!1}},{key:"_updateDimensions",value:function _updateDimensions(t,e){this._w===t&&this._h===e||(this._w=t,this._h=e,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}},{key:"setTextureCoords",value:function setTextureCoords(t,e,r,i){this.setHasRenderUpdates(3),this._ulx=t,this._uly=e,this._brx=r,this._bry=i}},{key:"displayedTextureSource",get:function get(){return this._displayedTextureSource}},{key:"setDisplayedTextureSource",value:function setDisplayedTextureSource(t){this.setHasRenderUpdates(3),this._displayedTextureSource=t}},{key:"isRoot",get:function get(){return this._isRoot}},{key:"setAsRoot",value:function setAsRoot(){this._parent=new ElementCore(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(7)}},{key:"isAncestorOf",value:function isAncestorOf(t){for(var e=t;e=e._parent;)if(this===e)return!0;return!1}},{key:"isZContext",value:function isZContext(){return this._forceZIndexContext||this._renderToTextureEnabled||0!==this._zIndex||this._isRoot||!this._parent}},{key:"findZContext",value:function findZContext(){return this.isZContext()?this:this._parent.findZContext()}},{key:"setZParent",value:function setZParent(t){if(this._zParent!==t){if(null!==this._zParent&&(0!==this._zIndex&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),null!==t){var e=t._zContextUsage>0;0!==this._zIndex&&t.incZContextUsage(),t._zContextUsage>0&&((e||this._parent!==t)&&t._zIndexedChildren.push(this),t.enableZSort())}this._zParent=t,this._zIndexResort=!0}}},{key:"incZContextUsage",value:function incZContextUsage(){if(this._zContextUsage++,1===this._zContextUsage&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(var t=0,e=this._children.length;t<e;t++)this._zIndexedChildren.push(this._children[t]);this._zSort=!1}}},{key:"decZContextUsage",value:function decZContextUsage(){this._zContextUsage--,0===this._zContextUsage&&(this._zSort=!1,this._zIndexedChildren.splice(0))}},{key:"zIndex",get:function get(){return this._zIndex},set:function set(t){if(this._zIndex!==t){this.setHasRenderUpdates(1);var e=this._zParent,r=this.isZContext();0===t&&0!==this._zIndex?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():e=this._parent:0!==t&&0===this._zIndex?(e=this._parent?this._parent.findZContext():null)===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort()):t!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),e!==this._zParent&&this.setZParent(null),this._zIndex=t,e!==this._zParent&&this.setZParent(e),r!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}},{key:"forceZIndexContext",get:function get(){return this._forceZIndexContext},set:function set(t){this.setHasRenderUpdates(1);var e=this.isZContext();this._forceZIndexContext=t,e!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}},{key:"enableZContext",value:function enableZContext(t){var e=this;t&&t._zContextUsage>0&&this._getZIndexedDescs().forEach(function(t){_newArrowCheck(this,e),this.isAncestorOf(t)&&0!==t._zIndex&&t.setZParent(this)}.bind(this))}},{key:"_getZIndexedDescs",value:function _getZIndexedDescs(){var t=[];if(this._children)for(var e=0,r=this._children.length;e<r;e++)this._children[e]._getZIndexedDescsRec(t);return t}},{key:"_getZIndexedDescsRec",value:function _getZIndexedDescsRec(t){if(this._zIndex)t.push(this);else if(this._children&&!this.isZContext())for(var e=0,r=this._children.length;e<r;e++)this._children[e]._getZIndexedDescsRec(t)}},{key:"disableZContext",value:function disableZContext(){if(this._zContextUsage>0){var t=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach((function(e){0!==e._zIndex&&e.setZParent(t)}))}}},{key:"colorUl",get:function get(){return this._colorUl},set:function set(t){this._colorUl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=t)}},{key:"colorUr",get:function get(){return this._colorUr},set:function set(t){this._colorUr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=t)}},{key:"colorBl",get:function get(){return this._colorBl},set:function set(t){this._colorBl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=t)}},{key:"colorBr",get:function get(){return this._colorBr},set:function set(t){this._colorBr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=t)}},{key:"onUpdate",set:function set(t){this._onUpdate=t,this._setRecalc(7)}},{key:"onAfterUpdate",set:function set(t){this._onAfterUpdate=t,this._setRecalc(7)}},{key:"onAfterCalcs",set:function set(t){this._onAfterCalcs=t,this._setRecalc(7)}},{key:"shader",get:function get(){return this._shader},set:function set(t){this.setHasRenderUpdates(1);var e=this._shader;if(this._shader=t,!t&&e){var r=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(r)}else t&&this._setShaderOwnerRecursive(this)}},{key:"activeShader",get:function get(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}},{key:"activeShaderOwner",get:function get(){return this._shaderOwner}},{key:"clipping",get:function get(){return this._clipping},set:function set(t){this._clipping!==t&&(this._clipping=t,this._setRecalc(3))}},{key:"clipbox",get:function get(){return this._clipbox},set:function set(t){this._clipbox=t}},{key:"_setShaderOwnerRecursive",value:function _setShaderOwnerRecursive(t){if(this._shaderOwner=t,this._children&&!this._renderToTextureEnabled)for(var e=0,r=this._children.length;e<r;e++){var i=this._children[e];i._shader||(i._setShaderOwnerRecursive(t),i._hasRenderUpdates=3)}}},{key:"_setShaderOwnerChildrenRecursive",value:function _setShaderOwnerChildrenRecursive(t){if(this._children)for(var e=0,r=this._children.length;e<r;e++){var i=this._children[e];i._shader||(i._setShaderOwnerRecursive(t),i._hasRenderUpdates=3)}}},{key:"_hasRenderContext",value:function _hasRenderContext(){return this._renderContext!==this._worldContext}},{key:"renderContext",get:function get(){return this._renderContext}},{key:"updateRenderToTextureEnabled",value:function updateRenderToTextureEnabled(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}},{key:"_enableRenderToTexture",value:function _enableRenderToTexture(){if(!this._renderToTextureEnabled){var t=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new k,this._setShaderOwnerChildrenRecursive(null),t||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}},{key:"_disableRenderToTexture",value:function _disableRenderToTexture(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}},{key:"isWhite",value:function isWhite(){return 4294967295===this._colorUl&&4294967295===this._colorUr&&4294967295===this._colorBl&&4294967295===this._colorBr}},{key:"hasSimpleTexCoords",value:function hasSimpleTexCoords(){return 0===this._ulx&&0===this._uly&&1===this._brx&&1===this._bry}},{key:"_stashTexCoords",value:function _stashTexCoords(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}},{key:"_unstashTexCoords",value:function _unstashTexCoords(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}},{key:"_stashColors",value:function _stashColors(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}},{key:"_unstashColors",value:function _unstashColors(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}},{key:"isVisible",value:function isVisible(){return this._localAlpha>1e-14}},{key:"outOfBounds",get:function get(){return this._outOfBounds}},{key:"boundsMargin",get:function get(){return this._boundsMargin},set:function set(t){this._boundsMargin=t?t.slice():null,this._triggerRecalcTranslate()}},{key:"update",value:function update(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?256&this._recalc&&this._layout.layoutFlexTree():2&this._recalc&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));var t=this._parent._worldContext,e=this._worldContext,r=t.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&r||e.alpha&&!r){var i=this._recalc;1&i&&(!e.alpha&&r&&(this._hasRenderUpdates=3),e.alpha=t.alpha*this._localAlpha,e.alpha<1e-14&&(e.alpha=0)),6&i&&(e.px=t.px+this._localPx*t.ta,e.py=t.py+this._localPy*t.td,0!==t.tb&&(e.px+=this._localPy*t.tb),0!==t.tc&&(e.py+=this._localPx*t.tc)),4&i&&(e.ta=this._localTa*t.ta,e.tb=this._localTd*t.tb,e.tc=this._localTa*t.tc,e.td=this._localTd*t.td,this._isComplex&&(e.ta+=this._localTc*t.tb,e.tb+=this._localTb*t.ta,e.tc+=this._localTc*t.td,e.td+=this._localTb*t.tc));var n=this._parent._renderContext;if(this._parent._hasRenderContext()){var s=this._renderContext===this._worldContext;s&&(this._renderContext=new k);var o=this._renderContext;(s||1&i)&&(o.alpha=n.alpha*this._localAlpha,o.alpha<1e-14&&(o.alpha=0)),(s||6&i)&&(o.px=n.px+this._localPx*n.ta,o.py=n.py+this._localPy*n.td,0!==n.tb&&(o.px+=this._localPy*n.tb),0!==n.tc&&(o.py+=this._localPx*n.tc)),s&&(i|=2),(s||4&i)&&(o.ta=this._localTa*n.ta,o.tb=this._localTd*n.tb,o.tc=this._localTa*n.tc,o.td=this._localTd*n.td,this._isComplex&&(o.ta+=this._localTc*n.tb,o.tb+=this._localTb*n.ta,o.tc+=this._localTc*n.td,o.td+=this._localTb*n.tc))}else this._renderContext=this._worldContext;-1===this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;var u=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==u&&(this._recalc|=6,i|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=u;var h,l,f,d,_=this._renderContext,g=this._dimsUnknown?2048:this._w,p=this._dimsUnknown?2048:this._h,v=0!==_.tb||0!==_.tc||_.ta<0||_.td<0;if(v?(h=Math.min(0,g*_.ta,g*_.ta+p*_.tb,p*_.tb)+_.px,f=Math.max(0,g*_.ta,g*_.ta+p*_.tb,p*_.tb)+_.px,l=Math.min(0,g*_.tc,g*_.tc+p*_.td,p*_.td)+_.py,d=Math.max(0,g*_.tc,g*_.tc+p*_.td,p*_.td)+_.py):(h=_.px,f=_.px+_.ta*g,l=_.py,d=_.py+_.td*p),this._dimsUnknown&&(v||this._localTa<1||this._localTb<1)){var y=this._x*n.ta+this._y*n.tb+n.px,x=this._x*n.tc+this._y*n.td+n.py;y<h&&(h=y),x<l&&(l=x),y>f&&(f=y),x>d&&(d=x)}if(6&i||!this._scissor)if(this._clipping&&_.isSquare()){var m=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(m){var S=Math.max(m[0],h),b=Math.max(m[1],l);this._scissor=[S,b,Math.min(m[2]+m[0],f)-S,Math.min(m[3]+m[1],d)-b]}else this._scissor=[h,l,f-h,d-l]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(v?(h=Math.min(0,g*_.ta,g*_.ta+p*_.tb,p*_.tb)+_.px,f=Math.max(0,g*_.ta,g*_.ta+p*_.tb,p*_.tb)+_.px,l=Math.min(0,g*_.tc,g*_.tc+p*_.td,p*_.td)+_.py,d=Math.max(0,g*_.tc,g*_.tc+p*_.td,p*_.td)+_.py):(h=_.px,f=_.px+_.ta*g,l=_.py,d=_.py+_.td*p),this._dimsUnknown&&(v||this._localTa<1||this._localTb<1))){var T=this._x*n.ta+this._y*n.tb+n.px,C=this._x*n.tc+this._y*n.td+n.py;T<h&&(h=T),C<l&&(l=C),T>f&&(f=T),C>d&&(d=C)}if(2===this._parent._outOfBounds)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(6&i){this._outOfBounds=0;var w=!0;if(this._renderToTextureEnabled&&this._texturizer&&this._texturizer.renderOffscreen||(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>f||this._scissor[1]>d||h>this._scissor[0]+this._scissor[2]||l>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&g&&p)&&(this._outOfBounds=2)),(w=0===this._outOfBounds)||(w=this._recBoundsMargin?!(f<this._scissor[0]-this._recBoundsMargin[2]||d<this._scissor[1]-this._recBoundsMargin[3]||h>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||l>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):!(f<this._scissor[0]-100||d<this._scissor[1]-100||h>this._scissor[0]+this._scissor[2]+100||l>this._scissor[1]+this._scissor[3]+100))&&2===this._outOfBounds&&(this._outOfBounds=1)),this._withinBoundsMargin!==w)if(this._withinBoundsMargin=w,this._withinBoundsMargin){this._hasUpdates=!0;var A=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=A}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=g,this._viewport[3]=p):this._viewport=[0,0,g,p]),this._pRecalc=135&this._recalc,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=k.IDENTITY),this._children)for(var R=0,E=this._children.length;R<E;R++)this._children[R].update();this._useRenderToTexture&&(this._renderContext=_)}else if(this._children)for(var L=0,I=this._children.length;L<I;L++)this._children[L]._hasUpdates?this._children[L].update():(this._children[L]._recalc|=this._pRecalc,this._children[L].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else-1===this.ctx.updateTreeOrder||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}},{key:"_applyRelativeDimFuncs",value:function _applyRelativeDimFuncs(){if(1&this._optFlags){var t=this._funcX(this._parent.w);t!==this._x&&(this._localPx+=t-this._x,this._x=t)}if(2&this._optFlags){var e=this._funcY(this._parent.h);e!==this._y&&(this._localPy+=e-this._y,this._y=e)}var r=!1;if(4&this._optFlags){var i=this._funcW(this._parent.w);i!==this._w&&(this._w=i,r=!0)}if(8&this._optFlags){var n=this._funcH(this._parent.h);n!==this._h&&(this._h=n,r=!0)}r&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}},{key:"updateOutOfBounds",value:function updateOutOfBounds(){if(2!==this._outOfBounds&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(var t=0,e=this._children.length;t<e;t++)this._children[t].updateOutOfBounds()}},{key:"updateTreeOrder",value:function updateTreeOrder(){if(this._localAlpha&&2!==this._outOfBounds&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(var t=0,e=this._children.length;t<e;t++)this._children[t].updateTreeOrder()}},{key:"_renderSimple",value:function _renderSimple(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){var t=this.renderState;if(0===this._outOfBounds&&this._displayedTextureSource&&(t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(var e=0,r=this._zIndexedChildren.length;e<r;e++)this._zIndexedChildren[e].render();else for(var i=0,n=this._children.length;i<n;i++)0===this._children[i]._zIndex&&this._children[i].render()}}},{key:"_renderAdvanced",value:function _renderAdvanced(){var t=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){var e,r,i=this.renderState,n=!0;if(this._useRenderToTexture){if(0===this._w||0===this._h)return;if(!this._texturizer.hasRenderTexture()||t>=3){if(i.setShader(i.defaultShader,this),r=i.renderTextureInfo,e={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!i.isCachingTexturizer&&t<3)&&(e.cache=!0,i.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),i.setRenderTextureInfo(e),i.setScissor(null),this._displayedTextureSource){var s=this._renderContext;this._renderContext=k.IDENTITY,this.renderState.addQuad(this),this._renderContext=s}}else n=!1}else 0===this._outOfBounds&&this._displayedTextureSource&&(i.setShader(this.activeShader,this._shaderOwner),i.setScissor(this._scissor),this.renderState.addQuad(this));if(n&&this._children)if(this._zContextUsage)for(var o=0,u=this._zIndexedChildren.length;o<u;o++)this._zIndexedChildren[o].render();else for(var h=0,l=this._children.length;h<l;h++)0===this._children[h]._zIndex&&this._children[h].render();if(this._useRenderToTexture){var f=!1;if(n&&(i.finishedRenderTexture(),this._texturizer.empty=e.empty,e.empty?this._texturizer.releaseRenderTexture():e.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(e.nativeTexture),e.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),e.nativeTexture=this._texturizer.getRenderTexture()),i.setRenderTextureInfo(r),f=!0),!this._texturizer.empty){var d=this._texturizer.getResultTexture();if(f&&(d&&(d.update=i.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){i.setShader(this.activeShader,this._shaderOwner),i.setScissor(this._scissor);var _=!e||e.cache;i.setTexturizer(this._texturizer,_),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),i.setTexturizer(null)}}}e&&e.cache&&(i.isCachingTexturizer=!1)}}},{key:"zSort",get:function get(){return this._zSort}},{key:"sortZIndexedChildren",value:function sortZIndexedChildren(){for(var t=this._zIndexedChildren.length,e=0,r=this._zIndexedChildren,i=[],n=0;n<t;n++)r[n]._zParent===this&&(r[n]._zIndexResort?i.push(r[n]):(e!==n&&(r[e]=r[n]),e++));var s=i.length;if(s){for(var o=0;o<s;o++)i[o]._zIndexResort=!1;i.sort(ElementCore.sortZIndexedChildren);var u=e;if(u){e=0;for(var h=0,l=0,f=[];;){var d=(r[h]._zIndex===i[l]._zIndex?r[h]._updateTreeOrder-i[l]._updateTreeOrder:r[h]._zIndex-i[l]._zIndex)>0?i[l++]:r[h++];if(0!==e&&f[e-1]===d||(f[e++]=d),h>=u){do{var _=i[l++];0!==e&&f[e-1]===_||(f[e++]=_)}while(l<s);break}if(l>=s){do{var g=r[h++];0!==e&&f[e-1]===g||(f[e++]=g)}while(h<u);break}}this._zIndexedChildren=f}else{e=0;var p=0;do{r[e++]=i[p++]}while(p<s);r.length>e&&r.splice(e)}}else r.length>e&&r.splice(e);this._zSort=!1}},{key:"localTa",get:function get(){return this._localTa}},{key:"localTb",get:function get(){return this._localTb}},{key:"localTc",get:function get(){return this._localTc}},{key:"localTd",get:function get(){return this._localTd}},{key:"element",get:function get(){return this._element}},{key:"renderUpdates",get:function get(){return this._hasRenderUpdates}},{key:"texturizer",get:function get(){return this._texturizer||(this._texturizer=new S(this)),this._texturizer}},{key:"getCornerPoints",value:function getCornerPoints(){var t=this._worldContext;return[t.px,t.py,t.px+this._w*t.ta,t.py+this._w*t.tc,t.px+this._w*t.ta+this._h*t.tb,t.py+this._w*t.tc+this._h*t.td,t.px+this._h*t.tb,t.py+this._h*t.td]}},{key:"getRenderTextureCoords",value:function getRenderTextureCoords(t,e){var r=this._renderContext;return[r.px+r.ta*t+r.tb*e,r.py+r.tc*t+r.td*e]}},{key:"getAbsoluteCoords",value:function getAbsoluteCoords(t,e){var r=this._renderContext;return[r.px+r.ta*t+r.tb*e,r.py+r.tc*t+r.td*e]}},{key:"collectAtCoord",value:function collectAtCoord(t,e,r){if(0!==this._renderContext.alpha){if(this.inBound(t,e)&&(this._scissor?this.inScissor()&&r.push(this):r.push(this)),this._children)for(var i=this._children.length,n=0;n<i;n++)this._children[n].collectAtCoord(t,e,r);return r.sort(ElementCore.sortZIndexedChildren)}}},{key:"inBound",value:function inBound(t,e){var r=this.getCornerPoints();return t>r[0]&&t<r[2]&&e>r[1]&&e<r[7]}},{key:"inScissor",value:function inScissor(){var t=this._scissor,e=this.getCornerPoints();return e[2]>=t[0]&&e[0]<=t[0]+t[2]&&e[7]>=t[1]&&e[1]<=t[1]+t[3]}},{key:"layout",get:function get(){return this._ensureLayout(),this._layout}},{key:"flex",get:function get(){return this._layout?this._layout.flex:null},set:function set(t){this.layout.flex=t}},{key:"flexItem",get:function get(){return this._layout?this._layout.flexItem:null},set:function set(t){this.layout.flexItem=t}},{key:"isFlexItem",value:function isFlexItem(){return!!this._layout&&this._layout.isFlexItemEnabled()}},{key:"isFlexContainer",value:function isFlexContainer(){return!!this._layout&&this._layout.isFlexEnabled()}},{key:"enableFlexLayout",value:function enableFlexLayout(){this._ensureLayout()}},{key:"_ensureLayout",value:function _ensureLayout(){this._layout||(this._layout=new x(this))}},{key:"disableFlexLayout",value:function disableFlexLayout(){this._triggerRecalcTranslate()}},{key:"hasFlexLayout",value:function hasFlexLayout(){return this._layout&&this._layout.isEnabled()}},{key:"setLayout",value:function setLayout(t,e,r,i){this.x=t,this.y=e,this._updateDimensions(r,i)}},{key:"triggerLayout",value:function triggerLayout(){this._setRecalc(256)}},{key:"_triggerRecalcTranslate",value:function _triggerRecalcTranslate(){this._setRecalc(2)}}]),ElementCore}(),k=function(){function ElementCoreContext(){_classCallCheck(this,ElementCoreContext),this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}return _createClass(ElementCoreContext,[{key:"isIdentity",value:function isIdentity(){return 1===this.alpha&&0===this.px&&0===this.py&&1===this.ta&&0===this.tb&&0===this.tc&&1===this.td}},{key:"isSquare",value:function isSquare(){return 0===this.tb&&0===this.tc}}]),ElementCoreContext}();k.IDENTITY=new k,b.sortZIndexedChildren=function(t,e){return t._zIndex===e._zIndex?t._updateTreeOrder-e._updateTreeOrder:t._zIndex-e._zIndex};var T=function(){function EventEmitter(){_classCallCheck(this,EventEmitter),this._hasEventListeners=!1}return _createClass(EventEmitter,[{key:"on",value:function on(t,e){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[t]?this._eventFunction[t]!==EventEmitter.combiner?(this._eventListeners[t]=[this._eventFunction[t],e],this._eventFunction[t]=EventEmitter.combiner):this._eventListeners[t].push(e):this._eventFunction[t]=e}},{key:"once",value:function once(t,e){var r=this,i=function wrapper(n,s,o){_newArrowCheck(this,r),e(n,s,o),this.off(t,i)}.bind(this);i.__originalFunc=e,this.on(t,i)}},{key:"has",value:function has(t,e){if(this._hasEventListeners){var r=this._eventFunction[t];if(r)if(r===EventEmitter.combiner){var i,n=_createForOfIteratorHelper(this._eventListeners[t]);try{for(n.s();!(i=n.n()).done;){var s=i.value;if(s===e||s.__originalFunc==e)return!0}}catch(t){n.e(t)}finally{n.f()}}else if(this._eventFunction[t]===e||this._eventFunction[t].__originalFunc===e)return!0}return!1}},{key:"off",value:function off(t,e){var r=this;if(this._hasEventListeners){var i=this._eventFunction[t];if(i)if(i===EventEmitter.combiner){var n=this._eventListeners[t],s=n.indexOf(e);s>=0&&n.splice(s,1),(s=n.map(function(t){return _newArrowCheck(this,r),t.__originalFunc}.bind(this)).indexOf(e))>=0&&n.splice(s,1),1===n.length&&(this._eventFunction[t]=n[0],this._eventListeners[t]=void 0)}else this._eventFunction[t]!==e&&this._eventFunction[t].__originalFunc!==e||(this._eventFunction[t]=void 0)}}},{key:"removeListener",value:function removeListener(t,e){this.off(t,e)}},{key:"emit",value:function emit(t,e,r,i){if(this._hasEventListeners){var n=this._eventFunction[t];n&&(n===EventEmitter.combiner?n(this,t,e,r,i):n(e,r,i))}}},{key:"listenerCount",value:function listenerCount(t){if(this._hasEventListeners){var e=this._eventFunction[t];if(e)return e===EventEmitter.combiner?this._eventListeners[t].length:1}return 0}},{key:"removeAllListeners",value:function removeAllListeners(t){this._hasEventListeners&&(delete this._eventFunction[t],delete this._eventListeners[t])}}]),EventEmitter}();T.combiner=function(t,e,r,i,n){var s=t._eventListeners[e];if(s)for(var o=0,u=_toConsumableArray(s);o<u.length;o++)(0,u[o])(r,i,n)},T.addAsMixin=function(t){t.prototype.on=T.prototype.on,t.prototype.once=T.prototype.once,t.prototype.has=T.prototype.has,t.prototype.off=T.prototype.off,t.prototype.removeListener=T.prototype.removeListener,t.prototype.emit=T.prototype.emit,t.prototype.listenerCount=T.prototype.listenerCount,t.prototype.removeAllListeners=T.prototype.removeAllListeners};var C=function(){function Shader(t){_classCallCheck(this,Shader),this._initialized=!1,this.ctx=t,this._elements=new Set}return _createClass(Shader,[{key:"addElement",value:function addElement(t){this._elements.add(t)}},{key:"removeElement",value:function removeElement(t){this._elements.delete(t),this._elements||this.cleanup()}},{key:"redraw",value:function redraw(){var t=this;this._elements.forEach(function(e){_newArrowCheck(this,t),e.setHasRenderUpdates(2)}.bind(this))}},{key:"patch",value:function patch(t){i.patchObject(this,t)}},{key:"useDefault",value:function useDefault(){return!1}},{key:"addEmpty",value:function addEmpty(){return!1}},{key:"cleanup",value:function cleanup(){}},{key:"isShader",get:function get(){return!0}}],[{key:"create",value:function create(t,e){var n;if(r.isObjectLiteral(e))(n=e.type?t.renderer.createShader(t.ctx,e):this.shader)&&i.patchObject(n,e);else if(null===e)n=t.ctx.renderState.defaultShader;else if(void 0===e)n=null;else{if(!e.isShader)return void console.error("[Lightning] Please specify a shader type.");t.renderer.isValidShaderType(e.constructor)||(console.error("[Lightning] Invalid shader type"),e=null),n=e}return n}},{key:"getWebGL",value:function getWebGL(){}},{key:"getC2d",value:function getC2d(){}}]),Shader}(),w=function(){function Texture(t){_classCallCheck(this,Texture),this.stage=t,this.manager=this.stage.textureManager,this.id=Texture.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}return _createClass(Texture,[{key:"source",get:function get(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}},{key:"addElement",value:function addElement(t){this.elements.has(t)||(this.elements.add(t),1===this.elements.size&&this._source&&this._source.addTexture(this),t.active&&this.incActiveCount())}},{key:"removeElement",value:function removeElement(t){this.elements.delete(t)&&(0===this.elements.size&&this._source&&this._source.removeTexture(this),t.active&&this.decActiveCount())}},{key:"incActiveCount",value:function incActiveCount(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,1===this._activeCount&&this.becomesUsed()}},{key:"decActiveCount",value:function decActiveCount(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}},{key:"becomesUsed",value:function becomesUsed(){this.source&&this.source.incActiveTextureCount()}},{key:"onLoad",value:function onLoad(){var t=this;this._resizeMode&&this._applyResizeMode(),this.elements.forEach(function(e){_newArrowCheck(this,t),e.active&&e.onTextureSourceLoaded()}.bind(this))}},{key:"_checkForNewerReusableTextureSource",value:function _checkForNewerReusableTextureSource(){var t=this.source;if(t.isLoaded())this._resizeMode&&this._applyResizeMode();else{var e=this._getReusableTextureSource();e&&e.isLoaded()&&e!==t&&this._replaceTextureSource(e)}}},{key:"becomesUnused",value:function becomesUnused(){this.source&&this.source.decActiveTextureCount()}},{key:"isUsed",value:function isUsed(){return this._activeCount>0}},{key:"_getLookupId",value:function _getLookupId(){return null}},{key:"_getSourceLoader",value:function _getSourceLoader(){throw new Error("Texture.generate must be implemented.")}},{key:"isValid",get:function get(){return this._getIsValid()}},{key:"_getIsValid",value:function _getIsValid(){return!0}},{key:"_changed",value:function _changed(){this.isUsed()?this._updateSource():this._mustUpdate=!0}},{key:"_updateSource",value:function _updateSource(){this.stage.addUpdateSourceTexture(this)}},{key:"_performUpdateSource",value:function _performUpdateSource(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.isUsed()){this._mustUpdate=!1;var t=this._getTextureSource();this._replaceTextureSource(t)}}},{key:"_getTextureSource",value:function _getTextureSource(){var t=null;if(this._getIsValid()){var e=this._getLookupId();(t=this._getReusableTextureSource(e))||(t=this.manager.getTextureSource(this._getSourceLoader(),e))}return t}},{key:"_getReusableTextureSource",value:function _getReusableTextureSource(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getLookupId();return this._getIsValid()&&t?this.manager.getReusableTextureSource(t):null}},{key:"_replaceTextureSource",value:function _replaceTextureSource(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=this._source;if(this._source=e,this.elements.size&&(r&&(this._activeCount&&r.decActiveTextureCount(),r.removeTexture(this)),e&&(e.addTexture(this),this._activeCount&&e.incActiveTextureCount())),this.isUsed())if(e)if(e.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach(function(e){_newArrowCheck(this,t),e.active&&e._setDisplayedTexture(this)}.bind(this));else{var i=e.loadError;i&&this.elements.forEach(function(e){_newArrowCheck(this,t),e.active&&e.onTextureSourceLoadError(i)}.bind(this))}else this.elements.forEach(function(e){_newArrowCheck(this,t),e.active&&e._setDisplayedTexture(null)}.bind(this))}},{key:"load",value:function load(){this.source&&(this.isLoaded()||this.source.load(!0))}},{key:"isLoaded",value:function isLoaded(){return this._source&&this._source.isLoaded()}},{key:"loadError",get:function get(){return this._source&&this._source.loadError}},{key:"free",value:function free(){this._source&&this._source.free()}},{key:"resizeMode",get:function get(){return this._resizeMode},set:function set(t){var e=t.type,r=void 0===e?"cover":e,i=t.w,n=void 0===i?0:i,s=t.h,o=void 0===s?0:s,u=t.clipX,h=void 0===u?.5:u,l=t.clipY,f=void 0===l?.5:l;this._resizeMode={type:r,w:n,h:o,clipX:h,clipY:f},this.isLoaded()&&this._applyResizeMode()}},{key:"_clearResizeMode",value:function _clearResizeMode(){this._resizeMode=null}},{key:"_applyResizeMode",value:function _applyResizeMode(){"cover"===this._resizeMode.type?this._applyResizeCover():"contain"===this._resizeMode.type&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}},{key:"_applyResizeCover",value:function _applyResizeCover(){var t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h,r=Math.max(t,e);if(r){if(this._precision=1/r,t&&t<r){var i=this._precision*this._resizeMode.w,n=this._source.w-i;this._x=n*this._resizeMode.clipX,this._w=this._source.w-n}if(e&&e<r){var s=this._precision*this._resizeMode.h,o=this._source.h-s;this._y=o*this._resizeMode.clipY,this._h=this._source.h-o}}}},{key:"_applyResizeContain",value:function _applyResizeContain(){var t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h,r=t;(!r||e<r)&&(r=e),r&&(this._precision=1/r)}},{key:"enableClipping",value:function enableClipping(t,e,r,i){this._clearResizeMode(),t*=this._precision,e*=this._precision,r*=this._precision,i*=this._precision,this._x===t&&this._y===e&&this._w===r&&this._h===i||(this._x=t,this._y=e,this._w=r,this._h=i,this._updateClipping(!0))}},{key:"disableClipping",value:function disableClipping(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}},{key:"_updateClipping",value:function _updateClipping(){this.clipping=!!(this._x||this._y||this._w||this._h);var t=this;this.elements.forEach((function(e){e.displayedTexture===t&&e.onDisplayedTextureClippingChanged()}))}},{key:"_updatePrecision",value:function _updatePrecision(){var t=this;this.elements.forEach((function(e){e.displayedTexture===t&&e.onPrecisionChanged()}))}},{key:"getNonDefaults",value:function getNonDefaults(){var t={};return t.type=this.constructor.name,0!==this.x&&(t.x=this.x),0!==this.y&&(t.y=this.y),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),1!==this.precision&&(t.precision=this.precision),t}},{key:"px",get:function get(){return this._x}},{key:"py",get:function get(){return this._y}},{key:"pw",get:function get(){return this._w}},{key:"ph",get:function get(){return this._h}},{key:"x",get:function get(){return this._x/this._precision},set:function set(t){this._clearResizeMode(),t*=this._precision,this._x!==t&&(this._x=t,this._updateClipping())}},{key:"y",get:function get(){return this._y/this._precision},set:function set(t){this._clearResizeMode(),t*=this._precision,this._y!==t&&(this._y=t,this._updateClipping())}},{key:"w",get:function get(){return this._w/this._precision},set:function set(t){this._clearResizeMode(),t*=this._precision,this._w!==t&&(this._w=t,this._updateClipping())}},{key:"h",get:function get(){return this._h/this._precision},set:function set(t){this._clearResizeMode(),t*=this._precision,this._h!==t&&(this._h=t,this._updateClipping())}},{key:"precision",get:function get(){return this._precision},set:function set(t){this._clearResizeMode(),this._precision!==t&&(this._precision=t,this._updatePrecision())}},{key:"isAutosizeTexture",value:function isAutosizeTexture(){return!0}},{key:"getRenderWidth",value:function getRenderWidth(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}},{key:"getRenderHeight",value:function getRenderHeight(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}},{key:"patch",value:function patch(t){i.patchObject(this,t)}}]),Texture}();w.prototype.isTexture=!0,w.id=0;var A=function(t){_inherits(ImageTexture,t);var e=_createSuper(ImageTexture);function ImageTexture(t){var r;return _classCallCheck(this,ImageTexture),(r=e.call(this,t))._src=void 0,r._hasAlpha=!1,r}return _createClass(ImageTexture,[{key:"src",get:function get(){return this._src},set:function set(t){this._src!==t&&(this._src=t,this._changed())}},{key:"hasAlpha",get:function get(){return this._hasAlpha},set:function set(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._changed())}},{key:"_getIsValid",value:function _getIsValid(){return!!this._src}},{key:"_getLookupId",value:function _getLookupId(){return this._src}},{key:"_getSourceLoader",value:function _getSourceLoader(){var t=this,e=this._src,r=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var i=e.charCodeAt(0);-1===e.indexOf("//")&&(i>=65&&i<=90||i>=97&&i<=122||46==i)&&(e=this.stage.getOption("srcBasePath")+e)}return function(i){return _newArrowCheck(this,t),this.stage.platform.loadSrcTexture({src:e,hasAlpha:r},i)}.bind(this)}},{key:"getNonDefaults",value:function getNonDefaults(){var t=_get(_getPrototypeOf(ImageTexture.prototype),"getNonDefaults",this).call(this);return this._src&&(t.src=this._src),t}}]),ImageTexture}(w),R=function(){function TextTextureRenderer(t,e,r){_classCallCheck(this,TextTextureRenderer),this._stage=t,this._canvas=e,this._context=this._canvas.getContext("2d"),this._settings=r}return _createClass(TextTextureRenderer,[{key:"getPrecision",value:function getPrecision(){return this._settings.precision}},{key:"setFontProperties",value:function setFontProperties(){this._context.font=r.isSpark?this._stage.platform.getFontSetting(this):this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}},{key:"_getFontSetting",value:function _getFontSetting(){var t=this._settings.fontFace;Array.isArray(t)||(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++)"serif"===t[r]||"sans-serif"===t[r]?e.push(t[r]):e.push('"'.concat(t[r],'"'));return"".concat(this._settings.fontStyle," ").concat(this._settings.fontSize*this.getPrecision(),"px ").concat(e.join(","))}},{key:"_load",value:function _load(){var t=this;if(r.isWeb&&document.fonts){var e=this._getFontSetting();try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch(function(r){_newArrowCheck(this,t),console.warn("[Lightning] Font load error",r,e)}.bind(this)).then(function(){_newArrowCheck(this,t),document.fonts.check(e,this._settings.text)||console.warn("[Lightning] Font not found",e)}.bind(this))}catch(t){console.warn("[Lightning] Can't check font loading for "+e)}}}},{key:"draw",value:function draw(){var t=this,e=this._load();return e?e.then(function(){return _newArrowCheck(this,t),r.isSpark?this._stage.platform.drawText(this):this._draw()}.bind(this)):r.isSpark?this._stage.platform.drawText(this):this._draw()}},{key:"_calculateRenderInfo",value:function _calculateRenderInfo(){var t={},e=this.getPrecision(),r=this._settings.paddingLeft*e,i=this._settings.paddingRight*e,n=this._settings.fontSize*e,s=null===this._settings.offsetY?null:this._settings.offsetY*e,o=this._settings.lineHeight*e,u=this._settings.w*e,h=this._settings.h*e,l=this._settings.wordWrapWidth*e,f=this._settings.cutSx*e,d=this._settings.cutEx*e,_=this._settings.cutSy*e,g=this._settings.cutEy*e,p=(this._settings.letterSpacing||0)*e,v=this._settings.textIndent*e;this.setFontProperties();var y,x=u||2048/this.getPrecision(),m=x-r;if(m<10&&(x+=10-m,m+=10-m),l||(l=m),this._settings.textOverflow&&!this._settings.wordWrap){var S;switch(this._settings.textOverflow){case"clip":S="";break;case"ellipsis":S=this._settings.maxLinesSuffix;break;default:S=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,l-v,S)}if(this._settings.wordWrap)y=this.wrapText(this._settings.text,l,p,v);else for(var b=(y={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]}).l.length,k=0;k<b-1;k++)y.n.push(k);var T=y.l;if(this._settings.maxLines&&T.length>this._settings.maxLines){var C=T.slice(0,this._settings.maxLines),w=null;if(this._settings.maxLinesSuffix){var A=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,R=this.wrapText(C[C.length-1],l-A,p,v);C[C.length-1]=R.l[0]+this._settings.maxLinesSuffix,w=[R.l.length>1?R.l[1]:""]}else w=[""];var E,L=T.length,I=0,O=y.n.length;for(E=this._settings.maxLines;E<L;E++)w[I]+=(w[I]?" ":"")+T[E],E+1<O&&y.n[E+1]&&I++;t.remainingText=w.join("\n"),t.moreTextLines=!0,T=C}else t.moreTextLines=!1,t.remainingText="";for(var P,M=0,z=[],U=0;U<T.length;U++){var B=this.measureText(T[U],p)+(0===U?v:0);z.push(B),M=Math.max(M,B)}if(t.lineWidths=z,u||(x=M+r+i,m=M),o=o||n,h)P=h;else{var D="bottom"!=this._settings.textBaseline?.5*n:0;P=o*(T.length-1)+D+Math.max(o,n)+s}return null===s&&(s=n),t.w=x,t.h=P,t.lines=T,t.precision=e,x||(x=1),P||(P=1),(f||d)&&(x=Math.min(x,d-f)),(_||g)&&(P=Math.min(P,g-_)),t.width=x,t.innerWidth=m,t.height=P,t.fontSize=n,t.cutSx=f,t.cutSy=_,t.cutEx=d,t.cutEy=g,t.lineHeight=o,t.lineWidths=z,t.offsetY=s,t.paddingLeft=r,t.paddingRight=i,t.letterSpacing=p,t.textIndent=v,t}},{key:"_draw",value:function _draw(){var t,r,i=this._calculateRenderInfo(),n=this.getPrecision();this._canvas.width=Math.ceil(i.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(i.height),this.setFontProperties(),i.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(i.cutSx||i.cutSy)&&this._context.translate(-i.cutSx,-i.cutSy);for(var s=[],o=0,u=i.lines.length;o<u;o++)t=0===o?i.textIndent:0,r=o*i.lineHeight+i.offsetY,"middle"==this._settings.verticalAlign?r+=(i.lineHeight-i.fontSize)/2:"bottom"==this._settings.verticalAlign&&(r+=i.lineHeight-i.fontSize),"right"===this._settings.textAlign?t+=i.innerWidth-i.lineWidths[o]:"center"===this._settings.textAlign&&(t+=(i.innerWidth-i.lineWidths[o])/2),t+=i.paddingLeft,s.push({text:i.lines[o],x:t,y:r,w:i.lineWidths[o]});if(this._settings.highlight){var h=this._settings.highlightColor||0,l=this._settings.highlightHeight*n||1.5*i.fontSize,f=this._settings.highlightOffset*n,d=null!==this._settings.highlightPaddingLeft?this._settings.highlightPaddingLeft*n:i.paddingLeft,_=null!==this._settings.highlightPaddingRight?this._settings.highlightPaddingRight*n:i.paddingRight;this._context.fillStyle=e.getRgbaString(h);for(var g=0;g<s.length;g++){var p=s[g];this._context.fillRect(p.x-d,p.y-i.offsetY+f,p.w+_+d,l)}}var v=null;this._settings.shadow&&(v=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=e.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*n,this._context.shadowOffsetY=this._settings.shadowOffsetY*n,this._context.shadowBlur=this._settings.shadowBlur*n),this._context.fillStyle=e.getRgbaString(this._settings.textColor);for(var y=0,x=s.length;y<x;y++){var m=s[y];if(0===i.letterSpacing)this._context.fillText(m.text,m.x,m.y);else for(var S=m.text.split(""),b=m.x,k=0,T=S.length;k<T;k++)this._context.fillText(S[k],b,m.y),b+=this.measureText(S[k],i.letterSpacing)}v&&(this._context.shadowColor=v[0],this._context.shadowOffsetX=v[1],this._context.shadowOffsetY=v[2],this._context.shadowBlur=v[3]),(i.cutSx||i.cutSy)&&this._context.translate(i.cutSx,i.cutSy),this.renderInfo=i}},{key:"wrapWord",value:function wrapWord(t,e,r){var i=this._context.measureText(r).width,n=t.length,s=this._context.measureText(t).width;if(s<=e)return t;var o=Math.floor(e*n/s),u=this._context.measureText(t.substring(0,o)).width+i;if(u>e)for(;o>0&&(u=this._context.measureText(t.substring(0,o)).width+i)>e;)o-=1;else for(;o<n;){if(!((u=this._context.measureText(t.substring(0,o)).width+i)<e)){o-=1;break}o+=1}return t.substring(0,o)+(e>=i?r:"")}},{key:"wrapText",value:function wrapText(t,e,r){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=t.split(/\r?\n/g),s=[],o=[],u=0;u<n.length;u++){for(var h=[],l="",f=e-i,d=n[u].split(" "),_=0;_<d.length;_++){var g=this.measureText(d[_],r),p=g+this.measureText(" ",r);0===_||p>f?(_>0&&(h.push(l),l=""),l+=d[_],f=e-g-(0===_?i:0)):(f-=p,l+=" "+d[_])}h.push(l),l="",s=s.concat(h),u<n.length-1&&o.push(s.length)}return{l:s,n:o}}},{key:"measureText",value:function measureText(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r?t.split("").reduce(function(t,i){return _newArrowCheck(this,e),t+this._context.measureText(i).width+r}.bind(this),0):this._context.measureText(t).width}}]),TextTextureRenderer}(),E=function(){function TextTextureRendererAdvanced(t,e,r){_classCallCheck(this,TextTextureRendererAdvanced),this._stage=t,this._canvas=e,this._context=this._canvas.getContext("2d"),this._settings=r}return _createClass(TextTextureRendererAdvanced,[{key:"getPrecision",value:function getPrecision(){return this._settings.precision}},{key:"setFontProperties",value:function setFontProperties(){var t=r.isSpark?this._stage.platform.getFontSetting(this):this._getFontSetting();return this._context.font=t,this._context.textBaseline=this._settings.textBaseline,t}},{key:"_getFontSetting",value:function _getFontSetting(){var t=this._settings.fontFace;Array.isArray(t)||(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++)"serif"===t[r]||"sans-serif"===t[r]?e.push(t[r]):e.push('"'.concat(t[r],'"'));return"".concat(this._settings.fontStyle," ").concat(this._settings.fontSize*this.getPrecision(),"px ").concat(e.join(","))}},{key:"_load",value:function _load(){var t=this;if(r.isWeb&&document.fonts){var e=this._getFontSetting();try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch(function(r){_newArrowCheck(this,t),console.warn("Font load error",r,e)}.bind(this)).then(function(){_newArrowCheck(this,t),document.fonts.check(e,this._settings.text)||console.warn("Font not found",e)}.bind(this))}catch(t){console.warn("Can't check font loading for "+e)}}}},{key:"draw",value:function draw(){var t=this,e=this._load();return e?e.then(function(){return _newArrowCheck(this,t),r.isSpark?this._stage.platform.drawText(this):this._draw()}.bind(this)):r.isSpark?this._stage.platform.drawText(this):this._draw()}},{key:"_calculateRenderInfo",value:function _calculateRenderInfo(){var t=this,e={},r=this.getPrecision(),i=this._settings.paddingLeft*r,n=this._settings.paddingRight*r,s=this._settings.fontSize*r,o=this._settings.lineHeight*r||s,u=0!=this._settings.w?this._settings.w*r:2048/r,h=this._settings.wordWrapWidth*r,l=this._settings.cutSx*r,f=this._settings.cutEx*r,d=this._settings.cutSy*r,_=this._settings.cutEy*r,g=this._settings.letterSpacing||0;e.baseFont=this.setFontProperties(),e.w=u,e.width=u,e.text=this._settings.text,e.precision=r,e.fontSize=s,e.lineHeight=o,e.letterSpacing=g,e.textAlign=this._settings.textAlign,e.textColor=this._settings.textColor,e.verticalAlign=this._settings.verticalAlign,e.highlight=this._settings.highlight,e.highlightColor=this._settings.highlightColor,e.highlightHeight=this._settings.highlightHeight,e.highlightPaddingLeft=this._settings.highlightPaddingLeft,e.highlightPaddingRight=this._settings.highlightPaddingRight,e.highlightOffset=this._settings.highlightOffset,e.paddingLeft=this._settings.paddingLeft,e.paddingRight=this._settings.paddingRight,e.maxLines=this._settings.maxLines,e.maxLinesSuffix=this._settings.maxLinesSuffix,e.textOverflow=this._settings.textOverflow,e.wordWrap=this._settings.wordWrap,e.wordWrapWidth=h,e.shadow=this._settings.shadow,e.shadowColor=this._settings.shadowColor,e.shadowOffsetX=this._settings.shadowOffsetX,e.shadowOffsetY=this._settings.shadowOffsetY,e.shadowBlur=this._settings.shadowBlur,e.cutSx=l,e.cutEx=f,e.cutSy=d,e.cutEy=_,e.textIndent=this._settings.textIndent*r,e.wordBreak=this._settings.wordBreak;var p=e.text,v=e.wordWrap&&e.wordWrapWidth||e.width;if(e.textOverflow&&!e.wordWrap){var y;switch(this._settings.textOverflow){case"clip":y="";break;case"ellipsis":y=this._settings.maxLinesSuffix;break;default:y=this._settings.textOverflow}p=this.wrapWord(p,h||e.w,y)}p=this.tokenize(p),p=this.parse(p),p=this.measure(p,g,e.baseFont),e.textIndent&&(p=this.indent(p,e.textIndent)),e.wordBreak&&(p=p.reduce(function(r,i){return _newArrowCheck(this,t),r.concat(this.wordBreak(i,v,e.baseFont))}.bind(this),[]),this.resetFontStyle());var x,m=i,S=0,b=_createForOfIteratorHelper(p);try{for(b.s();!(x=b.n()).done;){var k=x.value;(e.wordWrap&&m+k.width>v||"\n"==k.text)&&(m=i,S+=1),k.lineNo=S,"\n"!=k.text&&(k.x=m,m+=k.width)}}catch(t){b.e(t)}finally{b.f()}e.lineNum=S+1;var T=0;"middle"==e.verticalAlign?T+=(e.lineHeight-e.fontSize)/2:"bottom"==this._settings.verticalAlign&&(T+=e.lineHeight-e.fontSize),e.lines=[];for(var C=0;C<e.lineNum;C++)e.lines[C]={width:0,x:0,y:e.lineHeight*C+T,text:[]};var w,A=_createForOfIteratorHelper(p);try{for(A.s();!(w=A.n()).done;){var R=w.value;e.lines[R.lineNo].text.push(R)}}catch(t){A.e(t)}finally{A.f()}var E,L=_createForOfIteratorHelper(e.lines);try{for(L.s();!(E=L.n()).done;){var I=E.value;if(0!=I.text.length){var O=I.text[0].text,P=I.text[I.text.length-1].text;"\n"==O&&I.text.shift()," "!=P&&"\n"!=P||I.text.pop()}}}catch(t){L.e(t)}finally{L.f()}var M,z=_createForOfIteratorHelper(e.lines);try{for(z.s();!(M=z.n()).done;){var U=M.value;U.width=U.text.reduce(function(e,r){return _newArrowCheck(this,t),e+r.width}.bind(this),0)}}catch(t){z.e(t)}finally{z.f()}if(e.width=0!=this._settings.w?this._settings.w*r:Math.max.apply(Math,_toConsumableArray(e.lines.map(function(e){return _newArrowCheck(this,t),e.width}.bind(this))))+n,e.w=e.width,e.maxLines&&e.lineNum>e.maxLines&&e.maxLinesSuffix){var B=e.maxLines-1,D=p.filter(function(e){return _newArrowCheck(this,t),e.lineNo==B}.bind(this)),j=e.maxLinesSuffix;j=this.tokenize(j),j=this.parse(j),(j=this.measure(j,e.letterSpacing,e.baseFont)[0]).lineNo=B,D.length?j.x=D[D.length-1].x+D[D.length-1].width:j.x=0,D.push(j);for(var N=D.reduce(function(e,r){return _newArrowCheck(this,t),e+r.width}.bind(this),0);N>e.width||" "==D[D.length-2].text;){D.splice(D.length-2,1),N=D.reduce(function(e,r){return _newArrowCheck(this,t),e+r.width}.bind(this),0);var W=D[D.length-2]||{x:0,width:0};if(j.x=W.x+W.width,D.length<2)break}e.lines[B].text=D,e.lines[B].width=N}if(this._settings.h?e.h=this._settings.h:e.maxLines&&e.maxLines<e.lineNum?e.h=e.maxLines*e.lineHeight+s/2:e.h=e.lineNum*e.lineHeight+s/2,"center"==e.textAlign){var H,G=_createForOfIteratorHelper(e.lines);try{for(G.s();!(H=G.n()).done;){var V=H.value;V.x=(e.width-V.width-i)/2}}catch(t){G.e(t)}finally{G.f()}}else if("right"==e.textAlign){var Y,X=_createForOfIteratorHelper(e.lines);try{for(X.s();!(Y=X.n()).done;){var q=Y.value;q.x=e.width-q.width-i}}catch(t){X.e(t)}finally{X.f()}}return e}},{key:"_draw",value:function _draw(){var t=this,r=this._calculateRenderInfo(),i=this.getPrecision(),n=r.paddingLeft*i,s=r.w||r.width;(r.cutSx||r.cutEx)&&(s=Math.min(r.w,r.cutEx-r.cutSx));var o=r.h;if((r.cutSy||r.cutEy)&&(o=Math.min(r.h,r.cutEy-r.cutSy)),this._canvas.width=Math.ceil(s+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(o),this.setFontProperties(),r.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(r.cutSx||r.cutSy)&&this._context.translate(-r.cutSx,-r.cutSy),r.highlight){var u=r.highlightColor||0,h=r.highlightHeight?r.highlightHeight*i:1.5*r.fontSize,l=r.highlightOffset?r.highlightOffset*i:0,f=null!==r.highlightPaddingLeft?r.highlightPaddingLeft*i:r.paddingLeft,d=null!==r.highlightPaddingRight?r.highlightPaddingRight*i:r.paddingRight;this._context.fillStyle=e.getRgbaString(u);for(var _=r.maxLines?Math.min(r.maxLines,r.lineNum):r.lineNum,g=0;g<_;g++){var p=r.lines[g];this._context.fillRect(p.x-f+n,p.y+l,p.width+f+d,h)}}var v=null;this._settings.shadow&&(v=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=e.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*i,this._context.shadowOffsetY=this._settings.shadowOffsetY*i,this._context.shadowBlur=this._settings.shadowBlur*i);var y=e.getRgbaString(this._settings.textColor),x=y;this._context.fillStyle=y;var m,S=_createForOfIteratorHelper(r.lines);try{for(S.s();!(m=S.n()).done;){var b,k=_createForOfIteratorHelper(m.value.text);try{for(k.s();!(b=k.n()).done;){var T=b.value,C=0;if("\n"!=T.text&&!(r.maxLines&&T.lineNo>=r.maxLines))if(T.color!=x&&(x=T.color,this._context.fillStyle=x),this._context.font=T.fontStyle,T.letters){var w,A=_createForOfIteratorHelper(T.letters);try{for(A.s();!(w=A.n()).done;){var R=w.value,E=r.lines[T.lineNo].x+T.x+C;this._context.fillText(R.text,E,r.lines[T.lineNo].y+r.fontSize),C+=R.width}}catch(t){A.e(t)}finally{A.f()}}else{var L=r.lines[T.lineNo].x+T.x;this._context.fillText(T.text,L,r.lines[T.lineNo].y+r.fontSize)}}}catch(t){k.e(t)}finally{k.f()}}}catch(t){S.e(t)}finally{S.f()}v&&(this._context.shadowColor=v[0],this._context.shadowOffsetX=v[1],this._context.shadowOffsetY=v[2],this._context.shadowBlur=v[3]),(r.cutSx||r.cutSy)&&this._context.translate(r.cutSx,r.cutSy),r.lines=r.lines.map(function(e){var r=this;return _newArrowCheck(this,t),e.text.reduce(function(t,e){return _newArrowCheck(this,r),t+e.text}.bind(this),"")}.bind(this)),r.maxLines&&(r.lines=r.lines.slice(0,r.maxLines)),this.renderInfo=r}},{key:"measureText",value:function measureText(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r?t.split("").reduce(function(t,i){return _newArrowCheck(this,e),t+this._context.measureText(i).width+r}.bind(this),0):this._context.measureText(t).width}},{key:"tokenize",value:function tokenize(t){for(var e=this,r=/ |\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,i=t.match(r)||[],n=t.split(r)||[],s=[],o=0;o<n.length;o++)s.push(n[o],i[o]);return s.pop(),s.filter(function(t){return _newArrowCheck(this,e),""!=t}.bind(this))}},{key:"parse",value:function parse(t){var r=this,i=0,n=0,s=[e.getRgbaString(this._settings.textColor)],o=0,u=_wrapRegExp(/<color=(0[Xx][0-9A-Fa-f]{8})/,{color:1});return t.map(function(t){return _newArrowCheck(this,r),"<i>"==t?(i+=1,t=""):"</i>"==t&&i>0?(i-=1,t=""):"<b>"==t?(n+=1,t=""):"</b>"==t&&n>0?(n-=1,t=""):"</color>"==t?(s.length>1&&(o-=1,s.pop()),t=""):u.test(t)&&(s.push(e.getRgbaString(parseInt(u.exec(t).groups.color))),o+=1,t=""),{text:t,italic:i,bold:n,color:s[o]}}.bind(this)).filter(function(t){return _newArrowCheck(this,r),""!=t.text}.bind(this))}},{key:"applyFontStyle",value:function applyFontStyle(t,e){var r=e;t.bold&&(r="bold "+r),t.italic&&(r="italic "+r),this._context.font=r,t.fontStyle=r}},{key:"resetFontStyle",value:function resetFontStyle(t){this._context.font=t}},{key:"measure",value:function measure(t){var e,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=_createForOfIteratorHelper(t);try{for(s.s();!(e=s.n()).done;){var o=e.value;if(this.applyFontStyle(o,n),o.width=this.measureText(o.text,i),i>0){o.letters=o.text.split("").map(function(t){return _newArrowCheck(this,r),{text:t}}.bind(this));var u,h=_createForOfIteratorHelper(o.letters);try{for(h.s();!(u=h.n()).done;){var l=u.value;l.width=this.measureText(l.text,i)}}catch(t){h.e(t)}finally{h.f()}}}}catch(t){s.e(t)}finally{s.f()}return this.resetFontStyle(n),t}},{key:"indent",value:function indent(t,e){return t.splice(0,0,{text:"",width:e}),t}},{key:"wrapWord",value:function wrapWord(t,e,r){var i=this._context.measureText(r).width,n=t.length,s=this._context.measureText(t).width;if(s<=e)return t;var o=Math.floor(e*n/s),u=this._context.measureText(t.substring(0,o)).width+i;if(u>e)for(;o>0&&(u=this._context.measureText(t.substring(0,o)).width+i)>e;)o-=1;else for(;o<n;){if(!((u=this._context.measureText(t.substring(0,o)).width+i)<e)){o-=1;break}o+=1}return t.substring(0,o)+(e>=i?r:"")}},{key:"_getBreakIndex",value:function _getBreakIndex(t,e){var r=t.length,i=this.measureText(t);if(i<=e)return{breakIndex:t.length,truncWordWidth:i};var n=Math.floor(e*r/i),s=this.measureText(t.substring(0,n));if(s>e)for(;n>0&&(s=this.measureText(t.substring(0,n)))>e;)n-=1;else for(;n<r;){if(!((s=this.measureText(t.substring(0,n)))<e)){n-=1,s=this.measureText(t.substring(0,n));break}n+=1}return{breakIndex:n,truncWordWidth:s}}},{key:"wordBreak",value:function wordBreak(t,e,r){if(!t.text)return t;this.applyFontStyle(t,r);var i=[],n=t.text;if(t.letters){var s,o=0,u=[],h=0,l=_createForOfIteratorHelper(t.letters);try{for(l.s();!(s=l.n()).done;){var f=s.value;o+f.width>=e?(i.push(_objectSpread2({},t)),i[i.length-1].text=n.slice(0,h),i[i.length-1].width=o,i[i.length-1].letters=u,n=n.slice(h),o=0,u=[],h=0):(h+=1,u.push(f),o+=f.width)}}catch(t){l.e(t)}finally{l.f()}o>0&&(i.push(_objectSpread2({},t)),i[i.length-1].text=n.slice(0,h),i[i.length-1].width=o,i[i.length-1].letters=u)}else for(;;){var d=this._getBreakIndex(n,e),_=d.breakIndex,g=d.truncWordWidth;if(i.push(_objectSpread2({},t)),i[i.length-1].text=n.slice(0,_),i[i.length-1].width=g,_===n.length)break;n=n.slice(_)}return i}}]),TextTextureRendererAdvanced}(),L=function(t){_inherits(TextTexture,t);var e=_createSuper(TextTexture);function TextTexture(t){var r;return _classCallCheck(this,TextTexture),(r=e.call(this,t))._precision=r.stage.getOption("precision"),r}return _createClass(TextTexture,[{key:"text",get:function get(){return this._text},set:function set(t){this._text!==t&&(this._text=""+t,this._changed())}},{key:"w",get:function get(){return this._w},set:function set(t){this._w!==t&&(this._w=t,this._changed())}},{key:"h",get:function get(){return this._h},set:function set(t){this._h!==t&&(this._h=t,this._changed())}},{key:"fontStyle",get:function get(){return this._fontStyle},set:function set(t){this._fontStyle!==t&&(this._fontStyle=t,this._changed())}},{key:"fontSize",get:function get(){return this._fontSize},set:function set(t){this._fontSize!==t&&(this._fontSize=t,this._changed())}},{key:"fontFace",get:function get(){return this._fontFace},set:function set(t){this._fontFace!==t&&(this._fontFace=t,this._changed())}},{key:"wordWrap",get:function get(){return this._wordWrap},set:function set(t){this._wordWrap!==t&&(this._wordWrap=t,this._changed())}},{key:"wordWrapWidth",get:function get(){return this._wordWrapWidth},set:function set(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this._changed())}},{key:"wordBreak",get:function get(){return this._wordBreak},set:function set(t){this._wordBreak!==t&&(this._wordBreak=t,this._changed())}},{key:"textOverflow",get:function get(){return this._textOverflow},set:function set(t){t!=this._textOverflow&&(this._textOverflow=t,this._changed())}},{key:"lineHeight",get:function get(){return this._lineHeight},set:function set(t){this._lineHeight!==t&&(this._lineHeight=t,this._changed())}},{key:"textBaseline",get:function get(){return this._textBaseline},set:function set(t){this._textBaseline!==t&&(this._textBaseline=t,this._changed())}},{key:"textAlign",get:function get(){return this._textAlign},set:function set(t){this._textAlign!==t&&(this._textAlign=t,this._changed())}},{key:"verticalAlign",get:function get(){return this._verticalAlign},set:function set(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._changed())}},{key:"offsetY",get:function get(){return this._offsetY},set:function set(t){this._offsetY!==t&&(this._offsetY=t,this._changed())}},{key:"maxLines",get:function get(){return this._maxLines},set:function set(t){this._maxLines!==t&&(this._maxLines=t,this._changed())}},{key:"maxLinesSuffix",get:function get(){return this._maxLinesSuffix},set:function set(t){this._maxLinesSuffix!==t&&(this._maxLinesSuffix=t,this._changed())}},{key:"textColor",get:function get(){return this._textColor},set:function set(t){this._textColor!==t&&(this._textColor=t,this._changed())}},{key:"paddingLeft",get:function get(){return this._paddingLeft},set:function set(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._changed())}},{key:"paddingRight",get:function get(){return this._paddingRight},set:function set(t){this._paddingRight!==t&&(this._paddingRight=t,this._changed())}},{key:"shadow",get:function get(){return this._shadow},set:function set(t){this._shadow!==t&&(this._shadow=t,this._changed())}},{key:"shadowColor",get:function get(){return this._shadowColor},set:function set(t){this._shadowColor!==t&&(this._shadowColor=t,this._changed())}},{key:"shadowOffsetX",get:function get(){return this._shadowOffsetX},set:function set(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._changed())}},{key:"shadowOffsetY",get:function get(){return this._shadowOffsetY},set:function set(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._changed())}},{key:"shadowBlur",get:function get(){return this._shadowBlur},set:function set(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._changed())}},{key:"highlight",get:function get(){return this._highlight},set:function set(t){this._highlight!==t&&(this._highlight=t,this._changed())}},{key:"highlightHeight",get:function get(){return this._highlightHeight},set:function set(t){this._highlightHeight!==t&&(this._highlightHeight=t,this._changed())}},{key:"highlightColor",get:function get(){return this._highlightColor},set:function set(t){this._highlightColor!==t&&(this._highlightColor=t,this._changed())}},{key:"highlightOffset",get:function get(){return this._highlightOffset},set:function set(t){this._highlightOffset!==t&&(this._highlightOffset=t,this._changed())}},{key:"highlightPaddingLeft",get:function get(){return this._highlightPaddingLeft},set:function set(t){this._highlightPaddingLeft!==t&&(this._highlightPaddingLeft=t,this._changed())}},{key:"highlightPaddingRight",get:function get(){return this._highlightPaddingRight},set:function set(t){this._highlightPaddingRight!==t&&(this._highlightPaddingRight=t,this._changed())}},{key:"cutSx",get:function get(){return this._cutSx},set:function set(t){this._cutSx!==t&&(this._cutSx=t,this._changed())}},{key:"cutEx",get:function get(){return this._cutEx},set:function set(t){this._cutEx!==t&&(this._cutEx=t,this._changed())}},{key:"cutSy",get:function get(){return this._cutSy},set:function set(t){this._cutSy!==t&&(this._cutSy=t,this._changed())}},{key:"cutEy",get:function get(){return this._cutEy},set:function set(t){this._cutEy!==t&&(this._cutEy=t,this._changed())}},{key:"advancedRenderer",get:function get(){return this._advancedRenderer},set:function set(t){this._advancedRenderer!==t&&(this._advancedRenderer=t,this._changed())}},{key:"letterSpacing",get:function get(){return this._letterSpacing},set:function set(t){this._letterSpacing!==t&&(this._letterSpacing=t,this._changed())}},{key:"textIndent",get:function get(){return this._textIndent},set:function set(t){this._textIndent!==t&&(this._textIndent=t,this._changed())}},{key:"precision",get:function get(){return _get(_getPrototypeOf(TextTexture.prototype),"precision",this)},set:function set(t){this.precision!==t&&(_set(_getPrototypeOf(TextTexture.prototype),"precision",t,this,!0),this._changed())}},{key:"_getIsValid",value:function _getIsValid(){return!!this.text}},{key:"_getLookupId",value:function _getLookupId(){var t=[];return 0!==this.w&&t.push("w "+this.w),0!==this.h&&t.push("h "+this.h),"normal"!==this.fontStyle&&t.push("fS"+this.fontStyle),40!==this.fontSize&&t.push("fs"+this.fontSize),null!==this.fontFace&&t.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),!0!==this.wordWrap&&t.push("wr"+(this.wordWrap?1:0)),0!==this.wordWrapWidth&&t.push("ww"+this.wordWrapWidth),!1!==this.wordBreak&&t.push((this.wordBreak,1)),""!=this.textOverflow&&t.push("to"+this.textOverflow),null!==this.lineHeight&&t.push("lh"+this.lineHeight),"alphabetic"!==this.textBaseline&&t.push("tb"+this.textBaseline),"left"!==this.textAlign&&t.push("ta"+this.textAlign),"top"!==this.verticalAlign&&t.push("va"+this.verticalAlign),null!==this.offsetY&&t.push("oy"+this.offsetY),0!==this.maxLines&&t.push("ml"+this.maxLines),".."!==this.maxLinesSuffix&&t.push("ms"+this.maxLinesSuffix),t.push("pc"+this.precision),4294967295!==this.textColor&&t.push("co"+this.textColor.toString(16)),0!==this.paddingLeft&&t.push("pl"+this.paddingLeft),0!==this.paddingRight&&t.push("pr"+this.paddingRight),!1!==this.shadow&&t.push("sh"+(this.shadow?1:0)),4278190080!==this.shadowColor&&t.push("sc"+this.shadowColor.toString(16)),0!==this.shadowOffsetX&&t.push("sx"+this.shadowOffsetX),0!==this.shadowOffsetY&&t.push("sy"+this.shadowOffsetY),5!==this.shadowBlur&&t.push("sb"+this.shadowBlur),!1!==this.highlight&&t.push("hL"+(this.highlight?1:0)),0!==this.highlightHeight&&t.push("hh"+this.highlightHeight),4278190080!==this.highlightColor&&t.push("hc"+this.highlightColor.toString(16)),null!==this.highlightOffset&&t.push("ho"+this.highlightOffset),null!==this.highlightPaddingLeft&&t.push("hl"+this.highlightPaddingLeft),null!==this.highlightPaddingRight&&t.push("hr"+this.highlightPaddingRight),null!==this.letterSpacing&&t.push("ls"+this.letterSpacing),null!==this.textIndent&&t.push("ti"+this.textIndent),this.cutSx&&t.push("csx"+this.cutSx),this.cutEx&&t.push("cex"+this.cutEx),this.cutSy&&t.push("csy"+this.cutSy),this.cutEy&&t.push("cey"+this.cutEy),this.advancedRenderer&&t.push((this.advancedRenderer,1)),"TX$"+t.join("|")+":"+this.text}},{key:"_getSourceLoader",value:function _getSourceLoader(){var t=this.cloneArgs();null===t.fontFace&&(t.fontFace=this.stage.getOption("defaultFontFace"));var e=this.stage.gl;return function(i){var n=this,s=this.stage.platform.getDrawingCanvas(),o=t.advancedRenderer?new E(this.stage,s,t):new R(this.stage,s,t),u=o.draw(),h={},l=this.stage.getOption("fontSharp"),f=!1;r.isBoolean(l)?f=l:r.isObject(l)&&(f=this.stage.getRenderPrecision()<=l.precision&&t.fontSize<=l.fontSize),e&&f&&(h[e.TEXTURE_MAG_FILTER]=e.NEAREST),u?u.then(function(){_newArrowCheck(this,n),i(null,Object.assign({renderInfo:o.renderInfo,throttle:!1,texParams:h},this.stage.platform.getTextureOptionsForDrawingCanvas(s)))}.bind(this)).catch(function(t){_newArrowCheck(this,n),i(t)}.bind(this)):i(null,Object.assign({renderInfo:o.renderInfo,throttle:!1,texParams:h},this.stage.platform.getTextureOptionsForDrawingCanvas(s)))}}},{key:"getNonDefaults",value:function getNonDefaults(){var t=_get(_getPrototypeOf(TextTexture.prototype),"getNonDefaults",this).call(this);return""!==this.text&&(t.text=this.text),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),"normal"!==this.fontStyle&&(t.fontStyle=this.fontStyle),40!==this.fontSize&&(t.fontSize=this.fontSize),null!==this.fontFace&&(t.fontFace=this.fontFace),!0!==this.wordWrap&&(t.wordWrap=this.wordWrap),0!==this.wordWrapWidth&&(t.wordWrapWidth=this.wordWrapWidth),!1!==this.wordBreak&&(t.wordBreak=this.wordBreak),""!=this.textOverflow&&(t.textOverflow=this.textOverflow),null!==this.lineHeight&&(t.lineHeight=this.lineHeight),"alphabetic"!==this.textBaseline&&(t.textBaseline=this.textBaseline),"left"!==this.textAlign&&(t.textAlign=this.textAlign),"top"!==this.verticalAlign&&(t.verticalAlign=this.verticalAlign),null!==this.offsetY&&(t.offsetY=this.offsetY),0!==this.maxLines&&(t.maxLines=this.maxLines),".."!==this.maxLinesSuffix&&(t.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(t.precision=this.precision),4294967295!==this.textColor&&(t.textColor=this.textColor),0!==this.paddingLeft&&(t.paddingLeft=this.paddingLeft),0!==this.paddingRight&&(t.paddingRight=this.paddingRight),!1!==this.shadow&&(t.shadow=this.shadow),4278190080!==this.shadowColor&&(t.shadowColor=this.shadowColor),0!==this.shadowOffsetX&&(t.shadowOffsetX=this.shadowOffsetX),0!==this.shadowOffsetY&&(t.shadowOffsetY=this.shadowOffsetY),5!==this.shadowBlur&&(t.shadowBlur=this.shadowBlur),!1!==this.highlight&&(t.highlight=this.highlight),0!==this.highlightHeight&&(t.highlightHeight=this.highlightHeight),4278190080!==this.highlightColor&&(t.highlightColor=this.highlightColor),0!==this.highlightOffset&&(t.highlightOffset=this.highlightOffset),0!==this.highlightPaddingLeft&&(t.highlightPaddingLeft=this.highlightPaddingLeft),0!==this.highlightPaddingRight&&(t.highlightPaddingRight=this.highlightPaddingRight),0!==this.letterSpacing&&(t.letterSpacing=this.letterSpacing),0!==this.textIndent&&(t.textIndent=this.textIndent),this.cutSx&&(t.cutSx=this.cutSx),this.cutEx&&(t.cutEx=this.cutEx),this.cutSy&&(t.cutSy=this.cutSy),this.cutEy&&(t.cutEy=this.cutEy),this.advancedRenderer&&(t.renderer=this.advancedRenderer),t}},{key:"cloneArgs",value:function cloneArgs(){var t={};return t.text=this._text,t.w=this._w,t.h=this._h,t.fontStyle=this._fontStyle,t.fontSize=this._fontSize,t.fontFace=this._fontFace,t.wordWrap=this._wordWrap,t.wordWrapWidth=this._wordWrapWidth,t.wordBreak=this._wordBreak,t.textOverflow=this._textOverflow,t.lineHeight=this._lineHeight,t.textBaseline=this._textBaseline,t.textAlign=this._textAlign,t.verticalAlign=this._verticalAlign,t.offsetY=this._offsetY,t.maxLines=this._maxLines,t.maxLinesSuffix=this._maxLinesSuffix,t.precision=this._precision,t.textColor=this._textColor,t.paddingLeft=this._paddingLeft,t.paddingRight=this._paddingRight,t.shadow=this._shadow,t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur,t.highlight=this._highlight,t.highlightHeight=this._highlightHeight,t.highlightColor=this._highlightColor,t.highlightOffset=this._highlightOffset,t.highlightPaddingLeft=this._highlightPaddingLeft,t.highlightPaddingRight=this._highlightPaddingRight,t.letterSpacing=this._letterSpacing,t.textIndent=this._textIndent,t.cutSx=this._cutSx,t.cutEx=this._cutEx,t.cutSy=this._cutSy,t.cutEy=this._cutEy,t.advancedRenderer=this._advancedRenderer,t}}],[{key:"renderer",value:function renderer(t,e,r){return this.advancedRenderer?new E(t,e,r):new R(t,e,r)}}]),TextTexture}(w),I=L.prototype;I._text="",I._w=0,I._h=0,I._fontStyle="normal",I._fontSize=40,I._fontFace=null,I._wordWrap=!0,I._wordWrapWidth=0,I._wordBreak=!1,I._textOverflow="",I._lineHeight=null,I._textBaseline="alphabetic",I._textAlign="left",I._verticalAlign="top",I._offsetY=null,I._maxLines=0,I._maxLinesSuffix="..",I._textColor=4294967295,I._paddingLeft=0,I._paddingRight=0,I._shadow=!1,I._shadowColor=4278190080,I._shadowOffsetX=0,I._shadowOffsetY=0,I._shadowBlur=5,I._highlight=!1,I._highlightHeight=0,I._highlightColor=4278190080,I._highlightOffset=0,I._highlightPaddingLeft=0,I._highlightPaddingRight=0,I._letterSpacing=0,I._textIndent=0,I._cutSx=0,I._cutEx=0,I._cutSy=0,I._cutEy=0,I._advancedRenderer=!1;var O=function(t){_inherits(SourceTexture,t);var e=_createSuper(SourceTexture);function SourceTexture(t){var r;return _classCallCheck(this,SourceTexture),(r=e.call(this,t))._textureSource=void 0,r}return _createClass(SourceTexture,[{key:"textureSource",get:function get(){return this._textureSource},set:function set(t){t!==this._textureSource&&(t.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=t,this._changed())}},{key:"_getTextureSource",value:function _getTextureSource(){return this._textureSource}}]),SourceTexture}(w),P=function(t){_inherits(Transition,t);var e=_createSuper(Transition);function Transition(t,r,i,n){var s;return _classCallCheck(this,Transition),(s=e.call(this)).manager=t,s._settings=r,s._element=i,s._getter=i.constructor.getGetter(n),s._setter=i.constructor.getSetter(n),s._merger=r.merger,s._merger||(s._merger=i.constructor.getMerger(n)),s._startValue=s._getter(s._element),s._targetValue=s._startValue,s._p=1,s._delayLeft=0,s}return _createClass(Transition,[{key:"start",value:function start(t){this._startValue=this._getter(this._element),this.isAttached()?t===this._startValue?this.reset(t,1):(this._targetValue=t,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=t,this._p=1,this._updateDrawValue())}},{key:"finish",value:function finish(){this._p<1&&(this._p=1)}},{key:"stop",value:function stop(){this.emit("stop"),this.manager.removeActive(this)}},{key:"pause",value:function pause(){this.stop()}},{key:"play",value:function play(){this.manager.addActive(this)}},{key:"reset",value:function reset(t,e){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=t,this._p=e,this.add()):(this._startValue=this._getter(this._element),this._targetValue=t,this._p=1,this._updateDrawValue())}},{key:"_updateDrawValue",value:function _updateDrawValue(){this._setter(this._element,this.getDrawValue())}},{key:"add",value:function add(){this.manager.addActive(this)}},{key:"isAttached",value:function isAttached(){return this._element.attached}},{key:"isRunning",value:function isRunning(){return this._p<1}},{key:"progress",value:function progress(t){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0){if(this._delayLeft-=t,!(this.delayLeft<0))return;t=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd")}0==this._settings.duration?this._p=1:this._p+=t/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}},{key:"invokeListeners",value:function invokeListeners(){this.emit("progress",this.p),1===this.p&&this.emit("finish")}},{key:"updateTargetValue",value:function updateTargetValue(t){var e=this._settings.timingFunctionImpl(this.p);1===e?this._targetValue=t:0===e?(this._startValue=this._targetValue,this._targetValue=t):(this._startValue=t-(t-this._targetValue)/(1-e),this._targetValue=t)}},{key:"getDrawValue",value:function getDrawValue(){if(this.p>=1)return this.targetValue;var t=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,t)}},{key:"skipDelay",value:function skipDelay(){this._delayLeft=0}},{key:"startValue",get:function get(){return this._startValue}},{key:"targetValue",get:function get(){return this._targetValue}},{key:"p",get:function get(){return this._p}},{key:"delayLeft",get:function get(){return this._delayLeft}},{key:"element",get:function get(){return this._element}},{key:"settings",get:function get(){return this._settings},set:function set(t){this._settings=t}}]),Transition}(T);P.prototype.isTransition=!0;var M=function(){function ObjectList(){_classCallCheck(this,ObjectList),this._items=[],this._refs={}}return _createClass(ObjectList,[{key:"get",value:function get(){return this._items}},{key:"first",get:function get(){return this._items[0]}},{key:"last",get:function get(){return this._items.length?this._items[this._items.length-1]:void 0}},{key:"add",value:function add(t){this.addAt(t,this._items.length)}},{key:"addAt",value:function addAt(t,e){if(!(e>=0&&e<=this._items.length))throw new Error("addAt: The index "+e+" is out of bounds "+this._items.length);var i=this._items.indexOf(t);if(i===e)return t;if(r.isObjectLiteral(t)){var n=t;(t=this.createItem(n)).patch(n)}-1!=i?this.setAt(t,e):(t.ref&&(this._refs[t.ref]=t),this._items.splice(e,0,t),this.onAdd(t,e))}},{key:"replaceByRef",value:function replaceByRef(t){if(!t.ref)throw new Error("replaceByRef: no ref specified in item");var e=this.getByRef(t.ref);if(!e)throw new Error("replaceByRef: no item found with reference: "+t.ref);this.replace(t,e),this.addAt(t,this._items.length)}},{key:"replace",value:function replace(t,e){var r=this.getIndex(e);if(-1===r)throw new Error("replace: The previous item does not exist");this.setAt(t,r)}},{key:"setAt",value:function setAt(t,e){if(!(e>=0&&e<this._items.length))throw new Error("setAt: The index "+e+" is out of bounds "+this._items.length);if(r.isObjectLiteral(t)){var i=t;(t=this.createItem(i)).patch(i)}var n=this._items.indexOf(t);if(-1!=n){if(n!==e){var s=n;s!==e&&(this._items.splice(s,1),this._items.splice(e,0,t),this.onMove(t,s,e))}}else{e<this._items.length&&this._items[e].ref&&(this._refs[this._items[e].ref]=void 0);var o=this._items[e];this._items[e]=t,t.ref&&(this._refs[t.ref]=t),this.onSet(t,e,o)}}},{key:"getAt",value:function getAt(t){return this._items[t]}},{key:"getIndex",value:function getIndex(t){return this._items.indexOf(t)}},{key:"remove",value:function remove(t){var e=this._items.indexOf(t);-1!==e&&this.removeAt(e)}},{key:"removeAt",value:function removeAt(t){if(t>=0&&t<this._items.length){var e=this._items[t];return e.ref&&(this._refs[e.ref]=void 0),this._items.splice(t,1),this.onRemove(e,t),e}throw new Error("removeAt: The index ".concat(t," is out of bounds ").concat(this._items.length-1))}},{key:"clear",value:function clear(){if(this._items.length){var t=this._items;this._items=[],this._refs={},this.onSync(t,[],[])}}},{key:"a",value:function a(t){if(r.isObjectLiteral(t)){var e=this.createItem(t);return e.patch(t),this.add(e),e}if(Array.isArray(t)){for(var i=0,n=t.length;i<n;i++)this.a(t[i]);return null}if(this.isItem(t))return this.add(t),t}},{key:"length",get:function get(){return this._items.length}},{key:"_getRefs",value:function _getRefs(){return this._refs}},{key:"getByRef",value:function getByRef(t){return this._refs[t]}},{key:"clearRef",value:function clearRef(t){delete this._refs[t]}},{key:"setRef",value:function setRef(t,e){this._refs[t]=e}},{key:"patch",value:function patch(t){r.isObjectLiteral(t)?this._setByObject(t):Array.isArray(t)&&this._setByArray(t)}},{key:"_setByObject",value:function _setByObject(t){for(var e=this._getRefs(),r=Object.keys(t),i=0,n=r.length;i<n;i++){var s=r[i],o=t[s],u=e[s];if(u)if(this.isItem(o)){if(u!==o){var h=this.getIndex(u);o.ref=s,this.setAt(o,h)}}else u.patch(o);else this.isItem(o)?(o.ref=s,this.add(o)):((u=this.createItem(o)).ref=s,u.patch(o),this.add(u))}}},{key:"_equalsArray",value:function _equalsArray(t){var e=!0;if(t.length===this._items.length)for(var r=0,i=this._items.length;r<i&&e;r++)e=e&&this._items[r]===t[r];else e=!1;return e}},{key:"_setByArray",value:function _setByArray(t){if(!this._equalsArray(t)){for(var e=0,i=this._items.length;e<i;e++)this._items[e].marker=!0;for(var n,s=[],o=0,u=t.length;o<u;o++){var h=t[o];if(this.isItem(h))h.marker=!1,s.push(h);else{var l=h.ref,f=void 0;l&&(n||(n=this._getRefs()),f=n[l]),f?f.marker=!1:f=this.createItem(h),r.isObjectLiteral(h)&&f.patch(h),s.push(f)}}this._setItems(s)}}},{key:"_setItems",value:function _setItems(t){var e=this,r=this._items;this._items=t;var i=r.filter(function(t){_newArrowCheck(this,e);var r=t.marker;return delete t.marker,r}.bind(this)),n=t.filter(function(t){return _newArrowCheck(this,e),-1===r.indexOf(t)}.bind(this));if(i.length||n.length){this._refs={};for(var s=0,o=this._items.length;s<o;s++){var u=this._items[s].ref;u&&(this._refs[u]=this._items[s])}}this.onSync(i,n,t)}},{key:"sort",value:function sort(t){var e=this._items.slice();e.sort(t),this._setByArray(e)}},{key:"onAdd",value:function onAdd(t,e){}},{key:"onRemove",value:function onRemove(t,e){}},{key:"onSync",value:function onSync(t,e,r){}},{key:"onSet",value:function onSet(t,e,r){}},{key:"onMove",value:function onMove(t,e,r){}},{key:"createItem",value:function createItem(t){throw new Error("ObjectList.createItem must create and return a new object")}},{key:"isItem",value:function isItem(t){return!1}},{key:"forEach",value:function forEach(t){this.get().forEach(t)}}]),ObjectList}(),z=function(t){_inherits(ElementChildList,t);var e=_createSuper(ElementChildList);function ElementChildList(t){var r;return _classCallCheck(this,ElementChildList),(r=e.call(this))._element=t,r}return _createClass(ElementChildList,[{key:"_connectParent",value:function _connectParent(t){var e=t.parent;if(e&&e!==this._element){var r=t.parent.childList,i=r.getIndex(t);t.ref&&(r._refs[t.ref]=void 0),r._items.splice(i,1),e.core.removeChildAt(i)}t._setParent(this._element)}},{key:"onAdd",value:function onAdd(t,e){this._connectParent(t),this._element.core.addChildAt(e,t.core)}},{key:"onRemove",value:function onRemove(t,e){t._setParent(null),this._element.core.removeChildAt(e)}},{key:"onSync",value:function onSync(t,e,r){for(var i=this,n=0,s=t.length;n<s;n++)t[n]._setParent(null);for(var o=0,u=e.length;o<u;o++)this._connectParent(e[o]);var h=function gc(t){return _newArrowCheck(this,i),t.core}.bind(this);this._element.core.syncChildren(t.map(h),e.map(h),r.map(h))}},{key:"onSet",value:function onSet(t,e,r){r._setParent(null),this._connectParent(t),this._element.core.setChildAt(e,t.core)}},{key:"onMove",value:function onMove(t,e,r){this._element.core.moveChild(e,r)}},{key:"createItem",value:function createItem(t){return t.type?new t.type(this._element.stage):this._element.stage.createElement()}},{key:"isItem",value:function isItem(t){return t.isElement}}]),ElementChildList}(M),U=function(){function Element(t){_classCallCheck(this,Element),this.stage=t,this.__id=Element.id++,this.__start(),this._hasEventListeners=!1,this.__core=new b(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}return _createClass(Element,[{key:"__start",value:function __start(){}},{key:"id",get:function get(){return this.__id}},{key:"ref",get:function get(){return this.__ref},set:function set(t){if(this.__ref!==t){var e=t.charCodeAt(0);r.isUcChar(e)||this._throwError("Ref must start with an upper case character: "+t),null!==this.__ref&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=t,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}},{key:"core",get:function get(){return this.__core}},{key:"setAsRoot",value:function setAsRoot(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}},{key:"isRoot",get:function get(){return this.__core.isRoot}},{key:"_setParent",value:function _setParent(t){this.__parent!==t&&(this.__parent&&this._unsetTagsParent(),this.__parent=t,t&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&t&&this._throwError("Root should not be added as a child! Results are unspecified!"))}},{key:"getDepth",value:function getDepth(){for(var t=0,e=this.__parent;e;)t++,e=e.__parent;return t}},{key:"getAncestor",value:function getAncestor(t){for(var e=this;t>0&&e.__parent;)e=e.__parent,t--;return e}},{key:"getAncestors",value:function getAncestors(){for(var t=[],e=this;e;)t.push(e),e=e.__parent;return t}},{key:"getAncestorAtDepth",value:function getAncestorAtDepth(t){var e=this.getDepth()-t;return e<0?null:this.getAncestor(e)}},{key:"isAncestorOf",value:function isAncestorOf(t){for(var e=t;e=e.parent;)if(this===e)return!0;return!1}},{key:"getSharedAncestor",value:function getSharedAncestor(t){var e=this,r=t,i=e.getDepth(),n=r.getDepth();i>n?e=e.getAncestor(i-n):n>i&&(r=r.getAncestor(n-i));do{if(e===r)return e;e=e.__parent,r=r.__parent}while(e&&r);return null}},{key:"attached",get:function get(){return this.__attached}},{key:"enabled",get:function get(){return this.__enabled}},{key:"active",get:function get(){return this.__active}},{key:"_isAttached",value:function _isAttached(){return this.__parent?this.__parent.__attached:this.stage.root===this}},{key:"_isEnabled",value:function _isEnabled(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}},{key:"_isActive",value:function _isActive(){return this._isEnabled()&&this.withinBoundsMargin}},{key:"_updateAttachedFlag",value:function _updateAttachedFlag(){var t=this._isAttached();if(this.__attached!==t){this.__attached=t,t&&this._onSetup();var e=this._children.get();if(e){var r=e.length;if(r>0)for(var i=0;i<r;i++)e[i]._updateAttachedFlag()}t?this._onAttach():this._onDetach()}}},{key:"_updateEnabledFlag",value:function _updateEnabledFlag(){var t=this._isEnabled();if(this.__enabled!==t){t?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());var e=this._children.get();if(e){var r=e.length;if(r>0)for(var i=0;i<r;i++)e[i]._updateEnabledFlag()}}}},{key:"_setEnabledFlag",value:function _setEnabledFlag(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}},{key:"_unsetEnabledFlag",value:function _unsetEnabledFlag(){var t=this;this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach(function(e){return _newArrowCheck(this,t),e.removeElement(this.__core)}.bind(this)),this.__enabled=!1}},{key:"_setActiveFlag",value:function _setActiveFlag(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}},{key:"_unsetActiveFlag",value:function _unsetActiveFlag(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}},{key:"_onSetup",value:function _onSetup(){}},{key:"_onAttach",value:function _onAttach(){}},{key:"_onDetach",value:function _onDetach(){}},{key:"_onEnabled",value:function _onEnabled(){}},{key:"_onDisabled",value:function _onDisabled(){}},{key:"_onActive",value:function _onActive(){}},{key:"_onInactive",value:function _onInactive(){}},{key:"_onResize",value:function _onResize(){}},{key:"_getRenderWidth",value:function _getRenderWidth(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}},{key:"_getRenderHeight",value:function _getRenderHeight(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}},{key:"renderWidth",get:function get(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}},{key:"renderHeight",get:function get(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}},{key:"finalX",get:function get(){return this.__core.x}},{key:"finalY",get:function get(){return this.__core.y}},{key:"finalW",get:function get(){return this.__core.w}},{key:"finalH",get:function get(){return this.__core.h}},{key:"textureIsLoaded",value:function textureIsLoaded(){return this.__texture&&this.__texture.isLoaded()}},{key:"loadTexture",value:function loadTexture(){this.__texture&&(this.__texture.load(),this.__texture.isUsed()&&this._isEnabled()||this._updateDimensions())}},{key:"_enableTextureError",value:function _enableTextureError(){var t=this.__texture.loadError;t&&this.emit("txError",t,this.__texture._source)}},{key:"_enableTexture",value:function _enableTexture(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}},{key:"_disableTexture",value:function _disableTexture(){this._setDisplayedTexture(null)}},{key:"texture",get:function get(){return this.__texture},set:function set(t){var e;if(r.isObjectLiteral(t))(e=t.type?new t.type(this.stage):this.texture)&&i.patchObject(e,t);else if(t)if(t.isTexture)e=t;else{if(!t.isTextureSource)return void console.error("[Lightning] Please specify a texture type.");(e=new O(this.stage)).textureSource=t}else e=null;var n=this.__texture;e!==n&&(this.__texture=e,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),n&&n!==this.__displayedTexture&&n.removeElement(this),this._updateDimensions())}},{key:"displayedTexture",get:function get(){return this.__displayedTexture}},{key:"_setDisplayedTexture",value:function _setDisplayedTexture(t){var e=this.__displayedTexture;e&&t!==e&&this.__texture!==e&&e.removeElement(this);var r=this.__core.displayedTextureSource?this.__core.displayedTextureSource._source:null,i=(t?t._source:null)!==r;this.__displayedTexture=t,this._updateDimensions(),this.__displayedTexture?i&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),i&&(this.__displayedTexture?this.emit("txLoaded",this.__displayedTexture):this.emit("txUnloaded",this.__displayedTexture))}},{key:"onTextureSourceLoaded",value:function onTextureSourceLoaded(){this.active&&this._setDisplayedTexture(this.__texture)}},{key:"onTextureSourceLoadError",value:function onTextureSourceLoadError(t){this.emit("txError",t,this.__texture._source)}},{key:"forceRenderUpdate",value:function forceRenderUpdate(){this.__core.setHasRenderUpdates(3)}},{key:"onDisplayedTextureClippingChanged",value:function onDisplayedTextureClippingChanged(){this._updateDimensions(),this._updateTextureCoords()}},{key:"onPrecisionChanged",value:function onPrecisionChanged(){this._updateDimensions()}},{key:"onDimensionsChanged",value:function onDimensionsChanged(t,e){this.texture instanceof L&&(this.texture.w=t,this.texture.h=e,this.w=t,this.h=e)}},{key:"_updateDimensions",value:function _updateDimensions(){var t=this._getRenderWidth(),e=this._getRenderHeight(),r=!1;t&&e||!this.__displayedTexture&&this.__texture&&(t=t||this.__texture.mw,e=e||this.__texture.mh,t&&e||!this.__texture.isAutosizeTexture()||(r=!0)),this.__core.setDimensions(t,e,r)&&this._onResize()}},{key:"_updateTextureCoords",value:function _updateTextureCoords(){if(this.displayedTexture&&this.displayedTexture._source){var t=this.displayedTexture,e=this.displayedTexture._source,r=0,i=0,n=1,s=1;if(t.clipping){var o,u,h,l,f=e.getRenderWidth(),d=e.getRenderHeight();o=1/f,u=1/d,h=t.pw?t.pw*o:(f-t.px)*o,l=t.ph?t.ph*u:(d-t.py)*u,r=o*=t.px,i=u*=t.py,n=n*h+o,s=s*l+u,r=Math.max(0,r),i=Math.max(0,i),n=Math.min(1,n),s=Math.min(1,s)}if(e._flipTextureY){var _=s;s=i,i=_}this.__core.setTextureCoords(r,i,n,s)}}},{key:"getCornerPoints",value:function getCornerPoints(){return this.__core.getCornerPoints()}},{key:"_unsetTagsParent",value:function _unsetTagsParent(){var t=this;this.__tags&&this.__tags.forEach(function(e){_newArrowCheck(this,t);for(var r=this;(r=r.__parent)&&(r.__treeTags.get(e).delete(this),!r.__tagRoot););}.bind(this));var e=null,i=0;if(this.__treeTags&&!this.__tagRoot&&(i=(e=r.iteratorToArray(this.__treeTags.keys())).length)>0)for(var n=0;n<i;n++)for(var s=this.__treeTags.get(e[n]),o=this,u=function _loop(){var t=o.__treeTags.get(e[n]);if(s.forEach((function(e){t.delete(e)})),o.__tagRoot)return"break"};(o=o.__parent)&&"break"!==u(););}},{key:"_setTagsParent",value:function _setTagsParent(){var t=this;this.__tags&&this.__tags.forEach(function(e){_newArrowCheck(this,t);for(var r=this;r=r.__parent;){r.__treeTags||(r.__treeTags=new Map);var i=r.__treeTags.get(e);if(i||(i=new Set,r.__treeTags.set(e,i)),i.add(this),r.__tagRoot)break}}.bind(this)),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach(function(e,r){_newArrowCheck(this,t);for(var i=this,n=function _loop2(){i.__tagRoot,i.__treeTags||(i.__treeTags=new Map);var t=i.__treeTags.get(r);t||(t=new Set,i.__treeTags.set(r,t)),e.forEach((function(e){t.add(e)}))};!i.__tagRoot&&(i=i.__parent);)n()}.bind(this)))}},{key:"_getByTag",value:function _getByTag(t){if(!this.__treeTags)return[];var e=this.__treeTags.get(t);return e?r.setToArray(e):[]}},{key:"getTags",value:function getTags(){return this.__tags?this.__tags:[]}},{key:"setTags",value:function setTags(t){var e=this;t=t.reduce(function(t,r){return _newArrowCheck(this,e),t.concat(r.split(" "))}.bind(this),[]),this.__ref&&t.push(this.__ref);var r,i=t.length,n=[],s=[];for(r=0;r<i;r++)this.hasTag(t[r])||s.push(t[r]);var o=this.tags||[];for(i=o.length,r=0;r<i;r++)-1==t.indexOf(o[r])&&n.push(o[r]);for(r=0;r<n.length;r++)this.removeTag(n[r]);for(r=0;r<s.length;r++)this.addTag(s[r])}},{key:"addTag",value:function addTag(t){if(-1===t.indexOf(" "))r.isUcChar(t.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(t);else for(var e=t.split(" "),i=0,n=e.length;i<n;i++){var s=e[i];r.isUcChar(s.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(s)}}},{key:"_addTag",value:function _addTag(t){if(this.__tags||(this.__tags=[]),-1===this.__tags.indexOf(t)){this.__tags.push(t);var e=this.__parent;if(e)do{e.__treeTags||(e.__treeTags=new Map);var r=e.__treeTags.get(t);r||(r=new Set,e.__treeTags.set(t,r)),r.add(this)}while(!e.__tagRoot&&(e=e.__parent))}}},{key:"removeTag",value:function removeTag(t){var e=this.__tags.indexOf(t);if(-1!==e){this.__tags.splice(e,1);var r=this.__parent;if(r)do{var i=r.__treeTags.get(t);i&&i.delete(this)}while(!r.__tagRoot&&(r=r.__parent))}}},{key:"hasTag",value:function hasTag(t){return this.__tags&&-1!==this.__tags.indexOf(t)}},{key:"_tag",value:function _tag(t){if(-1!==t.indexOf("."))return this.mtag(t)[0];if(this.__treeTags){var e=this.__treeTags.get(t);if(e){var r=e.values().next();return r?r.value:void 0}}}},{key:"tag",get:function get(){return this._tag},set:function set(t){this.tags=t}},{key:"mtag",value:function mtag(t){if(t.indexOf(".")>=0){for(var e=t.split("."),r=this._getByTag(e[0]),i=1,n=e.length;r.length&&i<n;){for(var s=[],o=0,u=r.length;o<u;o++)s=s.concat(r[o]._getByTag(e[i]));r=s,i++}return r}return this._getByTag(t)}},{key:"stag",value:function stag(t,e){for(var r=this.mtag(t),n=r.length,s=0;s<n;s++)i.patchObject(r[s],e)}},{key:"tagRoot",get:function get(){return this.__tagRoot},set:function set(t){this.__tagRoot!==t&&(t?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=t)}},{key:"sel",value:function sel(t){var e=this.select(t);return e.length?e[0]:void 0}},{key:"select",value:function select(t){if(-1!==t.indexOf(",")){for(var e=t.split(","),r=[],i=0;i<e.length;i++)r=r.concat(this._select(e[i]));return r}return this._select(t)}},{key:"_select",value:function _select(t){if(""===t)return[this];var e,r=t.indexOf("."),i=t.indexOf(">");return-1===r&&-1===i?this.mtag(t):(0===i?(e=!0,t=t.substr(1)):0===r?(e=!1,t=t.substr(1)):e=!1,this._selectChilds(t,e))}},{key:"_selectChilds",value:function _selectChilds(t,e){var r=t.indexOf("."),i=t.indexOf(">");if(-1===r&&-1===i){if(e){var n=this.getByRef(t);return n?[n]:[]}return this.mtag(t)}if(-1===i||-1!==r&&r<i){var s,o=t.substr(0,r);if(e){var u=this.getByRef(o);s=u?[u]:[]}else s=this.mtag(o);for(var h=[],l=t.substr(r+1),f=0,d=s.length;f<d;f++)h=h.concat(s[f]._selectChilds(l,!1));return h}var _,g=t.substr(0,i);if(e){var p=this.getByRef(g);_=p?[p]:[]}else _=this.mtag(g);for(var v=[],y=t.substr(i+1),x=0,m=_.length;x<m;x++)v=v.concat(_[x]._selectChilds(y,!0));return v}},{key:"getByRef",value:function getByRef(t){return this.childList.getByRef(t)}},{key:"getLocationString",value:function getLocationString(){var t;t=this.__parent?this.__parent._children.getIndex(this):"R";var e=this.getTags(),r=this.__parent?this.__parent.getLocationString():"";return this.ref?r+=":["+t+"]"+this.ref:e.length?r+=":["+t+"]"+e.join(","):r+=":["+t+"]#"+this.id,r}},{key:"toString",value:function toString(){var t=this.getSettings();return Element.getPrettyString(t,"")}},{key:"getSettings",value:function getSettings(){var t=this,e=this.getNonDefaults(),r=this._children.get();if(r){var i=r.length;if(i){for(var n=[],s=!1,o=0;o<i;o++)n.push(r[o].getSettings()),s=s||!r[o].ref;s?e.children=n:(e.children={},n.forEach(function(r){_newArrowCheck(this,t),e.children[r.ref]=r}.bind(this)))}}return e.id=this.id,e}},{key:"getNonDefaults",value:function getNonDefaults(){var t={};if(this.constructor!==Element&&(t.type=this.constructor.name),this.__ref&&(t.ref=this.__ref),this.__tags&&this.__tags.length&&(t.tags=this.__tags),0!==this.x&&(t.x=this.x),0!==this.y&&(t.y=this.y),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),this.scaleX===this.scaleY?1!==this.scaleX&&(t.scale=this.scaleX):(1!==this.scaleX&&(t.scaleX=this.scaleX),1!==this.scaleY&&(t.scaleY=this.scaleY)),this.pivotX===this.pivotY?.5!==this.pivotX&&(t.pivot=this.pivotX):(.5!==this.pivotX&&(t.pivotX=this.pivotX),.5!==this.pivotY&&(t.pivotY=this.pivotY)),this.mountX===this.mountY?0!==this.mountX&&(t.mount=this.mountX):(0!==this.mountX&&(t.mountX=this.mountX),0!==this.mountY&&(t.mountY=this.mountY)),1!==this.alpha&&(t.alpha=this.alpha),this.visible||(t.visible=!1),0!==this.rotation&&(t.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?4294967295!==this.colorUl&&(t.color=this.colorUl.toString(16)):(4294967295!==this.colorUl&&(t.colorUl=this.colorUl.toString(16)),4294967295!==this.colorUr&&(t.colorUr=this.colorUr.toString(16)),4294967295!==this.colorBl&&(t.colorBl=this.colorBl.toString(16)),4294967295!==this.colorBr&&(t.colorBr=this.colorBr.toString(16))),this.zIndex&&(t.zIndex=this.zIndex),this.forceZIndexContext&&(t.forceZIndexContext=!0),this.clipping&&(t.clipping=this.clipping),this.clipbox||(t.clipbox=this.clipbox),this.__texture){var e=this.__texture.getNonDefaults();Object.keys(e).length&&(t.texture=e)}if(this.shader&&r.isFunction(this.shader.getNonDefaults)){var i=this.shader.getNonDefaults();Object.keys(i).length&&(t.shader=i)}return this._hasTexturizer()&&(this.texturizer.enabled&&(t.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(t.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(t.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(t.renderOffscreen=this.texturizer.renderOffscreen)),t}},{key:"withinBoundsMargin",get:function get(){return this.__core._withinBoundsMargin}},{key:"_enableWithinBoundsMargin",value:function _enableWithinBoundsMargin(){this.__enabled&&this._setActiveFlag()}},{key:"_disableWithinBoundsMargin",value:function _disableWithinBoundsMargin(){this.__active&&this._unsetActiveFlag()}},{key:"boundsMargin",get:function get(){return this.__core.boundsMargin},set:function set(t){if(!Array.isArray(t)&&null!==t)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=t}},{key:"x",get:function get(){return this.__core.offsetX},set:function set(t){this.__core.offsetX=t}},{key:"y",get:function get(){return this.__core.offsetY},set:function set(t){this.__core.offsetY=t}},{key:"w",get:function get(){return this._w},set:function set(t){r.isFunction(t)?(this._w=0,this.__core.funcW=t):(t=Math.max(t,0),this._w!==t&&(this.__core.disableFuncW(),this._w=t,this._updateDimensions()))}},{key:"h",get:function get(){return this._h},set:function set(t){r.isFunction(t)?(this._h=0,this.__core.funcH=t):(t=Math.max(t,0),this._h!==t&&(this.__core.disableFuncH(),this._h=t,this._updateDimensions()))}},{key:"collision",get:function get(){return this._collision},set:function set(t){this._collision=t}},{key:"_updateCollision",value:function _updateCollision(){this.collision&&this.__parent&&void 0===this.__parent.collision&&(this.__parent.collision=2)}},{key:"scaleX",get:function get(){return this.__core.scaleX},set:function set(t){this.__core.scaleX=t}},{key:"scaleY",get:function get(){return this.__core.scaleY},set:function set(t){this.__core.scaleY=t}},{key:"scale",get:function get(){return this.__core.scale},set:function set(t){this.__core.scale=t}},{key:"pivotX",get:function get(){return this.__core.pivotX},set:function set(t){this.__core.pivotX=t}},{key:"pivotY",get:function get(){return this.__core.pivotY},set:function set(t){this.__core.pivotY=t}},{key:"pivot",get:function get(){return this.__core.pivot},set:function set(t){this.__core.pivot=t}},{key:"mountX",get:function get(){return this.__core.mountX},set:function set(t){this.__core.mountX=t}},{key:"mountY",get:function get(){return this.__core.mountY},set:function set(t){this.__core.mountY=t}},{key:"mount",get:function get(){return this.__core.mount},set:function set(t){this.__core.mount=t}},{key:"rotation",get:function get(){return this.__core.rotation},set:function set(t){this.__core.rotation=t}},{key:"alpha",get:function get(){return this.__core.alpha},set:function set(t){this.__core.alpha=t}},{key:"visible",get:function get(){return this.__core.visible},set:function set(t){this.__core.visible=t}},{key:"colorUl",get:function get(){return this.__core.colorUl},set:function set(t){this.__core.colorUl=t}},{key:"colorUr",get:function get(){return this.__core.colorUr},set:function set(t){this.__core.colorUr=t}},{key:"colorBl",get:function get(){return this.__core.colorBl},set:function set(t){this.__core.colorBl=t}},{key:"colorBr",get:function get(){return this.__core.colorBr},set:function set(t){this.__core.colorBr=t}},{key:"color",get:function get(){return this.__core.colorUl},set:function set(t){this.colorUl===t&&this.colorUr===t&&this.colorBl===t&&this.colorBr===t||(this.colorUl=t,this.colorUr=t,this.colorBl=t,this.colorBr=t)}},{key:"colorTop",get:function get(){return this.colorUl},set:function set(t){this.colorUl===t&&this.colorUr===t||(this.colorUl=t,this.colorUr=t)}},{key:"colorBottom",get:function get(){return this.colorBl},set:function set(t){this.colorBl===t&&this.colorBr===t||(this.colorBl=t,this.colorBr=t)}},{key:"colorLeft",get:function get(){return this.colorUl},set:function set(t){this.colorUl===t&&this.colorBl===t||(this.colorUl=t,this.colorBl=t)}},{key:"colorRight",get:function get(){return this.colorUr},set:function set(t){this.colorUr===t&&this.colorBr===t||(this.colorUr=t,this.colorBr=t)}},{key:"zIndex",get:function get(){return this.__core.zIndex},set:function set(t){this.__core.zIndex=t}},{key:"forceZIndexContext",get:function get(){return this.__core.forceZIndexContext},set:function set(t){this.__core.forceZIndexContext=t}},{key:"clipping",get:function get(){return this.__core.clipping},set:function set(t){this.__core.clipping=t}},{key:"clipbox",get:function get(){return this.__core.clipbox},set:function set(t){this.__core.clipbox=t}},{key:"tags",get:function get(){return this.getTags()},set:function set(t){Array.isArray(t)||(t=[t]),this.setTags(t)}},{key:"t",set:function set(t){this.tags=t}},{key:"_children",get:function get(){return this.__childList||(this.__childList=new z(this,!1)),this.__childList}},{key:"childList",get:function get(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}},{key:"hasChildren",value:function hasChildren(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}},{key:"_allowChildrenAccess",value:function _allowChildrenAccess(){return!0}},{key:"children",get:function get(){return this.childList.get()},set:function set(t){this.childList.patch(t)}},{key:"add",value:function add(t){return this.childList.a(t)}},{key:"p",get:function get(){return this.__parent}},{key:"parent",get:function get(){return this.__parent}},{key:"src",get:function get(){return this.texture&&this.texture instanceof A?this.texture._src:void 0},set:function set(t){var e=new A(this.stage);e.src=t,this.texture=e}},{key:"mw",set:function set(t){this.texture?(this.texture.mw=t,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}},{key:"mh",set:function set(t){this.texture?(this.texture.mh=t,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}},{key:"rect",get:function get(){return this.texture===this.stage.rectangleTexture},set:function set(t){this.texture=t?this.stage.rectangleTexture:null}},{key:"enableTextTexture",value:function enableTextTexture(){return this.texture&&this.texture instanceof L||(this.texture=new L(this.stage),this.texture.w||this.texture.h||(this.texture.w=this.w,this.texture.h=this.h)),this.texture}},{key:"text",get:function get(){return this.texture&&this.texture instanceof L?this.texture:null},set:function set(t){this.texture&&this.texture instanceof L||this.enableTextTexture(),r.isString(t)?this.texture.text=t:this.texture.patch(t)}},{key:"onUpdate",set:function set(t){this.__core.onUpdate=t}},{key:"onAfterCalcs",set:function set(t){this.__core.onAfterCalcs=t}},{key:"onAfterUpdate",set:function set(t){this.__core.onAfterUpdate=t}},{key:"forceUpdate",value:function forceUpdate(){this.__core._setHasUpdates()}},{key:"shader",get:function get(){return this.__core.shader},set:function set(t){if(r.isObjectLiteral(t)&&!t.type)this.shader&&this.shader.patch(t);else{var e=C.create(this.stage,t);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=e,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}},{key:"_hasTexturizer",value:function _hasTexturizer(){return!!this.__core._texturizer}},{key:"renderToTexture",get:function get(){return this.rtt},set:function set(t){this.rtt=t}},{key:"rtt",get:function get(){return this._hasTexturizer()&&this.texturizer.enabled},set:function set(t){this.texturizer.enabled=t}},{key:"rttLazy",get:function get(){return this._hasTexturizer()&&this.texturizer.lazy},set:function set(t){this.texturizer.lazy=t}},{key:"renderOffscreen",get:function get(){return this._hasTexturizer()&&this.texturizer.renderOffscreen},set:function set(t){this.texturizer.renderOffscreen=t}},{key:"colorizeResultTexture",get:function get(){return this._hasTexturizer()&&this.texturizer.colorize},set:function set(t){this.texturizer.colorize=t}},{key:"getTexture",value:function getTexture(){return this.texturizer._getTextureSource()}},{key:"texturizer",get:function get(){return this.__core.texturizer}},{key:"patch",value:function patch(t){for(var e=Object.keys(t),n=0,s=e.length;n<s;n++){var o=e[n],u=t[o],h=o.charCodeAt(0);if(r.isUcChar(h)){var l=this.getByRef(o);if(l)void 0===u?l.parent&&l.parent.childList.remove(l):r.isObjectLiteral(u)?l.patch(u):u.isElement?(u.ref=o,this.childList.replace(u,l)):this._throwError("Unexpected value for path: "+o);else if(void 0!==u){var f=void 0;r.isObjectLiteral(u)?(f=this.childList.createItem(u)).patch(u):r.isObject(u)&&(f=u),f.isElement&&(f.ref=o),this.childList.a(f)}}else i.patchObjectProperty(this,o,u)}}},{key:"_throwError",value:function _throwError(t){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+t)}},{key:"animation",value:function animation(t){return this.stage.animations.createAnimation(this,t)}},{key:"transition",value:function transition(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e?this._getTransition(t):(this._setTransition(t,e),null)}},{key:"transitions",set:function set(t){var e=this;Object.keys(t).forEach(function(r){_newArrowCheck(this,e),this.transition(r,t[r])}.bind(this))}},{key:"smooth",set:function set(t){var e=this;Object.keys(t).forEach(function(r){_newArrowCheck(this,e);var i=t[r];Array.isArray(i)?this.setSmooth(r,i[0],i[1]):this.setSmooth(r,i)}.bind(this))}},{key:"fastForward",value:function fastForward(t){if(this._transitions){var e=this._transitions[t];e&&e.isTransition&&e.finish()}}},{key:"_getTransition",value:function _getTransition(t){this._transitions||(this._transitions={});var e=this._transitions[t];return e?e.isTransitionSettings&&(e=new P(this.stage.transitions,e,this,t)):e=new P(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,t),this._transitions[t]=e,e}},{key:"_setTransition",value:function _setTransition(t,e){if(e){r.isObjectLiteral(e)&&(e=this.stage.transitions.createSettings(e)),this._transitions||(this._transitions={});var i=this._transitions[t];if(i&&i.isTransition)return i.settings=e,i;this._transitions[t]=e}else this._removeTransition(t)}},{key:"_removeTransition",value:function _removeTransition(t){this._transitions&&delete this._transitions[t]}},{key:"getSmooth",value:function getSmooth(t,e){var r=this._getTransition(t);return r&&r.isAttached()?r.targetValue:e}},{key:"setSmooth",value:function setSmooth(t,e,r){r&&this._setTransition(t,r);var i=this._getTransition(t);return i.start(e),i}},{key:"flex",get:function get(){return this.__core.flex},set:function set(t){this.__core.flex=t}},{key:"flexItem",get:function get(){return this.__core.flexItem},set:function set(t){this.__core.flexItem=t}},{key:"toJSON",value:function toJSON(){var t=["".concat(this.constructor.name)],e={};return e[t]={},this.hasChildren()?Element.collectChildren(e[t],this.__childList):e[t]=_objectSpread2({},Element.getProperties(this)),e}}],[{key:"getPrettyString",value:function getPrettyString(t,e){var i=t.children;delete t.children;var n=["color","colorUl","colorUr","colorBl","colorBr"],s=JSON.stringify(t,(function(t,e){return-1!==n.indexOf(t)?"COLOR["+e.toString(16)+"]":e}));if(s=s.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),i){var o="";if(r.isObjectLiteral(i)){var u=Object.keys(i);o="";for(var h=0,l=u.length;h<l;h++)o+="\n".concat(e,'  "').concat(u[h],'":'),delete i[u[h]].ref,o+=Element.getPrettyString(i[u[h]],e+"  ")+(h<l-1?",":"");var f="{}"===s;s=s.substr(0,s.length-1)+(f?"":",")+o+"\n"+e+"}"}else{var d=i.length;o="[";for(var _=0;_<d;_++)o+=Element.getPrettyString(i[_],e+"  ")+(_<d-1?",":"")+"\n";o+=e+"]}";var g="{}"===s;s=s.substr(0,s.length-1)+(g?"":",")+'"children":\n'+e+o+"}"}}return s}},{key:"getGetter",value:function getGetter(t){var e=Element.PROP_GETTERS.get(t);return e||(e=new Function("obj","return obj."+t),Element.PROP_GETTERS.set(t,e)),e}},{key:"getSetter",value:function getSetter(t){var e=Element.PROP_SETTERS.get(t);return e||(e=new Function("obj","v","obj."+t+" = v"),Element.PROP_SETTERS.set(t,e)),e}},{key:"isColorProperty",value:function isColorProperty(t){return t.toLowerCase().indexOf("color")>=0}},{key:"getMerger",value:function getMerger(t){return Element.isColorProperty(t)?e.mergeColors:e.mergeNumbers}},{key:"collectChildren",value:function collectChildren(t,e){for(var r=e,i=0,n=r.length;i<n;i++){var s=r.getAt(i),o="".concat(s.__ref||"Element-".concat(s.id)),u=this.getProperties(s);t[o]=_objectSpread2({},u),s.hasChildren()&&(t[o].children={},this.collectChildren(t[o].children,s.__childList))}}},{key:"getProperties",value:function getProperties(t){for(var e={},r=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOfScreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"],i=r.length;i--;){var n=r[i],s=/\(\)$/;/^!{2}/.test(n)?e[n=n.substring(2,n.length)]=!!t[n]:s.test(n)?"function"==typeof t[n=n.substring(0,n.length-2)]&&(e[n]=t[n]()):e[n]=t[n]}return _objectSpread2(_objectSpread2({},e),t.getNonDefaults())}}]),Element}();T.addAsMixin(U),U.prototype.isElement=1,U.id=1,U.PROP_GETTERS=new Map,U.PROP_SETTERS=new Map;var B=function(){function StateMachine(){_classCallCheck(this,StateMachine),StateMachine.setupStateMachine(this)}return _createClass(StateMachine,[{key:"fire",value:function fire(t){if(this._hasMethod(t)){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this[t].apply(this,r)}}},{key:"_getState",value:function _getState(){return this._state.__path}},{key:"_inState",value:function _inState(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._state.__path,r=this._sm.getStateByPath(t),i=this._sm.getStateByPath(e),n=r.__level;return StateMachine._getStateAtLevel(i,n)===r}},{key:"_hasMember",value:function _hasMember(t){return!!this.constructor.prototype[t]}},{key:"_hasMethod",value:function _hasMethod(t){var e=this.constructor.prototype[t];return!!e&&"function"==typeof e}},{key:"_setState",value:function _setState(t,e){var r=++this._setStateCounter;if(this._setStateId=r,this._state.__path!==t){var i=this._sm._stateMap[t];i||(i=this._sm.getStateByPath(t));var n=this._state,s=i.prototype.$enter!==this._state.prototype.$enter,o=i.prototype.$exit!==this._state.prototype.$exit;if(s||o){var u=StateMachine._getSharedState(this._state,i),h={newState:i.__path,prevState:n.__path,sharedState:u.__path},l=u.__level;if(o)for(var f=StateMachine._getStatesUntilLevel(this._state,l),d=0,_=f.length;d<_;d++)if(this.__setState(f[d]),this._callExit(this._state,e,h),this._setStateId!==r)return;if(s)for(var g=StateMachine._getStatesUntilLevel(i,l).reverse(),p=0,v=g.length;p<v;p++)if(this.__setState(g[p]),this._callEnter(this._state,e,h),this._setStateId!==r)return}if(this.__setState(i),this._changedState){var y={newState:i.__path,prevState:n.__path};e?this._changedState.apply(this,[y].concat(_toConsumableArray(e))):this._changedState(y)}if(this._onStateChange){var x={newState:i.__path,prevState:n.__path};this._onStateChange(x)}}}},{key:"_callEnter",value:function _callEnter(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=!!t.__parent;t.prototype.$enter&&(i&&t.__parent.prototype.$enter===t.prototype.$enter||t.prototype.$enter.apply(this,[r].concat(_toConsumableArray(e))))}},{key:"_callExit",value:function _callExit(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=!!t.__parent;t.prototype.$exit&&(i&&t.__parent.prototype.$exit===t.prototype.$exit||t.prototype.$exit.apply(this,[r].concat(_toConsumableArray(e))))}},{key:"__setState",value:function __setState(t){this._state=t,this._stateIndex=t.__index,this.constructor=t}},{key:"_initStateMachine",value:function _initStateMachine(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));var t={newState:"",prevState:void 0,sharedState:void 0};this._callEnter(this._state,[],t),this._onStateChange=void 0}},{key:"_getMostSpecificHandledMember",value:function _getMostSpecificHandledMember(t){var e=this._state;do{for(var r=0,i=t.length;r<i;r++){var n=t[r];if(e.__parent){if(this[D.getStateMemberAlias(e.__path,n)])return n}else if(e.prototype[n])return n}e=e.__parent}while(e)}}],[{key:"setupStateMachine",value:function setupStateMachine(t){var e=t.constructor,r=StateMachine.create(e);Object.setPrototypeOf(t,r.prototype),t.constructor=e,t._initStateMachine()}},{key:"create",value:function create(t){if(!t.hasOwnProperty("_sm")){var e=new D(t);t._sm=e}return t._sm.router}},{key:"_getStatesUntilLevel",value:function _getStatesUntilLevel(t,e){for(var r=[];t.__level>e;)r.push(t),t=t.__parent;return r}},{key:"_getSharedState",value:function _getSharedState(t,e){for(var r=StateMachine._getAncestorStates(t),i=StateMachine._getAncestorStates(e),n=Math.min(r.length,i.length),s=0;s<n;s++)if(r[s]!==i[s])return r[s-1];return r[n-1]}},{key:"_getAncestorStates",value:function _getAncestorStates(t){var e=[];do{e.push(t)}while(t=t.__parent);return e.reverse()}},{key:"_getStateAtLevel",value:function _getStateAtLevel(t,e){if(!(e>t.__level)){for(;e<t.__level;)t=t.__parent;return t}}}]),StateMachine}(),D=function(){function StateMachineType(t){_classCallCheck(this,StateMachineType),this._type=t,this._router=null,this.init()}return _createClass(StateMachineType,[{key:"router",get:function get(){return this._router}},{key:"init",value:function init(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}},{key:"_createRouter",value:function _createRouter(){var t=this._type,e=function(e){_inherits(StateMachineRouter,e);var r=_createSuper(StateMachineRouter);function StateMachineRouter(){var e;if(_classCallCheck(this,StateMachineRouter),!(e=r.apply(this,arguments)).constructor.hasOwnProperty("_isRouter"))throw new Error("You need to extend ".concat(t.name,".original instead of ").concat(t.name,"."));return e}return StateMachineRouter}(t);return e._isRouter=!0,e.prototype._routedType=t,e.original=t,this._mixinStateMachineMethods(e),e}},{key:"_mixinStateMachineMethods",value:function _mixinStateMachineMethods(t){for(var e=Object.getOwnPropertyNames(B.prototype),r=0,i=e.length;r<i;r++){var n=e[r];if("constructor"!==n){var s=Object.getOwnPropertyDescriptor(B.prototype,n);Object.defineProperty(t.prototype,n,s)}}}},{key:"_addStateMemberDelegatorsToRouter",value:function _addStateMemberDelegatorsToRouter(){var t=this;this._getAllMemberNames().forEach(function(e){_newArrowCheck(this,t),this._addMemberRouter(e)}.bind(this))}},{key:"_addMemberRouter",value:function _addMemberRouter(t){var e=this,r=Object.keys(this._stateMap),i=[],n=[];r.forEach(function(r,s){_newArrowCheck(this,e);var o=this._stateMap[r],u=this._getDescriptor(o,t);if(u){i[s]=u;var h=StateMachineType.getStateMemberAlias(u._source.__path,t);n[s]=h,this._router.prototype.hasOwnProperty(h)||Object.defineProperty(this._router.prototype,h,u)}else i[s]=null,n[s]=null}.bind(this));var s=void 0;switch(i.forEach(function(r){if(_newArrowCheck(this,e),r){var i=this._getDescriptorType(r);if(s&&s!==i)return void console.warn("[Lightning] Member ".concat(t," in ").concat(this._type.name," has inconsistent types."));s=i}}.bind(this)),s){case"method":this._addMethodRouter(t,i,n);break;case"getter":this._addGetterSetterRouters(t);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!")}}},{key:"_getDescriptor",value:function _getDescriptor(t,e){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return _newArrowCheck(this,r),!0}.bind(this),n=t,s=t;do{var o=Object.getOwnPropertyDescriptor(n.prototype,e);if(o&&i(o))return o._source=s,o;(n=Object.getPrototypeOf(n))&&n.hasOwnProperty("__state")&&(s=n)}while(n&&n.prototype)}},{key:"_getDescriptorType",value:function _getDescriptorType(t){return t.get||t.set?"getter":"function"==typeof t.value?"method":"property"}},{key:"_addMethodRouter",value:function _addMethodRouter(t,e,r){for(var i=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],n=r[0],s=StateMachineType._supportsSpread(),o=1,u=r.length;o<u;o++){var h=r[o];h!==n&&(n?s?i.push("if (i < ".concat(o,') return this["').concat(n,'"](...arguments); else')):i.push("if (i < ".concat(o,') return this["').concat(n,'"].apply(this, arguments); else')):i.push("if (i < ".concat(o,") return ; else"))),n=h}n?s?i.push('return this["'.concat(n,'"](...arguments);')):i.push('return this["'.concat(n,'"].apply(this, arguments);')):i.push(";");var l=i.join("\n"),f={value:new Function([],l)};Object.defineProperty(this._router.prototype,t,f)}},{key:"_addGetterSetterRouters",value:function _addGetterSetterRouters(t){var e={get:this._getGetterRouter(t),set:this._getSetterRouter(t)};Object.defineProperty(this._router.prototype,t,e)}},{key:"_getGetterRouter",value:function _getGetterRouter(t){var e=this,r=Object.keys(this._stateMap),i=[],n=[];r.forEach(function(r,s){var o=this;_newArrowCheck(this,e);var u=this._stateMap[r],h=this._getDescriptor(u,t,function(t){return _newArrowCheck(this,o),t.get}.bind(this));if(h){i[s]=h;var l=StateMachineType.getStateMemberAlias(h._source.__path,t);n[s]=l,this._router.prototype.hasOwnProperty(l)||Object.defineProperty(this._router.prototype,l,h)}else i[s]=null,n[s]=null}.bind(this));for(var s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],o=n[0],u=1,h=n.length;u<h;u++){var l=n[u];l!==o&&(o?s.push("if (i < ".concat(u,') return this["').concat(o,'"]; else')):s.push("if (i < ".concat(u,") return ; else"))),o=l}o?s.push('return this["'.concat(o,'"];')):s.push(";");var f=s.join("\n");return new Function([],f)}},{key:"_getSetterRouter",value:function _getSetterRouter(t){var e=this,r=Object.keys(this._stateMap),i=[],n=[];r.forEach(function(r,s){var o=this;_newArrowCheck(this,e);var u=this._stateMap[r],h=this._getDescriptor(u,t,function(t){return _newArrowCheck(this,o),t.set}.bind(this));if(h){i[s]=h;var l=StateMachineType.getStateMemberAlias(h._source.__path,t);n[s]=l,this._router.prototype.hasOwnProperty(l)||Object.defineProperty(this._router.prototype,l,h)}else i[s]=null,n[s]=null}.bind(this));for(var s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"],o=n[0],u=1,h=n.length;u<h;u++){var l=n[u];l!==o&&(o?s.push("if (i < ".concat(u,') this["').concat(o,'"] = arg; else')):s.push("if (i < ".concat(u,") ; else"))),o=l}o?s.push('this["'.concat(o,'"] = arg;')):s.push(";");var f=s.join("\n");return new Function(["arg"],f)}},{key:"_getAllMemberNames",value:function _getAllMemberNames(){var t=this,e=this._stateMap,r=Object.keys(e),i=new Set;return r.forEach(function(r){var n=this;if(_newArrowCheck(this,t),""!==r){var s=e[r];this._getStateMemberNames(s).forEach(function(t){_newArrowCheck(this,n),i.add(t)}.bind(this))}}.bind(this)),_toConsumableArray(i)}},{key:"_getStateMemberNames",value:function _getStateMemberNames(t){var e=this,r=t,i=new Set,n=this._type===t;do{this._getStateMemberNamesForType(r).forEach(function(t){_newArrowCheck(this,e),i.add(t)}.bind(this)),r=Object.getPrototypeOf(r)}while(r&&r.prototype&&(!r.hasOwnProperty("__state")||n));return i}},{key:"_getStateMemberNamesForType",value:function _getStateMemberNamesForType(t){var e=this;return Object.getOwnPropertyNames(t.prototype).filter(function(t){return _newArrowCheck(this,e),"constructor"!==t&&!StateMachineType._isStateLocalMember(t)}.bind(this))}},{key:"getStateByPath",value:function getStateByPath(t){if(this._stateMap[t])return this._stateMap[t];for(var e=t.split(".");e.pop();){var r=e.join(".");if(this._stateMap[r])return this._stateMap[r]}}},{key:"_getStateMap",value:function _getStateMap(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}},{key:"_createStateMap",value:function _createStateMap(){var t={};return this._addState(this._type,null,"",t),t}},{key:"_addState",value:function _addState(t,e,r,i){var n=this;t.__state=!0,t.__name=r,this._addStaticStateProperty(t,e);var s=e?e.__path:"",o=(s?s+".":"")+r;t.__path=o,t.__level=e?e.__level+1:0,t.__parent=e,t.__index=Object.keys(i).length,i[o]=t;var u=t._states;u&&(e&&e._states===u||t._states().forEach(function(e){_newArrowCheck(this,n);var r=StateMachineType._getStateName(e);this._addState(e,t,r,i)}.bind(this)))}},{key:"_addStaticStateProperty",value:function _addStaticStateProperty(t,e){e&&(e&&!e.__parent?this._router[t.__name]=t:e[t.__name]=t)}}],[{key:"_supportsSpread",value:function _supportsSpread(){if(void 0===this.__supportsSpread){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch(t){}}return this.__supportsSpread}},{key:"getStateMemberAlias",value:function getStateMemberAlias(t,e){return"$"+(t?t+".":"")+e}},{key:"_isStateLocalMember",value:function _isStateLocalMember(t){return"$enter"===t||"$exit"===t}},{key:"_getStateName",value:function _getStateName(t){var e=t.name,r=e.indexOf("$");return r>0?e.substr(0,r):e}}]),StateMachineType}(),j=function(t){_inherits(Component,t);var e=_createSuper(Component);function Component(t,i){var n;_classCallCheck(this,Component),(n=e.call(this,t)).tagRoot=!0,r.isObjectLiteral(i)&&Object.assign(_assertThisInitialized(n),i),n.__initialized=!1,n.__firstActive=!1,n.__firstEnable=!1,n.__signals=void 0,n.__passSignals=void 0,n.__construct();var s=n.constructor.getTemplateFunc(_assertThisInitialized(n));return s.f(_assertThisInitialized(n),s.a),n._build(),n}return _createClass(Component,[{key:"__start",value:function __start(){B.setupStateMachine(this),this._onStateChange=Component.prototype.__onStateChange}},{key:"state",get:function get(){return this._getState()}},{key:"__onStateChange",value:function __onStateChange(){this.application&&this.application.updateFocusPath()}},{key:"_refocus",value:function _refocus(){this.application&&this.application.updateFocusPath()}},{key:"__bindProperty",value:function __bindProperty(t,e,r){for(var i=this,n=e,s=r,o=Array.isArray(t.__name)?t.__name:[t.__name],u=function _loop(e){var r=this,u=o[e],h=t.__func?t.__func:function(t){return _newArrowCheck(this,r),t[u]}.bind(this);i.hasOwnProperty(u)?i["__prop_bindings_".concat(u)].push({__obj:n,__prop:s,__func:h}):(i["__prop_bindings_".concat(u)]=[{__obj:n,__prop:s,__func:h}],Object.defineProperty(i,u,{set:function set(t){_newArrowCheck(this,r),i["__prop_".concat(u)]=t;var e,n=_createForOfIteratorHelper(i["__prop_bindings_".concat(u)]);try{for(n.s();!(e=n.n()).done;){var s=e.value,o=s.__obj,h=s.__prop,l=s.__func;o[h]=l(i)}}catch(t){n.e(t)}finally{n.f()}}.bind(this),get:function get(){return _newArrowCheck(this,r),i["__prop_".concat(u)]}.bind(this)}))},h=0;h<o.length;h++)u(h)}},{key:"_onSetup",value:function _onSetup(){this.__initialized||this._setup()}},{key:"_setup",value:function _setup(){}},{key:"_onAttach",value:function _onAttach(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}},{key:"_attach",value:function _attach(){}},{key:"_onDetach",value:function _onDetach(){this._detach()}},{key:"_detach",value:function _detach(){}},{key:"_onEnabled",value:function _onEnabled(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}},{key:"_firstEnable",value:function _firstEnable(){}},{key:"_enable",value:function _enable(){}},{key:"_onDisabled",value:function _onDisabled(){this._disable()}},{key:"_disable",value:function _disable(){}},{key:"_onActive",value:function _onActive(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}},{key:"_firstActive",value:function _firstActive(){}},{key:"_active",value:function _active(){}},{key:"_onInactive",value:function _onInactive(){this._inactive()}},{key:"_inactive",value:function _inactive(){}},{key:"application",get:function get(){return this.stage.application}},{key:"__construct",value:function __construct(){this._construct()}},{key:"_construct",value:function _construct(){}},{key:"_build",value:function _build(){}},{key:"__init",value:function __init(){this._init()}},{key:"_init",value:function _init(){}},{key:"_focus",value:function _focus(t,e){}},{key:"_unfocus",value:function _unfocus(t){}},{key:"_focusChange",value:function _focusChange(t,e){}},{key:"_getFocused",value:function _getFocused(){return this}},{key:"_setFocusSettings",value:function _setFocusSettings(t){}},{key:"_handleFocusSettings",value:function _handleFocusSettings(t){}},{key:"hasFinalFocus",value:function hasFinalFocus(){var t=this.application._focusPath;return t&&t.length&&t[t.length-1]===this}},{key:"hasFocus",value:function hasFocus(){var t=this.application._focusPath;return t&&t.indexOf(this)>=0}},{key:"cparent",get:function get(){return Component.getParent(this)}},{key:"seekAncestorByType",value:function seekAncestorByType(t){for(var e=this.cparent;e;){if(e.constructor===t)return e;e=e.cparent}}},{key:"getSharedAncestorComponent",value:function getSharedAncestorComponent(t){for(var e=this.getSharedAncestor(t);e&&!e.isComponent;)e=e.parent;return e}},{key:"signals",get:function get(){return this.__signals},set:function set(t){r.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=t}},{key:"alterSignals",set:function set(t){for(var e in r.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={}),t)void 0===t[e]?delete this.__signals[e]:this.__signals[e]=t}},{key:"passSignals",get:function get(){return this.__passSignals||{}},set:function set(t){this.__passSignals=Object.assign(this.__passSignals||{},t)}},{key:"alterPassSignals",set:function set(t){for(var e in r.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={}),t)void 0===t[e]?delete this.__passSignals[e]:this.__passSignals[e]=t}},{key:"signal",value:function signal(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this._signal(t,r)}},{key:"_signal",value:function _signal(t,e){var i=this._getParentSignalHandler();if(i){if(this.__signals){var n=this.__signals[t];if(!1===n)return;if(n){if(!0===n&&(n=t),r.isFunction(n))return n.apply(void 0,_toConsumableArray(e));if(i._hasMethod(n))return i[n].apply(i,_toConsumableArray(e))}}var s=this.__passSignals&&this.__passSignals[t];if(s)return s&&!0!==s&&(t=s),i._signal(t,e)}}},{key:"_getParentSignalHandler",value:function _getParentSignalHandler(){return this.cparent?this.cparent._getSignalHandler():null}},{key:"_getSignalHandler",value:function _getSignalHandler(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}},{key:"_signalProxy",get:function get(){return!1}},{key:"fireAncestors",value:function fireAncestors(t){if(!t.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");var e=this._getParentSignalHandler();if(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return e._doFireAncestors(t,i)}}},{key:"_doFireAncestors",value:function _doFireAncestors(t,e){if(this._hasMethod(t))return this.fire.apply(this,[t].concat(_toConsumableArray(e)));var r=this._getParentSignalHandler();return r?r._doFireAncestors(t,e):void 0}}],[{key:"bindProp",value:function bindProp(t){return{__propertyBinding:!0,__name:t,__func:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null}}},{key:"getTemplateFunc",value:function getTemplateFunc(t){var e="_templateFunc",r="__has"+e;return this[r]!==this&&(this[r]=this,this[e]=this.parseTemplate(this._template(t))),this[e]}},{key:"parseTemplate",value:function parseTemplate(t){var e={loc:[],store:[],rid:0};this.parseTemplateRec(t,e,"element");var r=e.loc.join(";\n");return{f:new Function("element","store",r),a:e.store}}},{key:"parseTemplateRec",value:function parseTemplateRec(t,e,i){var n=this,s=e.store,o=e.loc;Object.keys(t).forEach(function(u){_newArrowCheck(this,n);var h=t[u];if(r.isUcChar(u.charCodeAt(0)))if(r.isObjectLiteral(h)){var l="r".concat(u.replace(/[^a-z0-9]/gi,"")+e.rid),f=h.type?h.type:U;f===U?o.push("var ".concat(l," = element.stage.createElement()")):(s.push(f),o.push("var ".concat(l," = new store[").concat(s.length-1,"](").concat(i,".stage)"))),o.push("".concat(l,'.ref = "').concat(u,'"')),e.rid++,this.parseTemplateRec(h,e,l),o.push("".concat(i,".childList.add(").concat(l,")"))}else r.isObject(h)&&(s.push(h),o.push("".concat(i,".childList.add(store[").concat(s.length-1,"])")));else if("text"===u){var d=i+"__text";o.push("var ".concat(d," = ").concat(i,".enableTextTexture()")),!0===h.__propertyBinding?(s.push(h),o.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(u,'")'))):this.parseTemplatePropRec(h,e,d)}else if("shader"===u&&r.isObjectLiteral(h)){var _="".concat(i,'["shader"]');s.push(h),o.push("".concat(i,'["').concat(u,'"] = store[').concat(s.length-1,"]")),this.parsePropertyBindings(h,e,_)}else if("texture"===u&&r.isObjectLiteral(h)){var g=i+"__texture",p=h.type;p?(s.push(p),o.push("var ".concat(g," = new store[").concat(s.length-1,"](").concat(i,".stage)")),this.parseTemplatePropRec(h,e,g),o.push("".concat(i,'["').concat(u,'"] = ').concat(g))):(o.push("".concat(g," = ").concat(i,".texture")),this.parseTemplatePropRec(h,e,g))}else r.isObjectLiteral(h)&&!0===h.__propertyBinding?(s.push(h),o.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(u,'")'))):r.isNumber(h)?o.push("".concat(i,'["').concat(u,'"] = ').concat(h)):r.isBoolean(h)?o.push("".concat(i,'["').concat(u,'"] = ').concat(h?"true":"false")):r.isObject(h)||Array.isArray(h)?(s.push(h),o.push("".concat(i,'["').concat(u,'"] = store[').concat(s.length-1,"]"))):o.push("".concat(i,'["').concat(u,'"] = ').concat(JSON.stringify(h)))}.bind(this))}},{key:"parseTemplatePropRec",value:function parseTemplatePropRec(t,e,i){var n=this,s=e.store,o=e.loc;Object.keys(t).forEach(function(e){if(_newArrowCheck(this,n),"type"!==e){var u=t[e];r.isNumber(u)?o.push("".concat(i,'["').concat(e,'"] = ').concat(u)):r.isBoolean(u)?o.push("".concat(i,'["').concat(e,'"] = ').concat(u?"true":"false")):r.isObject(u)&&!0===u.__propertyBinding?(s.push(u),o.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(e,'")'))):r.isObject(u)||Array.isArray(u)?(s.push(u),o.push("".concat(i,'["').concat(e,'"] = store[').concat(s.length-1,"]"))):o.push("".concat(i,'["').concat(e,'"] = ').concat(JSON.stringify(u)))}}.bind(this))}},{key:"parsePropertyBindings",value:function parsePropertyBindings(t,e,i){var n=this,s=e.store,o=e.loc;Object.keys(t).forEach(function(e){if(_newArrowCheck(this,n),"type"!==e){var u=t[e];r.isObjectLiteral(u)&&!0===u.__propertyBinding&&(s.push(u),o.push("element.__bindProperty(store[".concat(s.length-1,"], ").concat(i,', "').concat(e,'")')))}}.bind(this))}},{key:"_template",value:function _template(){return{}}},{key:"collectSubComponents",value:function collectSubComponents(t,e){if(e.hasChildren())for(var r=e.__childList,i=0,n=r.length;i<n;i++){var s=r.getAt(i);s.isComponent?t.push(s):Component.collectSubComponents(t,s)}}},{key:"getComponent",value:function getComponent(t){for(var e=t;e&&!e.isComponent;)e=e.parent;return e}},{key:"getParent",value:function getParent(t){return Component.getComponent(t.parent)}}]),Component}(U);j.prototype.isComponent=!0;var N=function(){function CoreQuadList(t){_classCallCheck(this,CoreQuadList),this.ctx=t,this.quadTextures=[],this.quadElements=[]}return _createClass(CoreQuadList,[{key:"length",get:function get(){return this.quadTextures.length}},{key:"reset",value:function reset(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}},{key:"getElement",value:function getElement(t){return this.quadElements[t]._element}},{key:"getElementCore",value:function getElementCore(t){return this.quadElements[t]}},{key:"getTexture",value:function getTexture(t){return this.quadTextures[t]}},{key:"getTextureWidth",value:function getTextureWidth(t){var e=this.quadTextures[t];return e.w?e.w:this.quadElements[t]._displayedTextureSource.w}},{key:"getTextureHeight",value:function getTextureHeight(t){var e=this.quadTextures[t];return e.h?e.h:this.quadElements[t]._displayedTextureSource.h}}]),CoreQuadList}(),W=function(t){_inherits(WebGLCoreQuadList,t);var e=_createSuper(WebGLCoreQuadList);function WebGLCoreQuadList(t){var r;_classCallCheck(this,WebGLCoreQuadList),r=e.call(this,t);var i=t.stage.getOption("bufferMemory");return r.dataLength=0,r.data=new ArrayBuffer(i),r.floats=new Float32Array(r.data),r.uints=new Uint32Array(r.data),r}return _createClass(WebGLCoreQuadList,[{key:"getAttribsDataByteOffset",value:function getAttribsDataByteOffset(t){return 80*t}},{key:"getQuadContents",value:function getQuadContents(){for(var t=this.floats,e=this.uints,r=[],i=1;i<=this.length;i++){for(var n="entry "+i+": ",s=0;s<4;s++){var o=20*i+4*s;n+=t[o]+","+t[o+1]+":"+t[o+2]+","+t[o+3]+"["+e[o+4].toString(16)+"] "}r.push(n)}return r}}]),WebGLCoreQuadList}(N),H=function(){function CoreQuadOperation(t,e,r,i,n,s){_classCallCheck(this,CoreQuadOperation),this.ctx=t,this.shader=e,this.shaderOwner=r,this.renderTextureInfo=i,this.scissor=n,this.index=s,this.length=0}return _createClass(CoreQuadOperation,[{key:"quads",get:function get(){return this.ctx.renderState.quads}},{key:"getTexture",value:function getTexture(t){return this.quads.getTexture(this.index+t)}},{key:"getElementCore",value:function getElementCore(t){return this.quads.getElementCore(this.index+t)}},{key:"getElement",value:function getElement(t){return this.quads.getElement(this.index+t)}},{key:"getElementWidth",value:function getElementWidth(t){return this.getElement(t).renderWidth}},{key:"getElementHeight",value:function getElementHeight(t){return this.getElement(t).renderHeight}},{key:"getTextureWidth",value:function getTextureWidth(t){return this.quads.getTextureWidth(this.index+t)}},{key:"getTextureHeight",value:function getTextureHeight(t){return this.quads.getTextureHeight(this.index+t)}},{key:"getRenderWidth",value:function getRenderWidth(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}},{key:"getRenderHeight",value:function getRenderHeight(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}]),CoreQuadOperation}(),G=function(t){_inherits(WebGLCoreQuadOperation,t);var e=_createSuper(WebGLCoreQuadOperation);function WebGLCoreQuadOperation(t,r,i,n,s,o){var u;return _classCallCheck(this,WebGLCoreQuadOperation),(u=e.call(this,t,r,i,n,s,o)).extraAttribsDataByteOffset=0,u}return _createClass(WebGLCoreQuadOperation,[{key:"getAttribsDataByteOffset",value:function getAttribsDataByteOffset(t){return this.quads.getAttribsDataByteOffset(this.index+t)}},{key:"getNormalRenderTextureCoords",value:function getNormalRenderTextureCoords(t,e){var r=this.shaderOwner.getRenderTextureCoords(t,e);return r[0]/=this.getRenderWidth(),r[1]/=this.getRenderHeight(),r[0]=2*r[0]-1,r[1]=1-2*r[1],r}},{key:"getProjection",value:function getProjection(){return null===this.renderTextureInfo?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}]),WebGLCoreQuadOperation}(H),V=function(){function CoreRenderExecutor(t){_classCallCheck(this,CoreRenderExecutor),this.ctx=t,this.renderState=t.renderState,this.gl=this.ctx.stage.gl}return _createClass(CoreRenderExecutor,[{key:"destroy",value:function destroy(){}},{key:"_reset",value:function _reset(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}},{key:"execute",value:function execute(){this._reset();for(var t=this.renderState.quadOperations,e=0,r=t.length;e<r;)this._processQuadOperation(t[e]),e++}},{key:"_processQuadOperation",value:function _processQuadOperation(t){t.renderTextureInfo&&t.renderTextureInfo.ignore||(this._setupQuadOperation(t),this._execQuadOperation(t))}},{key:"_setupQuadOperation",value:function _setupQuadOperation(t){}},{key:"_execQuadOperation",value:function _execQuadOperation(t){var e=t.renderTextureInfo?t.renderTextureInfo.nativeTexture:null;this._renderTexture!==e&&this._bindRenderTexture(e),t.renderTextureInfo&&!t.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),t.renderTextureInfo.cleared=!0,this._setScissor(t.scissor)):this._setScissor(t.scissor),this._renderQuadOperation(t)}},{key:"_renderQuadOperation",value:function _renderQuadOperation(t){}},{key:"_bindRenderTexture",value:function _bindRenderTexture(t){this._renderTexture=t}},{key:"_clearRenderTexture",value:function _clearRenderTexture(t){}},{key:"_setScissor",value:function _setScissor(t){}}]),CoreRenderExecutor}(),Y=function(t){_inherits(WebGLCoreRenderExecutor,t);var e=_createSuper(WebGLCoreRenderExecutor);function WebGLCoreRenderExecutor(t){var r;return _classCallCheck(this,WebGLCoreRenderExecutor),(r=e.call(this,t)).gl=r.ctx.stage.gl,r.init(),r}return _createClass(WebGLCoreRenderExecutor,[{key:"init",value:function init(){var t=this.gl;this._attribsBuffer=t.createBuffer();for(var e=Math.floor(this.renderState.quads.data.byteLength/80),r=new Uint16Array(6*e),i=0,n=0;i<e;i+=6,n+=4)r[i]=n,r[i+1]=n+1,r[i+2]=n+2,r[i+3]=n,r[i+4]=n+2,r[i+5]=n+3;this._quadsBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(WebGLCoreRenderExecutor.prototype),"destroy",this).call(this),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer)}},{key:"_reset",value:function _reset(){_get(_getPrototypeOf(WebGLCoreRenderExecutor.prototype),"_reset",this).call(this);var t=this.gl;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}},{key:"_setupBuffers",value:function _setupBuffers(){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);var e=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);t.bindBuffer(t.ARRAY_BUFFER,this._attribsBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW)}},{key:"_setupQuadOperation",value:function _setupQuadOperation(t){_get(_getPrototypeOf(WebGLCoreRenderExecutor.prototype),"_setupQuadOperation",this).call(this,t),this._useShaderProgram(t.shader,t)}},{key:"_renderQuadOperation",value:function _renderQuadOperation(t){var e=t.shader;(t.length||t.shader.addEmpty())&&(e.beforeDraw(t),e.draw(t),e.afterDraw(t))}},{key:"_useShaderProgram",value:function _useShaderProgram(t,e){t.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),t.useProgram(),this._currentShaderProgram=t),t.setupUniforms(e)}},{key:"_stopShaderProgram",value:function _stopShaderProgram(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}},{key:"_bindRenderTexture",value:function _bindRenderTexture(t){_get(_getPrototypeOf(WebGLCoreRenderExecutor.prototype),"_bindRenderTexture",this).call(this,t);var e=this.gl;this._renderTexture?(e.bindFramebuffer(e.FRAMEBUFFER,this._renderTexture.framebuffer),e.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}},{key:"_clearRenderTexture",value:function _clearRenderTexture(){_get(_getPrototypeOf(WebGLCoreRenderExecutor.prototype),"_clearRenderTexture",this).call(this);var t=this.gl;if(this._renderTexture)t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);else{var e=this.ctx.stage.getClearColor();e&&(t.clearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]),t.clear(t.COLOR_BUFFER_BIT))}}},{key:"_setScissor",value:function _setScissor(t){if(_get(_getPrototypeOf(WebGLCoreRenderExecutor.prototype),"_setScissor",this).call(this,t),this._scissor!==t){this._scissor=t;var e=this.gl;if(t){e.enable(e.SCISSOR_TEST);var r=this.ctx.stage.getRenderPrecision(),i=t[1];null===this._renderTexture&&(i=this.ctx.stage.h/r-(t[1]+t[3])),e.scissor(Math.round(t[0]*r),Math.round(i*r),Math.round(t[2]*r),Math.round(t[3]*r))}else e.disable(e.SCISSOR_TEST)}}}]),WebGLCoreRenderExecutor}(V),X=function(){function CoreRenderState(t){_classCallCheck(this,CoreRenderState),this.ctx=t,this.stage=t.stage,this.defaultShader=this.stage.renderer.getDefaultShader(t),this.renderer=t.stage.renderer,this.quads=this.renderer.createCoreQuadList(t)}return _createClass(CoreRenderState,[{key:"reset",value:function reset(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}},{key:"length",get:function get(){return this.quads.quadTextures.length}},{key:"setShader",value:function setShader(t,e){this._shaderOwner===e&&this._realShader===t||(this._realShader=t,t.useDefault()&&(t=this.defaultShader),this._shader===t&&this._shaderOwner===e||(this._shader=t,this._shaderOwner=e,this._check=!0))}},{key:"renderTextureInfo",get:function get(){return this._renderTextureInfo}},{key:"setScissor",value:function setScissor(t){this._scissor!==t&&(this._scissor=t||null,this._check=!0)}},{key:"getScissor",value:function getScissor(){return this._scissor}},{key:"setRenderTextureInfo",value:function setRenderTextureInfo(t){this._renderTextureInfo!==t&&(this._renderTextureInfo=t,this._scissor=null,this._check=!0)}},{key:"setTexturizer",value:function setTexturizer(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._texturizer=t,this._cacheTexturizer=e}},{key:"isCachingTexturizer",get:function get(){return this._isCachingTexturizer},set:function set(t){this._isCachingTexturizer=t}},{key:"addQuad",value:function addQuad(t){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();var e=null;this._texturizer&&(e=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),e||(e=t._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=e,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(e),this.quads.quadElements.push(t),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}},{key:"finishedRenderTexture",value:function finishedRenderTexture(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}},{key:"_isRenderTextureReusable",value:function _isRenderTextureReusable(){var t=this._renderTextureInfo.offset;return this.quads.quadTextures[t].w===this._renderTextureInfo.w&&this.quads.quadTextures[t].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}},{key:"_hasChanges",value:function _hasChanges(){var t=this._quadOperation;return this._shader!==t.shader||this._shaderOwner!==t.shaderOwner||this._renderTextureInfo!==t.renderTextureInfo||this._scissor!==t.scissor&&(this._scissor[0]!==t.scissor[0]||this._scissor[1]!==t.scissor[1]||this._scissor[2]!==t.scissor[2]||this._scissor[3]!==t.scissor[3])}},{key:"_finishQuadOperation",value:function _finishQuadOperation(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(var e=0,r=this._temporaryTexturizers.length;e<r;e++)this._temporaryTexturizers[e].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}t&&this._createQuadOperation()}},{key:"_createQuadOperation",value:function _createQuadOperation(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}},{key:"finish",value:function finish(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}]),CoreRenderState}(),q=function(){function WebGLShaderProgram(t,e){_classCallCheck(this,WebGLShaderProgram),this.vertexShaderSource=t,this.fragmentShaderSource=e,this._program=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}return _createClass(WebGLShaderProgram,[{key:"compile",value:function compile(t){if(!this._program){this.gl=t,this._program=t.createProgram();var e=this._glCompile(t.VERTEX_SHADER,this.vertexShaderSource),r=this._glCompile(t.FRAGMENT_SHADER,this.fragmentShaderSource);t.attachShader(this._program,e),t.attachShader(this._program,r),t.linkProgram(this._program),t.getProgramParameter(this._program,t.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",t.getProgramParameter(this._program,t.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",t.getError()),""!==t.getProgramInfoLog(this._program)&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(this._program)),t.deleteProgram(this._program),this._program=null),t.deleteShader(e),t.deleteShader(r)}}},{key:"_glCompile",value:function _glCompile(t,e){var r=this,i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(i));var n=0;return console.error("[Lightning]","========== source ==========\n"+e.split("\n").map(function(t){return _newArrowCheck(this,r),++n+": "+t}.bind(this)).join("\n")),null}return i}},{key:"getUniformLocation",value:function getUniformLocation(t){var e=this._uniformLocations.get(t);return void 0===e&&(e=this.gl.getUniformLocation(this._program,t),this._uniformLocations.set(t,e)),e}},{key:"getAttribLocation",value:function getAttribLocation(t){var e=this._attributeLocations.get(t);return void 0===e&&(e=this.gl.getAttribLocation(this._program,t),this._attributeLocations.set(t,e)),e}},{key:"destroy",value:function destroy(){this._program&&(this.gl.deleteProgram(this._program),this._program=null)}},{key:"glProgram",get:function get(){return this._program}},{key:"compiled",get:function get(){return!!this._program}},{key:"_valueEquals",value:function _valueEquals(t,e){if(t.length&&e.length){for(var r=0,i=t.length;r<i;r++)if(t[r]!==e[r])return!1;return!0}return t===e}},{key:"_valueClone",value:function _valueClone(t){return t.length?t.slice(0):t}},{key:"setUniformValue",value:function setUniformValue(t,e,r){var i=this._currentUniformValues[t];if(void 0===i||!this._valueEquals(i,e)){var n=this._valueClone(e);this._currentUniformValues[t]=n;var s=this.getUniformLocation(t);s&&(r===this.gl.uniformMatrix2fv||r===this.gl.uniformMatrix3fv||r===this.gl.uniformMatrix4fv?r.call(this.gl,s,!1,n):r.call(this.gl,s,n))}}}]),WebGLShaderProgram}(),$=function(t){_inherits(WebGLShader,t);var e=_createSuper(WebGLShader);function WebGLShader(t){var r;_classCallCheck(this,WebGLShader),r=e.call(this,t);var i=t.stage;return r._program=i.renderer.shaderPrograms.get(r.constructor),r._program||(r._program=new q(r.constructor.vertexShaderSource,r.constructor.fragmentShaderSource),i.renderer.shaderPrograms.set(r.constructor,r._program)),r.gl=i.gl,r}return _createClass(WebGLShader,[{key:"glProgram",get:function get(){return this._program.glProgram}},{key:"_init",value:function _init(){this._initialized||(this.initialize(),this._initialized=!0)}},{key:"initialize",value:function initialize(){this._program.compile(this.gl)}},{key:"initialized",get:function get(){return this._initialized}},{key:"_uniform",value:function _uniform(t){return this._program.getUniformLocation(t)}},{key:"_attrib",value:function _attrib(t){return this._program.getAttribLocation(t)}},{key:"_setUniform",value:function _setUniform(t,e,r){this._program.setUniformValue(t,e,r)}},{key:"useProgram",value:function useProgram(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}},{key:"stopProgram",value:function stopProgram(){this.afterUsage(),this.disableAttribs()}},{key:"hasSameProgram",value:function hasSameProgram(t){return t&&(t===this||t._program===this._program)}},{key:"beforeUsage",value:function beforeUsage(){}},{key:"afterUsage",value:function afterUsage(){}},{key:"enableAttribs",value:function enableAttribs(){}},{key:"disableAttribs",value:function disableAttribs(){}},{key:"getExtraAttribBytesPerVertex",value:function getExtraAttribBytesPerVertex(){return 0}},{key:"getVertexAttribPointerOffset",value:function getVertexAttribPointerOffset(t){return t.extraAttribsDataByteOffset-4*t.index*this.getExtraAttribBytesPerVertex()}},{key:"setExtraAttribsInBuffer",value:function setExtraAttribsInBuffer(t){}},{key:"setupUniforms",value:function setupUniforms(t){}},{key:"_getProjection",value:function _getProjection(t){return t.getProjection()}},{key:"getFlipY",value:function getFlipY(t){return this._getProjection(t)[1]<0}},{key:"beforeDraw",value:function beforeDraw(t){}},{key:"draw",value:function draw(t){}},{key:"afterDraw",value:function afterDraw(t){}},{key:"cleanup",value:function cleanup(){this._initialized=!1}}]),WebGLShader}(C),Z=function(t){_inherits(DefaultShader,t);var e=_createSuper(DefaultShader);function DefaultShader(){return _classCallCheck(this,DefaultShader),e.apply(this,arguments)}return _createClass(DefaultShader,[{key:"enableAttribs",value:function enableAttribs(){var t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(this._attrib("aColor")))}},{key:"disableAttribs",value:function disableAttribs(){var t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&t.disableVertexAttribArray(this._attrib("aColor"))}},{key:"setupUniforms",value:function setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}},{key:"draw",value:function draw(t){var e=this.gl,r=t.length;if(r){for(var i=t.getTexture(0),n=0,s=0;s<r;s++){var o=t.getTexture(s);i!==o&&(e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(s-n),e.UNSIGNED_SHORT,6*(n+t.index)*2),i=o,n=s)}n<r&&(e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(r-n),e.UNSIGNED_SHORT,6*(n+t.index)*2))}}}]),DefaultShader}($);Z.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Z.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";var K=function(){function Renderer(t){_classCallCheck(this,Renderer),this.stage=t,this._defaultShader=void 0}return _createClass(Renderer,[{key:"gc",value:function gc(t){}},{key:"destroy",value:function destroy(){}},{key:"getDefaultShader",value:function getDefaultShader(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stage.ctx;return this._defaultShader||(this._defaultShader=this._createDefaultShader(t)),this._defaultShader}},{key:"_createDefaultShader",value:function _createDefaultShader(t){}},{key:"isValidShaderType",value:function isValidShaderType(t){return t.prototype instanceof this._getShaderBaseType()}},{key:"createShader",value:function createShader(t,e){var r=e.type;if(this.isValidShaderType(r)){var n=new r(t);return i.patchObject(this,e),n}var s=this._getShaderAlternative(r);return s?new s(t):(console.warn("[Lightning] Shader has no implementation for render target: "+r.name),this._createDefaultShader(t))}},{key:"_getShaderBaseType",value:function _getShaderBaseType(){}},{key:"_getShaderAlternative",value:function _getShaderAlternative(t){return this.getDefaultShader()}},{key:"copyRenderTexture",value:function copyRenderTexture(t,e,r){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}]),Renderer}(),Q=function(t){_inherits(WebGLRenderer,t);var i=_createSuper(WebGLRenderer);function WebGLRenderer(t){var e;return _classCallCheck(this,WebGLRenderer),(e=i.call(this,t)).shaderPrograms=new Map,e}return _createClass(WebGLRenderer,[{key:"destroy",value:function destroy(){var t=this;this.shaderPrograms.forEach(function(e){return _newArrowCheck(this,t),e.destroy()}.bind(this))}},{key:"_createDefaultShader",value:function _createDefaultShader(t){return new Z(t)}},{key:"_getShaderBaseType",value:function _getShaderBaseType(){return $}},{key:"_getShaderAlternative",value:function _getShaderAlternative(t){return t.getWebGL&&t.getWebGL()}},{key:"createCoreQuadList",value:function createCoreQuadList(t){return new W(t)}},{key:"createCoreQuadOperation",value:function createCoreQuadOperation(t,e,r,i,n,s){return new G(t,e,r,i,n,s)}},{key:"createCoreRenderExecutor",value:function createCoreRenderExecutor(t){return new Y(t)}},{key:"createCoreRenderState",value:function createCoreRenderState(t){return new X(t)}},{key:"createRenderTexture",value:function createRenderTexture(t,e,r,i){var n=this.stage.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r,i,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),s.params={},s.params[n.TEXTURE_MAG_FILTER]=n.LINEAR,s.params[n.TEXTURE_MIN_FILTER]=n.LINEAR,s.params[n.TEXTURE_WRAP_S]=n.CLAMP_TO_EDGE,s.params[n.TEXTURE_WRAP_T]=n.CLAMP_TO_EDGE,s.options={format:n.RGBA,internalFormat:n.RGBA,type:n.UNSIGNED_BYTE},s.framebuffer=n.createFramebuffer(),s.projection=new Float32Array([2/t,2/e]),n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0),s}},{key:"freeRenderTexture",value:function freeRenderTexture(t){var e=this.stage.gl;e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t)}},{key:"uploadTextureSource",value:function uploadTextureSource(t,e){var i=this,n=this.stage.gl,s=e.source,o={premultiplyAlpha:!0,hasAlpha:!0};e&&e.hasOwnProperty("premultiplyAlpha")&&(o.premultiplyAlpha=e.premultiplyAlpha),e&&e.hasOwnProperty("flipBlueRed")&&(o.flipBlueRed=e.flipBlueRed),e&&e.hasOwnProperty("hasAlpha")&&(o.hasAlpha=e.hasAlpha),o.hasAlpha||(o.premultiplyAlpha=!1),o.texParams=e.texParams||{},o.texOptions=e.texOptions||{};var u=n.createTexture();n.bindTexture(n.TEXTURE_2D,u),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),r.isNode&&n.pixelStorei(n.UNPACK_FLIP_BLUE_RED,!!o.flipBlueRed);var h=o.texParams;h[n.TEXTURE_MAG_FILTER]||(h[n.TEXTURE_MAG_FILTER]=n.LINEAR),h[n.TEXTURE_MIN_FILTER]||(h[n.TEXTURE_MIN_FILTER]=n.LINEAR),h[n.TEXTURE_WRAP_S]||(h[n.TEXTURE_WRAP_S]=n.CLAMP_TO_EDGE),h[n.TEXTURE_WRAP_T]||(h[n.TEXTURE_WRAP_T]=n.CLAMP_TO_EDGE),Object.keys(h).forEach(function(t){_newArrowCheck(this,i);var e=h[t];n.texParameteri(n.TEXTURE_2D,parseInt(t),e)}.bind(this));var l=o.texOptions;return l.format=l.format||(o.hasAlpha?n.RGBA:n.RGB),l.type=l.type||n.UNSIGNED_BYTE,l.internalFormat=l.internalFormat||l.format,e&&e.imageRef&&(l.imageRef=e.imageRef),this.stage.platform.uploadGlTexture(n,t,s,l),u.params=r.cloneObjShallow(h),u.options=r.cloneObjShallow(l),u}},{key:"freeTextureSource",value:function freeTextureSource(t){this.stage.gl.deleteTexture(t.nativeTexture)}},{key:"addQuad",value:function addQuad(t,r,i){var n=20*i,s=r.quadElements[i],o=s._renderContext,u=t.quads.floats,h=t.quads.uints,l=e.mergeColorAlpha;if(0!==o.tb||0!==o.tc)u[n++]=o.px,u[n++]=o.py,u[n++]=s._ulx,u[n++]=s._uly,h[n++]=l(s._colorUl,o.alpha),u[n++]=o.px+s._w*o.ta,u[n++]=o.py+s._w*o.tc,u[n++]=s._brx,u[n++]=s._uly,h[n++]=l(s._colorUr,o.alpha),u[n++]=o.px+s._w*o.ta+s._h*o.tb,u[n++]=o.py+s._w*o.tc+s._h*o.td,u[n++]=s._brx,u[n++]=s._bry,h[n++]=l(s._colorBr,o.alpha),u[n++]=o.px+s._h*o.tb,u[n++]=o.py+s._h*o.td,u[n++]=s._ulx,u[n++]=s._bry,h[n]=l(s._colorBl,o.alpha);else{var f=o.px+s._w*o.ta,d=o.py+s._h*o.td;u[n++]=o.px,u[n++]=o.py,u[n++]=s._ulx,u[n++]=s._uly,h[n++]=l(s._colorUl,o.alpha),u[n++]=f,u[n++]=o.py,u[n++]=s._brx,u[n++]=s._uly,h[n++]=l(s._colorUr,o.alpha),u[n++]=f,u[n++]=d,u[n++]=s._brx,u[n++]=s._bry,h[n++]=l(s._colorBr,o.alpha),u[n++]=o.px,u[n++]=d,u[n++]=s._ulx,u[n++]=s._bry,h[n]=l(s._colorBl,o.alpha)}}},{key:"isRenderTextureReusable",value:function isRenderTextureReusable(t,e){var r=80*t._renderTextureInfo.offset/4,i=t.quads.floats,n=t.quads.uints;return 0===i[r]&&0===i[r+1]&&0===i[r+2]&&0===i[r+3]&&4294967295===n[r+4]&&i[r+5]===e.w&&0===i[r+6]&&1===i[r+7]&&0===i[r+8]&&4294967295===n[r+9]&&i[r+10]===e.w&&i[r+11]===e.h&&1===i[r+12]&&1===i[r+13]&&4294967295===n[r+14]&&0===i[r+15]&&i[r+16]===e.h&&0===i[r+17]&&1===i[r+18]&&4294967295===n[r+19]}},{key:"finishRenderState",value:function finishRenderState(t){for(var e=80*t.length,r=0,i=t.quadOperations.length;r<i;r++){t.quadOperations[r].extraAttribsDataByteOffset=e;var n=4*t.quadOperations[r].shader.getExtraAttribBytesPerVertex()*t.quadOperations[r].length;e+=n,n&&t.quadOperations[r].shader.setExtraAttribsInBuffer(t.quadOperations[r],t.quads)}t.quads.dataLength=e}},{key:"copyRenderTexture",value:function copyRenderTexture(t,e,r){var i=this.stage.gl;i.bindTexture(i.TEXTURE_2D,e),i.bindFramebuffer(i.FRAMEBUFFER,t.framebuffer);var n=t.precision;i.copyTexSubImage2D(i.TEXTURE_2D,0,n*(r.sx||0),n*(r.sy||0),n*(r.x||0),n*(r.y||0),n*(r.w||t.ow),n*(r.h||t.oh))}}]),WebGLRenderer}(K),J=function(t){_inherits(C2dCoreQuadList,t);var e=_createSuper(C2dCoreQuadList);function C2dCoreQuadList(t){var r;return _classCallCheck(this,C2dCoreQuadList),(r=e.call(this,t)).renderContexts=[],r.modes=[],r}return _createClass(C2dCoreQuadList,[{key:"setRenderContext",value:function setRenderContext(t,e){this.renderContexts[t]=e}},{key:"setSimpleTc",value:function setSimpleTc(t,e){e?this.modes[t]|=1:this.modes[t]-=1&this.modes[t]}},{key:"setWhite",value:function setWhite(t,e){e?this.modes[t]|=2:this.modes[t]-=2&this.modes[t]}},{key:"getRenderContext",value:function getRenderContext(t){return this.renderContexts[t]}},{key:"getSimpleTc",value:function getSimpleTc(t){return 1&this.modes[t]}},{key:"getWhite",value:function getWhite(t){return 2&this.modes[t]}}]),C2dCoreQuadList}(N),tt=function(t){_inherits(C2dCoreQuadOperation,t);var e=_createSuper(C2dCoreQuadOperation);function C2dCoreQuadOperation(){return _classCallCheck(this,C2dCoreQuadOperation),e.apply(this,arguments)}return _createClass(C2dCoreQuadOperation,[{key:"getRenderContext",value:function getRenderContext(t){return this.quads.getRenderContext(this.index+t)}},{key:"getSimpleTc",value:function getSimpleTc(t){return this.quads.getSimpleTc(this.index+t)}},{key:"getWhite",value:function getWhite(t){return this.quads.getWhite(this.index+t)}}]),C2dCoreQuadOperation}(H),et=function(t){_inherits(C2dCoreRenderExecutor,t);var i=_createSuper(C2dCoreRenderExecutor);function C2dCoreRenderExecutor(){return _classCallCheck(this,C2dCoreRenderExecutor),i.apply(this,arguments)}return _createClass(C2dCoreRenderExecutor,[{key:"init",value:function init(){this._mainRenderTexture=this.ctx.stage.getCanvas()}},{key:"_renderQuadOperation",value:function _renderQuadOperation(t){var e=t.shader;if(t.length||t.shader.addEmpty()){var r=this._renderTexture||this._mainRenderTexture;e.beforeDraw(t,r),e.draw(t,r),e.afterDraw(t,r)}}},{key:"_clearRenderTexture",value:function _clearRenderTexture(){var t=this._getContext(),r=[0,0,0,0];this._mainRenderTexture.ctx===t&&(r=this.ctx.stage.getClearColor());var i=t.canvas;t.setTransform(1,0,0,1,0,0),r[0]||r[1]||r[2]||r[3]?(t.fillStyle=e.getRgbaStringFromArray(r),t.globalCompositeOperation="copy",t.beginPath(),t.rect(0,0,i.width,i.height),t.closePath(),t.fill(),t.globalCompositeOperation="source-over"):t.clearRect(0,0,i.width,i.height)}},{key:"_getContext",value:function _getContext(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}},{key:"_restoreContext",value:function _restoreContext(){var t=this._getContext();t.restore(),t.save(),t._scissor=null}},{key:"_setScissor",value:function _setScissor(t){var e=this._getContext();if(!C2dCoreRenderExecutor._equalScissorAreas(e.canvas,e._scissor,t)){this._restoreContext();var r=this.ctx.stage.getRenderPrecision();t&&(e.beginPath(),e.rect(Math.round(t[0]*r),Math.round(t[1]*r),Math.round(t[2]*r),Math.round(t[3]*r)),e.closePath(),e.clip()),e._scissor=t}}}],[{key:"_equalScissorAreas",value:function _equalScissorAreas(t,e,i){return e||(e=[0,0,t.width,t.height]),i||(i=[0,0,t.width,t.height]),r.equalValues(e,i)}}]),C2dCoreRenderExecutor}(V),rt=function(t){_inherits(C2dShader,t);var e=_createSuper(C2dShader);function C2dShader(){return _classCallCheck(this,C2dShader),e.apply(this,arguments)}return _createClass(C2dShader,[{key:"beforeDraw",value:function beforeDraw(t){}},{key:"draw",value:function draw(t){}},{key:"afterDraw",value:function afterDraw(t){}}]),C2dShader}(C),it=function(t){_inherits(DefaultShader,t);var r=_createSuper(DefaultShader);function DefaultShader(t){var e;return _classCallCheck(this,DefaultShader),(e=r.call(this,t))._rectangleTexture=t.stage.rectangleTexture.source.nativeTexture,e._tintManager=e.ctx.stage.renderer.tintManager,e}return _createClass(DefaultShader,[{key:"draw",value:function draw(t,r){for(var i=r.ctx,n=t.length,s=0;s<n;s++){var o=t.getTexture(s),u=t.getElementCore(s),h=t.getRenderContext(s),l=t.getWhite(s),f=t.getSimpleTc(s),d=this.ctx.stage.getRenderPrecision();i.setTransform(h.ta*d,h.tc*d,h.tb*d,h.td*d,h.px*d,h.py*d);var _=o===this._rectangleTexture,g={operation:t,target:r,index:s,rect:_};if(_)l?i.fillStyle="white":this._setColorGradient(i,u),i.globalAlpha=h.alpha,this._beforeDrawEl(g),i.fillRect(0,0,u.w,u.h),this._afterDrawEl(g),i.globalAlpha=1;else{i.globalAlpha=h.alpha,this._beforeDrawEl(g);var p=f?0:u._ulx*o.w,v=f?0:u._uly*o.h,y=(f?1:u._brx-u._ulx)*o.w,x=(f?1:u._bry-u._uly)*o.h;if(l)i.fillStyle="white",i.drawImage(o,p,v,y,x,0,0,u.w,u.h);else{var m=u._colorUl;u._colorUl===u._colorUr&&u._colorUr===u._colorBl&&u._colorBr===u._colorBl||(m=e.mergeMultiColorsEqual([u._colorUl,u._colorUr,u._colorBl,u._colorBr]));var S=(m/16777216|0)/255;i.globalAlpha*=S;var b=16777215&m,k=this._tintManager.getTintTexture(o,b);i.fillStyle="white",i.drawImage(k,p,v,y,x,0,0,u.w,u.h)}this._afterDrawEl(g),i.globalAlpha=1}}}},{key:"_setColorGradient",value:function _setColorGradient(t,r){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.w,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.h,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=r._colorUl;r._colorUl===r._colorUr?r._colorBl===r._colorBr&&(r._colorUl===r.colorBl||(i=t.createLinearGradient(0,0,0,s),o?(i.addColorStop(0,e.getRgbaString(r._colorUl)),i.addColorStop(1,e.getRgbaString(r._colorBl))):(i.addColorStop(0,e.getRgbString(r._colorUl)),i.addColorStop(1,e.getRgbString(r._colorBl))))):r._colorUl===r._colorBl&&r._colorUr===r._colorBr&&(i=t.createLinearGradient(0,0,n,0),o?(i.addColorStop(0,e.getRgbaString(r._colorUl)),i.addColorStop(1,e.getRgbaString(r._colorBr))):(i.addColorStop(0,e.getRgbString(r._colorUl)),i.addColorStop(1,e.getRgbString(r._colorBr)))),t.fillStyle=i||(o?e.getRgbaString(u):e.getRgbString(u))}},{key:"_beforeDrawEl",value:function _beforeDrawEl(t){}},{key:"_afterDrawEl",value:function _afterDrawEl(t){}}]),DefaultShader}(rt),nt=function(){function C2dTextureTintManager(t){_classCallCheck(this,C2dTextureTintManager),this.stage=t,this._usedMemory=0,this._cachedNativeTextures=new Set}return _createClass(C2dTextureTintManager,[{key:"destroy",value:function destroy(){this.gc(!0)}},{key:"_addMemoryUsage",value:function _addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}},{key:"delete",value:function _delete(t){if(this._hasCache(t)){var e=this._getCache(t),r=e.memoryUsage;e.clear(),this._cachedNativeTextures.delete(t),this._addMemoryUsage(e.memoryUsage-r)}}},{key:"getTintTexture",value:function getTintTexture(t,e){var r=this.stage.frameCounter;this._cachedNativeTextures.add(t);var i=this._getCache(t),n=i.get(e);if(n.lf=r,n.tx)return t.update>n.u&&this._tintTexture(n.tx,t,e),n.tx;var s=i.memoryUsage,o=i.reuseTexture(r);o?o.ctx.clearRect(0,0,o.width,o.height):((o=document.createElement("canvas")).width=t.w,o.height=t.h,o.ctx=o.getContext("2d")),this._tintTexture(o,t,e),i.set(e,o,r);var u=i.memoryUsage;return u!==s&&this._addMemoryUsage(u-s),o}},{key:"_tintTexture",value:function _tintTexture(t,e,r){for(var i=r.toString(16);i.length<6;)i="0"+i;t.ctx.fillStyle="#"+i,t.ctx.globalCompositeOperation="copy",t.ctx.fillRect(0,0,e.w,e.h),t.ctx.globalCompositeOperation="multiply",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height),t.ctx.globalCompositeOperation="destination-in",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height)}},{key:"_hasCache",value:function _hasCache(t){return!!t._tintCache}},{key:"_getCache",value:function _getCache(t){return t._tintCache||(t._tintCache=new st(t)),t._tintCache}},{key:"gc",value:function gc(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.stage.frameCounter,i=0;this._cachedNativeTextures.forEach(function(n){_newArrowCheck(this,t);var s=this._getCache(n);if(e)i+=s.memoryUsage,s.clear();else{var o=s.memoryUsage;s.cleanup(r),s.releaseBlancoTextures(),i+=s.memoryUsage-o}}.bind(this)),e&&this._cachedNativeTextures.clear(),i&&this._addMemoryUsage(i)}}]),C2dTextureTintManager}(),st=function(){function C2dTintCache(t){_classCallCheck(this,C2dTintCache),this._tx=t,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}return _createClass(C2dTintCache,[{key:"memoryUsage",get:function get(){return this._memTextures*this._tx.w*this._tx.h}},{key:"releaseBlancoTextures",value:function releaseBlancoTextures(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}},{key:"clear",value:function clear(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}},{key:"get",value:function get(t){var e=this._colors.get(t);return e||(e={lf:-1,tx:void 0,u:-1},this._colors.set(t,e)),e}},{key:"set",value:function set(t,e,r){var i=this.get(t);i.lf=r,i.tx=e,i.u=r,this._memTextures++}},{key:"cleanup",value:function cleanup(t){var e=this;this._lastCleanupFrame!==t&&(this._blancoTextures=[],this._colors.forEach(function(r,i){_newArrowCheck(this,e),r.lf<t-1&&(r.tx&&this._blancoTextures.push(r.tx),this._colors.delete(i))}.bind(this)),this._lastCleanupFrame=t)}},{key:"reuseTexture",value:function reuseTexture(t){if(this.cleanup(t),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}]),C2dTintCache}(),ot=function(t){_inherits(C2dRenderer,t);var e=_createSuper(C2dRenderer);function C2dRenderer(t){var r;return _classCallCheck(this,C2dRenderer),(r=e.call(this,t)).tintManager=new nt(t),r.setupC2d(r.stage.c2d.canvas),r}return _createClass(C2dRenderer,[{key:"destroy",value:function destroy(){this.tintManager.destroy()}},{key:"_createDefaultShader",value:function _createDefaultShader(t){return new it(t)}},{key:"_getShaderBaseType",value:function _getShaderBaseType(){return rt}},{key:"_getShaderAlternative",value:function _getShaderAlternative(t){return t.getC2d&&t.getC2d()}},{key:"createCoreQuadList",value:function createCoreQuadList(t){return new J(t)}},{key:"createCoreQuadOperation",value:function createCoreQuadOperation(t,e,r,i,n,s){return new tt(t,e,r,i,n,s)}},{key:"createCoreRenderExecutor",value:function createCoreRenderExecutor(t){return new et(t)}},{key:"createCoreRenderState",value:function createCoreRenderState(t){return new X(t)}},{key:"createRenderTexture",value:function createRenderTexture(t,e,r,i){var n=document.createElement("canvas");return n.width=r,n.height=i,this.setupC2d(n),n}},{key:"freeRenderTexture",value:function freeRenderTexture(t){this.tintManager.delete(t)}},{key:"gc",value:function gc(t){this.tintManager.gc(t)}},{key:"uploadTextureSource",value:function uploadTextureSource(t,e){if(e.source.buffer){var r=document.createElement("canvas");r.width=e.w,r.height=e.h;var i=new ImageData(new Uint8ClampedArray(e.source.buffer),e.w,e.h);return r.getContext("2d").putImageData(i,0,0),r}return e.source}},{key:"freeTextureSource",value:function freeTextureSource(t){this.tintManager.delete(t.nativeTexture)}},{key:"addQuad",value:function addQuad(t,e,r){var i=e.quadElements[r];e.setRenderContext(r,i._renderContext),e.setWhite(r,i.isWhite()),e.setSimpleTc(r,i.hasSimpleTexCoords())}},{key:"isRenderTextureReusable",value:function isRenderTextureReusable(t,e){return!1}},{key:"finishRenderState",value:function finishRenderState(t){}},{key:"setupC2d",value:function setupC2d(t){var e=t.getContext("2d");t.ctx=e,e._scissor=null,t.ctx.save()}}]),C2dRenderer}(K),ut=function(t){_inherits(SparkShader,t);var e=_createSuper(SparkShader);function SparkShader(){return _classCallCheck(this,SparkShader),e.apply(this,arguments)}return _createClass(SparkShader,[{key:"enableAttribs",value:function enableAttribs(){var t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(this._attrib("aColor")))}},{key:"disableAttribs",value:function disableAttribs(){var t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&t.disableVertexAttribArray(this._attrib("aColor"))}},{key:"setupUniforms",value:function setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}},{key:"draw",value:function draw(t){var e=this.gl,r=t.length;if(r){for(var i=t.getTexture(0),n=0,s=0;s<r;s++){var o=t.getTexture(s);if(i!==o){if(i.options&&i.options.imageRef){var u=s>0?s-1:s,h=this.ctx.stage.getOption("precision"),l=t.getElementCore(u);this.ctx.stage.platform.paint(e,i.options.imageRef,l._worldContext.px*h,l._worldContext.py*h,l._colorUl,l)}else e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(s-n),e.UNSIGNED_SHORT,6*(n+t.index)*2);i=o,n=s}}if(n<r)if(i.options&&i.options.imageRef){var f=this.ctx.stage.getOption("precision"),d=t.getElementCore(n);this.ctx.stage.platform.paint(e,i.options.imageRef,d._worldContext.px*f,d._worldContext.py*f,d._colorUl,d)}else e.bindTexture(e.TEXTURE_2D,i),e.drawElements(e.TRIANGLES,6*(r-n),e.UNSIGNED_SHORT,6*(n+t.index)*2)}}}]),SparkShader}($);ut.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ut.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";var ht=function(e){_inherits(SparkRenderer,e);var r=_createSuper(SparkRenderer);function SparkRenderer(t){return _classCallCheck(this,SparkRenderer),r.call(this,t)}return _createClass(SparkRenderer,[{key:"_createDefaultShader",value:function _createDefaultShader(t){return new ut(t)}},{key:"createCoreRenderExecutor",value:function createCoreRenderExecutor(e){t.beginDrawing();var r=_get(_getPrototypeOf(SparkRenderer.prototype),"createCoreRenderExecutor",this).call(this,e);return t.endDrawing(),r}}]),SparkRenderer}(Q),lt=function(){function ImageWorker(){_classCallCheck(this,ImageWorker),this._items=new Map,this._id=0,this._initWorker()}return _createClass(ImageWorker,[{key:"destroy",value:function destroy(){this._worker&&this._worker.terminate()}},{key:"_initWorker",value:function _initWorker(){var t=this,e="(".concat(ft.toString(),")()"),r=new Blob([e.replace('"use strict";',"")]),i=(window.URL?URL:webkitURL).createObjectURL(r,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(i),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=function(e){if(_newArrowCheck(this,t),e.data&&e.data.id){var r=e.data.id,i=this._items.get(r);i&&("data"==e.data.type?this.finish(i,e.data.info):this.error(i,e.data.info))}}.bind(this)}},{key:"create",value:function create(t){var e=++this._id,r=new ct(this,e,t);return this._items.set(e,r),this._worker.postMessage({type:"add",id:e,src:t}),r}},{key:"cancel",value:function cancel(t){this._worker.postMessage({type:"cancel",id:t.id}),this._items.delete(t.id)}},{key:"error",value:function error(t,e){t.error(e),this._items.delete(t.id)}},{key:"finish",value:function finish(t,e){t.load(e),this._items.delete(t.id)}}]),ImageWorker}(),ct=function(){function ImageWorkerImage(t,e,r){_classCallCheck(this,ImageWorkerImage),this._manager=t,this._id=e,this._src=r,this._onError=null,this._onLoad=null}return _createClass(ImageWorkerImage,[{key:"id",get:function get(){return this._id}},{key:"src",get:function get(){return this._src}},{key:"onError",set:function set(t){this._onError=t}},{key:"onLoad",set:function set(t){this._onLoad=t}},{key:"cancel",value:function cancel(){this._manager.cancel(this)}},{key:"load",value:function load(t){this._onLoad&&this._onLoad(t)}},{key:"error",value:function error(t){this._onError&&this._onError(t)}}]),ImageWorkerImage}(),ft=function createWorker(){function ImageWorkerServer(){this.items=new Map;var t=this;onmessage=function onmessage(e){t._receiveMessage(e)}}function ImageWorkerServerItem(t,e){this._onError=void 0,this._onFinish=void 0,this._id=t,this._src=e,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}ImageWorkerServer.isPathAbsolute=function(t){return/^(?:\/|[a-z]+:\/\/)/.test(t)||"data:"==t.substr(0,5)},ImageWorkerServer.prototype._receiveMessage=function(t){if("config"===t.data.type){this.config=t.data.config;var e=this.config.path;/#.*?\//.test(e)&&(e=e.replace(/#.*$/,""));var r=e.split("/");r.pop(),this._relativeBase=r.join("/")+"/"}else"add"===t.data.type?this.add(t.data.id,t.data.src):"cancel"===t.data.type&&this.cancel(t.data.id)},ImageWorkerServer.prototype.add=function(t,e){ImageWorkerServer.isPathAbsolute(e)||(e=this._relativeBase+e),"//"===e.substr(0,2)&&(e=this.config.protocol+e);var r=new ImageWorkerServerItem(t,e),i=this;r.onFinish=function(t){i.finish(r,t)},r.onError=function(t){i.error(r,t)},this.items.set(t,r),r.start()},ImageWorkerServer.prototype.cancel=function(t){var e=this.items.get(t);e&&(e.cancel(),this.items.delete(t))},ImageWorkerServer.prototype.finish=function(t,e){var r=e.imageBitmap,i=e.hasAlphaChannel;postMessage({type:"data",id:t.id,info:{imageBitmap:r,hasAlphaChannel:i}},[r]),this.items.delete(t.id)},ImageWorkerServer.prototype.error=function(t,e){var r=e.type,i=e.message;postMessage({type:"error",id:t.id,info:{type:r,message:i}}),this.items.delete(t.id)},ImageWorkerServer.isWPEBrowser=function(){return-1!==navigator.userAgent.indexOf("WPE")},Object.defineProperty(ImageWorkerServerItem.prototype,"id",{get:function get(){return this._id}}),Object.defineProperty(ImageWorkerServerItem.prototype,"onFinish",{get:function get(){return this._onFinish},set:function set(t){this._onFinish=t}}),Object.defineProperty(ImageWorkerServerItem.prototype,"onError",{get:function get(){return this._onError},set:function set(t){this._onError=t}}),ImageWorkerServerItem.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var t=this;this._xhr.onerror=function(e){t.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(e){var r=t._xhr.response;t._mimeType=r.type,t._createImageBitmap(r)},this._xhr.send()},ImageWorkerServerItem.prototype._createImageBitmap=function(t){var e=this;createImageBitmap(t,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then((function(t){e.finish({imageBitmap:t,hasAlphaChannel:e._hasAlphaChannel()})})).catch((function(t){e.error({type:"parse",message:"Error parsing image data"})}))},ImageWorkerServerItem.prototype._hasAlphaChannel=function(){return!!ImageWorkerServer.isWPEBrowser()||-1!==this._mimeType.indexOf("image/png")},ImageWorkerServerItem.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},ImageWorkerServerItem.prototype.error=function(t,e){!this._canceled&&this._onError&&this._onError({type:t,message:e})},ImageWorkerServerItem.prototype.finish=function(t){!this._canceled&&this._onFinish&&this._onFinish(t)},new ImageWorkerServer},dt=function(){function WebPlatform(){_classCallCheck(this,WebPlatform)}return _createClass(WebPlatform,[{key:"init",value:function init(t){this.stage=t,this._looping=!1,this._awaitingLoop=!1,this.stage.getOption("useImageWorker")&&(window.createImageBitmap&&window.Worker?this._imageWorker=new lt:console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support"))}},{key:"destroy",value:function destroy(){this._imageWorker&&this._imageWorker.destroy(),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler()}},{key:"startLoop",value:function startLoop(){this._looping=!0,this._awaitingLoop||this.loop()}},{key:"stopLoop",value:function stopLoop(){this._looping=!1}},{key:"loop",value:function loop(){var t=this,e=function lp(){t._awaitingLoop=!1,t._looping&&(t.stage.drawFrame(),requestAnimationFrame(lp),t._awaitingLoop=!0)};requestAnimationFrame(e)}},{key:"uploadGlTexture",value:function uploadGlTexture(t,e,r,i){if(r instanceof ImageData||r instanceof HTMLImageElement||r instanceof HTMLVideoElement||window.ImageBitmap&&r instanceof ImageBitmap)t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,i.format,i.type,r);else if(r instanceof HTMLCanvasElement){var n=r.getContext("2d");t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,i.format,i.type,n.getImageData(0,0,r.width,r.height))}else t.texImage2D(t.TEXTURE_2D,0,i.internalFormat,e.w,e.h,0,i.format,i.type,r)}},{key:"loadSrcTexture",value:function loadSrcTexture(t,e){var i=t.src,n=t.hasAlpha,s=void 0,o=i.indexOf(".png")>=0||"data:image/png;base64"==i.substr(0,21);if(this._imageWorker){var u=this._imageWorker.create(i);u.onError=function(t){return e("Image load error")},u.onLoad=function(t){var r=t.imageBitmap,n=t.hasAlphaChannel;e(null,{source:r,renderInfo:{src:i},hasAlpha:n,premultiplyAlpha:!0})},s=function cancelCb(){u.cancel()}}else{var h=new Image;"data:"==i.substr(0,5)||r.isPS4||(h.crossOrigin="Anonymous"),h.onerror=function(t){if(h.src)return e("Image load error")},h.onload=function(){e(null,{source:h,renderInfo:{src:i},hasAlpha:o||n})},h.src=i,s=function cancelCb(){h.onerror=null,h.onload=null,h.removeAttribute("src")}}return s}},{key:"createWebGLContext",value:function createWebGLContext(t,e){var r=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(r.width=t,r.height=e);var i={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},n=r.getContext("webgl",i)||r.getContext("experimental-webgl",i);if(!n)throw new Error("This browser does not support webGL.");return n}},{key:"createCanvasContext",value:function createCanvasContext(t,e){var r=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(r.width=t,r.height=e);var i=r.getContext("2d");if(!i)throw new Error("This browser does not support 2d canvas.");return i}},{key:"getHrTime",value:function getHrTime(){return window.performance?window.performance.now():(new Date).getTime()}},{key:"getDrawingCanvas",value:function getDrawingCanvas(){return document.createElement("canvas")}},{key:"getTextureOptionsForDrawingCanvas",value:function getTextureOptionsForDrawingCanvas(t){var e={};return e.source=t,e}},{key:"nextFrame",value:function nextFrame(t){}},{key:"registerKeydownHandler",value:function registerKeydownHandler(t){var e=this;this._keydownListener=function(r){_newArrowCheck(this,e),t(r)}.bind(this),window.addEventListener("keydown",this._keydownListener)}},{key:"registerKeyupHandler",value:function registerKeyupHandler(t){var e=this;this._keyupListener=function(r){_newArrowCheck(this,e),t(r)}.bind(this),window.addEventListener("keyup",this._keyupListener)}},{key:"_removeKeyHandler",value:function _removeKeyHandler(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}},{key:"registerClickHandler",value:function registerClickHandler(t){var e=this;this._clickListener=function(r){_newArrowCheck(this,e),t(r)}.bind(this),window.addEventListener("mousedown",this._clickListener)}},{key:"_removeClickHandler",value:function _removeClickHandler(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}},{key:"registerHoverHandler",value:function registerHoverHandler(t){var e=this;this._hoverListener=function(r){_newArrowCheck(this,e),t(r)}.bind(this),window.addEventListener("mousemove",this._hoverListener)}},{key:"_removeHoverHandler",value:function _removeHoverHandler(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}},{key:"registerScrollWheelHandler",value:function registerScrollWheelHandler(t){var e=this;this._scrollWheelListener=function(r){_newArrowCheck(this,e),t(r)}.bind(this),window.addEventListener("wheel",this._scrollWheelListener)}},{key:"_removeScrollWheelHandler",value:function _removeScrollWheelHandler(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}}]),WebPlatform}(),_t=function(){function PlatformLoader(){_classCallCheck(this,PlatformLoader)}return _createClass(PlatformLoader,null,[{key:"load",value:function load(t){return t.platform?t.platform:dt}}]),PlatformLoader}(),gt=function(){function Utils(){_classCallCheck(this,Utils)}return _createClass(Utils,null,[{key:"isFunction",value:function isFunction(t){return"function"==typeof t}},{key:"isNumber",value:function isNumber(t){return"number"==typeof t}},{key:"isInteger",value:function isInteger(t){return"number"==typeof t&&t%1==0}},{key:"isBoolean",value:function isBoolean(t){return!0===t||!1===t}},{key:"isString",value:function isString(t){return"string"==typeof t}},{key:"isObject",value:function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}},{key:"isPlainObject",value:function isPlainObject(t){return!!t&&"object"==typeof t}},{key:"isObjectLiteral",value:function isObjectLiteral(t){return"object"==typeof t&&t&&t.constructor===Object}},{key:"getArrayIndex",value:function getArrayIndex(t,e){return Utils.getModuloIndex(t,e.length)}},{key:"equalValues",value:function equalValues(t,e){return typeof t==typeof e&&(Utils.isObjectLiteral(t)?Utils.isObjectLiteral(e)&&Utils.equalObjectLiterals(t,e):Array.isArray(t)?Array.isArray(e)&&Utils.equalArrays(t,e):t===e)}},{key:"equalObjectLiterals",value:function equalObjectLiterals(t,e){var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(var n=0,s=r.length;n<s;n++){var o=r[n],u=i[n];if(o!==u)return!1;var h=t[o],l=e[u];if(!Utils.equalValues(h,l))return!1}return!0}},{key:"equalArrays",value:function equalArrays(t,e){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(!this.equalValues(t[r],e[r]))return!1;return!0}}]),Utils}(),pt=function(){function WebGLState(t,e){_classCallCheck(this,WebGLState),this._id=t,this._gl=e,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=e.TEXTURE0,this._pixelStorei=new Array(5)}return _createClass(WebGLState,[{key:"_getDefaultFlag",value:function _getDefaultFlag(t){return t===this._gl.DITHER}},{key:"setFlag",value:function setFlag(t,e){return e===this._getDefaultFlag(t)?this._nonDefaultFlags.delete(t):!this._nonDefaultFlags.has(t)&&(this._nonDefaultFlags.add(t),!0)}},{key:"setBuffer",value:function setBuffer(t,e){var r=this._buffers.get(t)!==e;return this._buffers.set(t,e),r&&t===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),r}},{key:"setFramebuffer",value:function setFramebuffer(t,e){var r=this._framebuffers.get(t)!==e;return this._framebuffers.set(t,e),r}},{key:"setRenderbuffer",value:function setRenderbuffer(t,e){var r=this._renderbuffers.get(t)!==e;return this._renderbuffers.set(t,e),r}},{key:"setProgram",value:function setProgram(t){var e=this._program!==t;return this._program=t,e}},{key:"setSetting",value:function setSetting(t,e){var r=this._settings.get(t),i=!r||!gt.equalValues(r,e);return this._settings.set(t,e),i}},{key:"disableVertexAttribArray",value:function disableVertexAttribArray(t){var e=this._vertexAttribs[t];return!(!e||!e[5]||(e[5]=!1,0))}},{key:"enableVertexAttribArray",value:function enableVertexAttribArray(t){var e=this._vertexAttribs[t];return e?!e[0]&&(e[0]=!0,!0):(this._vertexAttribs[t]=[0,0,0,0,0,!0],!0)}},{key:"vertexAttribPointer",value:function vertexAttribPointer(t,e){var r=this._vertexAttribs[t],i=!1;return r&&(i=r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]),!i&&(e[5]=!!r&&r[5],!0)}},{key:"setActiveTexture",value:function setActiveTexture(t){var e=this._activeTexture!==t;return this._activeTexture=t,e}},{key:"bindTexture",value:function bindTexture(t,e){var r=WebGLState._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,r+1);var i=this._textures[r],n=WebGLState._getTextureTargetIndex(t);return i?i[n]!==e&&(i[n]=e,!0):!!e&&(this._textures[r]=[],this._textures[r][n]=e,!0)}},{key:"setPixelStorei",value:function setPixelStorei(t,e){var r=WebGLState._getPixelStoreiIndex(t),i=!gt.equalValues(this._pixelStorei[r],e);return this._pixelStorei[r]=e,i}},{key:"migrate",value:function migrate(t){var e=this;this._migrateFlags(e,t),t._program!==e._program&&this._gl._useProgram(t._program),this._migrateFramebuffers(e,t),this._migrateRenderbuffers(e,t);var r=this._migrateBuffers(e,t);this._migrateAttributes(e,t,r),this._migrateFlags(e,t),this._migrateSettings(e,t),this._migratePixelStorei(e,t),this._migrateTextures(e,t)}},{key:"_migratePixelStorei",value:function _migratePixelStorei(t,e){for(var r=0,i=t._pixelStorei.length;r<i;r++)if(t._pixelStorei[r]!==e._pixelStorei[r]){var n=void 0!==e._pixelStorei[r]?e._pixelStorei[r]:WebGLState._getDefaultPixelStoreiByIndex(r);this._gl._pixelStorei(WebGLState._getPixelStoreiByIndex(r),n)}}},{key:"_migrateTextures",value:function _migrateTextures(t,e){for(var r=Math.max(t._maxTexture,e._maxTexture),i=t._activeTexture,n=0;n<r;n++)for(var s=e._textures[n],o=t._textures[n],u=WebGLState._getTextureByIndex(n),h=0,l=Math.max(o?o.length:0,s?s.length:0);h<l;h++){var f=WebGLState._getTextureTargetByIndex(h);i!==u&&(this._gl._activeTexture(u),i=u);var d=s&&s[h]||null;this._gl._bindTexture(f,d)}e._activeTexture!==i&&this._gl._activeTexture(e._activeTexture)}},{key:"_migrateBuffers",value:function _migrateBuffers(t,e){var r=this;return e._buffers.forEach(function(e,i){_newArrowCheck(this,r),t._buffers.get(i)!==e&&this._gl._bindBuffer(i,e)}.bind(this)),t._buffers.forEach(function(t,i){_newArrowCheck(this,r),void 0===e._buffers.get(i)&&this._gl._bindBuffer(i,null)}.bind(this)),e._buffers.get(this._gl.ARRAY_BUFFER)!==t._buffers.get(this._gl.ARRAY_BUFFER)}},{key:"_migrateFramebuffers",value:function _migrateFramebuffers(t,e){var r=this;e._framebuffers.forEach(function(e,i){_newArrowCheck(this,r),t._framebuffers.get(i)!==e&&this._gl._bindFramebuffer(i,e)}.bind(this)),t._framebuffers.forEach(function(t,i){_newArrowCheck(this,r),void 0===e._framebuffers.get(i)&&this._gl._bindFramebuffer(i,null)}.bind(this))}},{key:"_migrateRenderbuffers",value:function _migrateRenderbuffers(t,e){var r=this;e._renderbuffers.forEach(function(e,i){_newArrowCheck(this,r),t._renderbuffers.get(i)!==e&&this._gl._bindRenderbuffer(i,e)}.bind(this)),t._renderbuffers.forEach(function(t,i){_newArrowCheck(this,r),void 0===e._renderbuffers.get(i)&&this._gl._bindRenderbuffer(i,null)}.bind(this))}},{key:"_migrateAttributes",value:function _migrateAttributes(t,e,r){var i=this;r?e._vertexAttribs.forEach(function(t,e){_newArrowCheck(this,i),t[0]&&this._gl._vertexAttribPointer(e,t[0],t[1],t[2],t[3],t[4]),t[5]&&this._gl._enableVertexAttribArray(e)}.bind(this)):(t._vertexAttribs.forEach(function(t,r){_newArrowCheck(this,i),e._vertexAttribs[r]||this._gl._disableVertexAttribArray(r)}.bind(this)),e._vertexAttribs.forEach(function(t,e){_newArrowCheck(this,i),this._gl._vertexAttribPointer(e,t[0],t[1],t[2],t[4]),t[5]?this._gl._enableVertexAttribArray(e):this._gl._disableVertexAttribArray(e)}.bind(this)))}},{key:"_migrateSettings",value:function _migrateSettings(t,e){var r=this,i=this.constructor.getDefaultSettings();t._settings.forEach(function(t,n){_newArrowCheck(this,r);var s=n.name||n.xname;if(!e._settings.has(n)){var o=i.get(s);gt.isFunction(o)&&(o=o(this._gl)),e._settings.set(n,o),n.apply(this._gl,o)}}.bind(this)),e._settings.forEach(function(e,i){_newArrowCheck(this,r);var n=t._settings.get(i);n&&gt.equalValues(n,e)||i.apply(this._gl,e)}.bind(this))}},{key:"_migrateFlags",value:function _migrateFlags(t,e){var r=this;t._nonDefaultFlags.forEach(function(t){_newArrowCheck(this,r),e._nonDefaultFlags.has(t)||(this._getDefaultFlag(t)?this._gl._enable(t):this._gl._disable(t))}.bind(this)),e._nonDefaultFlags.forEach(function(e){_newArrowCheck(this,r),t._nonDefaultFlags.has(e)||(this._getDefaultFlag(e)?this._gl._disable(e):this._gl._enable(e))}.bind(this))}}],[{key:"getDefaultSettings",value:function getDefaultSettings(){if(!this._defaultSettings){this._defaultSettings=new Map;var t=this._defaultSettings,e=WebGLRenderingContext.prototype;t.set("viewport",(function(t){return[0,0,t.canvas.width,t.canvas.height]})),t.set("scissor",(function(t){return[0,0,t.canvas.width,t.canvas.height]})),t.set("blendColor",[0,0,0,0]),t.set("blendEquation",[e.FUNC_ADD]),t.set("blendEquationSeparate",[e.FUNC_ADD,e.FUNC_ADD]),t.set("blendFunc",[e.ONE,e.ZERO]),t.set("blendFuncSeparate",[e.ONE,e.ZERO,e.ONE,e.ZERO]),t.set("clearColor",[0,0,0,0]),t.set("clearDepth",[1]),t.set("clearStencil",[0]),t.set("colorMask",[!0,!0,!0,!0]),t.set("cullFace",[e.BACK]),t.set("depthFunc",[e.LESS]),t.set("depthMask",[!0]),t.set("depthRange",[0,1]),t.set("frontFace",[e.CCW]),t.set("lineWidth",[1]),t.set("polygonOffset",[0,0]),t.set("sampleCoverage",[1,!1]),t.set("stencilFunc",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFront",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateBack",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFrontAndBack",[e.ALWAYS,0,1]),t.set("stencilMask",[1]),t.set("_stencilMaskSeparateFront",[1]),t.set("_stencilMaskSeparateBack",[1]),t.set("_stencilMaskSeparateFrontAndBack",[1]),t.set("stencilOp",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFront",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFrontAndBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("vertexAttrib1f",[]),t.set("vertexAttrib1fv",[]),t.set("vertexAttrib2f",[]),t.set("vertexAttrib2fv",[]),t.set("vertexAttrib3f",[]),t.set("vertexAttrib3fv",[]),t.set("vertexAttrib4f",[]),t.set("vertexAttrib4fv",[])}return this._defaultSettings}},{key:"_getTextureTargetIndex",value:function _getTextureTargetIndex(t){switch(t){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+t)}}},{key:"_getTextureTargetByIndex",value:function _getTextureTargetByIndex(t){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[t]}},{key:"_getTextureIndex",value:function _getTextureIndex(t){return t-33984}},{key:"_getTextureByIndex",value:function _getTextureByIndex(t){return t+33984}},{key:"_getPixelStoreiIndex",value:function _getPixelStoreiIndex(t){switch(t){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+t)}}},{key:"_getPixelStoreiByIndex",value:function _getPixelStoreiByIndex(t){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[t]}},{key:"_getDefaultPixelStoreiByIndex",value:function _getDefaultPixelStoreiByIndex(t){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[t]}}]),WebGLState}(),vt=function(){function WebGLStateManager(){_classCallCheck(this,WebGLStateManager)}return _createClass(WebGLStateManager,[{key:"_initStateManager",value:function _initStateManager(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this._states={},this._state=this._getState(t)}},{key:"_getState",value:function _getState(t){return this._states[t]||(this._states[t]=new pt(t,this)),this._states[t]}},{key:"switchState",value:function switchState(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if(this._state._id!==t){var e=this._getState(t);this._state.migrate(e),this._state=e}}},{key:"$useProgram",value:function $useProgram(t){this._state.setProgram(t)&&this._useProgram(t)}},{key:"$bindBuffer",value:function $bindBuffer(t,e){this._state.setBuffer(t,e)&&this._bindBuffer(t,e)}},{key:"$bindFramebuffer",value:function $bindFramebuffer(t,e){this._state.setFramebuffer(t,e)&&this._bindFramebuffer(t,e)}},{key:"$bindRenderbuffer",value:function $bindRenderbuffer(t,e){this._state.setRenderbuffer(t,e)&&this._bindRenderbuffer(t,e)}},{key:"$enable",value:function $enable(t){this._state.setFlag(t,!0)&&this._enable(t)}},{key:"$disable",value:function $disable(t){this._state.setFlag(t,!1)&&this._disable(t)}},{key:"$viewport",value:function $viewport(t,e,r,i){this._state.setSetting(this._viewport,[t,e,r,i])&&this._viewport(t,e,r,i)}},{key:"$scissor",value:function $scissor(t,e,r,i){this._state.setSetting(this._scissor,[t,e,r,i])&&this._scissor(t,e,r,i)}},{key:"$disableVertexAttribArray",value:function $disableVertexAttribArray(t){this._state.disableVertexAttribArray(t)&&this._disableVertexAttribArray(t)}},{key:"$enableVertexAttribArray",value:function $enableVertexAttribArray(t){this._state.enableVertexAttribArray(t)&&this._enableVertexAttribArray(t)}},{key:"$vertexAttribPointer",value:function $vertexAttribPointer(t,e,r,i,n,s){this._state.vertexAttribPointer(t,[e,r,i,n,s])&&this._vertexAttribPointer(t,e,r,i,n,s)}},{key:"$activeTexture",value:function $activeTexture(t){this._state.setActiveTexture(t)&&this._activeTexture(t)}},{key:"$bindTexture",value:function $bindTexture(t,e){this._state.bindTexture(t,e)&&this._bindTexture(t,e)}},{key:"$pixelStorei",value:function $pixelStorei(t,e){this._state.setPixelStorei(t,e)&&this._pixelStorei(t,e)}},{key:"$stencilFuncSeparate",value:function $stencilFuncSeparate(t,e,r,i){var n;switch(t){case this.FRONT:n=this._stencilFuncSeparateFront;break;case this.BACK:n=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilFuncSeparateFrontAndBack}this._state.setSetting(n,[e,r,i])&&n.apply(this,[e,r,i])}},{key:"_stencilFuncSeparateFront",value:function _stencilFuncSeparateFront(t,e,r){this._stencilFuncSeparate(this.FRONT,t,e,r)}},{key:"_stencilFuncSeparateBack",value:function _stencilFuncSeparateBack(t,e,r){this._stencilFuncSeparate(this.BACK,t,e,r)}},{key:"_stencilFuncSeparateFrontAndBack",value:function _stencilFuncSeparateFrontAndBack(t,e,r){this._stencilFuncSeparate(this.FRONT_AND_BACK,t,e,r)}},{key:"$stencilMaskSeparate",value:function $stencilMaskSeparate(t,e){var r;switch(t){case this.FRONT:r=this._stencilMaskSeparateFront;break;case this.BACK:r=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:r=this._stencilMaskSeparateFrontAndBack}this._state.setSetting(r,[e])&&r.apply(this,[e])}},{key:"_stencilMaskSeparateFront",value:function _stencilMaskSeparateFront(t){this._stencilMaskSeparate(this.FRONT,t)}},{key:"_stencilMaskSeparateBack",value:function _stencilMaskSeparateBack(t){this._stencilMaskSeparate(this.BACK,t)}},{key:"_stencilMaskSeparateFrontAndBack",value:function _stencilMaskSeparateFrontAndBack(t){this._stencilMaskSeparate(this.FRONT_AND_BACK,t)}},{key:"$stencilOpSeparate",value:function $stencilOpSeparate(t,e,r,i){var n;switch(t){case this.FRONT:n=this._stencilOpSeparateFront;break;case this.BACK:n=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilOpSeparateFrontAndBack}this._state.setSetting(n,[e,r,i])&&n.apply(this,[e,r,i])}},{key:"_stencilOpSeparateFront",value:function _stencilOpSeparateFront(t,e,r){this._stencilOpSeparate(this.FRONT,t,e,r)}},{key:"_stencilOpSeparateBack",value:function _stencilOpSeparateBack(t,e,r){this._stencilOpSeparate(this.BACK,t,e,r)}},{key:"_stencilOpSeparateFrontAndBack",value:function _stencilOpSeparateFrontAndBack(t,e,r){this._stencilOpSeparate(this.FRONT_AND_BACK,t,e,r)}},{key:"$blendColor",value:function $blendColor(t,e,r,i){this._state.setSetting(this._blendColor,[t,e,r,i])&&this._blendColor(t,e,r,i)}},{key:"$blendEquation",value:function $blendEquation(t){this._state.setSetting(this._blendEquation,[t])&&this._blendEquation(t)}},{key:"$blendEquationSeparate",value:function $blendEquationSeparate(t,e){this._state.setSetting(this._blendEquationSeparate,[t,e])&&this._blendEquationSeparate(t,e)}},{key:"$blendFunc",value:function $blendFunc(t,e){this._state.setSetting(this._blendFunc,[t,e])&&this._blendFunc(t,e)}},{key:"$blendFuncSeparate",value:function $blendFuncSeparate(t,e,r,i){this._state.setSetting(this._blendFuncSeparate,[t,e,r,i])&&this._blendFuncSeparate(t,e,r,i)}},{key:"$clearColor",value:function $clearColor(t,e,r,i){this._state.setSetting(this._clearColor,[t,e,r,i])&&this._clearColor(t,e,r,i)}},{key:"$clearDepth",value:function $clearDepth(t){this._state.setSetting(this._clearDepth,[t])&&this._clearDepth(t)}},{key:"$clearStencil",value:function $clearStencil(t){this._state.setSetting(this._clearStencil,[t])&&this._clearStencil(t)}},{key:"$colorMask",value:function $colorMask(t,e,r,i){this._state.setSetting(this._colorMask,[t,e,r,i])&&this._colorMask(t,e,r,i)}},{key:"$cullFace",value:function $cullFace(t){this._state.setSetting(this._cullFace,[t])&&this._cullFace(t)}},{key:"$depthFunc",value:function $depthFunc(t){this._state.setSetting(this._depthFunc,[t])&&this._depthFunc(t)}},{key:"$depthMask",value:function $depthMask(t){this._state.setSetting(this._depthMask,[t])&&this._depthMask(t)}},{key:"$depthRange",value:function $depthRange(t,e){this._state.setSetting(this._depthRange,[t,e])&&this._depthRange(t,e)}},{key:"$frontFace",value:function $frontFace(t){this._state.setSetting(this._frontFace,[t])&&this._frontFace(t)}},{key:"$lineWidth",value:function $lineWidth(t){this._state.setSetting(this._lineWidth,[t])&&this._lineWidth(t)}},{key:"$polygonOffset",value:function $polygonOffset(t,e){this._state.setSetting(this._polygonOffset,[t,e])&&this._polygonOffset(t,e)}},{key:"$sampleCoverage",value:function $sampleCoverage(t,e){this._state.setSetting(this._sampleCoverage,[t,e])&&this._sampleCoverage(t,e)}},{key:"$stencilFunc",value:function $stencilFunc(t,e,r){this._state.setSetting(this._stencilFunc,[t,e,r])&&this._stencilFunc(t,e,r)}},{key:"$stencilMask",value:function $stencilMask(t){this._state.setSetting(this._stencilMask,[t])&&this._stencilMask(t)}},{key:"$stencilOp",value:function $stencilOp(t,e,r){this._state.setSetting(this._stencilOp,[t,e,r])&&this._stencilOp(t,e,r)}},{key:"$vertexAttrib1f",value:function $vertexAttrib1f(t,e){this._state.setSetting(this._vertexAttrib1f,[t,e])&&this._vertexAttrib1f(t,e)}},{key:"$vertexAttrib1fv",value:function $vertexAttrib1fv(t,e){this._state.setSetting(this._vertexAttrib1fv,[t,e])&&this._vertexAttrib1fv(t,e)}},{key:"$vertexAttrib2f",value:function $vertexAttrib2f(t,e,r){this._state.setSetting(this._vertexAttrib2f,[t,e,r])&&this._vertexAttrib2f(t,e,r)}},{key:"$vertexAttrib2fv",value:function $vertexAttrib2fv(t,e){this._state.setSetting(this._vertexAttrib2fv,[t,e])&&this._vertexAttrib2fv(t,e)}},{key:"$vertexAttrib3f",value:function $vertexAttrib3f(t,e,r,i){this._state.setSetting(this._vertexAttrib3f,[t,e,r,i])&&this._vertexAttrib3f(t,e,r,i)}},{key:"$vertexAttrib3fv",value:function $vertexAttrib3fv(t,e){this._state.setSetting(this._vertexAttrib3fv,[t,e])&&this._vertexAttrib3fv(t,e)}},{key:"$vertexAttrib4f",value:function $vertexAttrib4f(t,e,r,i,n){this._state.setSetting(this._vertexAttrib4f,[t,e,r,i,n])&&this._vertexAttrib4f(t,e,r,i,n)}},{key:"$vertexAttrib4fv",value:function $vertexAttrib4fv(t,e){this._state.setSetting(this._vertexAttrib4fv,[t,e])&&this._vertexAttrib4fv(t,e)}}],[{key:"enable",value:function enable(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",i=Object.getOwnPropertyNames(WebGLStateManager.prototype);return t.__proto__,i.forEach(function(r){if(_newArrowCheck(this,e),"constructor"!==r){var i=WebGLStateManager.prototype[r];"$"===r.charAt(0)&&(r=r.substr(1)),t[r]!==i&&(t[r]&&(t[r].name||(t[r].xname=r),t["_"+r]=t[r]),t[r]=i)}}.bind(this)),WebGLStateManager.prototype._initStateManager.call(t,r),t}}]),WebGLStateManager}(),yt=function(){function TextureManager(t){_classCallCheck(this,TextureManager),this.stage=t,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}return _createClass(TextureManager,[{key:"usedMemory",get:function get(){return this._usedMemory}},{key:"destroy",value:function destroy(){for(var t=0,e=this._uploadedTextureSources.length;t<e;t++)this._nativeFreeTextureSource(this._uploadedTextureSources[t]);this.textureSourceHashmap.clear(),this._usedMemory=0}},{key:"getReusableTextureSource",value:function getReusableTextureSource(t){return this.textureSourceHashmap.get(t)}},{key:"getTextureSource",value:function getTextureSource(t,e){var r=e?this.textureSourceHashmap.get(e):null;return r||(r=new m(this,t),e&&(r.lookupId=e,this.textureSourceHashmap.set(e,r))),r}},{key:"uploadTextureSource",value:function uploadTextureSource(t,e){if(!t.isLoaded()){this._addMemoryUsage(t.w*t.h);var r=this._nativeUploadTextureSource(t,e);t._nativeTexture=r,r.w=t.w,r.h=t.h,r.update=this.stage.frameCounter,this._uploadedTextureSources.push(t),this.addToLookupMap(t)}}},{key:"_addMemoryUsage",value:function _addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}},{key:"addToLookupMap",value:function addToLookupMap(t){var e=t.lookupId;e&&(this.textureSourceHashmap.has(e)||this.textureSourceHashmap.set(e,t))}},{key:"gc",value:function gc(){this.freeUnusedTextureSources(),this._cleanupLookupMap()}},{key:"freeUnusedTextureSources",value:function freeUnusedTextureSources(){for(var t=[],e=0,r=this._uploadedTextureSources.length;e<r;e++){var i=this._uploadedTextureSources[e];i.allowCleanup()?this._freeManagedTextureSource(i):t.push(i)}this._uploadedTextureSources=t,this._cleanupLookupMap()}},{key:"_freeManagedTextureSource",value:function _freeManagedTextureSource(t){t.isLoaded()&&(this._nativeFreeTextureSource(t),this._addMemoryUsage(-t.w*t.h)),t.loadingSince=null}},{key:"_cleanupLookupMap",value:function _cleanupLookupMap(){var t=this;this.textureSourceHashmap.forEach(function(e,r){_newArrowCheck(this,t),e.isLoaded()||e.isLoading()||e.isUsed()||this.textureSourceHashmap.delete(r)}.bind(this))}},{key:"freeTextureSource",value:function freeTextureSource(t){var e=this._uploadedTextureSources.indexOf(t),r=-1!==e;t.isLoaded()&&(r&&(this._addMemoryUsage(-t.w*t.h),this._uploadedTextureSources.splice(e,1)),this._nativeFreeTextureSource(t)),t.loadingSince=null}},{key:"_nativeUploadTextureSource",value:function _nativeUploadTextureSource(t,e){return this.stage.renderer.uploadTextureSource(t,e)}},{key:"_nativeFreeTextureSource",value:function _nativeFreeTextureSource(t){this.stage.renderer.freeTextureSource(t),t.clearNativeTexture()}}]),TextureManager}(),xt=function(){function TextureThrottler(t){var e=this;_classCallCheck(this,TextureThrottler),this.stage=t,this.genericCancelCb=function(t){_newArrowCheck(this,e),this._remove(t)}.bind(this),this._sources=[],this._data=[]}return _createClass(TextureThrottler,[{key:"destroy",value:function destroy(){this._sources=[],this._data=[]}},{key:"processSome",value:function processSome(){if(this._sources.length){var t=Date.now();do{this._processItem()}while(this._sources.length&&Date.now()-t<TextureThrottler.MAX_UPLOAD_TIME_PER_FRAME)}}},{key:"_processItem",value:function _processItem(){var t=this._sources.pop(),e=this._data.pop();t.isLoading()&&t.processLoadedSource(e)}},{key:"add",value:function add(t,e){this._sources.push(t),this._data.push(e)}},{key:"_remove",value:function _remove(t){var e=this._sources.indexOf(t);e>=0&&(this._sources.splice(e,1),this._data.splice(e,1))}}]),TextureThrottler}();xt.MAX_UPLOAD_TIME_PER_FRAME=10;var mt=function(){function CoreContext(t){_classCallCheck(this,CoreContext),this.stage=t,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[]}return _createClass(CoreContext,[{key:"usedMemory",get:function get(){return this._usedMemory}},{key:"destroy",value:function destroy(){var t=this;this._renderTexturePool.forEach(function(e){return _newArrowCheck(this,t),this._freeRenderTexture(e)}.bind(this)),this._usedMemory=0}},{key:"hasRenderUpdates",value:function hasRenderUpdates(){return!!this.root._parent._hasRenderUpdates}},{key:"render",value:function render(){this.root._parent._hasRenderUpdates=0,this._render()}},{key:"update",value:function update(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}},{key:"_performForcedZSorts",value:function _performForcedZSorts(){if(this._zSorts.length){for(var t=0,e=this._zSorts.length;t<e;t++)this._zSorts[t].zSort&&this._zSorts[t].sortZIndexedChildren();this._zSorts=[]}}},{key:"_update",value:function _update(){this.updateTreeOrder=0,this.root.update()}},{key:"_render",value:function _render(){if(this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")){var t=new Uint8Array(4),e=this.stage.gl;e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,t)}this._performRender()}},{key:"_fillRenderState",value:function _fillRenderState(){this.renderState.reset(),this.root.render(),this.renderState.finish()}},{key:"_performRender",value:function _performRender(){this.renderExec.execute()}},{key:"_addMemoryUsage",value:function _addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}},{key:"allocateRenderTexture",value:function allocateRenderTexture(t,e){for(var r=this.stage.getRenderPrecision(),i=Math.max(1,Math.round(t*r)),n=Math.max(1,Math.round(e*r)),s=this._renderTexturePool.length-1;s>=0;s--){var o=this._renderTexturePool[s];if(o.w===i&&o.h===n&&o.update!==this.stage.frameCounter)return o.f=this.stage.frameCounter,this._renderTexturePool.splice(s,1),o}var u=this._createRenderTexture(t,e,i,n);return u.precision=r,u}},{key:"releaseRenderTexture",value:function releaseRenderTexture(t){this._renderTexturePool.push(t)}},{key:"freeUnusedRenderTextures",value:function freeUnusedRenderTextures(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,r=this.stage.frameCounter-e;this._renderTexturePool=this._renderTexturePool.filter(function(e){return _newArrowCheck(this,t),!(e.f<=r&&(this._freeRenderTexture(e),1))}.bind(this))}},{key:"_createRenderTexture",value:function _createRenderTexture(t,e,r,i){this._addMemoryUsage(r*i);var n=this.stage.renderer.createRenderTexture(t,e,r,i);return n.id=this._renderTextureId++,n.f=this.stage.frameCounter,n.ow=t,n.oh=e,n.w=r,n.h=i,n}},{key:"_freeRenderTexture",value:function _freeRenderTexture(t){this.stage.renderer.freeRenderTexture(t),this._addMemoryUsage(-t.w*t.h)}},{key:"copyRenderTexture",value:function copyRenderTexture(t,e,r){this.stage.renderer.copyRenderTexture(t,e,r)}},{key:"forceZSort",value:function forceZSort(t){this._zSorts.push(t)}}]),CoreContext}(),St=function(){function TransitionSettings(t){_classCallCheck(this,TransitionSettings),this.stage=t,this._timingFunction="ease",this._timingFunctionImpl=e.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}return _createClass(TransitionSettings,[{key:"timingFunction",get:function get(){return this._timingFunction},set:function set(t){this._timingFunction=t,this._timingFunctionImpl=e.getTimingFunction(t)}},{key:"timingFunctionImpl",get:function get(){return this._timingFunctionImpl}},{key:"patch",value:function patch(t){i.patchObject(this,t)}}]),TransitionSettings}();St.prototype.isTransitionSettings=!0;var bt=function(){function TransitionManager(t){var e=this;_classCallCheck(this,TransitionManager),this.stage=t,this.stage.on("frameStart",function(){return _newArrowCheck(this,e),this.progress()}.bind(this)),this.active=new Set,this.defaultTransitionSettings=new St(this.stage)}return _createClass(TransitionManager,[{key:"progress",value:function progress(){var t=this;if(this.active.size){var e=this.stage.dt,r=!1;this.active.forEach((function(t){t.progress(e),t.isRunning()||(r=!0)})),r&&(this.active=new Set(_toConsumableArray(this.active).filter(function(e){return _newArrowCheck(this,t),e.isRunning()}.bind(this))))}}},{key:"createSettings",value:function createSettings(t){var e=new St;return i.patchObject(e,t),e}},{key:"addActive",value:function addActive(t){this.active.add(t)}},{key:"removeActive",value:function removeActive(t){this.active.delete(t)}}]),TransitionManager}(),kt=function(){function MultiSpline(){_classCallCheck(this,MultiSpline),this._clear()}return _createClass(MultiSpline,[{key:"_clear",value:function _clear(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}},{key:"parse",value:function parse(t,e){var i,n;r.isObjectLiteral(e)||(e={0:e});var s=.5,o=[];for(var u in e)if(e.hasOwnProperty(u)){var h=e[u];r.isObjectLiteral(h)||(h={v:h});var l=parseFloat(u);"sm"===u?s=h.v:!isNaN(l)&&l>=0&&l<=2&&(h.p=l,h.f=r.isFunction(h.v),h.lv=h.f?h.v(0,0):h.v,o.push(h))}for(n=(o=o.sort((function(t,e){return t.p-e.p}))).length,i=0;i<n;i++){var f=i===n-1;if(o[i].hasOwnProperty("pe")){var d=i<n-1?o[i+1].p:1;o[i].pe>d&&(o[i].pe=d)}else o[i].pe=f?o[i].p<=1?1:2:o[i+1].p;o[i].pe===o[i].p?o[i].idp=0:o[i].idp=1/(o[i].pe-o[i].p)}for(i=0;i<n;i++)if(o[i].hasOwnProperty("sm")||(o[i].sm=s),!o[i].hasOwnProperty("s"))if(0===i||i===n-1||1===o[i].p)o[i].s=t?[0,0,0,0]:0;else{var _=o[i-1],g=o[i+1];if(_.p===g.p)o[i].s=t?[0,0,0,0]:0;else if(t){var p=MultiSpline.getRgbaComponents(g.lv),v=MultiSpline.getRgbaComponents(_.lv),y=1/(g.p-_.p);o[i].s=[y*(p[0]-v[0]),y*(p[1]-v[1]),y*(p[2]-v[2]),y*(p[3]-v[3])]}else o[i].s=(g.lv-_.lv)/(g.p-_.p)}for(i=0;i<n-1;i++)if(!o[i].f){var x=i===n-1;o[i].hasOwnProperty("ve")||(o[i].ve=x?o[i].lv:o[i+1].lv),r.isNumber(o[i].v)&&r.isNumber(o[i].lv)&&(o[i].hasOwnProperty("sme")||(o[i].sme=x?s:o[i+1].sm),o[i].hasOwnProperty("se")||(o[i].se=x?t?[0,0,0,0]:0:o[i+1].s),o[i].v=t?MultiSpline.getSplineRgbaValueFunction(o[i].v,o[i].ve,o[i].p,o[i].pe,o[i].sm,o[i].sme,o[i].s,o[i].se):MultiSpline.getSplineValueFunction(o[i].v,o[i].ve,o[i].p,o[i].pe,o[i].sm,o[i].sme,o[i].s,o[i].se),o[i].f=!0)}for(this.length&&this._clear(),i=0,n=o.length;i<n;i++)this._add(o[i])}},{key:"_add",value:function _add(t){this._p.push(t.p||0),this._pe.push(t.pe||0),this._idp.push(t.idp||0),this._f.push(t.f||!1),this._v.push(t.hasOwnProperty("v")?t.v:0),this._lv.push(t.lv||0),this._sm.push(t.sm||0),this._s.push(t.s||0),this._ve.push(t.ve||0),this._sme.push(t.sme||0),this._se.push(t.se||0),this._length++}},{key:"_getItem",value:function _getItem(t){var e=this._length;if(!e)return-1;if(t<this._p[0])return 0;for(var r=0;r<e;r++)if(this._p[r]<=t&&t<this._pe[r])return r;return e-1}},{key:"getValue",value:function getValue(t){var e=this._getItem(t);if(-1!==e){if(this._f[e]){var r=Math.min(1,Math.max(0,(t-this._p[e])*this._idp[e]));return this._v[e](r)}return this._v[e]}}},{key:"length",get:function get(){return this._length}}],[{key:"getRgbaComponents",value:function getRgbaComponents(t){return[(t/65536|0)%256,(t/256|0)%256,t%256,t/16777216|0]}},{key:"getSplineValueFunction",value:function getSplineValueFunction(t,e,r,i,n,s,o,u){var h=i-r;o*=h,u*=h;var l=MultiSpline.getSplineHelpers(t,e,n,s,o,u);return l?function(r){return 0===r?t:1===r?e:MultiSpline.calculateSpline(l,r)}:function(r){return 0===r?t:1===r?e:e*r+t*(1-r)}}},{key:"getSplineRgbaValueFunction",value:function getSplineRgbaValueFunction(t,e,r,i,n,s,o,u){var h=i-r;o[0]*=h,o[1]*=h,o[2]*=h,o[3]*=h,u[0]*=h,u[1]*=h,u[2]*=h,u[3]*=h;var l=MultiSpline.getRgbaComponents(t),f=MultiSpline.getRgbaComponents(e),d=[MultiSpline.getSplineHelpers(l[0],f[0],n,s,o[0],u[0]),MultiSpline.getSplineHelpers(l[1],f[1],n,s,o[1],u[1]),MultiSpline.getSplineHelpers(l[2],f[2],n,s,o[2],u[2]),MultiSpline.getSplineHelpers(l[3],f[3],n,s,o[3],u[3])];return d[0]?function(r){return 0===r?t:1===r?e:MultiSpline.getArgbNumber([Math.min(255,MultiSpline.calculateSpline(d[0],r)),Math.min(255,MultiSpline.calculateSpline(d[1],r)),Math.min(255,MultiSpline.calculateSpline(d[2],r)),Math.min(255,MultiSpline.calculateSpline(d[3],r))])}:function(r){return 0===r?t:1===r?e:MultiSpline.mergeColors(e,t,r)}}},{key:"getSplineHelpers",value:function getSplineHelpers(t,e,r,i,n,s){if(!r&&!i)return null;var o=t+n*r,u=1-i,h=e-s*i;return[3*r-3*u+1,-6*r+3*u,3*r,3*o-3*h+e-t,3*(h+t)-6*o,3*(o-t),t]}},{key:"calculateSpline",value:function calculateSpline(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],u=t[5],h=t[6];if(-2===r&&-2===s&&0===n&&0===u)return e;for(var l,f=.5,d=0;d<20;d++){if((l=e-f*(f*(f*r+i)+n))>-1e-8&&l<1e-8)return f*(f*(f*s+o)+u)+h;var _=f*(f*(3*r)+2*i)+n;if(_>1e-10&&_<1e-10)break;f+=l/_}for(var g=0,p=1,v=0;v<20;v++){if((l=e-(f=.5*(g+p))*(f*(f*r+i)+n))>-1e-8&&l<1e-8)return f*(f*(f*s+o)+u)+h;l<0?p=f:g=f}return f}},{key:"mergeColors",value:function mergeColors(t,e,r){var i=(t/65536|0)%256*r+(e/65536|0)%256*(1-r),n=(t/256|0)%256*r+(e/256|0)%256*(1-r),s=t%256*r+e%256*(1-r),o=(t/16777216|0)*r+(e/16777216|0)*(1-r);return 16777216*Math.round(o)+65536*Math.round(i)+256*Math.round(n)+Math.round(s)}},{key:"getArgbNumber",value:function getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));var e=((0|t[3])<<24)+((0|t[0])<<16)+((0|t[1])<<8)+(0|t[2]);return e<0&&(e=4294967295+e+1),e}}]),MultiSpline}(),Tt=function(){function AnimationActionSettings(t){_classCallCheck(this,AnimationActionSettings),this.animationSettings=t,this._selector="",this._items=new kt,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}return _createClass(AnimationActionSettings,[{key:"getResetValue",value:function getResetValue(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}},{key:"apply",value:function apply(t,i,n){var s=this.getAnimatedElements(t),o=this._items.getValue(i);if(void 0!==o&&s.length){if(1!==n){var u=this.getResetValue();r.isNumber(o)&&r.isNumber(u)&&(o=this.hasColorProperty()?e.mergeColors(o,u,n):e.mergeNumbers(o,u,n))}for(var h=this._propSetters.length,l=s.length,f=0;f<l;f++)for(var d=0;d<h;d++)this._propSetters[d](s[f],o)}}},{key:"getAnimatedElements",value:function getAnimatedElements(t){return t.select(this._selector)}},{key:"reset",value:function reset(t){var e=this.getAnimatedElements(t),r=this.getResetValue();if(void 0!==r&&e.length)for(var i=this._propSetters.length,n=e.length,s=0;s<n;s++)for(var o=0;o<i;o++)this._propSetters[o](e[s],r)}},{key:"selector",set:function set(t){this._selector=t}},{key:"t",set:function set(t){this.selector=t}},{key:"resetValue",get:function get(){return this._resetValue},set:function set(t){this._resetValue=t,this._hasResetValue=void 0!==t}},{key:"rv",set:function set(t){this.resetValue=t}},{key:"value",set:function set(t){this._items.parse(this.hasColorProperty(),t)}},{key:"v",set:function set(t){this.value=t}},{key:"properties",set:function set(t){var e=this;Array.isArray(t)||(t=[t]),this._props=[],t.forEach(function(t){_newArrowCheck(this,e),this._props.push(t),this._propSetters.push(U.getSetter(t))}.bind(this))}},{key:"property",set:function set(t){this._hasColorProperty=void 0,this.properties=t}},{key:"p",set:function set(t){this.properties=t}},{key:"patch",value:function patch(t){i.patchObject(this,t)}},{key:"hasColorProperty",value:function hasColorProperty(){return void 0===this._hasColorProperty&&(this._hasColorProperty=!!this._props.length&&U.isColorProperty(this._props[0])),this._hasColorProperty}}]),AnimationActionSettings}();Tt.prototype.isAnimationActionSettings=!0;var Ct=function(){function AnimationSettings(){_classCallCheck(this,AnimationSettings),this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=AnimationSettings.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=e.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}return _createClass(AnimationSettings,[{key:"actions",get:function get(){return this._actions},set:function set(t){this._actions=[];for(var e=0,r=t.length;e<r;e++){var i=t[e];if(i.isAnimationActionSettings)this._actions.push(i);else{var n=new Tt(this);n.patch(i),this._actions.push(n)}}}},{key:"apply",value:function apply(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._actions.forEach((function(i){i.apply(t,e,r)}))}},{key:"reset",value:function reset(t){this._actions.forEach((function(e){e.reset(t)}))}},{key:"stopTimingFunction",get:function get(){return this._stopTimingFunction},set:function set(t){this._stopTimingFunction=t,this._stopTimingFunctionImpl=e.getTimingFunction(t)}},{key:"stopTimingFunctionImpl",get:function get(){return this._stopTimingFunctionImpl}},{key:"patch",value:function patch(t){i.patchObject(this,t)}}]),AnimationSettings}();Ct.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};var wt=function(t){_inherits(Animation,t);var e=_createSuper(Animation);function Animation(t,r,i){var n;return _classCallCheck(this,Animation),(n=e.call(this)).manager=t,n._settings=r,n._element=i,n._state=Animation.STATES.IDLE,n._p=0,n._delayLeft=0,n._repeatsLeft=0,n._stopDelayLeft=0,n._stopP=0,n}return _createClass(Animation,[{key:"start",value:function start(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=Animation.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}},{key:"play",value:function play(){this._state===Animation.STATES.PAUSED?(this._state=Animation.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==Animation.STATES.STOPPING&&this.settings.stopMethod==Ct.STOP_METHODS.REVERSE?(this._state=Animation.STATES.PLAYING,this.emit("stopContinue")):this._state!=Animation.STATES.PLAYING&&this._state!=Animation.STATES.FINISHED&&this.start()}},{key:"pause",value:function pause(){this._state===Animation.STATES.PLAYING&&(this._state=Animation.STATES.PAUSED,this.emit("pause"))}},{key:"replay",value:function replay(){this._state==Animation.STATES.FINISHED?this.start():this.play()}},{key:"skipDelay",value:function skipDelay(){this._delayLeft=0,this._stopDelayLeft=0}},{key:"finish",value:function finish(){this._state===Animation.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===Animation.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}},{key:"stop",value:function stop(){this._state!==Animation.STATES.STOPPED&&this._state!==Animation.STATES.IDLE&&(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===Ct.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=Animation.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===Ct.STOP_METHODS.FADE&&(this._stopP=0),this._state=Animation.STATES.STOPPING,this.emit("stop")),this.checkActive())}},{key:"stopNow",value:function stopNow(){this._state===Animation.STATES.STOPPED&&this._state===Animation.STATES.IDLE||(this._state=Animation.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=Animation.STATES.STOPPED,this.emit("stopFinish"))}},{key:"isPaused",value:function isPaused(){return this._state===Animation.STATES.PAUSED}},{key:"isPlaying",value:function isPlaying(){return this._state===Animation.STATES.PLAYING}},{key:"isStopping",value:function isStopping(){return this._state===Animation.STATES.STOPPING}},{key:"isFinished",value:function isFinished(){return this._state===Animation.STATES.FINISHED}},{key:"checkActive",value:function checkActive(){this.isActive()&&this.manager.addActive(this)}},{key:"isActive",value:function isActive(){return(this._state==Animation.STATES.PLAYING||this._state==Animation.STATES.STOPPING)&&this._element&&this._element.attached}},{key:"progress",value:function progress(t){this._element&&(this._progress(t),this.apply())}},{key:"_progress",value:function _progress(t){if(this._state!=Animation.STATES.STOPPING){if(this._state==Animation.STATES.PLAYING){if(this._delayLeft>0){if(this._delayLeft-=t,!(this._delayLeft<0))return;t=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd")}0===this.settings.duration?this._p=1:this.settings.duration>0&&(this._p+=t/this.settings.duration),this._p>=1?-1==this.settings.repeat||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=Animation.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}else this._stopProgress(t)}},{key:"_stopProgress",value:function _stopProgress(t){var e=this._getStopDuration();if(this._stopDelayLeft>0){if(this._stopDelayLeft-=t,!(this._stopDelayLeft<0))return;t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd")}this.settings.stopMethod==Ct.STOP_METHODS.IMMEDIATE?(this._state=Animation.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==Ct.STOP_METHODS.REVERSE?(0===e?this._p=0:e>0&&(this._p-=t/e),this._p<=0&&(this._p=0,this._state=Animation.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==Ct.STOP_METHODS.FADE?(this._progressStopTransition(t),this._stopP>=1&&(this._p=0,this._state=Animation.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==Ct.STOP_METHODS.ONETOTWO?this._p<2&&(0===e?this._p=2:e>0&&(this._p<1?this._p+=t/this.settings.duration:this._p+=t/e),this._p>=2?(this._p=2,this._state=Animation.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==Ct.STOP_METHODS.FORWARD&&this._p<1&&(0==this.settings.duration?this._p=1:this._p+=t/this.settings.duration,this._p>=1?this.settings.stopMethod==Ct.STOP_METHODS.FORWARD?(this._p=1,this._state=Animation.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=Animation.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}},{key:"_progressStopTransition",value:function _progressStopTransition(t){if(this._stopP<1){if(this._stopDelayLeft>0){if(this._stopDelayLeft-=t,!(this._stopDelayLeft<0))return;t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd")}var e=this._getStopDuration();0==e?this._stopP=1:this._stopP+=t/e,this._stopP>=1&&(this._stopP=1)}}},{key:"_getStopDuration",value:function _getStopDuration(){return this.settings.stopDuration||this.settings.duration}},{key:"apply",value:function apply(){if(this._state===Animation.STATES.STOPPED)this.reset();else{var t=1;this._state===Animation.STATES.STOPPING&&this.settings.stopMethod===Ct.STOP_METHODS.FADE&&(t=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,t)}}},{key:"reset",value:function reset(){this._settings.reset(this._element)}},{key:"state",get:function get(){return this._state}},{key:"p",get:function get(){return this._p}},{key:"delayLeft",get:function get(){return this._delayLeft}},{key:"element",get:function get(){return this._element}},{key:"frame",get:function get(){return Math.round(this._p*this._settings.duration*60)}},{key:"settings",get:function get(){return this._settings}}]),Animation}(T);wt.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};var At=function(){function AnimationManager(t){var e=this;_classCallCheck(this,AnimationManager),this.stage=t,this.stage.on("frameStart",function(){return _newArrowCheck(this,e),this.progress()}.bind(this)),this.active=new Set}return _createClass(AnimationManager,[{key:"progress",value:function progress(){var t=this;if(this.active.size){var e=this.stage.dt,r=!1;this.active.forEach((function(t){t.isActive()?t.progress(e):r=!0})),r&&(this.active=new Set(_toConsumableArray(this.active).filter(function(e){return _newArrowCheck(this,t),e.isActive()}.bind(this))))}}},{key:"createAnimation",value:function createAnimation(t,e){return r.isObjectLiteral(e)&&(e=this.createSettings(e)),new wt(this,e,t)}},{key:"createSettings",value:function createSettings(t){var e=new Ct;return i.patchObject(e,t),e}},{key:"addActive",value:function addActive(t){this.active.add(t)}}]),AnimationManager}(),Rt=function(t){_inherits(RectangleTexture,t);var e=_createSuper(RectangleTexture);function RectangleTexture(){return _classCallCheck(this,RectangleTexture),e.apply(this,arguments)}return _createClass(RectangleTexture,[{key:"_getLookupId",value:function _getLookupId(){return"__whitepix"}},{key:"_getSourceLoader",value:function _getSourceLoader(){return function(t){t(null,{source:new Uint8Array([255,255,255,255]),w:1,h:1,permanent:!0})}}},{key:"isAutosizeTexture",value:function isAutosizeTexture(){return!1}}]),RectangleTexture}(w),Et=function(t){_inherits(Stage,t);var i=_createSuper(Stage);function Stage(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Stage),(t=i.call(this))._setOptions(e),t._usedMemory=0,t._lastGcFrame=0;var n=Stage.platform?Stage.platform:_t.load(e);t.platform=new n,t.platform.init&&t.platform.init(_assertThisInitialized(t)),t.gl=null,t.c2d=null;var s=t.getOption("context");return s?s.useProgram?t.gl=s:t.c2d=s:!r.isWeb||Stage.isWebglSupported()&&!t.getOption("canvas2d")?t.gl=t.platform.createWebGLContext(t.getOption("w"),t.getOption("h")):t.c2d=t.platform.createCanvasContext(t.getOption("w"),t.getOption("h")),t.gl&&vt.enable(t.gl,"lightning"),t._mode=t.gl?0:1,t.getCanvas()&&(t._options.w=t.getCanvas().width,t._options.h=t.getCanvas().height),0===t._mode?r.isSpark?t._renderer=new ht(_assertThisInitialized(t)):t._renderer=new Q(_assertThisInitialized(t)):t._renderer=new ot(_assertThisInitialized(t)),t.setClearColor(t.getOption("clearColor")),t.frameCounter=0,t.transitions=new bt(_assertThisInitialized(t)),t.animations=new At(_assertThisInitialized(t)),t.textureManager=new yt(_assertThisInitialized(t)),t.textureThrottler=new xt(_assertThisInitialized(t)),t.startTime=0,t.currentTime=0,t.dt=0,t.rectangleTexture=new Rt(_assertThisInitialized(t)),t.rectangleTexture.load(),t.rectangleTexture.source.permanent=!0,t.ctx=new mt(_assertThisInitialized(t)),t._updateSourceTextures=new Set,t}return _createClass(Stage,[{key:"renderer",get:function get(){return this._renderer}},{key:"mode",get:function get(){return this._mode}},{key:"isWebgl",value:function isWebgl(){return 0===this.mode}},{key:"isC2d",value:function isC2d(){return 1===this.mode}},{key:"getOption",value:function getOption(t){return this._options[t]}},{key:"_setOptions",value:function _setOptions(t){var e=this;this._options={};var r=function opt(r,i){_newArrowCheck(this,e);var n=t[r];this._options[r]=void 0===n?i:n}.bind(this);r("canvas",null),r("context",null),r("w",1920),r("h",1080),r("srcBasePath",null),r("memoryPressure",24e6),r("bufferMemory",2e6),r("textRenderIssueMargin",0),r("fontSharp",{precision:.6666666667,fontSize:24}),r("clearColor",[0,0,0,0]),r("defaultFontFace","sans-serif"),r("fixedDt",0),r("useImageWorker",!0),r("autostart",!0),r("precision",1),r("canvas2d",!1),r("platform",null),r("readPixelsBeforeDraw",!1)}},{key:"setApplication",value:function setApplication(t){this.application=t}},{key:"init",value:function init(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}},{key:"destroy",value:function destroy(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy()}},{key:"stop",value:function stop(){this.platform.stopLoop()}},{key:"resume",value:function resume(){this.platform.startLoop()}},{key:"root",get:function get(){return this.application}},{key:"getCanvas",value:function getCanvas(){return this._mode?this.c2d.canvas:this.gl.canvas}},{key:"getRenderPrecision",value:function getRenderPrecision(){return this._options.precision}},{key:"addUpdateSourceTexture",value:function addUpdateSourceTexture(t){this._updatingFrame?t._performUpdateSource():this._updateSourceTextures.add(t)}},{key:"removeUpdateSourceTexture",value:function removeUpdateSourceTexture(t){this._updateSourceTextures&&this._updateSourceTextures.delete(t)}},{key:"hasUpdateSourceTexture",value:function hasUpdateSourceTexture(t){return this._updateSourceTextures&&this._updateSourceTextures.has(t)}},{key:"drawFrame",value:function drawFrame(){var t=this;this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02,this.emit("frameStart"),this._updateSourceTextures.size&&(this._updateSourceTextures.forEach(function(e){_newArrowCheck(this,t),e._performUpdateSource()}.bind(this)),this._updateSourceTextures=new Set),this.emit("update");var e=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),e&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(e),this.emit("frameEnd"),this.frameCounter++}},{key:"isUpdatingFrame",value:function isUpdatingFrame(){return this._updatingFrame}},{key:"renderFrame",value:function renderFrame(){this.ctx.frame()}},{key:"forceRenderUpdate",value:function forceRenderUpdate(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}},{key:"setClearColor",value:function setClearColor(t){this.forceRenderUpdate(),null===t?this._clearColor=null:Array.isArray(t)?this._clearColor=t:this._clearColor=e.getRgbaComponentsNormalized(t)}},{key:"getClearColor",value:function getClearColor(){return this._clearColor}},{key:"createElement",value:function createElement(t){return t?this.element(t):new U(this)}},{key:"createShader",value:function createShader(t){return C.create(this,t)}},{key:"element",value:function element(t){return t.isElement?t:(element=t.type?new t.type(this):new U(this),element.patch(t),element);var element}},{key:"c",value:function c(t){return this.element(t)}},{key:"w",get:function get(){return this._options.w}},{key:"h",get:function get(){return this._options.h}},{key:"coordsWidth",get:function get(){return this.w/this._options.precision}},{key:"coordsHeight",get:function get(){return this.h/this._options.precision}},{key:"addMemoryUsage",value:function addMemoryUsage(t){this._usedMemory+=t,this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}},{key:"usedMemory",get:function get(){return this._usedMemory}},{key:"gc",value:function gc(t){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;var e=this._usedMemory;if(this.gcTextureMemory(t),this.gcRenderTextureMemory(t),this.renderer.gc(t),this.application.getOption("debug")){console.log("[Lightning] GC".concat(t?"[aggressive]":"","! Frame ").concat(this._lastGcFrame," Freed ").concat(((e-this._usedMemory)/1e6).toFixed(2),"MP from GPU memory. Remaining: ").concat((this._usedMemory/1e6).toFixed(2),"MP"));var r=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log("[Lightning] Textures: ".concat((this.textureManager.usedMemory/1e6).toFixed(2),"MP, Render Textures: ").concat((this.ctx.usedMemory/1e6).toFixed(2),"MP, Renderer caches: ").concat((r/1e6).toFixed(2),"MP"))}}}},{key:"gcTextureMemory",value:function gcTextureMemory(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}},{key:"gcRenderTextureMemory",value:function gcRenderTextureMemory(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}},{key:"getDrawingCanvas",value:function getDrawingCanvas(){return this.platform.getDrawingCanvas()}},{key:"update",value:function update(){this.ctx.update()}},{key:"addServiceProvider",value:function addServiceProvider(t){r.isSpark&&this.platform.addServiceProvider(t)}},{key:"getChildrenByPosition",value:function getChildrenByPosition(t,e){var r=[];return this.root.core.update(),this.root.core.collectAtCoord(t,e,r),r}}],[{key:"isWebglSupported",value:function isWebglSupported(){if(r.isNode)return!0;try{return!!window.WebGLRenderingContext}catch(t){return!1}}}]),Stage}(T),Lt=function(t){_inherits(Application,t);var e=_createSuper(Application);function Application(){var t,r=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;_classCallCheck(this,Application),Application._temp_options=i,Application.booting=!0;var s=new Et(i.stage);return t=e.call(this,s,n),Application.booting=!1,t.__updateFocusCounter=0,t.__keypressTimers=new Map,t.__hoveredChild=null,t.stage.init(),t.updateFocusSettings(),t.__keymap=t.getOption("keys"),t.__keymap&&(t.stage.platform.registerKeydownHandler(function(e){_newArrowCheck(this,r),t._receiveKeydown(e)}.bind(this)),t.stage.platform.registerKeyupHandler(function(e){_newArrowCheck(this,r),t._receiveKeyup(e)}.bind(this))),t.getOption("enablePointer")&&(t.stage.platform.registerClickHandler(function(e){_newArrowCheck(this,r),t._receiveClick(e)}.bind(this)),t.stage.platform.registerHoverHandler(function(e){_newArrowCheck(this,r),t._receiveHover(e)}.bind(this)),t.stage.platform.registerScrollWheelHandler(function(e){_newArrowCheck(this,r),t._recieveScrollWheel(e)}.bind(this)),t.cursor="default"),t}return _createClass(Application,[{key:"getOption",value:function getOption(t){return this.__options[t]}},{key:"_setOptions",value:function _setOptions(t){var e=this;this.__options={};var r=function opt(r,i){_newArrowCheck(this,e);var n=t[r];this.__options[r]=void 0===n?i:n}.bind(this);r("debug",!1),r("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),r("enablePointer",!1)}},{key:"__construct",value:function __construct(){this.stage.setApplication(this),this._setOptions(Application._temp_options),delete Application._temp_options,_get(_getPrototypeOf(Application.prototype),"__construct",this).call(this)}},{key:"__init",value:function __init(){_get(_getPrototypeOf(Application.prototype),"__init",this).call(this),this.__updateFocus()}},{key:"updateFocusPath",value:function updateFocusPath(){this.__updateFocus()}},{key:"__updateFocus",value:function __updateFocus(){var t=this.__updateFocusRec();!Application.booting&&t&&this.updateFocusSettings()}},{key:"__updateFocusRec",value:function __updateFocusRec(){var t=++this.__updateFocusCounter;this.__updateFocusId=t;var e=this.__getFocusPath(),r=e[e.length-1],i=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(!i){this._focusPath=[];for(var n=0,s=e.length;n<s;n++)if(this._focusPath.push(e[n]),this._focusPath[n]._focus(r,void 0),this.__updateFocusId!==t)return!1;return!0}var o,u=Math.min(this._focusPath.length,e.length);for(o=0;o<u&&this._focusPath[o]===e[o];o++);if(this._focusPath.length!==e.length||o!==e.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+r.getLocationString());for(var h=this._focusPath.length-1;h>=o;h--)if(this._focusPath.pop()._unfocus(r,i),this.__updateFocusId!==t)return!1;for(var l=o,f=e.length;l<f;l++)if(this._focusPath.push(e[l]),this._focusPath[l]._focus(r,i),this.__updateFocusId!==t)return!1;for(var d=0;d<o;d++)this._focusPath[d]._focusChange(r,i)}return!0}},{key:"updateFocusSettings",value:function updateFocusSettings(){for(var t=this._focusPath[this._focusPath.length-1],e={},r=j.prototype._setFocusSettings,i=0,n=this._focusPath.length;i<n;i++)this._focusPath[i]._setFocusSettings!==r&&this._focusPath[i]._setFocusSettings(e);for(var s=j.prototype._handleFocusSettings,o=0,u=this._focusPath.length;o<u;o++)this._focusPath[o]._handleFocusSettings!==s&&this._focusPath[o]._handleFocusSettings(e,this.__prevFocusSettings,t);this.__prevFocusSettings=e}},{key:"_handleFocusSettings",value:function _handleFocusSettings(t,e,r,i){}},{key:"__getFocusPath",value:function __getFocusPath(){for(var t=[this],e=this;;){var r=e._getFocused();if(!r||r===e)break;var i=r.cparent;if(i===e)t.push(r);else{var n=[r];do{i||e._throwError("Return value for _getFocused must be an attached descendant component but its '"+r.getLocationString()+"'"),n.push(i),i=i.cparent}while(i!==e);for(var s=0,o=n.length;s<o;s++)t.push(n[o-s-1])}e=r}return t}},{key:"focusPath",get:function get(){return this._focusPath}},{key:"focusTopDownEvent",value:function focusTopDownEvent(t){for(var e=this.focusPath,r=e.length,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];for(var o=0;o<r;o++){var u,h=e[o]._getMostSpecificHandledMember(t);if(void 0!==h&&!1!==(u=e[o])[h].apply(u,n))return!0}return!1}},{key:"focusBottomUpEvent",value:function focusBottomUpEvent(t){for(var e=this.focusPath,r=e.length,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];for(var o=r-1;o>=0;o--){var u,h=e[o]._getMostSpecificHandledMember(t);if(void 0!==h&&!1!==(u=e[o])[h].apply(u,n))return!0}return!1}},{key:"_receiveKeydown",value:function _receiveKeydown(t){var e,r=t,i=this.__keymap[t.keyCode],n=this.focusPath;if(i&&(e=Array.isArray(i)?i:[i]),e)for(var s=0,o=e.length;s<o;s++){var u=this.__keypressTimers.has(e[s]);if(n[n.length-1].longpress&&u)return;this.stage.application.focusTopDownEvent(["_capture".concat(e[s]),"_captureKey"],r)||this.stage.application.focusBottomUpEvent(["_handle".concat(e[s]),"_handleKey"],r)}else this.stage.application.focusTopDownEvent(["_captureKey"],r)||this.stage.application.focusBottomUpEvent(["_handleKey"],r);this.updateFocusPath();var h=n[n.length-1];if(e&&h.longpress)for(var l=0,f=e.length;l<f;l++)this._startLongpressTimer(e[l],h)}},{key:"_receiveKeyup",value:function _receiveKeyup(t){var e,r=t,i=this.__keymap[t.keyCode];if(i&&(e=Array.isArray(i)?i:[i]),e)for(var n=0,s=e.length;n<s;n++)this.stage.application.focusTopDownEvent(["_capture".concat(e[n],"Release"),"_captureKeyRelease"],r)||this.stage.application.focusBottomUpEvent(["_handle".concat(e[n],"Release"),"_handleKeyRelease"],r);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],r)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],r);if(this.updateFocusPath(),e)for(var o=0,u=e.length;o<u;o++)this.__keypressTimers.has(e[o])&&(clearTimeout(this.__keypressTimers.get(e[o])),this.__keypressTimers.delete(e[o]))}},{key:"_startLongpressTimer",value:function _startLongpressTimer(t,e){var i=this,n=e.longpress,s=t.toLowerCase();if(n[s]){var o=n[s];r.isNumber(o)?this.__keypressTimers.set(t,setTimeout(function(){_newArrowCheck(this,i),this.stage.application.focusTopDownEvent(["_capture".concat(t,"Long"),"_captureKey"],{})||this.stage.application.focusBottomUpEvent(["_handle".concat(t,"Long"),"_handleKey"],{}),this.__keypressTimers.delete(t)}.bind(this),o||500)):e._throwError("config value for longpress must be a number")}}},{key:"_recieveScrollWheel",value:function _recieveScrollWheel(t){var e=t,r=e.clientX,i=e.clientY;r<=this.stage.w&&i<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",e)||this.fireBottomUpScrollWheelHandler("_handleScroll",e))}},{key:"fireTopDownScrollWheelHandler",value:function fireTopDownScrollWheelHandler(t,e){for(var r=this.stage.application.children,i=this._findChildren([],r).reverse(),n=i.length;n--;){var s=i[n];if(s&&s[t])return s._captureScroll(e),!0}return!1}},{key:"fireBottomUpScrollWheelHandler",value:function fireBottomUpScrollWheelHandler(t,e){for(var r=e.clientX,i=e.clientY,n=this._getTargetChild(r,i);null!==n;){if(n&&n[t])return n._handleScroll(e),!0;n=n.parent}return!1}},{key:"_receiveClick",value:function _receiveClick(t){var e=t,r=e.clientX,i=e.clientY;r<=this.stage.w&&i<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(e)}},{key:"fireBottomUpClickHandler",value:function fireBottomUpClickHandler(t){for(var e=t.clientX,r=t.clientY,i=this._getTargetChild(e,r),n=i;null!==n;){if(n&&n._handleClick){n._handleClick(i);break}n=n.parent}}},{key:"_receiveHover",value:function _receiveHover(t){var e=t,r=e.clientX,i=e.clientY;r<=this.stage.w&&i<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(e)}},{key:"fireBottomUpHoverHandler",value:function fireBottomUpHoverHandler(t){var e=this,r=t.clientX,i=t.clientY,n=this._getTargetChild(r,i);n!==this.__hoveredChild&&function(){var t=this,r=new Set,i=new Set;if(n&&(i=new Set(n.getAncestors())),e.__hoveredChild){var s,o=_createForOfIteratorHelper(_toConsumableArray(r=new Set(e.__hoveredChild.getAncestors())).filter(function(e){return _newArrowCheck(this,t),!i.has(e)}.bind(this)));try{for(o.s();!(s=o.n()).done;){var u=s.value,h=j.getComponent(u);h._handleUnhover&&h._handleUnhover(u),u.parent&&u.parent.cursor&&(e.stage.getCanvas().style.cursor=u.parent.cursor)}}catch(t){o.e(t)}finally{o.f()}}e.__hoveredChild=n;var l,f=_toConsumableArray(i).filter(function(e){return _newArrowCheck(this,t),!r.has(e)}.bind(this)),d=_createForOfIteratorHelper(f);try{for(d.s();!(l=d.n()).done;){var _=l.value,g=j.getComponent(_);g._handleHover&&g._handleHover(_)}}catch(t){d.e(t)}finally{d.f()}var p=f[0];if(p&&p.cursor&&(e.stage.getCanvas().style.cursor=p.cursor),0===f.length&&n){var v=j.getComponent(n);v._handleHover&&v._handleHover(n)}}()}},{key:"_getTargetChild",value:function _getTargetChild(t,e){var r=this,i=this.stage.application.children,n=this._findChildren([],i),s=this._withinClickableRange(n,t,e);return s.sort(function(t,e){return _newArrowCheck(this,r),t.zIndex>e.zIndex?1:t.zIndex<e.zIndex?-1:t.id>e.id?1:-1}.bind(this)),s.length?s.slice(-1)[0]:null}},{key:"_findChildren",value:function _findChildren(t,e){for(var r=e.length;r--;){var i=e[r];i.__active&&i.collision&&(!0===i.collision&&t.push(i),i.hasChildren()&&this._findChildren(t,i.children))}return t}},{key:"_withinClickableRange",value:function _withinClickableRange(t,e,r){for(var i=this,n=t.length,s=[],o=function _loop(){var o=this,u=t[n],h=i.stage.getRenderPrecision(),l=u.core._worldContext,f=l.px*h,d=l.py*h,_=u.finalW*l.ta*h,g=u.finalH*l.td*h;if(f>i.stage.w||d>i.stage.h)return"continue";if(u.parent.core._scissor){var p=u.parent.core._scissor.map(function(t){return _newArrowCheck(this,o),t*h}.bind(this));if(!i._testCollision.apply(i,[e,r].concat(_toConsumableArray(p))))return"continue"}i._testCollision(e,r,f,d,_,g)&&s.push(u)};n--;)o();return s}},{key:"_testCollision",value:function _testCollision(t,e,r,i,n,s){return t>=r&&t<=r+n&&e>=i&&e<=i+s}},{key:"destroy",value:function destroy(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}},{key:"_destroy",value:function _destroy(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){var t,e=_createForOfIteratorHelper(this.__keypressTimers.values());try{for(e.s();!(t=e.n()).done;){var r=t.value;clearTimeout(r)}}catch(t){e.e(t)}finally{e.f()}this.__keypressTimers.clear()}}},{key:"getCanvas",value:function getCanvas(){return this.stage.getCanvas()}}]),Application}(j),It=function(t){_inherits(StaticCanvasTexture,t);var e=_createSuper(StaticCanvasTexture);function StaticCanvasTexture(t){var r;return _classCallCheck(this,StaticCanvasTexture),(r=e.call(this,t))._factory=void 0,r._lookupId=void 0,r}return _createClass(StaticCanvasTexture,[{key:"content",set:function set(t){var e=t.factory,r=t.lookupId,i=void 0===r?void 0:r;this._factory=e,this._lookupId=i,this._changed()}},{key:"_getIsValid",value:function _getIsValid(){return!!this._factory}},{key:"_getLookupId",value:function _getLookupId(){return this._lookupId}},{key:"_getSourceLoader",value:function _getSourceLoader(){var t=this,e=this._factory;return function(r){var i=this;return _newArrowCheck(this,t),e(function(t,e){if(_newArrowCheck(this,i),t)return r(t);r(null,this.stage.platform.getTextureOptionsForDrawingCanvas(e))}.bind(this),this.stage)}.bind(this)}}]),StaticCanvasTexture}(w),Ot=function(){function Tools(){_classCallCheck(this,Tools)}return _createClass(Tools,null,[{key:"getCanvasTexture",value:function getCanvasTexture(t,e){return{type:It,content:{factory:t,lookupId:e}}}},{key:"getRoundRect",value:function getRoundRect(t,e,i,n,s,o,u){var h=this;Array.isArray(i)||(i=[i,i,i,i]);var l=function factory(l,f){_newArrowCheck(this,h),r.isSpark?f.platform.createRoundRect(l,f,t,e,i,n,s,o,u):l(null,this.createRoundRect(f,t,e,i,n,s,o,u))}.bind(this),f="rect"+[t,e,n,s,o?1:0,u].concat(i).join(",");return Tools.getCanvasTexture(l,f)}},{key:"createRoundRect",value:function createRoundRect(t,i,n,s,o,u,h,l){void 0===h&&(h=!0),void 0===o&&(o=0);var f=t.platform.getDrawingCanvas(),d=f.getContext("2d");d.imageSmoothingEnabled=!0,f.width=i+o+2,f.height=n+o+2,d.beginPath();var _=.5*o+1,g=.5*o+1;return d.moveTo(_+s[0],g),d.lineTo(_+i-s[1],g),d.arcTo(_+i,g,_+i,g+s[1],s[1]),d.lineTo(_+i,g+n-s[2]),d.arcTo(_+i,g+n,_+i-s[2],g+n,s[2]),d.lineTo(_+s[3],g+n),d.arcTo(_,g+n,_,g+n-s[3],s[3]),d.lineTo(_,g+s[0]),d.arcTo(_,g,_+s[0],g,s[0]),d.closePath(),h&&(r.isNumber(l)?d.fillStyle=e.getRgbaString(l):d.fillStyle="white",d.fill()),o&&(r.isNumber(u)?d.strokeStyle=e.getRgbaString(u):d.strokeStyle="white",d.lineWidth=o,d.stroke()),f}},{key:"getShadowRect",value:function getShadowRect(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*s;Array.isArray(n)||(n=[n,n,n,n]);var u=function factory(u,h){_newArrowCheck(this,i),r.isSpark?h.platform.createShadowRect(u,h,t,e,n,s,o):u(null,this.createShadowRect(h,t,e,n,s,o))}.bind(this),h="shadow"+[t,e,s,o].concat(n).join(",");return Tools.getCanvasTexture(u,h)}},{key:"createShadowRect",value:function createShadowRect(t,r,i,n,s,o){var u=t.platform.getDrawingCanvas(),h=u.getContext("2d");h.imageSmoothingEnabled=!0,u.width=r+2*o,u.height=i+2*o,h.globalAlpha=.01,h.fillRect(0,0,.01,.01),h.globalAlpha=1,h.shadowColor=e.getRgbaString(4294967295),h.fillStyle=e.getRgbaString(4294967295),h.shadowBlur=s,h.shadowOffsetX=r+10+o,h.shadowOffsetY=o,h.beginPath();var l=-(r+10),f=0;return h.moveTo(l+n[0],f),h.lineTo(l+r-n[1],f),h.arcTo(l+r,f,l+r,f+n[1],n[1]),h.lineTo(l+r,f+i-n[2]),h.arcTo(l+r,f+i,l+r-n[2],f+i,n[2]),h.lineTo(l+n[3],f+i),h.arcTo(l,f+i,l,f+i-n[3],n[3]),h.lineTo(l,f+n[0]),h.arcTo(l,f,l+n[0],f,n[0]),h.closePath(),h.fill(),u}},{key:"getSvgTexture",value:function getSvgTexture(t,e,i){var n=this,s=function factory(s,o){_newArrowCheck(this,n),r.isSpark?o.platform.createSvg(s,o,t,e,i):this.createSvg(s,o,t,e,i)}.bind(this),o="svg"+[e,i,t].join(",");return Tools.getCanvasTexture(s,o)}},{key:"createSvg",value:function createSvg(t,e,i,n,s){var o=this,u=e.platform.getDrawingCanvas(),h=u.getContext("2d");h.imageSmoothingEnabled=!0;var l=new Image;l.onload=function(){_newArrowCheck(this,o),u.width=n,u.height=s,h.drawImage(l,0,0,u.width,u.height),t(null,u)}.bind(this),l.onError=function(e){_newArrowCheck(this,o),t(e)}.bind(this),r.isPS4||(l.crossOrigin="Anonymous"),l.src=i}}]),Tools}(),Pt=function(){function ObjMerger(){_classCallCheck(this,ObjMerger)}return _createClass(ObjMerger,null,[{key:"isMf",value:function isMf(t){return r.isFunction(t)&&t.__mf}},{key:"mf",value:function mf(t){return t.__mf=!0,t}},{key:"merge",value:function merge(t,e){var i=Object.keys(t),n=Object.keys(e);if(!n.length)return t;for(var s={},o={},u=0,h=n.length;u<h;u++){var l=n[u];s[l]=-1,o[l]=u}for(var f=0,d=i.length;f<d;f++){var _=i[f];s[_]=f,void 0===o[_]&&(o[_]=-1)}for(var g=i.length,p={},v=0,y=n.length;v<y;v++){for(var x=n[v],m=s[x],S=m;--S>=0&&-1===o[i[S]];);for(;++S<m;){var b=i[S];p[b]=t[b]}var k=e[x],T=t[x],C=void 0;void 0!==(C=this.isMf(k)?k(T):r.isObjectLiteral(T)&&r.isObjectLiteral(k)?ObjMerger.merge(T,k):k)&&(p[x]=C)}for(var w=g;--w>=0&&-1===o[i[w]];);for(;++w<g;){var A=i[w];p[A]=t[A]}return p}}]),ObjMerger}(),Mt=function(t){_inherits(ObjectListProxy,t);var e=_createSuper(ObjectListProxy);function ObjectListProxy(t){var r;return _classCallCheck(this,ObjectListProxy),(r=e.call(this))._target=t,r}return _createClass(ObjectListProxy,[{key:"onAdd",value:function onAdd(t,e){this._target.addAt(t,e)}},{key:"onRemove",value:function onRemove(t,e){this._target.removeAt(e)}},{key:"onSync",value:function onSync(t,e,r){this._target._setByArray(r)}},{key:"onSet",value:function onSet(t,e){this._target.setAt(t,e)}},{key:"onMove",value:function onMove(t,e,r){this._target.setAt(t,r)}},{key:"createItem",value:function createItem(t){return this._target.createItem(t)}},{key:"isItem",value:function isItem(t){return this._target.isItem(t)}}]),ObjectListProxy}(M),Ft=function(t){_inherits(ObjectListWrapper,t);var e=_createSuper(ObjectListWrapper);function ObjectListWrapper(t,r){var i;return _classCallCheck(this,ObjectListWrapper),(i=e.call(this,t))._wrap=r,i}return _createClass(ObjectListWrapper,[{key:"wrap",value:function wrap(t){var e=this._wrap(t);return t._wrapper=e,e}},{key:"onAdd",value:function onAdd(t,e){t=this.wrap(t),_get(_getPrototypeOf(ObjectListWrapper.prototype),"onAdd",this).call(this,t,e)}},{key:"onRemove",value:function onRemove(t,e){_get(_getPrototypeOf(ObjectListWrapper.prototype),"onRemove",this).call(this,t,e)}},{key:"onSync",value:function onSync(t,e,r){var i=this;e.forEach(function(t){return _newArrowCheck(this,i),this.wrap(t)}.bind(this)),r=r.map(function(t){return _newArrowCheck(this,i),t._wrapper}.bind(this)),_get(_getPrototypeOf(ObjectListWrapper.prototype),"onSync",this).call(this,t,e,r)}},{key:"onSet",value:function onSet(t,e){t=this.wrap(t),_get(_getPrototypeOf(ObjectListWrapper.prototype),"onSet",this).call(this,t,e)}},{key:"onMove",value:function onMove(t,e,r){_get(_getPrototypeOf(ObjectListWrapper.prototype),"onMove",this).call(this,t,e,r)}}]),ObjectListWrapper}(Mt),zt=function(t){_inherits(NoiseTexture,t);var e=_createSuper(NoiseTexture);function NoiseTexture(){return _classCallCheck(this,NoiseTexture),e.apply(this,arguments)}return _createClass(NoiseTexture,[{key:"_getLookupId",value:function _getLookupId(){return"__noise"}},{key:"_getSourceLoader",value:function _getSourceLoader(){var t=this.stage.gl;return function(e){for(var r=new Uint8Array(65536),i=0;i<65536;i+=4){var n=Math.floor(256*Math.random());r[i]=n,r[i+1]=n,r[i+2]=n,r[i+3]=255}var s={};t&&(s[t.TEXTURE_WRAP_S]=t.REPEAT,s[t.TEXTURE_WRAP_T]=t.REPEAT,s[t.TEXTURE_MIN_FILTER]=t.NEAREST,s[t.TEXTURE_MAG_FILTER]=t.NEAREST),e(null,{source:r,w:128,h:128,texParams:s})}}}]),NoiseTexture}(w),Ut=function(t){_inherits(HtmlTexture,t);var e=_createSuper(HtmlTexture);function HtmlTexture(t){var r;return _classCallCheck(this,HtmlTexture),(r=e.call(this,t))._htmlElement=void 0,r._scale=1,r}return _createClass(HtmlTexture,[{key:"htmlElement",get:function get(){return this._htmlElement},set:function set(t){this._htmlElement=t,this._changed()}},{key:"scale",get:function get(){return this._scale},set:function set(t){this._scale=t,this._changed()}},{key:"html",get:function get(){return this._htmlElement.innerHTML},set:function set(t){if(t){var e=document.createElement("div");e.innerHTML="<div>"+t+"</div>",this.htmlElement=e.firstElementChild}else this.htmlElement=void 0}},{key:"_getIsValid",value:function _getIsValid(){return this.htmlElement}},{key:"_getLookupId",value:function _getLookupId(){return this._scale+":"+this._htmlElement.innerHTML}},{key:"_getSourceLoader",value:function _getSourceLoader(){var t=this._htmlElement,e=this._scale;return function(r){var i=this;if(!window.html2canvas)return r(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));var n=HtmlTexture.getPreloadArea();n.appendChild(t),html2canvas(t,{backgroundColor:null,scale:e}).then((function(e){if(n.removeChild(t),0===e.height)return r(new Error("Canvas height is 0"));r(null,{source:e,width:e.width,height:e.height})})).catch(function(t){_newArrowCheck(this,i),console.error("[Lightning]",t)}.bind(this))}}}],[{key:"getPreloadArea",value:function getPreloadArea(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}]),HtmlTexture}(w),Bt=function(t){_inherits(StaticTexture,t);var e=_createSuper(StaticTexture);function StaticTexture(t,r){var i;return _classCallCheck(this,StaticTexture),(i=e.call(this,t))._options=r,i}return _createClass(StaticTexture,[{key:"options",get:function get(){return this._options},set:function set(t){this._options!==t&&(this._options=t,this._changed())}},{key:"_getIsValid",value:function _getIsValid(){return!!this._options}},{key:"_getSourceLoader",value:function _getSourceLoader(){var t=this;return function(e){_newArrowCheck(this,t),e(null,this._options)}.bind(this)}}]),StaticTexture}(w),Dt=function(t){_inherits(ListComponent,t);var e=_createSuper(ListComponent);function ListComponent(t){var r,i;return _classCallCheck(this,ListComponent),(i=e.call(this,t))._wrapper=_get((r=_assertThisInitialized(i),_getPrototypeOf(ListComponent.prototype)),"_children",r).a({}),i._reloadVisibleElements=!1,i._visibleItems=new Set,i._index=0,i._started=!1,i._scrollTransitionSettings=i.stage.transitions.createSettings({}),i._itemSize=100,i._viewportScrollOffset=0,i._itemScrollOffset=0,i._roll=!1,i._rollMin=0,i._rollMax=0,i._progressAnimation=null,i._invertDirection=!1,i._horizontal=!0,i.itemList=new jt(_assertThisInitialized(i)),i}return _createClass(ListComponent,[{key:"_allowChildrenAccess",value:function _allowChildrenAccess(){return!1}},{key:"items",get:function get(){return this.itemList.get()},set:function set(t){this.itemList.patch(t)}},{key:"start",value:function start(){var t=this;this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",function(e){return _newArrowCheck(this,t),this.update()}.bind(this)),this.setIndex(0,!0,!0),this._started=!0,this.update()}},{key:"setIndex",value:function setIndex(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.length;if(n){if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),i){var s=r.getModuloIndex(t,n)-r.getModuloIndex(this.index,n);s>.5*n?s-=n:s<-.5*n&&(s+=n),this._index+=s}else this._index=t;(this._roll||this.viewportSize>this._itemSize*n)&&(this._index=r.getModuloIndex(this._index,n));var o,u,h,l=this._horizontal^this._invertDirection?-1:1,f=l*this._index*this._itemSize;if(this._roll)if(1==l)u=(n-1)*this._itemSize,u-=h=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,o=this.viewportSize-(this._itemSize+h),this._rollMin&&(o-=this._rollMin),this._rollMax&&(u+=this._rollMax),f=Math.max(Math.min(f,u),o);else{u=n*this._itemSize-this.viewportSize,u+=h=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize;var d=h;this._rollMin&&(d-=this._rollMin),this._rollMax&&(u+=this._rollMax),f=Math.min(Math.max(-u,f),-d)}this._scrollTransition.start(f),e&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}}},{key:"getAxisPosition",value:function getAxisPosition(){var t=-this._scrollTransition._targetValue,e=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(e-t)}},{key:"update",value:function update(){if(this._started){var t=this.length;if(t){var e,i,n,s,o=this._horizontal^this._invertDirection?-1:1,u=this._horizontal?this._wrapper.x:this._wrapper.y,h=this.viewportSize,l=this._viewportScrollOffset*h-this._itemScrollOffset*this._itemSize;u+=l,-1==o?(e=Math.floor(-u/this._itemSize),n=1-(-u/this._itemSize-e),i=Math.floor((h-u)/this._itemSize),s=(h-u)/this._itemSize-i):(e=Math.ceil(u/this._itemSize),n=1+u/this._itemSize-e,s=(i=Math.ceil((u-h)/this._itemSize))-(u-h)/this._itemSize),(this._roll||h>this._itemSize*t)&&(i>=t&&(i=t-1,s=1),e>=t&&(e=t-1,n=1),i<=-1&&(i=0,s=1),e<=-1&&(e=0,n=1));for(var f,d=-o*e*this._itemSize,_=e;-1==o?_<=i:_>=i;-1==o?_++:_--){var g=r.getModuloIndex(_,t),p=this.getElement(g);f=p.parent,this._visibleItems.delete(f),this._horizontal?f.x=d+l:f.y=d+l;var v=f.visible;if(f.visible=!0,v&&!this._reloadVisibleElements||this.emit("visible",_,g),this._progressAnimation){var y=1;_==e?y=n:_==i&&(y=s),this._progressAnimation.apply(p,y)}d+=this._itemSize}var x=this;this._visibleItems.forEach((function(t){t.visible=!1,x._visibleItems.delete(t)}));for(var m=e;-1==o?m<=i:m>=i;-1==o?m++:m--){var S=r.getModuloIndex(m,t);this._visibleItems.add(this.getWrapper(S))}this._reloadVisibleElements=!1}}}},{key:"setPrevious",value:function setPrevious(){this.setIndex(this._index-1)}},{key:"setNext",value:function setNext(){this.setIndex(this._index+1)}},{key:"getWrapper",value:function getWrapper(t){return this._wrapper.children[t]}},{key:"getElement",value:function getElement(t){var e=this._wrapper.children[t];return e?e.children[0]:null}},{key:"reload",value:function reload(){this._reloadVisibleElements=!0,this.update()}},{key:"element",get:function get(){var t=this._wrapper.children[this.realIndex];return t?t.children[0]:null}},{key:"length",get:function get(){return this._wrapper.children.length}},{key:"property",get:function get(){return this._horizontal?"x":"y"}},{key:"viewportSize",get:function get(){return this._horizontal?this.w:this.h}},{key:"index",get:function get(){return this._index}},{key:"realIndex",get:function get(){return r.getModuloIndex(this._index,this.length)}},{key:"itemSize",get:function get(){return this._itemSize},set:function set(t){this._itemSize=t,this.update()}},{key:"viewportScrollOffset",get:function get(){return this._viewportScrollOffset},set:function set(t){this._viewportScrollOffset=t,this.update()}},{key:"itemScrollOffset",get:function get(){return this._itemScrollOffset},set:function set(t){this._itemScrollOffset=t,this.update()}},{key:"scrollTransitionSettings",get:function get(){return this._scrollTransitionSettings},set:function set(t){this._scrollTransitionSettings.patch(t)}},{key:"scrollTransition",get:function get(){return this._scrollTransition},set:function set(t){this._scrollTransitionSettings.patch(t)}},{key:"progressAnimation",get:function get(){return this._progressAnimation},set:function set(t){r.isObjectLiteral(t)?this._progressAnimation=this.stage.animations.createSettings(t):this._progressAnimation=t,this.update()}},{key:"roll",get:function get(){return this._roll},set:function set(t){this._roll=t,this.update()}},{key:"rollMin",get:function get(){return this._rollMin},set:function set(t){this._rollMin=t,this.update()}},{key:"rollMax",get:function get(){return this._rollMax},set:function set(t){this._rollMax=t,this.update()}},{key:"invertDirection",get:function get(){return this._invertDirection},set:function set(t){this._started||(this._invertDirection=t)}},{key:"horizontal",get:function get(){return this._horizontal},set:function set(t){t!==this._horizontal&&(this._started||(this._horizontal=t))}}]),ListComponent}(j),jt=function(t){_inherits(ListItems,t);var e=_createSuper(ListItems);function ListItems(t){var r,i=this;_classCallCheck(this,ListItems);var n=function wrap(t){_newArrowCheck(this,i);var e=t.stage.createElement();return e.add(t),e.visible=!1,e}.bind(this);return(r=e.call(this,t._wrapper._children,n)).list=t,r}return _createClass(ListItems,[{key:"onAdd",value:function onAdd(t,e){_get(_getPrototypeOf(ListItems.prototype),"onAdd",this).call(this,t,e),this.checkStarted(e)}},{key:"checkStarted",value:function checkStarted(t){this.list._reloadVisibleElements=!0,this.list._started?(1===this.list.length?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}},{key:"onRemove",value:function onRemove(t,e){_get(_getPrototypeOf(ListItems.prototype),"onRemove",this).call(this,t,e);var r=this.list.realIndex;r===e?(r===this.list.length&&r--,r>=0&&this.list.setIndex(r)):r>e&&this.list.setIndex(r-1),this.list._reloadVisibleElements=!0}},{key:"onSet",value:function onSet(t,e){_get(_getPrototypeOf(ListItems.prototype),"onSet",this).call(this,t,e),this.checkStarted(e)}},{key:"onSync",value:function onSync(t,e,r){_get(_getPrototypeOf(ListItems.prototype),"onSync",this).call(this,t,e,r),this.checkStarted(0)}},{key:"_signalProxy",get:function get(){return!0}}]),ListItems}(Ft),Nt=function(t){_inherits(LinearBlurShader,t);var e=_createSuper(LinearBlurShader);function LinearBlurShader(t){var r;return _classCallCheck(this,LinearBlurShader),(r=e.call(this,t))._direction=new Float32Array([1,0]),r._kernelRadius=1,r}return _createClass(LinearBlurShader,[{key:"x",get:function get(){return this._direction[0]},set:function set(t){this._direction[0]=t,this.redraw()}},{key:"y",get:function get(){return this._direction[1]},set:function set(t){this._direction[1]=t,this.redraw()}},{key:"kernelRadius",get:function get(){return this._kernelRadius},set:function set(t){this._kernelRadius=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._kernelRadius}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(LinearBlurShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);var e=t.getRenderWidth(),r=t.getRenderHeight();this._setUniform("resolution",new Float32Array([e,r]),this.gl.uniform2fv)}}]),LinearBlurShader}(Z);Nt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 resolution;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 direction;\n    uniform int kernelRadius;\n    \n    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n    }\n    \n    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n    }\n    \n    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.411764705882353) * direction;\n        vec2 off2 = vec2(3.2941176470588234) * direction;\n        vec2 off3 = vec2(5.176470588235294) * direction;\n        color += texture2D(image, uv) * 0.1964825501511404;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n        return color;\n    }    \n\n    void main(void){\n        if (kernelRadius == 1) {\n            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else if (kernelRadius == 2) {\n            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else {\n            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;\n        }\n    }\n";var Wt=function(t){_inherits(BoxBlurShader,t);var e=_createSuper(BoxBlurShader);function BoxBlurShader(){return _classCallCheck(this,BoxBlurShader),e.apply(this,arguments)}return _createClass(BoxBlurShader,[{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(BoxBlurShader.prototype),"setupUniforms",this).call(this,t);var e=1/t.getTextureWidth(0),r=1/t.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([e,r]),this.gl.uniform2fv)}}]),BoxBlurShader}(Z);Wt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 stepTextureCoord;\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec4 vColor;\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoordUl = aTextureCoord - stepTextureCoord;\n        vTextureCoordBr = aTextureCoord + stepTextureCoord;\n        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);\n        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Wt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));\n        gl_FragColor = color * vColor;\n    }\n";var Ht=function(t){_inherits(BlurShader,t);var e=_createSuper(BlurShader);function BlurShader(t){var r;return _classCallCheck(this,BlurShader),(r=e.call(this,t))._kernelRadius=1,r}return _createClass(BlurShader,[{key:"kernelRadius",get:function get(){return this._kernelRadius},set:function set(t){this._kernelRadius=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._amount}},{key:"_beforeDrawEl",value:function _beforeDrawEl(t){t.target.ctx.filter="blur("+this._kernelRadius+"px)"}},{key:"_afterDrawEl",value:function _afterDrawEl(t){t.target.ctx.filter="none"}}]),BlurShader}(it),Gt=function(t){_inherits(FastBlurComponent,t);var e=_createSuper(FastBlurComponent);function FastBlurComponent(){return _classCallCheck(this,FastBlurComponent),e.apply(this,arguments)}return _createClass(FastBlurComponent,[{key:"wrap",get:function get(){return this.tag("Wrap")}},{key:"content",get:function get(){return this.wrap.content},set:function set(t){return this.wrap.content=t}},{key:"padding",set:function set(t){this.wrap._paddingX=t,this.wrap._paddingY=t,this.wrap._updateBlurSize()}},{key:"paddingX",set:function set(t){this.wrap._paddingX=t,this.wrap._updateBlurSize()}},{key:"paddingY",set:function set(t){this.wrap._paddingY=t,this.wrap._updateBlurSize()}},{key:"amount",get:function get(){return this.wrap.amount},set:function set(t){return this.wrap.amount=t}},{key:"_onResize",value:function _onResize(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}},{key:"_signalProxy",get:function get(){return!0}},{key:"_build",value:function _build(){this.patch({Wrap:{type:this.stage.gl?Yt:Vt}})}}],[{key:"_template",value:function _template(){return{}}}]),FastBlurComponent}(j),Vt=function(t){_inherits(C2dFastBlurComponent,t);var e=_createSuper(C2dFastBlurComponent);function C2dFastBlurComponent(t){var r;return _classCallCheck(this,C2dFastBlurComponent),(r=e.call(this,t))._textwrap=r.sel("Textwrap"),r._wrapper=r.sel("Textwrap>Content"),r._amount=0,r._paddingX=0,r._paddingY=0,r}return _createClass(C2dFastBlurComponent,[{key:"content",get:function get(){return this.sel("Textwrap>Content")},set:function set(t){this.sel("Textwrap>Content").patch(t,!0)}},{key:"padding",set:function set(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}},{key:"paddingX",set:function set(t){this._paddingX=t,this._updateBlurSize()}},{key:"paddingY",set:function set(t){this._paddingY=t,this._updateBlurSize()}},{key:"_updateBlurSize",value:function _updateBlurSize(){var t=this.renderWidth,e=this.renderHeight,r=this._paddingX,i=this._paddingY;this._wrapper.x=r,this._textwrap.x=-r,this._wrapper.y=i,this._textwrap.y=-i,this._textwrap.w=t+2*r,this._textwrap.h=e+2*i}},{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this._textwrap.shader.kernelRadius=C2dFastBlurComponent._amountToKernelRadius(t)}},{key:"_signalProxy",get:function get(){return!0}}],[{key:"_template",value:function _template(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:Ht},Content:{}}}}},{key:"getSpline",value:function getSpline(){return this._multiSpline||(this._multiSpline=new kt,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}},{key:"_amountToKernelRadius",value:function _amountToKernelRadius(t){return C2dFastBlurComponent.getSpline().getValue(Math.min(1,.25*t))}}]),C2dFastBlurComponent}(j),Yt=function(t){_inherits(WebGLFastBlurComponent,t);var e=_createSuper(WebGLFastBlurComponent);function WebGLFastBlurComponent(t){var r;return _classCallCheck(this,WebGLFastBlurComponent),(r=e.call(this,t))._textwrap=r.sel("Textwrap"),r._wrapper=r.sel("Textwrap>Content"),r._layers=r.sel("Layers"),r._output=r.sel("Result"),r._amount=0,r._paddingX=0,r._paddingY=0,r}return _createClass(WebGLFastBlurComponent,[{key:"_signalProxy",get:function get(){return!0}},{key:"_buildLayers",value:function _buildLayers(){var t=this,e=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map(function(e){return _newArrowCheck(this,t),C.create(this.stage,Object.assign({type:Nt},e))}.bind(this));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}},{key:"_setLayerTexture",value:function _setLayerTexture(t,e,r){if(r.length){var i=r.pop(),n=t.stage.c({rtt:!0,shader:i});this._setLayerTexture(n,e,r),t.childList.add(n)}else t.texture=e;return t}},{key:"content",get:function get(){return this.sel("Textwrap>Content")},set:function set(t){this.sel("Textwrap>Content").patch(t,!0)}},{key:"padding",set:function set(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}},{key:"paddingX",set:function set(t){this._paddingX=t,this._updateBlurSize()}},{key:"paddingY",set:function set(t){this._paddingY=t,this._updateBlurSize()}},{key:"getLayer",value:function getLayer(t){return this._layers.sel("L"+t)}},{key:"getLayerContents",value:function getLayerContents(t){return this.getLayer(t).sel("Content")}},{key:"_onResize",value:function _onResize(){this._updateBlurSize()}},{key:"_updateBlurSize",value:function _updateBlurSize(){var t=this.renderWidth,e=this.renderHeight,r=this._paddingX,i=this._paddingY,n=t+2*r,s=e+2*i;this._textwrap.w=n,this._wrapper.x=r,this.getLayer(0).w=this.getLayerContents(0).w=n/2,this.getLayer(1).w=this.getLayerContents(1).w=n/4,this.getLayer(2).w=this.getLayerContents(2).w=n/8,this.getLayer(3).w=this.getLayerContents(3).w=n/16,this._output.x=-r,this._textwrap.x=-r,this._output.w=n,this._textwrap.h=s,this._wrapper.y=i,this.getLayer(0).h=this.getLayerContents(0).h=s/2,this.getLayer(1).h=this.getLayerContents(1).h=s/4,this.getLayer(2).h=this.getLayerContents(2).h=s/8,this.getLayer(3).h=this.getLayerContents(3).h=s/16,this._output.y=-i,this._textwrap.y=-i,this._output.h=s,this.w=t,this.h=e}},{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this._update()}},{key:"_update",value:function _update(){var t=Math.min(4,Math.max(0,this._amount));0===t?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3,t<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=t):t<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=t-1):t<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=t-2):t<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=t-3))}},{key:"shader",set:function set(t){_set(_getPrototypeOf(WebGLFastBlurComponent.prototype),"shader",t,this,!0),this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}},{key:"_firstActive",value:function _firstActive(){this._buildLayers()}}],[{key:"_template",value:function _template(){var t=function onUpdate(t,e){if(130&e._recalc){var r=e.w,i=e.h,n=e;do{(n=n._children[0])._element.w=r,n._element.h=i}while(n._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Wt}}},L1:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Wt}}},L2:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Wt}}},L3:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:Wt}}}},Result:{shader:{type:Xt},visible:!1}}}}]),WebGLFastBlurComponent}(j),Xt=function(t){_inherits(FastBlurOutputShader,t);var e=_createSuper(FastBlurOutputShader);function FastBlurOutputShader(t){var r;return _classCallCheck(this,FastBlurOutputShader),(r=e.call(this,t))._a=0,r._otherTextureSource=null,r}return _createClass(FastBlurOutputShader,[{key:"a",get:function get(){return this._a},set:function set(t){this._a=t,this.redraw()}},{key:"otherTextureSource",set:function set(t){this._otherTextureSource=t,this.redraw()}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(FastBlurOutputShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}},{key:"beforeDraw",value:function beforeDraw(t){var e=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,r=this.gl;r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,e),r.activeTexture(r.TEXTURE0)}}]),FastBlurOutputShader}(Z);Xt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uSampler2;\n    uniform float a;\n    void main(void){\n        if (a == 1.0) {\n            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;\n        } else {\n            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;\n        }\n    }\n";var qt=function(t){_inherits(BloomComponent,t);var e=_createSuper(BloomComponent);function BloomComponent(t){var r;return _classCallCheck(this,BloomComponent),(r=e.call(this,t))._textwrap=r.sel("Textwrap"),r._wrapper=r.sel("Textwrap.Content"),r._layers=r.sel("Layers"),r._amount=0,r._paddingX=0,r._paddingY=0,r}return _createClass(BloomComponent,[{key:"_signalProxy",get:function get(){return!0}},{key:"_build",value:function _build(){var t=this,e=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map(function(e){return _newArrowCheck(this,t),this.stage.createShader(Object.assign({type:Nt},e))}.bind(this));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[e[0],e[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[e[0],e[1],e[2],e[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[e[0],e[1],e[2],e[3]])}},{key:"_setLayerTexture",value:function _setLayerTexture(t,e,r){if(r.length){var i=r.pop(),n=t.stage.c({rtt:!0,shader:i});this._setLayerTexture(n,e,r),t.childList.add(n)}else t.texture=e;return t}},{key:"content",get:function get(){return this.sel("Textwrap.Content")},set:function set(t){this.sel("Textwrap.Content").patch(t)}},{key:"padding",set:function set(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}},{key:"paddingX",set:function set(t){this._paddingX=t,this._updateBlurSize()}},{key:"paddingY",set:function set(t){this._paddingY=t,this._updateBlurSize()}},{key:"getLayer",value:function getLayer(t){return this._layers.sel("L"+t)}},{key:"getLayerContents",value:function getLayerContents(t){return this.getLayer(t).sel("Content")}},{key:"_onResize",value:function _onResize(){this._updateBlurSize()}},{key:"_updateBlurSize",value:function _updateBlurSize(){var t=this.renderWidth,e=this.renderHeight,r=this._paddingX,i=this._paddingY,n=t+2*r,s=e+2*i;this._textwrap.w=n,this._wrapper.x=r,this.getLayer(0).w=this.getLayerContents(0).w=n/2,this.getLayer(1).w=this.getLayerContents(1).w=n/4,this.getLayer(2).w=this.getLayerContents(2).w=n/8,this.getLayer(3).w=this.getLayerContents(3).w=n/16,this._textwrap.x=-r,this._textwrap.h=s,this._wrapper.y=i,this.getLayer(0).h=this.getLayerContents(0).h=s/2,this.getLayer(1).h=this.getLayerContents(1).h=s/4,this.getLayer(2).h=this.getLayerContents(2).h=s/8,this.getLayer(3).h=this.getLayerContents(3).h=s/16,this._textwrap.y=-i,this.w=t,this.h=e}},{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this._update()}},{key:"_update",value:function _update(){var t=Math.min(4,Math.max(0,this._amount));t>0&&(this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3)}},{key:"shader",set:function set(t){_set(_getPrototypeOf(BloomComponent.prototype),"shader",t,this,!0),this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}},{key:"_firstActive",value:function _firstActive(){this._build()}}],[{key:"_template",value:function _template(){var t=function onUpdate(t,e){if(130&e._recalc){var r=e.w,i=e.h,n=e;do{(n=n._children[0])._element.w=r,n._element.h=i}while(n._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:$t},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:t,scale:2,pivot:0,visible:!1,Content:{shader:{type:Wt}}},L1:{rtt:!0,onUpdate:t,scale:4,pivot:0,visible:!1,Content:{shader:{type:Wt}}},L2:{rtt:!0,onUpdate:t,scale:8,pivot:0,visible:!1,Content:{shader:{type:Wt}}},L3:{rtt:!0,onUpdate:t,scale:16,pivot:0,visible:!1,Content:{shader:{type:Wt}}}}}}}]),BloomComponent}(j),$t=function(t){_inherits(BloomBaseShader,t);var e=_createSuper(BloomBaseShader);function BloomBaseShader(){return _classCallCheck(this,BloomBaseShader),e.apply(this,arguments)}return BloomBaseShader}(Z);$t.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float m = max(max(color.r, color.g), color.b);\n        float c = max(0.0, (m - 0.80)) * 5.0;\n        color = color * c;\n        gl_FragColor = color;\n    }\n";var Zt=function(t){_inherits(SmoothScaleComponent,t);var e=_createSuper(SmoothScaleComponent);function SmoothScaleComponent(t){var r;return _classCallCheck(this,SmoothScaleComponent),(r=e.call(this,t))._smoothScale=1,r._iterations=0,r}return _createClass(SmoothScaleComponent,[{key:"content",get:function get(){return this.tag("Content")},set:function set(t){this.tag("Content").patch(t,!0)}},{key:"smoothScale",get:function get(){return this._smoothScale},set:function set(t){if(this._smoothScale!==t){for(var e=0;t<.5&&e<12;)e++,t*=2;this.scale=t,this._setIterations(e),this._smoothScale=t}}},{key:"_setIterations",value:function _setIterations(t){if(this._iterations!==t){for(var e=this.sel("Scale").childList,r=this.sel("ContentWrap");e.length<t;){var i=0===e.length?r.getTexture():e.last.getTexture();e.a({rtt:!0,renderOffscreen:!0,texture:i})}SmoothScaleComponent._updateDimensions(this.tag("ContentWrap"),!0);var n=t>0;this.patch({ContentWrap:{renderToTexture:n},Scale:{visible:n}});for(var s=0,o=e.length;s<o;s++)e.getAt(s).patch({visible:s<t,renderOffscreen:s!==t-1});this._iterations=t}}},{key:"_signalProxy",get:function get(){return!0}}],[{key:"_template",value:function _template(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:SmoothScaleComponent._updateDimensions,Content:{}},Scale:{visible:!1}}}},{key:"_updateDimensions",value:function _updateDimensions(t,e){var r=t.children[0],i=r.renderWidth,n=r.renderHeight;if(i!==t.w||n!==t.h||e){t.w=i,t.h=n;for(var s=t.parent.tag("Scale").children,o=0,u=s.length;o<u;o++)i*=.5,n*=.5,s[o].w=i,s[o].h=n}}}]),SmoothScaleComponent}(j),Kt=function(t){_inherits(BorderComponent,t);var e=_createSuper(BorderComponent);function BorderComponent(t){var r;return _classCallCheck(this,BorderComponent),(r=e.call(this,t))._borderTop=r.tag("Top"),r._borderRight=r.tag("Right"),r._borderBottom=r.tag("Bottom"),r._borderLeft=r.tag("Left"),r.onAfterUpdate=function(t){var e=t.childList.first,r=t.core.w||e.renderWidth,i=t.core.h||e.renderHeight;t._borderTop.w=r,t._borderBottom.y=i,t._borderBottom.w=r,t._borderLeft.h=i+t._borderTop.h+t._borderBottom.h,t._borderLeft.y=-t._borderTop.h,t._borderRight.x=r,t._borderRight.h=i+t._borderTop.h+t._borderBottom.h,t._borderRight.y=-t._borderTop.h},r.borderWidth=1,r}return _createClass(BorderComponent,[{key:"_signalProxy",get:function get(){return!0}},{key:"content",get:function get(){return this.sel("Content")},set:function set(t){this.sel("Content").patch(t,!0)}},{key:"borderWidth",get:function get(){return this.borderWidthTop},set:function set(t){this.borderWidthTop=t,this.borderWidthRight=t,this.borderWidthBottom=t,this.borderWidthLeft=t}},{key:"borderWidthTop",get:function get(){return this._borderTop.h},set:function set(t){this._borderTop.h=t,this._borderTop.visible=t>0}},{key:"borderWidthRight",get:function get(){return this._borderRight.w},set:function set(t){this._borderRight.w=t,this._borderRight.visible=t>0}},{key:"borderWidthBottom",get:function get(){return this._borderBottom.h},set:function set(t){this._borderBottom.h=t,this._borderBottom.visible=t>0}},{key:"borderWidthLeft",get:function get(){return this._borderLeft.w},set:function set(t){this._borderLeft.w=t,this._borderLeft.visible=t>0}},{key:"colorBorder",get:function get(){return this.colorBorderTop},set:function set(t){this.colorBorderTop=t,this.colorBorderRight=t,this.colorBorderBottom=t,this.colorBorderLeft=t}},{key:"colorBorderTop",get:function get(){return this._borderTop.color},set:function set(t){this._borderTop.color=t}},{key:"colorBorderRight",get:function get(){return this._borderRight.color},set:function set(t){this._borderRight.color=t}},{key:"colorBorderBottom",get:function get(){return this._borderBottom.color},set:function set(t){this._borderBottom.color=t}},{key:"colorBorderLeft",get:function get(){return this._borderLeft.color},set:function set(t){this._borderLeft.color=t}},{key:"borderTop",get:function get(){return this._borderTop},set:function set(t){this.borderTop.patch(t)}},{key:"borderRight",get:function get(){return this._borderRight},set:function set(t){this.borderRight.patch(t)}},{key:"borderBottom",get:function get(){return this._borderBottom},set:function set(t){this.borderBottom.patch(t)}},{key:"borderLeft",get:function get(){return this._borderLeft},set:function set(t){this.borderLeft.patch(t)}},{key:"borders",set:function set(t){this.borderTop=t,this.borderLeft=t,this.borderBottom=t,this.borderRight=t}}],[{key:"_template",value:function _template(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}}]),BorderComponent}(j),Qt=function(t){_inherits(WebGLGrayscaleShader,t);var e=_createSuper(WebGLGrayscaleShader);function WebGLGrayscaleShader(t){var r;return _classCallCheck(this,WebGLGrayscaleShader),(r=e.call(this,t))._amount=1,r}return _createClass(WebGLGrayscaleShader,[{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._amount}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(WebGLGrayscaleShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}],[{key:"getC2d",value:function getC2d(){return Jt}}]),WebGLGrayscaleShader}(Z);Qt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;\n        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);\n    }\n";var Jt=function(t){_inherits(C2dGrayscaleShader,t);var e=_createSuper(C2dGrayscaleShader);function C2dGrayscaleShader(t){var r;return _classCallCheck(this,C2dGrayscaleShader),(r=e.call(this,t))._amount=1,r}return _createClass(C2dGrayscaleShader,[{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._amount}},{key:"_beforeDrawEl",value:function _beforeDrawEl(t){t.target.ctx.filter="grayscale("+this._amount+")"}},{key:"_afterDrawEl",value:function _afterDrawEl(t){t.target.ctx.filter="none"}}],[{key:"getWebGL",value:function getWebGL(){return Qt}}]),C2dGrayscaleShader}(it),te=function(t){_inherits(DitheringShader,t);var e=_createSuper(DitheringShader);function DitheringShader(t){var r;return _classCallCheck(this,DitheringShader),(r=e.call(this,t))._noiseTexture=new zt(t.stage),r._graining=1/256,r._random=!1,r}return _createClass(DitheringShader,[{key:"graining",set:function set(t){this._graining=t,this.redraw()}},{key:"random",set:function set(t){this._random=t,this.redraw()}},{key:"setExtraAttribsInBuffer",value:function setExtraAttribsInBuffer(t){this._noiseTexture.load();for(var e=t.extraAttribsDataByteOffset/4,r=t.quads.floats,i=t.length,n=0;n<i;n++){var s=t.getElementWidth(n)/this._noiseTexture.getRenderWidth(),o=t.getElementHeight(n)/this._noiseTexture.getRenderHeight(),u=0,h=0;if(this._random){if(s+=u=Math.random(),o+=h=Math.random(),Math.random()<.5){var l=u;u=s,s=l}if(Math.random()<.5){var f=h;h=o,o=f}}r[e]=u,r[e+1]=h,r[e+2]=s,r[e+3]=h,r[e+4]=s,r[e+5]=o,r[e+6]=u,r[e+7]=o,e+=8}}},{key:"beforeDraw",value:function beforeDraw(t){var e=this.gl;e.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t));var r=this._noiseTexture.source.nativeTexture;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.activeTexture(e.TEXTURE0)}},{key:"getExtraAttribBytesPerVertex",value:function getExtraAttribBytesPerVertex(){return 8}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(DitheringShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}},{key:"enableAttribs",value:function enableAttribs(){_get(_getPrototypeOf(DitheringShader.prototype),"enableAttribs",this).call(this),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}},{key:"disableAttribs",value:function disableAttribs(){_get(_getPrototypeOf(DitheringShader.prototype),"disableAttribs",this).call(this),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}},{key:"useDefault",value:function useDefault(){return 0===this._graining}},{key:"afterDraw",value:function afterDraw(t){this._random&&this.redraw()}}]),DitheringShader}(Z);te.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec2 aNoiseTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vNoiseTextureCoord = aNoiseTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",te.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uNoiseSampler;\n    uniform float graining;\n    void main(void){\n        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);\n    }\n";var ee=function(t){_inherits(CircularPushShader,t);var e=_createSuper(CircularPushShader);function CircularPushShader(t){var r;return _classCallCheck(this,CircularPushShader),(r=e.call(this,t))._inputValue=0,r._maxDerivative=.01,r._normalizedValue=0,r._offset=0,r._amount=.1,r._aspectRatio=1,r._offsetX=0,r._offsetY=0,r.buckets=100,r}return _createClass(CircularPushShader,[{key:"aspectRatio",get:function get(){return this._aspectRatio},set:function set(t){this._aspectRatio=t,this.redraw()}},{key:"offsetX",get:function get(){return this._offsetX},set:function set(t){this._offsetX=t,this.redraw()}},{key:"offsetY",get:function get(){return this._offsetY},set:function set(t){this._offsetY=t,this.redraw()}},{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this.redraw()}},{key:"inputValue",get:function get(){return this._inputValue},set:function set(t){this._inputValue=t}},{key:"maxDerivative",get:function get(){return this._maxDerivative},set:function set(t){this._maxDerivative=t}},{key:"buckets",get:function get(){return this._buckets},set:function set(t){t>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),t=100),this._buckets=t,this._values=new Uint8Array(this._getValues(t)),this.redraw()}},{key:"_getValues",value:function _getValues(t){for(var e=[],r=0;r<t;r++)e.push(this._inputValue);return e}},{key:"progress",value:function progress(t){this._offset+=t*this._buckets;var e=Math.floor(this._offset);this._offset-=e,this._shiftBuckets(e),this.redraw()}},{key:"_shiftBuckets",value:function _shiftBuckets(t){for(var e=this._buckets-1;e>=0;e--){var r=e-t;r<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[e]=255*this._normalizedValue):this._values[e]=this._values[r]}}},{key:"offset",set:function set(t){this._offset=t,this.redraw()}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(CircularPushShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}},{key:"useDefault",value:function useDefault(){return 0===this._amount}},{key:"beforeDraw",value:function beforeDraw(t){var e=this.gl;e.activeTexture(e.TEXTURE1),this._valuesTexture?e.bindTexture(e.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._valuesTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r.isNode&&e.pixelStorei(e.UNPACK_FLIP_BLUE_RED,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this._buckets,1,0,e.ALPHA,e.UNSIGNED_BYTE,this._values),e.activeTexture(e.TEXTURE0)}},{key:"cleanup",value:function cleanup(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}]),CircularPushShader}(Z);ee.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    uniform float offsetX;\n    uniform float offsetY;\n    uniform float aspectRatio;\n    varying vec2 vTextureCoord;\n    varying vec2 vPos;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vPos = vTextureCoord * 2.0 - 1.0;\n        vPos.y = vPos.y * aspectRatio;\n        vPos.y = vPos.y + offsetY;\n        vPos.x = vPos.x + offsetX;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ee.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vPos;\n    uniform float amount;\n    uniform float offset;\n    uniform float values[100];\n    uniform float buckets;\n    uniform sampler2D uSampler;\n    uniform sampler2D uValueSampler;\n    void main(void){\n        float l = length(vPos);\n        float m = (l * buckets * 0.678 - offset) / buckets;\n        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;\n        vec2 unit = vPos / l;\n        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;\n    }\n";var re=function(t){_inherits(InversionShader,t);var e=_createSuper(InversionShader);function InversionShader(t){var r;return _classCallCheck(this,InversionShader),(r=e.call(this,t))._amount=1,r}return _createClass(InversionShader,[{key:"amount",get:function get(){return this._amount},set:function set(t){this._amount=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._amount}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(InversionShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}]),InversionShader}(Z);re.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); \n        gl_FragColor = color * vColor;\n    }\n";var ie=function(t){_inherits(OutlineShader,t);var r=_createSuper(OutlineShader);function OutlineShader(t){var e;return _classCallCheck(this,OutlineShader),(e=r.call(this,t))._width=5,e._col=4294967295,e._color=[1,1,1,1],e}return _createClass(OutlineShader,[{key:"width",set:function set(t){this._width=t,this.redraw()}},{key:"color",get:function get(){return this._col},set:function set(t){if(this._col!==t){var r=e.getRgbaComponentsNormalized(t);r[0]=r[0]*r[3],r[1]=r[1]*r[3],r[2]=r[2]*r[3],this._color=r,this.redraw(),this._col=t}}},{key:"useDefault",value:function useDefault(){return 0===this._width||0===this._col[3]}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(OutlineShader.prototype),"setupUniforms",this).call(this,t);var e=this.gl;this._setUniform("color",new Float32Array(this._color),e.uniform4fv)}},{key:"enableAttribs",value:function enableAttribs(){_get(_getPrototypeOf(OutlineShader.prototype),"enableAttribs",this).call(this),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}},{key:"disableAttribs",value:function disableAttribs(){_get(_getPrototypeOf(OutlineShader.prototype),"disableAttribs",this).call(this),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}},{key:"setExtraAttribsInBuffer",value:function setExtraAttribsInBuffer(t){for(var e=t.extraAttribsDataByteOffset/4,r=t.quads.floats,i=t.length,n=0;n<i;n++){var s=t.getElementCore(n),o=this._width/s.w,u=o/(1-2*o),h=this._width/s.h,l=h/(1-2*h);r[e]=-u,r[e+1]=-l,r[e+2]=1+u,r[e+3]=-l,r[e+4]=1+u,r[e+5]=1+l,r[e+6]=-u,r[e+7]=1+l,e+=8}}},{key:"beforeDraw",value:function beforeDraw(t){var e=this.gl;e.vertexAttribPointer(this._attrib("aCorner"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t))}},{key:"getExtraAttribBytesPerVertex",value:function getExtraAttribBytesPerVertex(){return 8}}]),OutlineShader}(Z);ie.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aCorner;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vCorner;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vCorner = aCorner;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ie.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vCorner;\n    uniform vec4 color;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec2 m = min(vCorner, 1.0 - vCorner);\n        float value = step(0.0, min(m.x, m.y));\n        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);\n    }\n";var ne=function(t){_inherits(PixelateShader,t);var e=_createSuper(PixelateShader);function PixelateShader(t){var r;return _classCallCheck(this,PixelateShader),(r=e.call(this,t))._size=new Float32Array([4,4]),r}return _createClass(PixelateShader,[{key:"x",get:function get(){return this._size[0]},set:function set(t){this._size[0]=t,this.redraw()}},{key:"y",get:function get(){return this._size[1]},set:function set(t){this._size[1]=t,this.redraw()}},{key:"size",get:function get(){return this._size[0]},set:function set(t){this._size[0]=t,this._size[1]=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._size[0]&&0===this._size[1]}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(PixelateShader.prototype),"setupUniforms",this).call(this,t);var e=this.gl;this._setUniform("size",new Float32Array(this._size),e.uniform2fv)}},{key:"getExtraAttribBytesPerVertex",value:function getExtraAttribBytesPerVertex(){return 8}},{key:"enableAttribs",value:function enableAttribs(){_get(_getPrototypeOf(PixelateShader.prototype),"enableAttribs",this).call(this),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}},{key:"disableAttribs",value:function disableAttribs(){_get(_getPrototypeOf(PixelateShader.prototype),"disableAttribs",this).call(this),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}},{key:"setExtraAttribsInBuffer",value:function setExtraAttribsInBuffer(t){for(var e=t.extraAttribsDataByteOffset/4,r=t.quads.floats,i=t.length,n=0;n<i;n++){var s=t.quads.getTextureWidth(t.index+n),o=t.quads.getTextureHeight(t.index+n);r[e]=s,r[e+1]=o,r[e+2]=s,r[e+3]=o,r[e+4]=s,r[e+5]=o,r[e+6]=s,r[e+7]=o,e+=8}}},{key:"beforeDraw",value:function beforeDraw(t){var e=this.gl;e.vertexAttribPointer(this._attrib("aTextureRes"),2,e.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(t))}}],[{key:"getWebGLImpl",value:function getWebGLImpl(){return WebGLPixelateShaderImpl}}]),PixelateShader}(Z);ne.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aTextureRes;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        vTextureRes = aTextureRes;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ne.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n\n    uniform vec2 size;\n    uniform sampler2D uSampler;\n    \n    vec2 mapCoord( vec2 coord )\n    {\n        coord *= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 unmapCoord( vec2 coord )\n    {\n        coord /= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 pixelate(vec2 coord, vec2 size)\n    {\n        return floor( coord / size ) * size;\n    }\n    \n    void main(void)\n    {\n        vec2 coord = mapCoord(vTextureCoord);\n        coord = pixelate(coord, size);\n        coord = unmapCoord(coord);\n        gl_FragColor = texture2D(uSampler, coord) * vColor;\n    }\n";var se=function(t){_inherits(RadialFilterShader,t);var e=_createSuper(RadialFilterShader);function RadialFilterShader(t){var r;return _classCallCheck(this,RadialFilterShader),(r=e.call(this,t))._radius=0,r._cutoff=1,r}return _createClass(RadialFilterShader,[{key:"radius",get:function get(){return this._radius},set:function set(t){this._radius=t,this.redraw()}},{key:"cutoff",get:function get(){return this._cutoff},set:function set(t){this._cutoff=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._radius}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(RadialFilterShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("radius",2*(this._radius-.5)/t.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*t.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}]),RadialFilterShader}(Z);se.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 pos;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n        pos = gl_Position.xy;\n    }\n",se.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 pos;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float radius;\n    uniform float cutoff;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;\n    }\n";var oe=function(t){_inherits(RoundedRectangleShader,t);var r=_createSuper(RoundedRectangleShader);function RoundedRectangleShader(t){var e;return _classCallCheck(this,RoundedRectangleShader),(e=r.call(this,t))._blend=0,e._radius=[1,1,1,1],e._stroke=0,e._fc=16777215,e._fillColor=e._getNormalizedColor(4294967295),e._strokeColor=e._getNormalizedColor(16777215),e}return _createClass(RoundedRectangleShader,[{key:"blend",set:function set(t){this._blend=Math.min(Math.max(t,0),1)}},{key:"radius",get:function get(){return this._radius},set:function set(t){Array.isArray(t)?2===t.length?this._radius=[t[0],t[1],t[0],t[1]]:3===t.length?this._radius=[t[0],t[1],t[2],this._radius[3]]:4===t.length?this._radius=t:this._radius=[t[0],t[0],t[0],t[0]]:this._radius=[t,t,t,t],this.redraw()}},{key:"topLeft",get:function get(){return this._radius[0]},set:function set(t){this._radius[0]=t,this.redraw()}},{key:"topRight",get:function get(){return this._radius[1]},set:function set(t){this._radius[1]=t,this.redraw()}},{key:"bottomRight",get:function get(){return this._radius[2]},set:function set(t){this._radius[2]=t,this.redraw()}},{key:"bottomLeft",get:function get(){return this._radius[4]},set:function set(t){this._radius[3]=t,this.redraw()}},{key:"strokeColor",get:function get(){return this._sc},set:function set(t){this._sc=t,this._strokeColor=this._getNormalizedColor(t),this.redraw()}},{key:"fillColor",get:function get(){return this._fc},set:function set(t){this._fc=t,this._fillColor=this._getNormalizedColor(t),this.redraw()}},{key:"stroke",get:function get(){return this._stroke},set:function set(t){this._stroke=t,this.redraw()}},{key:"_getNormalizedColor",value:function _getNormalizedColor(t){var r=e.getRgbaComponentsNormalized(t);return r[0]*=r[3],r[1]*=r[3],r[2]*=r[3],new Float32Array(r)}},{key:"setupUniforms",value:function setupUniforms(t){var e=this;_get(_getPrototypeOf(RoundedRectangleShader.prototype),"setupUniforms",this).call(this,t);var r=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),n=this._radius.map(function(t){return _newArrowCheck(this,e),(t+.5)*i}.bind(this));this._setUniform("radius",new Float32Array(n),this.gl.uniform4fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([r._w*i,r._h*i]),this.gl.uniform2fv)}}]),RoundedRectangleShader}(Z);oe.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",oe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n\n    #define PI 3.14159265359\n\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 radius;\n    uniform float stroke;\n    uniform vec4 strokeColor;\n    uniform vec4 fillColor;\n    uniform float alpha;\n    uniform float fill;\n    uniform float blend;\n    \n    float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    float innerBorderMask(float dist, float width){\n        float alpha1 = clamp(dist + width, 0.0, 1.0);\n        float alpha2 = clamp(dist, 0.0, 1.0);\n        return alpha1 - alpha2;\n    }\n\n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        float r = 0.0;\n        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[0];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[1];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {\n            r = radius[2];\n        } else {\n            r = radius[3];\n        }\n        \n        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);\n        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;\n        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     \n        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));\n        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));\n    }\n";var ae=function(t){_inherits(FadeOutShader,t);var e=_createSuper(FadeOutShader);function FadeOutShader(t){var r;return _classCallCheck(this,FadeOutShader),(r=e.call(this,t))._fade=[0,0,0,0],r}return _createClass(FadeOutShader,[{key:"top",get:function get(){return this._fade[0]},set:function set(t){this._fade[0]=t,this.redraw()}},{key:"right",get:function get(){return this._fade[1]},set:function set(t){this._fade[1]=t,this.redraw()}},{key:"bottom",get:function get(){return this._fade[2]},set:function set(t){this._fade[2]=t,this.redraw()}},{key:"left",get:function get(){return this._fade[3]},set:function set(t){this._fade[3]=t,this.redraw()}},{key:"fade",get:function get(){return this._fade},set:function set(t){Array.isArray(t)?2===t.length?this._fade=[t[0],t[1],t[0],t[1]]:3===t.length?this._fade=[t[0],t[1],t[2],this._fade[3]]:4===t.length?this._fade=t:this._fade=[t[0],t[0],t[0],t[0]]:this._fade=[t,t,t,t],this.redraw()}},{key:"setupUniforms",value:function setupUniforms(t){var e=this;_get(_getPrototypeOf(FadeOutShader.prototype),"setupUniforms",this).call(this,t);var r=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),n=this._fade.map(function(t){return _newArrowCheck(this,e),t*i}.bind(this));this._setUniform("fade",new Float32Array(n),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([r._w*i,r._h*i]),this.gl.uniform2fv)}}]),FadeOutShader}(Z);ae.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 fade;\n    \n    void main() {\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 point = vTextureCoord.xy * resolution.xy;\n        \n        vec2 pos1;\n        vec2 pos2;\n        vec2 d;\n        float c;\n        float t = 0.0;\n             \n        if(fade[0] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x, point.y + fade[0]);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[1] > 0.0) {\n            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);\n            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[2] > 0.0) {\n            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);\n            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[3] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x + fade[3], point.y);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        gl_FragColor = color;\n    }\n";var ue=function(t){_inherits(VignetteShader,t);var e=_createSuper(VignetteShader);function VignetteShader(t){var r;return _classCallCheck(this,VignetteShader),(r=e.call(this,t))._magnitude=1.3,r._intensity=.7,r._pivot=[.5,.5],r}return _createClass(VignetteShader,[{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(VignetteShader.prototype),"setupUniforms",this).call(this,t),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}},{key:"pivot",set:function set(t){Array.isArray(t)?this._pivot=t:this._pivot=[t,t],this.redraw()}},{key:"pivotX",get:function get(){return this._pivot[0]},set:function set(t){this._pivot[0]=t,this.redraw()}},{key:"pivotY",get:function get(){return this._pivot[1]},set:function set(t){this._pivot[1]=t,this.redraw()}},{key:"intensity",get:function get(){return this._intensity},set:function set(t){this._intensity=t,this.redraw()}},{key:"magnitude",get:function get(){return this._magnitude},set:function set(t){this._magnitude=t,this.redraw()}}]),VignetteShader}(Z);ue.vertexShaderSource=Z.vertexShaderSource,ue.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float magnitude;\n    uniform float intensity;\n    uniform vec2 pivot;\n\n    void main() {\n        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);\n        uv.x = clamp(uv.x, 0.0, 1.0);\n        uv.y = clamp(uv.y, 0.0, 1.0);\n   \n        uv *=  1.00 - uv.yx;\n        float vig = uv.x * uv.y * 25.0 * intensity;\n        vig = pow(vig, 0.45 * magnitude);\n        vec4 fragColor = vec4(vig) * vColor;\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;\n\n    }\n";var he=function(t){_inherits(SpinnerShader,t);var r=_createSuper(SpinnerShader);function SpinnerShader(t){var e;return _classCallCheck(this,SpinnerShader),(e=r.call(this,t))._radius=100,e._width=50,e._period=1,e._angle=.5,e._smooth=.005,e._color=4294967295,e._backgroundColor=4278190080,e._time=Date.now(),e}return _createClass(SpinnerShader,[{key:"radius",set:function set(t){this._radius=t,this.redraw()}},{key:"width",set:function set(t){this._width=t,this.redraw()}},{key:"period",set:function set(t){this._period=t,this.redraw()}},{key:"angle",set:function set(t){this._angle=t,this.redraw()}},{key:"smooth",set:function set(t){this._smooth=t,this.redraw()}},{key:"color",set:function set(t){this._color=t,this.redraw()}},{key:"backgroundColor",set:function set(t){this._backgroundColor=t,this.redraw()}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(SpinnerShader.prototype),"setupUniforms",this).call(this,t);var r=t.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);var i=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*i,this.gl.uniform1f),this._setUniform("width",this._width*i,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(e.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(e.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([r._w*i,r._h*i]),this.gl.uniform2fv),this.redraw()}}]),SpinnerShader}(Z);he.vertexShaderSource=Z.vertexShaderSource,he.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float iTime;\n    uniform float radius;\n    uniform float width;\n    uniform float period;\n    uniform float angle;\n    uniform float smooth;\n    uniform vec2 resolution;\n\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n\n    float ratio = resolution.y / resolution.x;\n\n    vec2 transpose_pos(vec2 pos) {\n        if (ratio < 1.) {\n            float diff = 0.5 - pos.x;\n            pos.x = 0.5 - diff / ratio;\n        } else {\n            float diff = 0.5 - pos.y;\n            pos.y = 0.5 - diff * ratio;\n        }\n        return pos;\n    }\n\n    float get_angle(vec2 pos) {\n        pos = transpose_pos(pos);\n        float a = atan(pos.y - 0.5, pos.x - 0.5);\n        a = (1.0+a/3.14159)/2.0;\n        \n        return a;\n    }\n\n    float dist(vec2 pos1, vec2 pos2) {\n        pos1 = transpose_pos(pos1);\n        return distance(pos1, pos2);\n    }\n\n    void main()\n    {\n        vec2 fragCoord = vTextureCoord;\n        vec4 fragColor = vColor;\n        \n        vec2 st = vTextureCoord;\n        float pct = dist(st, vec2(0.5));\n\n        float a = get_angle(st);\n        float t = iTime / 1000.0 / period;\n\n        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);\n        float outer = max(radius / resolution.x, radius / resolution.y);\n\n        float x1 = mod(t, 1.0);\n        float x2 = mod(t + angle, 1.0);\n\n        if (x1 < x2) {\n            if (a > x1 && a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        } else {\n            if (a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else if (a > x1) {\n                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        }\n\n        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));\n        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;\n    }\n";var le=function(t){_inherits(HoleShader,t);var e=_createSuper(HoleShader);function HoleShader(t){var r;return _classCallCheck(this,HoleShader),(r=e.call(this,t))._x=0,r._y=0,r._w=0,r._h=0,r._radius=0,r}return _createClass(HoleShader,[{key:"x",get:function get(){return this._x},set:function set(t){this._x=t,this.redraw()}},{key:"y",get:function get(){return this._y},set:function set(t){this._y=t,this.redraw()}},{key:"w",get:function get(){return this._w},set:function set(t){this._w=t,this.redraw()}},{key:"h",get:function get(){return this._h},set:function set(t){this._h=t,this.redraw()}},{key:"radius",get:function get(){return this._radius},set:function set(t){this._radius=t,this.redraw()}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(HoleShader.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,r=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*r,this.gl.uniform1f),this._setUniform("y",this._y*r,this.gl.uniform1f),this._setUniform("w",this._w*r,this.gl.uniform1f),this._setUniform("h",this._h*r,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*r,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*r,e._h*r]),this.gl.uniform2fv)}},{key:"useDefault",value:function useDefault(){return 0===this._x&&0===this._y&&0===this._w&&0===this._h}}]),HoleShader}(Z);le.vertexShaderSource=Z.vertexShaderSource,le.fragmentShaderSource="\n   #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float x;\n    uniform float y;\n    uniform float w;\n    uniform float h;\n    uniform vec2 resolution;\n    uniform float radius;\n\n    float roundBox(vec2 p, vec2 b, float r) {\n        float d = length(max(abs(p)-b+r, 0.1))-r;\n        return smoothstep(1.0, 0.0, d);\n    }\n\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n        vec2 size = vec2(w, h) / 2.0;\n        float b = roundBox(pos, size, radius);\n        gl_FragColor = mix(color, vec4(0.0), b);\n    }\n";var ce=function(t){_inherits(RadialGradientShader,t);var r=_createSuper(RadialGradientShader);function RadialGradientShader(t){var e;return _classCallCheck(this,RadialGradientShader),(e=r.call(this,t))._pivot=[0,0],e._ic=4294967295,e._normalizedIC=e._getNormalizedColor(e._ic),e._oc=16777215,e._normalizedOC=e._getNormalizedColor(e._oc),e._radius=0,e}return _createClass(RadialGradientShader,[{key:"radiusX",get:function get(){return this._radius},set:function set(t){this.radius=t}},{key:"radiusY",get:function get(){return this._radiusY},set:function set(t){this._radiusY=t,this.redraw()}},{key:"radius",set:function set(t){this._radius=t,this.redraw()}},{key:"innerColor",get:function get(){return this._ic},set:function set(t){this._ic=t,this._normalizedIC=this._getNormalizedColor(t),this.redraw()}},{key:"outerColor",get:function get(){return this._ic},set:function set(t){this._oc=t,this._normalizedOC=this._getNormalizedColor(t),this.redraw()}},{key:"color",get:function get(){return this.innerColor},set:function set(t){this.innerColor=t}},{key:"x",set:function set(t){this._x=t,this.redraw()}},{key:"y",set:function set(t){this._y=t,this.redraw()}},{key:"pivot",get:function get(){return this._pivot[0]},set:function set(t){Array.isArray(t)&&2===t.length?this._pivot=t:Array.isArray(t)?this._pivot=[t[0],t[1]||t[0]]:this._pivot=[t,t],this.redraw()}},{key:"pivotY",get:function get(){return this._pivot[1]},set:function set(t){this._pivot[1]=t,this.redraw()}},{key:"pivotX",get:function get(){return this._pivot[0]},set:function set(t){this._pivot[0]=t,this.redraw()}},{key:"_getNormalizedColor",value:function _getNormalizedColor(t){var r=e.getRgbaComponentsNormalized(t);return r[0]*=r[3],r[1]*=r[3],r[2]*=r[3],new Float32Array(r)}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(RadialGradientShader.prototype),"setupUniforms",this).call(this,t);var r=t.shaderOwner;this._x&&(this._pivot[0]=this._x/r.w),this._y&&(this._pivot[1]=this._y/r.h),0===this._radius&&(this._radius=.5*r.w),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",e.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([r._w,r._h]),this.gl.uniform2fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}]),RadialGradientShader}(Z);ce.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec2 pivot;\n    uniform vec4 innerColor;\n    uniform vec4 outerColor;\n    uniform float radius;\n    uniform float radiusY;\n    uniform float alpha;\n    uniform float fill;\n    uniform float aspectRatio;\n    \n    void main() {\n        vec2 point = vTextureCoord.xy * resolution;\n        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);\n        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));\n        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);\n        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));\n    }\n";var fe=function(t){_inherits(Light3dShader,t);var e=_createSuper(Light3dShader);function Light3dShader(t){var r;return _classCallCheck(this,Light3dShader),(r=e.call(this,t))._strength=.5,r._ambient=.5,r._fudge=.4,r._rx=0,r._ry=0,r._z=0,r._pivotX=NaN,r._pivotY=NaN,r._pivotZ=0,r._lightY=0,r._lightZ=0,r}return _createClass(Light3dShader,[{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(Light3dShader.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,r=e.element,i=isNaN(this._pivotX)?r.pivotX*e.w:this._pivotX,n=isNaN(this._pivotY)?r.pivotY*e.h:this._pivotY,s=e.getRenderTextureCoords(i,n),o=-Math.atan2(e._renderContext.tc,e._renderContext.ta),u=this.gl;this._setUniform("pivot",new Float32Array([s[0],s[1],this._pivotZ]),u.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,o]),u.uniform3fv),this._setUniform("z",this._z,u.uniform1f),this._setUniform("lightY",this.lightY,u.uniform1f),this._setUniform("lightZ",this.lightZ,u.uniform1f),this._setUniform("strength",this._strength,u.uniform1f),this._setUniform("ambient",this._ambient,u.uniform1f),this._setUniform("fudge",this._fudge,u.uniform1f)}},{key:"strength",get:function get(){return this._strength},set:function set(t){this._strength=t,this.redraw()}},{key:"ambient",get:function get(){return this._ambient},set:function set(t){this._ambient=t,this.redraw()}},{key:"fudge",get:function get(){return this._fudge},set:function set(t){this._fudge=t,this.redraw()}},{key:"rx",get:function get(){return this._rx},set:function set(t){this._rx=t,this.redraw()}},{key:"ry",get:function get(){return this._ry},set:function set(t){this._ry=t,this.redraw()}},{key:"z",get:function get(){return this._z},set:function set(t){this._z=t,this.redraw()}},{key:"pivotX",get:function get(){return this._pivotX},set:function set(t){this._pivotX=t+1,this.redraw()}},{key:"pivotY",get:function get(){return this._pivotY},set:function set(t){this._pivotY=t+1,this.redraw()}},{key:"lightY",get:function get(){return this._lightY},set:function set(t){this._lightY=t,this.redraw()}},{key:"pivotZ",get:function get(){return this._pivotZ},set:function set(t){this._pivotZ=t,this.redraw()}},{key:"lightZ",get:function get(){return this._lightZ},set:function set(t){this._lightZ=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._rx&&0===this._ry&&0===this._z&&0===this._strength&&1===this._ambient}}]),Light3dShader}(Z);fe.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float fudge;\n    uniform float strength;\n    uniform float ambient;\n    uniform float z;\n    uniform float lightY;\n    uniform float lightZ;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Set depth perspective\n        float perspective = 1.0 + fudge * pos.z;\n\n        pos.z += lightZ * projection.x;\n\n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, perspective);\n\n        // Correct light source position.\n        pos.y += lightY * abs(projection.y);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",fe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec3 pos;\n    uniform sampler2D uSampler;\n    uniform float ambient;\n    uniform float strength;\n    void main(void){\n        vec4 rgba = texture2D(uSampler, vTextureCoord);\n        float d = length(pos);\n        float n = 1.0 / max(0.1, d);\n        rgba.rgb = rgba.rgb * (strength * n + ambient);\n        gl_FragColor = rgba * vColor;\n    }\n";var de=function(t){_inherits(PerspectiveShader,t);var e=_createSuper(PerspectiveShader);function PerspectiveShader(t){var r;return _classCallCheck(this,PerspectiveShader),(r=e.call(this,t))._fudge=.2,r._rx=0,r._ry=0,r._z=1,r}return _createClass(PerspectiveShader,[{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(PerspectiveShader.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,r=e.element,i=r.pivotX*e.w,n=r.pivotY*e.h,s=e.getRenderTextureCoords(i,n),o=-Math.atan2(e._renderContext.tc,e._renderContext.ta),u=this.gl;this._setUniform("pivot",new Float32Array([s[0],s[1],0]),u.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,o]),u.uniform3fv),this._setUniform("z",this._z,u.uniform1f),this._setUniform("fudge",this._fudge,u.uniform1f)}},{key:"fudge",get:function get(){return this._fudge},set:function set(t){this._fudge=t,this.redraw()}},{key:"rx",get:function get(){return this._rx},set:function set(t){this._rx=t,this.redraw()}},{key:"ry",get:function get(){return this._ry},set:function set(t){this._ry=t,this.redraw()}},{key:"z",get:function get(){return this._z},set:function set(t){this._z=t,this.redraw()}},{key:"useDefault",value:function useDefault(){return 0===this._rx&&0===this._ry&&0===this._z}}]),PerspectiveShader}(Z);de.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float z;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, z);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",de.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform vec3 rot;\n    uniform float fudge;\n\n    void main(void) {\n        vec2 coords = vTextureCoord;\n\n        coords.xy -= vec2(0.5);\n        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;\n        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;\n        coords.xy += vec2(0.5);\n\n        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {\n            gl_FragColor = vec4(0.0);\n        } else {\n            gl_FragColor = texture2D(uSampler, coords) * vColor;\n        }\n    }\n";var _e=function(t){_inherits(MagnifierShader,t);var e=_createSuper(MagnifierShader);function MagnifierShader(t){var r;return _classCallCheck(this,MagnifierShader),(r=e.call(this,t))._x=0,r._y=0,r._w=0,r._h=0,r._radius=0,r._magnification=.6,r}return _createClass(MagnifierShader,[{key:"x",get:function get(){return this._x},set:function set(t){this._x=t,this.redraw()}},{key:"y",get:function get(){return this._y},set:function set(t){this._y=t,this.redraw()}},{key:"w",get:function get(){return this._w},set:function set(t){this._w=t,this.redraw()}},{key:"h",get:function get(){return this._h},set:function set(t){this._h=t,this.redraw()}},{key:"magnification",get:function get(){return this._magnification},set:function set(t){this._magnification=t,this.redraw()}},{key:"radius",get:function get(){return this._radius},set:function set(t){this._radius=t,this.redraw()}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(MagnifierShader.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,r=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*r,this.gl.uniform1f),this._setUniform("y",this._y*r,this.gl.uniform1f),this._setUniform("w",this._w*r,this.gl.uniform1f),this._setUniform("h",this._h*r,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*r,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*r,e._h*r]),this.gl.uniform2fv)}},{key:"useDefault",value:function useDefault(){return 0===this._w&&0===this._h}}]),MagnifierShader}(Z);_e.vertexShaderSource=Z.vertexShaderSource,_e.fragmentShaderSource="\n\t  #ifdef GL_ES\n\t\t# ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp float;\n\t\t# else\n\t\tprecision lowp float;\n\t\t# endif\n\t  #endif\n\n\t  varying vec2 vTextureCoord;\n\t  varying vec4 vColor;\n\t  uniform sampler2D uSampler;\n\t  uniform float x;\n\t  uniform float y;\n\t  uniform float w;\n\t  uniform float h;\n\t  uniform vec2 resolution;\n\t  uniform float radius;\n\t  uniform float magnification;\n  \n\t  float roundBox(vec2 p, vec2 b, float r) {\n\t\t  float d = length(max(abs(p)-b+r, 0.1))-r;\n\t\t  return smoothstep(1.0, 0.0, d);\n\t  }\n\n\t  float inside(vec2 v) {\n\t\tvec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);\n\t\treturn s.x * s.y;   \n      }\n  \n\t  void main(void) {\n\t\tvec4 color = texture2D(uSampler, vTextureCoord);\n\t\tvec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n\t\tvec2 size = vec2(w, h) / 2.0;\n\t\tfloat b = roundBox(pos, size, radius);\n\t\tvec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;\n\t\tgl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;\n\t  }\n  ";var ge=function(t){_inherits(SpinnerShader2,t);var r=_createSuper(SpinnerShader2);function SpinnerShader2(t){var e;return _classCallCheck(this,SpinnerShader2),(e=r.call(this,t))._period=1,e._stroke=0,e._showDot=!0,e._clockwise=!0,e._bc=4278190080,e._normalizedBC=e._getNormalizedColor(e._bc),e._c=4294967295,e._normalizedC=e._getNormalizedColor(e._c),e}return _createClass(SpinnerShader2,[{key:"radius",set:function set(t){0===t&&(t=1),this._radius=t}},{key:"stroke",get:function get(){return this._stroke},set:function set(t){this._stroke=Math.abs(t)}},{key:"color",get:function get(){return this._c},set:function set(t){this._c=t,this._normalizedC=this._getNormalizedColor(t)}},{key:"backgroundColor",get:function get(){return this._sc},set:function set(t){this._bc=t,this._normalizedBC=this._getNormalizedColor(t)}},{key:"showDot",get:function get(){return this._showDot},set:function set(t){this._showDot=t}},{key:"clockwise",get:function get(){return this._clockwise},set:function set(t){this._clockwise=t}},{key:"period",get:function get(){return this._period},set:function set(t){this._period=t}},{key:"_getNormalizedColor",value:function _getNormalizedColor(t){var r=e.getRgbaComponentsNormalized(t);return r[0]*=r[3],r[1]*=r[3],r[2]*=r[3],new Float32Array(r)}},{key:"setupUniforms",value:function setupUniforms(t){_get(_getPrototypeOf(SpinnerShader2.prototype),"setupUniforms",this).call(this,t);var e=t.shaderOwner,r=this._radius||e._w/2;0===this._stroke&&(this._stroke=.33*r),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",r,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-SpinnerShader2.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._sc===this._bc&&this._stroke===.5*r||this.redraw()}}]),SpinnerShader2}(Z);ge.spinSync=Date.now(),ge.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    \n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n    uniform float direction;\n    uniform float radius;\n    uniform float time;\n    uniform float stroke;\n    uniform float showDot;\n    uniform float period;\n    uniform float alpha;\n    \n    float circleDist(vec2 p, float radius){\n        return length(p) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 center = vTextureCoord.xy * resolution - halfRes;\n        \n        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));\n        float rot = -(time / 1000.0 / period) * 6.0 * direction;\n        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));\n        \n        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;\n        \n        float strokeRad = stroke * 0.5;\n        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);\n        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));\n        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);\n    }\n";var pe={Application:Lt,Component:j,Base:i,Utils:r,StageUtils:e,Element:U,Tools:Ot,Stage:Et,ElementCore:b,ElementTexturizer:S,Texture:w,EventEmitter:T,shaders:{Grayscale:Qt,BoxBlur:Wt,Dithering:te,CircularPush:ee,Inversion:re,LinearBlur:Nt,Outline:ie,Pixelate:ne,RadialFilter:se,RoundedRectangle:oe,Spinner2:ge,FadeOut:ae,Hole:le,Vignette:ue,Spinner:he,RadialGradient:ce,Light3d:fe,Perspective:de,Magnifier:_e,WebGLShader:$,WebGLDefaultShader:Z,C2dShader:rt,C2dDefaultShader:it,c2d:{Grayscale:Jt,Blur:Ht}},textures:{RectangleTexture:Rt,NoiseTexture:zt,TextTexture:L,ImageTexture:A,HtmlTexture:Ut,StaticTexture:Bt,StaticCanvasTexture:It,SourceTexture:O},components:{FastBlurComponent:Gt,BloomComponent:qt,SmoothScaleComponent:Zt,BorderComponent:Kt,ListComponent:Dt},tools:{ObjMerger:Pt,ObjectListProxy:Mt,ObjectListWrapper:Ft}};r.isWeb&&(window.lng=pe)})()}();
//# sourceMappingURL=dependencies.es5.production.js.map

/*! For license information please see commerce-render-lightning.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.commerceRender=e():t.commerceRender=e()}(self,(()=>(()=>{var t={757:(t,e,i)=>{t.exports=i(666)},601:t=>{t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAABIxJREFUWAnFmU2IVlUYx+e1hCxBtJCcWiQzC1NnoUJtgsBF0CIyN6IL3blRF7lRhLpgSFtxBjctI5gxMAqqRYtaRExgieUHLvwAUcsP+lDJD2j6/ca578zc97n33Pu+M/TAj3vvc/7Pc56595xzz32n1delTUxMDBD6NmyA/hlw2ndtBj9x/nmr1bpgQ1NrNQmgqOXod8M7sBYewUm4CnlRnPatAIt+EdbDk3AaPoMRir3Bce6MwhZDBnfgLozBNliS6gXN0intKMd7YI4MFqdia7WTaDP8Bg9hGLyLXRmxz8NRMJc5N3eVyCCCW5DBv/AlDHadrBBIrgH4CsydQaOhZnGL4Bhoh6BZgkJB0SU5F8CHoNnXokjX4UPonfsU/oGtHYI5dtCHY9m+LDJ9IxBloM17cfnfSl8WqWW5LzwicEI4Lg6Fgnl00qeP277jiUODS4kzywmRvtVBsd3GmYpYx6QTxxo6lyCcGTj9G89WYpxUo+BYugnvBvUnXcQ5u61h9qPGsRxcQIeTWQIBcRZXtJ2BNOkiieuktUyvt1x8AL4hpp3JVI8FxOyEyLybG2umacuIcTH3jXNQ5+RY4+JXzs/yjtzSVpacoH2OpjfAP+Y1cFCXjdkJ2n6AK3AbPqKPUxwrjT5GEaxBO+Tg9LlryWUFzWpwEHdrPrrXK6ujEU2+7Ax4sRccmHVe/OfQ9Wpf1yjQDcYj2LsAsfu5k9zOv6oCETv1V1Vpara9nNJRyx9ofoYNFui+zf1cpRF0F8EvJaKH+PdDvnH1XF9k30TOwOe47fcRn4eRQNDhQrcLIttXFCPaFwnxvVLURtfo3Nqdt0AH7oFIVPShewocG0VzBz3LEPQXRVzfmyWquEB7AO74iF0KahmP+T7CskdXzBHl9Y2zrCisurbA6+DYSRrJNyJ6OhBuD3w7Ap/r5e7AH7ms6ZqP+Fs4HimKPnQfQ2QPcDrmVkyxn6O+yC7jLFvY212iOQ7fuTn9BO8gj+/VdmvJCdpLNL1U0tzEvZT+/qwKoK8fab/oI/a7dR2O5EKN7gT0aidqFGct62DcR9zkVbcG/VXo1lzSXkj9hWjyV93KybGAo8lmwcHre/tZ8MPczcIzEJkz/gh8D36se/f82K806hlDsBrt0KQQRy/brVXE34bI3qqsJGgkiXtTt34H281TThfs4bazwQlxb0JxAT/cIEVbSp4R+Bvc1k0bjgzc1TTe8puFuE0wDmfBD6AnprPXOyNmEKzhvY4InD1/NHUkbeCgf5c8P9h+t5YwlIb/87PTXzD87NwUFpc7EWSgJXfYeUyvR/ua7DF6tMXkCL3V/gzhR8+8F2kfU30dK9ZSek2Auw6L1ObrxyNvhLk1+6r341FeNQEmyMBxMdc/vzlbzWnuzhmbF1HnSAInjl9yTn93uY2/nfN+jAXXOXM5W6snRB6YOpIo+gnYsZPcYKgBtWPgG8JF+H2Il5JCMcl92Uw9Sb17e8C/fC2U/Yju+1rcGLgrWQhnwH3nEd6xtzjWskYFzsxIsVX/hnCX7q/+HsfhC4pyL9nY/gMXG2+mRBQhagAAAABJRU5ErkJggg=="},303:t=>{t.exports="data:image/png;charset=utf-8;base64,iVBORw0KGgoAAAANSUhEUgAAAQgAAAEICAYAAACj9mr/AAAAAXNSR0IArs4c6QAAFLpJREFUeF7tnUGSG0kOBNn/f3Svjc1tbVTOKhcsk0zfKzqAQAAIJrUa9c/v7+/vq/+lQAqkwH8o8JNBtBcpkAJ/UiCDaDdSIAX+qEAG0XKkQApkEO1ACqTAfQV6QdzXLEQKHKNABnHMqGs0Be4rkEHc1yxEChyjQAZxzKhrNAXuK5BB3NcsRAoco0AGccyoazQF7iuQQdzXLEQKHKNABnHMqGs0Be4rkEHc1yxEChyjQAZxzKhrNAXuK5BB3NcsRAoco0AGccyoazQF7iuQQdzXLEQKHKNABnHMqGs0Be4rkEHc1yxEChyjQAZxzKhrNAXuK5BB3NcsRAoco0AGccyoazQF7iuQQdzXLEQKHKNABnHMqGs0Be4rkEHc1yxEChyjQAZxzKhrNAXuK5BB3NcsRAoco0AGccyoazQF7iuQQdzXLEQKHKNABnHMqGs0Be4rkEHc1yxEChyjwHKD+Pn5+Wqxf39/L/uj/glP4k3np/oUt/wIT/V3j9v52/4yCKsg4GnAtOCEJ/rT+ak+xS0/wlP93eN2/ra/DMIqmEEoBenA6UAIr8htAKb+pylmEMMK04BpwQlP9KfzU32KW36Ep/q7x+38bX8ZhFWwF4RSkA6cDoTwitwGYOp/mmIGMawwDZgWnPBEfzo/1ae45Ud4qr973M7f9pdBWAV7QSgF6cDpQAivyG0Apv6nKWYQwwrTgGnBCU/0p/NTfYpbfoSn+rvH7fxtf9sbxGqBSGBaUMt/9/zEj/SjOOlH9QlP9afju/PPIOQGTA949/zET8r7ogOn+oS3/Cx+d/4ZhJzw9IB3z0/8pLwZBPxNXKsv4TMIUgjidCD2E2z3/MRPyptBZBDX/y2GPTC7oISnA7H8d89P/Eg/ipN+VJ/wVH86vjv/XhByA6YHvHt+4ifl7QXRC6IXxNUR0QHaT0ibn/AZxLUCpJ+dr9W/F4RUcHrAu+cnflLeXhC9INwL4tsXlPqznzA2P+F3N4hP52/1JfzHvyC+fcDUXwbRBwwduYlnEKAeHeDuB0zLYfkTnupTfFr/T+dP+tl4BpFBXCpgD9QuqK1v8bvzt/wIn0FkEBkEXYmIW4MivKD2FjSDyCAyiLdO5dkP0YHTVxzCP2P1PiqDyCAyiPfv5fZP0oFnECCpFYjwtyf6f4DVA6b+iB/1b/MTnupTnPqj+hZP/Chu6xOe6tt4L4jNXxB2wISnAyM8xacXnPhTfcJTfxS39QlP9W08g8gg7A6pryi2OB04HRjhLT9bn/CWH+EziAyCdkTFpxecDpzqE141/3p9/F8VzyAyCHsDvSAuFLAGRfjR4b1erwwigxjdsekFpxcA1Se8FcfWJ7zlR/gMIoOgHVHx6QWnA6f6hFfN9xXDyvd60YAasNf4KgPpb6vT/Gx+4k/1CW/52fqEt/wI3wuiFwTtiIpPLzgdONUnvGq+F4SVrxeEXVB7ANN42hDqf5of1Sf+FJ/mT/VtvBfE4heEXdDpBSR+VJ8W1OafxhN/ipM+lj/Vt/EMIoO4VGB6gW3+abw9sAxCKnj6gKl/knd6AYkf1Sf+Nv80nvhTnPSx/Km+jfeC6AXRC8Je0QU+g5DiWgclvKQ3/ldlLf/pBSR+VJ/0t/mn8cSf4qSP5U/1bbwXRC+IXhD2inpBzCloHZTwlvn0J4Dlv5of1Sf9qX/KP40n/hSf5k/1bfzjXxBWAIufXlBaMMuf8NQf4W2c+id+hLf8LH53/hmEnLAdsMVL+ggnfphA/gAdOPEjvKSn4bvzzyDkiO2ALV7SRzjxwwTyB+jAiR/hJT0N351/BiFHbAds8ZI+wokfJpA/QAdO/Agv6Wn47vwzCDliO2CLl/QRTvwwgfwBOnDiR3hJT8N3559ByBHbAVu8pI9w4ocJ5A/QgRM/wkt6Gr47/wxCjtgO2OIlfYQTP0wgf4AOnPgRXtLT8N35ZxByxHbAFi/pI5z4YQL5A3TgxI/wkp6G785/e4PQE1icgBbULkj4n8UTni1P+zNb/QP+0dppAabz04A78OsDt/pNz3c6P/U/Xb8XxLDCNOAMIoO4WkHan+H13f+fvZ8WYDo/DTiDyCAyiAsF6ECmD3g6fwbxeykxzd/qNz3f6fzU/3T9vmIMK0wDnj6Q0+sPj3c8Pc1vmkAGMawwDTiD6CtGXzH6ivFHBTKIDCKDGP6U/ub00wZC2tELiPCWP+UvPqvA8q8Ys+19fnZ7YIQnhTIIUui74xnE5vOlA6cDJjy1T/kJT/Vtfqpf3CmQQTj9xtH2wAhPDdgDpvo2P/Ev7hTIIJx+42h7YISnBuwBU32bn/gXdwpkEE6/cbQ9MMJTA/aAqb7NT/yLOwUyCKffONoeGOGpAXvAVN/mJ/7FnQIZhNNvHG0PjPDUgD1gqm/zE//iToHtDYIWzLW/Hk0HQv1b/LQClh/hiT/pR3hbn/ITv+n6yO93NQNgSAJSg7vHSX7q3+Kn9bH8CE/8ST/C2/qUn/hN10d+GQRJNBunBbALRPjZ7l7jv/yY+Nv+aT5Un+LEb7o+8ssgSKLZOC2AXSDCz3aXQZC+NB/aD8pv4/0ZhFVQ4mkB7AIRXtJH+HR/RMD2T/ypPsWJ33R95NcLgiSajdMC2AUi/Gx3vSBIX5oP7Qflt/FeEFZBiacFsAtEeEkf4dP9EQHbP/Gn+hQnftP1kV8vCJJoNk4LYBeI8LPd9YIgfWk+tB+U38a//gWxWmAakF0Qiyd+FLf1LX6a3+r8VH86nkFMKwz57YFYvG3f1rd44v/p+am/6XgGMa1wBnGpwKcf8DT/xeu5/vdikAA0AML3FeP6n50n/ShO8yH9LX6a3+r8VH863gtiWuFeEL0gFu+YKZ9BGPX+AtZ+glq8bcHWt3ji/+n5qb/peAYxrXAviF4Qi3fMlM8gjHp/AWs/4SzetmDrWzzx//T81N90fLlB0ABJgOk/BJvmR/3Z+DR/m5/6+/T5Wn2of9LPxjOIX/fLZWkAywf8c/2bqyx/ewDT9Ul/y391ftLPxjOIDOJyh6YPgBbY1rf4aX42P+FtPIPIIDIIcUWrDUhQfwuaQWQQGcRbp/LfP5RBCPHega7+Dvj1A+7PIC7XcPX+0Y3QfhLexntB9ILoBSGuiA542oAE9begGUQGkUG8dSp9xRAyzUGtAxMz+wlg8cRvdZz6I340P8o/jSf+xI/wlj/ln44vf0FQgyQw4SlOC0D1LZ74rY5Tf8RvWj/iR/WJP+UnPNW3+am+jWcQ8isGDZgWxA5wGk/9UX3qn/JP44k/8SO85U/5p+MZRAah/gyCFtQeyDSe+GcQVgFSWMZpQWT68d/8NM3f9k94ux7UP+Wfxu/eP/GbjveC6AXRC+JCATIwOlBrcJR/Op5BZBAZRAbxRwUyiAwig8ggPtcg7BPKPvEIT/zoiTqdn/hNx6m/1foQP6uP7Y/wlh/ht39BUAMUpwWgARCe6q/OT/ym46Tfan2In9XH9kd4y4/wGYT8ikEC04DtglJ+4jcdp/6IP+GJ/3T+6frEn+rbeAaRQdgdusTTgdMBEJ7IT+efrk/8qb6NZxAZhN2hDEL8IScZYAYxup6vlx0A4Yk+DXg6P/GbjlN/q/UhflYf2x/hLT/C94LoBUE7ouJ0gHQAhCdy0/mn6xN/qm/jGUQGYXeorxh9xZjbIfqEsA46nX9OmX8zT/On/NTft8+H9Pn6/n9th7RBED99ACTfan2In12f6f6IP8Wn+U3np/4ovvwrxrRA0/lJYBuf5k/5iX8Gcf2Ll0g/0t/qS/UpnkHAn0GQgNPx6QWi/NSfXWCqb/MTf4pP85vOT/1RPIPIIGhHLuP2gLc/EPi1AV/ff38G4Z6I6rreAE8fEOUnil9/IBnE2o9QWtBvX0A6wNX6EL9vn89q/a2+ND+K9xVjrT/SfPq/ORfPJ4NYbFF2ALvjyQFIfurP5ie8rU/5bf+Ep/rU33R+4mfrU36Kf/wLwg54Gk8DoAUgfjY/4W19ym/7JzzVp/6m8xM/W5/yUzyDkH8IRQtGA6AFmM5P/Gx9ym/7JzzVp/6m8xM/W5/yUzyDyCAud4QOiBaM4nQAVJ/wVH91fuJn+6P8FM8gMogM4kIBe6BkQHSgtj7lp3gGkUFkEBnEHxXIIDKIDCKDyCD+pAA9AemJR3h6wq3OT/xsf5Tf9k94qk/9TecnfrY+5af4178gSIDlA5AvGOqP4nQghCf9KP/ueOrfxq0+tj7hM4gv/5t6uABgUITf/cC3P8DFHxA03wwig6AduYxnEEq+8b9K79i9XhlEBqF2KINQ8mUQJJ99AhKe6tOCE97Gif80P6pP/RE/yr87nvq3cauPrU/4XhC9IGhH+oqhFLoGZxAgrhWI8DRb+gQjvI0T/2l+VJ/6I36Uf3c89W/jVh9bn/C9IHpB0I70glAK9YJQ8k076LfnV+K/Xi/6BLf5SX+bfxpP+lB/hJ/mb/N//AuCBJge4Or81D/FpxeY9CF+q+OkD/VH+NX9Uf0MQn7FmF4Qyk8Dpvj0Ak/zp/5snPSh/ghv+U3jM4gMYnTH6IBGi/+F5HTg1B/h/wLF0RQZRAYxu2Dyr3KPknsjOR14BvGGiOZHpgX+9vxG+3+wdAA2P+lv80/jSR/qj/DT/G3+XhC9IOwOXeLpgEaL/4XkdODUH+H/AsXRFBlEBjG7YH3FGNV3Ovlyg5hucPf89AlE/OkTivJb/Gp+VJ/ipA/hV+tH/Gw8g7AKSvzqBV294NQ/8ZPy439NSfmJH/Vn8xPexjMIq6DETy8Q5V+94JaflD+DAAEzCLthEk8HQuntgVv8an5Un+Kr9Sd+NB/C23gGYRWU+NULSgu4Oz8pfy+IXhB2hWbxux/g7vzsdFb3R/zJwAlv470grIISv3pBaQF35yfl7wXRC8Ku0Cx+9wPcnZ+dzur+iD8ZOOFtfPkLwg7ICjCNpwFT/4S3/Km+zU/8qf6n46f1s/kJn0GQQjI+veCSnn5iU/3p/nc3GNKH4qQf4W08g7AKAp4GbBfc0qf6Nv90/8R/df1p/Wx+wmcQpJCMTy+opNcLQv5mKzIoOx/aH5uf8BkEKSTjNGBaMMJLehlEBnG5QhmEvbC+YlwqQAZnDXJ3vF0v0s/mJ3wGQQrJOA3YLrik1wuiF0QvCHtEBp9B/F4v4PCBTutPBm925x8s8bf5Cb/9C2K1QCjg4Qtu50MHZvNPz4/yU3x1/8jvd3oCwGB3gVDADIIkGn1BqOKvF37Fmj6P3fe/F4TcMDvg3fEkjz0g2z/xo/jp9VGfXhAk0XXcLtjueFIngyCFZvfHVWd0LwjWaPSJnEH8XOprDYjGa/Wn/BRfXR/59YIgiWY/AeyCTONJHXvAlj/xo/jp9VGfDIIkyiCuFMgg1u6Pq87ovmKwRn3FuFAgg3ALtPoFQ+w/3iBIYBKA4nQAVH8aT/yJH+Epbvuj/Kvjq/uj+tP6ZBCgMA2IDnAaTwtC/AhPcdsf5V8dX90f1Z/WJ4PIINSO0QJPG5Qi/wZ4dX9U/40W1I9kEBmEWiBa4AxCydt/i0ELtHoBbf1pPK0f6Ut4itv+KP/q+Or+qP60Pr0gekGoHaMFnjYoRf4N8Or+qP4bLagfySAyCLVAtMAZhJK3rxi0QKsX0NafxtP6kb6Ep7jtj/Kvjq/uj+pP69MLYvMXBC2AXaDTDYT0I30sfnq+lJ/iGUQGQTui4tMHpMi98S82ZRA0QTsBwK8eALVH8qzmT/yoP+JPeIoTv+n60/ym+6P81J+N94LoBWF36BJPC55BXMtP+o0O759/cevT/2vO6QWjAVF9i6cFoPyEJ/6Epzjxm64/zW+6P8pP/dl4BtELwu5QL4gLBawBZhDD/+ir3X4aEC2AxRN/yk944k94ihO/6frT/Kb7o/zUn433gugFYXeoF0QviLkdok8QclDCW+a2fvjZX5xD86X9oPlM55/mR/wp3gti8xcELbBdsE/H44LLr7DT+a3+xM/GM4gMYvQrwrTB0QFMH6DNb/HUv41nEBlEBiGuyB64xQvqb0EziAwig3jrVP77h+yBW7yg/hY0g8ggMoi3TiWDEDI9h1oHJfxzZv8ip79DE//qX/+/IDRfq+90/ml+xJ/ivSB6QfSCoCu5iNsDt3hB/S3oxxvEW10O/pAdMOEHqb+Vml4wlGS6P8uP+E/HSZ/V/WUQcgPsgAkv6Wm4XdDp/iw/LZBMQPqs7i+DWDxgWhBJT8Ptgk73Z/lpgWQC0md1fxnE4gHTgkh6Gm4XdLo/y08LJBOQPqv7yyAWD5gWRNLTcLug0/1ZflogmYD0Wd1fBrF4wLQgkp6G2wWd7s/y0wLJBKTP6v4yiMUDpgWR9DTcLuh0f5afFkgmIH1W95dBLB4wLYikp+F2Qaf7s/y0QDIB6bO6v+0NQuq/HD49YLtghJ8WkPSZ5kf1bf+W/zQ/6i+DIIVkfHrAtIBUn/CyfYSv5kf1sQH4AavvND/qL4MghWR8esC0gFSf8LJ9hK/mR/WxgQzCSnSNX72gs93xf+xl65N+dACEt/wIv5of1Sf+FLf6TvND/rv/XgxqYPf49IBpAak+4af1Xc2P6tv+rb7T/Ki/vmKQQjI+PWBaQKpPeNk+wlfzo/rYQF8xrER9xZhUkA6cDoDwk9z/yb2aH9W3/Vt9p/lRf70gSCEZnx4wLSDVJ7xsH+Gr+VF9bKAXhJUofAqkwKcqsPwF8anCxTsFTlAggzhhyvWYAg8VyCAeChcsBU5QIIM4Ycr1mAIPFcggHgoXLAVOUCCDOGHK9ZgCDxXIIB4KFywFTlAggzhhyvWYAg8VyCAeChcsBU5QIIM4Ycr1mAIPFcggHgoXLAVOUCCDOGHK9ZgCDxXIIB4KFywFTlAggzhhyvWYAg8VyCAeChcsBU5QIIM4Ycr1mAIPFcggHgoXLAVOUCCDOGHK9ZgCDxXIIB4KFywFTlAggzhhyvWYAg8VyCAeChcsBU5QIIM4Ycr1mAIPFcggHgoXLAVOUCCDOGHK9ZgCDxXIIB4KFywFTlAggzhhyvWYAg8VyCAeChcsBU5QIIM4Ycr1mAIPFcggHgoXLAVOUCCDOGHK9ZgCDxXIIB4KFywFTlDgf/73nhVM7/lcAAAAAElFTkSuQmCC"},296:t=>{function e(t,e,i){var r,s,n,o,a;function h(){var l=Date.now()-o;l<e&&l>=0?r=setTimeout(h,e-l):(r=null,i||(a=t.apply(n,s),n=s=null))}null==e&&(e=100);var l=function(){n=this,s=arguments,o=Date.now();var l=i&&!r;return r||(r=setTimeout(h,e)),l&&(a=t.apply(n,s),n=s=null),a};return l.clear=function(){r&&(clearTimeout(r),r=null)},l.flush=function(){r&&(a=t.apply(n,s),n=s=null,clearTimeout(r),r=null)},l}e.debounce=e,t.exports=e},996:t=>{"use strict";var e=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===i}(t)}(t)},i="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function r(t,e){return!1!==e.clone&&e.isMergeableObject(t)?a((i=t,Array.isArray(i)?[]:{}),t,e):t;var i}function s(t,e,i){return t.concat(e).map((function(t){return r(t,i)}))}function n(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function o(t,e){try{return e in t}catch(t){return!1}}function a(t,i,h){(h=h||{}).arrayMerge=h.arrayMerge||s,h.isMergeableObject=h.isMergeableObject||e,h.cloneUnlessOtherwiseSpecified=r;var l=Array.isArray(i);return l===Array.isArray(t)?l?h.arrayMerge(t,i,h):function(t,e,i){var s={};return i.isMergeableObject(t)&&n(t).forEach((function(e){s[e]=r(t[e],i)})),n(e).forEach((function(n){(function(t,e){return o(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,n)||(o(t,n)&&i.isMergeableObject(e[n])?s[n]=function(t,e){if(!e.customMerge)return a;var i=e.customMerge(t);return"function"==typeof i?i:a}(n,i)(t[n],e[n],i):s[n]=r(e[n],i))})),s}(t,i,h):r(i,h)}a.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,i){return a(t,i,e)}),{})};var h=a;t.exports=h},666:t=>{var e=function(t){"use strict";var e,i=Object.prototype,r=i.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},n=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function h(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,i){return t[e]=i}}function l(t,e,i,r){var s=e&&e.prototype instanceof p?e:p,n=Object.create(s.prototype),o=new E(r||[]);return n._invoke=function(t,e,i){var r=u;return function(s,n){if(r===_)throw new Error("Generator is already running");if(r===g){if("throw"===s)throw n;return P()}for(i.method=s,i.arg=n;;){var o=i.delegate;if(o){var a=C(o,i);if(a){if(a===f)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===u)throw r=g,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=_;var h=c(t,e,i);if("normal"===h.type){if(r=i.done?g:d,h.arg===f)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(r=g,i.method="throw",i.arg=h.arg)}}}(t,i,o),n}function c(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u="suspendedStart",d="suspendedYield",_="executing",g="completed",f={};function p(){}function x(){}function m(){}var y={};h(y,n,(function(){return this}));var v=Object.getPrototypeOf,S=v&&v(v(L([])));S&&S!==i&&r.call(S,n)&&(y=S);var T=m.prototype=p.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function i(s,n,o,a){var h=c(t[s],t,n);if("throw"!==h.type){var l=h.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,o,a)}),(function(t){i("throw",t,o,a)})):e.resolve(u).then((function(t){l.value=t,o(l)}),(function(t){return i("throw",t,o,a)}))}a(h.arg)}var s;this._invoke=function(t,r){function n(){return new e((function(e,s){i(t,r,e,s)}))}return s=s?s.then(n,n):n()}}function C(t,i){var r=t.iterator[i.method];if(r===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=e,C(t,i),"throw"===i.method))return f;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var s=c(r,t.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,f;var n=s.arg;return n?n.done?(i[t.resultName]=n.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,f):n:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,f)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function L(t){if(t){var i=t[n];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,o=function i(){for(;++s<t.length;)if(r.call(t,s))return i.value=t[s],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}return{next:P}}function P(){return{value:e,done:!0}}return x.prototype=m,h(T,"constructor",m),h(m,"constructor",x),x.displayName=h(m,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,h(t,a,"GeneratorFunction")),t.prototype=Object.create(T),t},t.awrap=function(t){return{__await:t}},b(w.prototype),h(w.prototype,o,(function(){return this})),t.AsyncIterator=w,t.async=function(e,i,r,s,n){void 0===n&&(n=Promise);var o=new w(l(e,i,r,s),n);return t.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(T),h(T,a,"Generator"),h(T,n,(function(){return this})),h(T,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var r=e.pop();if(r in t)return i.value=r,i.done=!1,i}return i.done=!0,i}},t.values=L,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function s(r,s){return a.type="throw",a.arg=t,i.next=r,s&&(i.method="next",i.arg=e),!!s}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var h=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=e,n?(this.method="next",this.next=n.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),R(i),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var s=r.arg;R(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,r){return this.delegate={iterator:L(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};return(()=>{"use strict";function t(t,e,i,r,s,n,o){try{var a=t[n](o),h=a.value}catch(t){return void i(t)}a.done?e(h):Promise.resolve(h).then(r,s)}function e(e){return function(){var i=this,r=arguments;return new Promise((function(s,n){var o=e.apply(i,r);function a(e){t(o,s,n,a,h,"next",e)}function h(e){t(o,s,n,a,h,"throw",e)}a(void 0)}))}}i.d(r,{default:()=>va});var s=i(757),n=i.n(s);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var u={},d={},_=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(null!==t){for(var i=e.split("."),r=0;r<i.length;r++)t=t[i[r]]=void 0!==t[i[r]]?t[i[r]]:{};return"object"===l(t)&&null!==t?Object.keys(t).length?t:void 0:t}};const g=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=_(u[t],e);return void 0!==r?r:i},f=function(){var t,e=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}(Object.getOwnPropertyNames(d));try{for(e.s();!(t=e.n()).done;){var i=t.value;delete d[i]}}catch(t){e.e(t)}finally{e.f()}};var p=function(t,e){return["%c"+((e=Array.from(e)).length>1&&"string"==typeof e[0]?e.shift():t),"background-color: "+{Info:"green",Debug:"gray",Warn:"orange",Error:"red"}[t]+"; color: white; padding: 2px 4px; border-radius: 2px",e]};const x=function(){g("platform","log")&&console.log.apply(console,p("Info",arguments))},m=function(){g("platform","log")&&console.debug.apply(console,p("Debug",arguments))},y=function(){g("platform","log")&&console.error.apply(console,p("Error",arguments))},v=function(){g("platform","log")&&console.warn.apply(console,p("Warn",arguments))};function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function T(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function b(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?T(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var w=function(t,e,i){x("Sending metric",t,e,i)},C=function(t,e,i,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};s=b({params:s},{message:e,code:i,visible:r}),w(t,"error",s)},A=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.reduce((function(e,r){return e[r]=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s=b(b(b({},i),e?{name:e}:{}),s),w(t,r,s)},e}),{error:function(e,i,r){C(t,e,i,r)},event:function(e,i){w(t,e,i)}})};const R=(E={app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]},Object.keys(E).reduce((function(t,e){return t[e]="media"===e?function(t){return A(e,E[e],{url:t})}:A(e,E[e]),t}),{error:C,event:w}));var E;const L={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"};var P,I=null;const O=function(t){return P+t};var F=function(t){return/^\/\//.test(t)?window.location.protocol+t:/^(?:https?:)/i.test(t)?t:window.location.origin+t},k=function(t){if("/"===t.slice(-1))return t.slice(0,-1);var e=t.split("/");return e[e.length-1].indexOf(".")>-1&&e.pop(),e.join("/")};function z(t,e){return z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},z(t,e)}function M(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}function B(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}class U{static mergeNumbers(t,e,i){return t*i+e*(1-i)}static rgb(t,e,i){return(t<<16)+(e<<8)+i+4278190080}static rgba(t,e,i,r){return(t<<16)+(e<<8)+i+16777216*(255*r|0)}static getRgbString(t){return"rgb("+(t/65536|0)%256+","+(t/256|0)%256+","+t%256+")"}static getRgbaString(t){return"rgba("+(t/65536|0)%256+","+(t/256|0)%256+","+t%256+","+((t/16777216|0)/255).toFixed(4)+")"}static getRgbaStringFromArray(t){return"rgba("+Math.floor(255*t[0])+","+Math.floor(255*t[1])+","+Math.floor(255*t[2])+","+(Math.floor(255*t[3])/255).toFixed(4)+")"}static getRgbaComponentsNormalized(t){return[(t/65536|0)%256/255,(t/256|0)%256/255,t%256/255,(t/16777216|0)/255]}static getRgbComponentsNormalized(t){return[(t/65536|0)%256/255,(t/256|0)%256/255,t%256/255]}static getRgbaComponents(t){return[(t/65536|0)%256,(t/256|0)%256,t%256,t/16777216|0]}static getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));let e=((0|t[3])<<24)+((0|t[0])<<16)+((0|t[1])<<8)+(0|t[2]);return e<0&&(e=4294967295+e+1),e}static mergeColors(t,e,i){let r=(t/65536|0)%256*i+(e/65536|0)%256*(1-i),s=(t/256|0)%256*i+(e/256|0)%256*(1-i),n=t%256*i+e%256*(1-i),o=(t/16777216|0)*i+(e/16777216|0)*(1-i);return 16777216*Math.round(o)+65536*Math.round(r)+256*Math.round(s)+Math.round(n)}static mergeMultiColors(t,e){let i=0,r=0,s=0,n=0,o=0,a=t.length;for(let h=0;h<a;h++){let a=(t[h]/65536|0)%256,l=(t[h]/256|0)%256,c=t[h]%256,u=t[h]/16777216|0;i+=a*e[h],r+=l*e[h],s+=c*e[h],n+=u*e[h],o+=e[h]}return o=1/o,16777216*Math.round(n*o)+65536*Math.round(i*o)+256*Math.round(r*o)+Math.round(s*o)}static mergeMultiColorsEqual(t){let e=0,i=0,r=0,s=0,n=0,o=t.length;for(let a=0;a<o;a++)e+=(t[a]/65536|0)%256,i+=(t[a]/256|0)%256,r+=t[a]%256,s+=t[a]/16777216|0,n+=1;return n=1/n,16777216*Math.round(s*n)+65536*Math.round(e*n)+256*Math.round(i*n)+Math.round(r*n)}static mergeColorAlpha(t,e){let i=(t/16777216|0)*e|0;return((t>>16&255)*i/255&255)+((65280&t)*i/255&65280)+(((255&t)<<16)*i/255&16711680)+(i<<24)}static rad(t){return t*(Math.PI/180)}static getTimingBezier(t,e,i,r){let s=3*t,n=3*(i-t)-s,o=1-s-n,a=3*e,h=3*(r-e)-a,l=1-a-h;return function(t){if(t>=1)return 1;if(t<=0)return 0;let e,i,r,c=.5;for(let u=0;u<20;u++){if(e=c*(c*(c*o+n)+s),r=t-e,r>-1e-8&&r<1e-8)return c*(c*(c*l+h)+a);if(i=c*(c*(3*o)+2*n)+s,i>1e-10&&i<1e-10)break;c+=r/i}let u=0,d=1;for(let i=0;i<20;i++){if(c=.5*(u+d),e=c*(c*(c*o+n)+s),r=t-e,r>-1e-8&&r<1e-8)return c*(c*(c*l+h)+a);r<0?d=c:u=c}}}static getTimingFunction(t){switch(t){case"linear":return function(t){return t};case"ease":return U.getTimingBezier(.25,.1,.25,1);case"ease-in":return U.getTimingBezier(.42,0,1,1);case"ease-out":return U.getTimingBezier(0,0,.58,1);case"ease-in-out":return U.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(t){return 1===t?1:0};default:let e="cubic-bezier(";if(t&&0===t.indexOf(e)){let i=t.substr(e.length,t.length-e.length-1).split(",");if(4!==i.length)return console.warn("[Lightning] Unknown timing function: "+t),function(t){return t};let r=parseFloat(i[0]),s=parseFloat(i[1]),n=parseFloat(i[2]),o=parseFloat(i[3]);return isNaN(r)||isNaN(s)||isNaN(n)||isNaN(o)?(console.warn("[Lightning] Unknown timing function: "+t),function(t){return t}):U.getTimingBezier(r,s,n,o)}return console.warn("[Lightning] Unknown timing function: "+t),function(t){return t}}}}class W{static isFunction(t){return"function"==typeof t}static isNumber(t){return"number"==typeof t}static isInteger(t){return"number"==typeof t&&t%1==0}static isBoolean(t){return!0===t||!1===t}static isString(t){return"string"==typeof t}static clone(t){return W.isObjectLiteral(t)||Array.isArray(t)?W.getDeepClone(t):t}static cloneObjShallow(t){let e=Object.keys(t),i={};for(let r=0;r<e.length;r++)i[e[r]]=t[e[r]];return i}static merge(t,e){let i=Object.keys(e);for(let r=0;r<i.length;r++)t[i[r]]=e[i[r]];return t}static isObject(t){let e=typeof t;return!!t&&("object"===e||"function"===e)}static isPlainObject(t){return!!t&&"object"==typeof t}static isObjectLiteral(t){return"object"==typeof t&&t&&t.constructor===Object}static getArrayIndex(t,e){return W.getModuloIndex(t,e.length)}static getModuloIndex(t,e){if(0===e)return t;for(;t<0;)t+=Math.ceil(-t/e)*e;return t%e}static getDeepClone(t){let e,i;if(W.isFunction(t))return t;if(Array.isArray(t)){i=[];let r=Object.keys(t);for(e=0;e<r.length;e++)i[r[e]]=W.getDeepClone(t[r[e]]);return i}if(W.isObject(t)){i={};let r=Object.keys(t);for(e=0;e<r.length;e++)i[r[e]]=W.getDeepClone(t[r[e]]);return i}return t}static equalValues(t,e){return typeof t==typeof e&&(W.isObjectLiteral(t)?W.isObjectLiteral(e)&&W.equalObjectLiterals(t,e):Array.isArray(t)?Array.isArray(e)&&W.equalArrays(t,e):t===e)}static equalObjectLiterals(t,e){let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let s=0,n=i.length;s<n;s++){const n=i[s],o=r[s];if(n!==o)return!1;const a=t[n],h=e[o];if(!W.equalValues(a,h))return!1}return!0}static equalArrays(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(!this.equalValues(t[i],e[i]))return!1;return!0}static setToArray(t){let e=[];return t.forEach((function(t){e.push(t)})),e}static iteratorToArray(t){let e=[],i=t.next();for(;!i.done;)e.push(i.value),i=t.next();return e}static isUcChar(t){return t>=65&&t<=90}}W.isWeb="undefined"!=typeof window&&"undefined"==typeof sparkscene,W.isWPE=W.isWeb&&-1!==navigator.userAgent.indexOf("WPE"),W.isSpark="undefined"!=typeof sparkscene,W.isNode="undefined"==typeof window||W.isSpark,W.isPS4=W.isWeb&&-1!==navigator.userAgent.indexOf("PlayStation 4"),W.isZiggo=W.isWeb&&(-1!==navigator.userAgent.indexOf("EOSSTB")||-1!==navigator.userAgent.indexOf("HZNSTB"));class H{static defaultSetter(t,e,i){t[e]=i}static patchObject(t,e){if(W.isObjectLiteral(e)){let i=Object.keys(e);for(let r=0,s=i.length;r<s;r++){let s=i[r];this.patchObjectProperty(t,s,e[s])}}else console.error("[Lightning] Settings must be object literal")}static patchObjectProperty(t,e,i){let r=t.setSetting||H.defaultSetter;"_"===e.charAt(0)?"__create"!==e&&console.error("[Lightning] Patch of private property '"+e+"' is not allowed"):"type"!==e&&(W.isFunction(i)&&i.__local&&(i=i.__local(t)),r(t,e,i))}static local(t){t.__local=!0}}class j{static getSpacing(t,e,i){const r=e-1;let s,n,o;switch(t){case"flex-start":case"stretch":n=0,o=0;break;case"flex-end":n=i,o=0;break;case"center":n=i/2,o=0;break;case"space-between":n=0,o=Math.max(0,i)/r;break;case"space-around":if(i<0)return this.getSpacing("center",e,i);s=i/(r+1),n=.5*s,o=s;break;case"space-evenly":if(i<0)return this.getSpacing("center",e,i);s=i/(r+2),n=s,o=s;break;default:throw new Error("Unknown mode: "+t)}return{spacingBefore:n,spacingBetween:o}}}class N{constructor(t){this._layout=t,this._totalCrossAxisSize=0}get _lines(){return this._layout._lines}init(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}align(){const t=this._layout.crossAxisSize-this._totalCrossAxisSize,{spacingBefore:e,spacingBetween:i}=this._getSpacing(t),r=this._lines;let s=0;"stretch"===this._layout._flexContainer.alignContent&&r.length&&t>0&&(s=t/r.length);let n=e;for(let t=0,e=r.length;t<e;t++){const e=n,o=r[t].createItemAligner();let a=r[t].crossAxisLayoutSize+s;o.setCrossAxisLayoutSize(a),o.setCrossAxisLayoutOffset(e),o.align(),o.recursiveResizeOccured&&r[t].setItemPositions(),n+=a,n+=i}}get totalCrossAxisSize(){return this._totalCrossAxisSize}_getTotalCrossAxisSize(){const t=this._lines;let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].crossAxisLayoutSize;return e}_getSpacing(t){const e=this._layout._flexContainer.alignContent,i=this._lines.length;return j.getSpacing(e,i,t)}}class X{static getParentAxisSizeWithPadding(t,e){const i=t.target.getParent();if(i){const r=t.flexParent;return r?this.getAxisLayoutSize(r,e)+this.getTotalPadding(r,e):e?i.w:i.h}return 0}static getRelAxisSize(t,e){return e?t.funcW?this._allowRelAxisSizeFunction(t,!0)?t.funcW(this.getParentAxisSizeWithPadding(t,!0)):0:t.originalWidth:t.funcH?this._allowRelAxisSizeFunction(t,!1)?t.funcH(this.getParentAxisSizeWithPadding(t,!1)):0:t.originalHeight}static _allowRelAxisSizeFunction(t,e){const i=t.flexParent;return!i||!i._flex._layout.isAxisFitToContents(e)}static isZeroAxisSize(t,e){return e?!t.originalWidth&&!t.funcW:!t.originalHeight&&!t.funcH}static getAxisLayoutPos(t,e){return e?t.x:t.y}static getAxisLayoutSize(t,e){return e?t.w:t.h}static setAxisLayoutPos(t,e,i){e?t.x=i:t.y=i}static setAxisLayoutSize(t,e,i){e?t.w=i:t.h=i}static getAxisMinSize(t,e){let i=this.getPlainAxisMinSize(t,e),r=0;return t.isFlexItemEnabled()&&(r=t._flexItem._getMinSizeSetting(e)),r>0&&(i=Math.max(i,r)),i}static getPlainAxisMinSize(t,e){return t.isFlexEnabled()?t._flex._layout.getAxisMinSize(e):0!==t.flexItem.shrink?0:this.getRelAxisSize(t,e)}static resizeAxis(t,e,i){t.isFlexEnabled()?t._flex._horizontal===e?t._flex._layout.resizeMainAxis(i):t._flex._layout.resizeCrossAxis(i):this.setAxisLayoutSize(t,e,i)}static getPaddingOffset(t,e){if(t.isFlexEnabled()){const i=t._flex;return e?i.paddingLeft:i.paddingTop}return 0}static getTotalPadding(t,e){if(t.isFlexEnabled()){const i=t._flex;return e?i.paddingRight+i.paddingLeft:i.paddingTop+i.paddingBottom}return 0}static getMarginOffset(t,e){const i=t.flexItem;return i?e?i.marginLeft:i.marginTop:0}static getTotalMargin(t,e){const i=t.flexItem;return i?e?i.marginRight+i.marginLeft:i.marginTop+i.marginBottom:0}}class G{constructor(t){this._line=t,this._amountRemaining=0,this._shrunkSize=0}shrink(t){this._shrunkSize=0,this._amountRemaining=t;let e=this._getTotalShrinkAmount();if(e){const t=this._line.items;do{let i=this._amountRemaining/e;for(let r=this._line.startIndex;r<=this._line.endIndex;r++){const s=t[r].flexItem,n=s.shrink;if(n>0){let t=n*i;const r=s._getMainAxisMinSize(),o=s._getMainAxisLayoutSize();if(o>r){const i=o-r;t>=i&&(t=i,e-=n);const a=o-t;if(s._resizeMainAxis(a),this._shrunkSize+=t,this._amountRemaining-=t,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalShrinkAmount(){let t=0;const e=this._line.items;for(let i=this._line.startIndex;i<=this._line.endIndex;i++){const r=e[i].flexItem;if(r.shrink){const e=r._getMainAxisMinSize();r._getMainAxisLayoutSize()>e&&(t+=r.shrink)}}return t}getShrunkSize(){return this._shrunkSize}}class Y{constructor(t){this._line=t,this._amountRemaining=0,this._grownSize=0}grow(t){this._grownSize=0,this._amountRemaining=t;let e=this._getTotalGrowAmount();if(e){const t=this._line.items;do{let i=this._amountRemaining/e;for(let r=this._line.startIndex;r<=this._line.endIndex;r++){const s=t[r].flexItem,n=s.grow;if(n>0){let t=n*i;const r=s._getMainAxisMaxSizeSetting(),o=s._getMainAxisLayoutSize();if(r>0)if(o>=r)t=0;else{const i=r-o;t>=i&&(t=i,e-=n)}if(t>0){const e=o+t;if(s._resizeMainAxis(e),this._grownSize+=t,this._amountRemaining-=t,Math.abs(this._amountRemaining)<1e-5)return}}}}while(e&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalGrowAmount(){let t=0;const e=this._line.items;for(let i=this._line.startIndex;i<=this._line.endIndex;i++){const r=e[i].flexItem;if(r.grow){const e=r._getMainAxisMaxSizeSetting(),i=r._getMainAxisLayoutSize();(0===e||i<e)&&(t+=r.grow)}}return t}getGrownSize(){return this._grownSize}}class V{constructor(t){this._line=t}get _layout(){return this._line._layout}position(){const{spacingBefore:t,spacingBetween:e}=this._getSpacing();let i=t;const r=this._line.items;for(let t=this._line.startIndex;t<=this._line.endIndex;t++){const s=r[t];s.flexItem._setMainAxisLayoutPos(i),i+=s.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i+=e}}_getSpacing(){const t=this._line._availableSpace;let e=this._layout._flexContainer.justifyContent;const i=this._line.numberOfItems;return j.getSpacing(e,i,t)}}class ${constructor(t){this._line=t,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}get _layout(){return this._line._layout}get _flexContainer(){return this._layout._flexContainer}setCrossAxisLayoutSize(t){this._crossAxisLayoutSize=t}setCrossAxisLayoutOffset(t){this._crossAxisLayoutOffset=t}align(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;const t=this._line.items;for(let e=this._line.startIndex;e<=this._line.endIndex;e++){const i=t[e];this._alignItem(i)}}get recursiveResizeOccured(){return this._recursiveResizeOccured}_alignItem(t){const e=t.flexItem;let i=e.alignSelf||this._alignItemsSetting;switch("stretch"===i&&this._preventStretch(e)&&(i="flex-start"),"stretch"===i||this._isCrossAxisFitToContents||e._hasRelCrossAxisSize()&&e._resetCrossAxisLayoutSize(),i){case"flex-start":this._alignItemFlexStart(e);break;case"flex-end":this._alignItemFlexEnd(e);break;case"center":this._alignItemFlexCenter(e);break;case"stretch":this._alignItemStretch(e)}}_alignItemFlexStart(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}_alignItemFlexEnd(t){const e=t._getCrossAxisLayoutSizeWithPaddingAndMargin();t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-e))}_alignItemFlexCenter(t){const e=t._getCrossAxisLayoutSizeWithPaddingAndMargin(),i=(this._crossAxisLayoutSize-e)/2;t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+i)}_alignItemStretch(t){t._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);const e=t._getMainAxisLayoutSize();let i=this._crossAxisLayoutSize-t._getCrossAxisMargin()-t._getCrossAxisPadding();const r=t._getCrossAxisMinSizeSetting();r>0&&(i=Math.max(i,r));const s=t._getCrossAxisMaxSizeSetting();s>0&&(i=Math.min(i,s)),t._resizeCrossAxis(i),t._getMainAxisLayoutSize()!==e&&(this._recursiveResizeOccured=!0)}_preventStretch(t){const e=t._hasFixedCrossAxisSize(),i="stretch"===t.alignSelf;return e&&!i}}class q{constructor(t,e,i,r){this._layout=t,this.items=t.items,this.startIndex=e,this.endIndex=i,this._availableSpace=r}performLayout(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}_setItemSizes(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}_growItemSizes(t){const e=new Y(this);e.grow(t),this._availableSpace-=e.getGrownSize()}_shrinkItemSizes(t){const e=new G(this);e.shrink(t),this._availableSpace+=e.getShrunkSize()}setItemPositions(){new V(this).position()}createItemAligner(){return new $(this)}_calcLayoutInfo(){this._calcCrossAxisMaxLayoutSize()}getMainAxisMinSize(){let t=0;for(let e=this.startIndex;e<=this.endIndex;e++)t+=this.items[e].flexItem._getMainAxisMinSizeWithPaddingAndMargin();return t}get numberOfItems(){return this.endIndex-this.startIndex+1}get crossAxisLayoutSize(){const t=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||t?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}_calcCrossAxisMaxLayoutSize(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}_getCrossAxisMaxLayoutSize(){let t=0;for(let e=this.startIndex;e<=this.endIndex;e++){const i=this.items[e];t=Math.max(t,i.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return t}}class Q{constructor(t){this._layout=t,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}get lines(){return this._lines}get mainAxisMinSize(){return-1===this._mainAxisMinSize&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}get crossAxisMinSize(){return-1===this._crossAxisMinSize&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}get mainAxisContentSize(){return this._mainAxisContentSize}layoutLines(){this._setup();const t=this._layout.items,e=this._layout.isWrapping();let i,r=0;const s=t.length;for(i=0;i<s;i++){const s=t[i];this._layoutFlexItem(s);const n=s.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();e&&i>r&&this._curMainAxisPos+n>this._mainAxisSize&&(this._layoutLine(r,i-1),this._curMainAxisPos=0,r=i),this._addToMainAxisPos(n)}r<i&&this._layoutLine(r,i-1)}_layoutFlexItem(t){t.isFlexEnabled()?t.flexLayout.updateTreeLayout():t.flexItem._resetLayoutSize()}_setup(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}_addToMainAxisPos(t){this._curMainAxisPos+=t,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}_layoutLine(t,e){const i=this._getAvailableMainAxisLayoutSpace(),r=new q(this._layout,t,e,i);r.performLayout(),this._lines.push(r),(0===this._mainAxisContentSize||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}_getAvailableMainAxisLayoutSpace(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}_getCrossAxisMinSize(){let t=0;const e=this._layout.items;for(let i=0,r=e.length;i<r;i++){const r=e[i].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();t=Math.max(t,r)}return t}_getMainAxisMinSize(){return 1===this._lines.length?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}class K{constructor(t){this._layout=t,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}get _flexContainer(){return this._layout._flexContainer}finalize(){const t=this._layout.getParentFlexContainer();t?new K(t._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}_finalizeRoot(){const t=this._flexContainer.item;let e=X.getAxisLayoutPos(t,!0),i=X.getAxisLayoutPos(t,!1),r=X.getAxisLayoutSize(t,!0),s=X.getAxisLayoutSize(t,!1);r+=this._layout._getHorizontalPadding(),s+=this._layout._getVerticalPadding(),t.clearRecalcFlag(),t.setLayout(e,i,r,s)}_finalizeItems(){const t=this._layout.items;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=this._validateItemCache(i);this._finalizeItem(i),r||this._finalizeItemChildren(i)}}_validateItemCache(t){if(0===t.recalc&&t.isFlexEnabled()){const e=t._flex._layout;if(t.w===t.target.w&&t.h===t.target.h)return!0;{const t=e.crossAxisSize;e.performResizeMainAxis(e.mainAxisSize),e.performResizeCrossAxis(t)}}return!1}_finalizeItemAndChildren(t){this._finalizeItem(t),this._finalizeItemChildren(t)}_finalizeItem(t){this._isReverse&&this._reverseMainAxisLayoutPos(t);let e=X.getAxisLayoutPos(t,!0),i=X.getAxisLayoutPos(t,!1),r=X.getAxisLayoutSize(t,!0),s=X.getAxisLayoutSize(t,!1);e+=this._horizontalPaddingOffset,i+=this._verticalPaddingOffset,t.flex&&(r+=t._flex._layout._getHorizontalPadding(),s+=t._flex._layout._getVerticalPadding());const n=t.flexItem;n&&(e+=n._getHorizontalMarginOffset(),i+=n._getVerticalMarginOffset()),t.clearRecalcFlag(),t.setLayout(e,i,r,s)}_finalizeItemChildren(t){const e=t._flex;e&&new K(e._layout)._finalizeItems()}_reverseMainAxisLayoutPos(t){const e=t.flexItem._getMainAxisLayoutPos()+t.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i=this._layout.mainAxisSize-e;t.flexItem._setMainAxisLayoutPos(i)}}class Z{constructor(t){this._flexContainer=t,this._lineLayouter=new Q(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}get shrunk(){return this._shrunk}get recalc(){return this.item.recalc}layoutTree(){null!==this.item.flexParent?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}updateTreeLayout(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}_performUpdateLayoutTree(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}_refreshLayoutCache(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}_performUpdateLayoutTreeFromCache(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}updateItemCoords(){new K(this).finalize()}_updateSubTreeLayout(){const t=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(t)}_setInitialAxisSizes(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}_layoutAxes(){this._layoutMainAxis(),this._layoutCrossAxis()}_layoutMainAxis(){this._layoutLines(),this._fitMainAxisSizeToContents()}_layoutLines(){this._lineLayouter.layoutLines()}get _lines(){return this._lineLayouter.lines}_fitMainAxisSizeToContents(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}_layoutCrossAxis(){const t=new N(this);t.init(),this._totalCrossAxisSize=t.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),t.align()}_fitCrossAxisSizeToContents(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}isWrapping(){return this._flexContainer.wrap}isAxisFitToContents(t){return this._horizontal===t?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}isMainAxisFitToContents(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}isCrossAxisFitToContents(){return!this._hasFixedCrossAxisBasis()}_hasFixedMainAxisBasis(){return!X.isZeroAxisSize(this.item,this._horizontal)}_hasFixedCrossAxisBasis(){return!X.isZeroAxisSize(this.item,!this._horizontal)}getAxisMinSize(t){return this._horizontal===t?this._getMainAxisMinSize():this._getCrossAxisMinSize()}_getMainAxisMinSize(){return this._lineLayouter.mainAxisMinSize}_getCrossAxisMinSize(){return this._lineLayouter.crossAxisMinSize}resizeMainAxis(t){this.mainAxisSize!==t&&(this.recalc>0?this.performResizeMainAxis(t):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=t,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(t)))}_checkValidCacheMainAxisResize(t){return t===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}performResizeMainAxis(t){const e=t<this.mainAxisSize;this._shrunk=e,this.mainAxisSize=t,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}resizeCrossAxis(t){this.crossAxisSize!==t&&(this.recalc>0?this.performResizeCrossAxis(t):this.crossAxisSize=t)}performResizeCrossAxis(t){this.crossAxisSize=t,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}get targetMainAxisSize(){return this._horizontal?this.item.target.w:this.item.target.h}get targetCrossAxisSize(){return this._horizontal?this.item.target.h:this.item.target.w}getParentFlexContainer(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}_getHorizontalPadding(){return X.getTotalPadding(this.item,!0)}_getVerticalPadding(){return X.getTotalPadding(this.item,!1)}_getHorizontalPaddingOffset(){return X.getPaddingOffset(this.item,!0)}_getVerticalPaddingOffset(){return X.getPaddingOffset(this.item,!1)}_getMainAxisBasis(){return X.getRelAxisSize(this.item,this._horizontal)}_getCrossAxisBasis(){return X.getRelAxisSize(this.item,!this._horizontal)}get _horizontal(){return this._flexContainer._horizontal}get _reverse(){return this._flexContainer._reverse}get item(){return this._flexContainer.item}get items(){return this.item.items}get resizingMainAxis(){return this._resizingMainAxis}get resizingCrossAxis(){return this._resizingCrossAxis}get numberOfItems(){return this.items.length}get mainAxisSize(){return X.getAxisLayoutSize(this.item,this._horizontal)}get crossAxisSize(){return X.getAxisLayoutSize(this.item,!this._horizontal)}set mainAxisSize(t){X.setAxisLayoutSize(this.item,this._horizontal,t)}set crossAxisSize(t){X.setAxisLayoutSize(this.item,!this._horizontal,t)}}class J{constructor(t){this._item=t,this._layout=new Z(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}get item(){return this._item}_changedDimensions(){this._item.changedDimensions()}_changedContents(){this._item.changedContents()}get direction(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")}set direction(t){this.direction!==t&&(this._horizontal="row"===t||"row-reverse"===t,this._reverse="row-reverse"===t||"column-reverse"===t,this._changedContents())}set wrap(t){this._wrap=t,this._changedContents()}get wrap(){return this._wrap}get alignItems(){return this._alignItems}set alignItems(t){if(this._alignItems!==t){if(-1===J.ALIGN_ITEMS.indexOf(t))throw new Error("Unknown alignItems, options: "+J.ALIGN_ITEMS.join(","));this._alignItems=t,this._changedContents()}}get alignContent(){return this._alignContent}set alignContent(t){if(this._alignContent!==t){if(-1===J.ALIGN_CONTENT.indexOf(t))throw new Error("Unknown alignContent, options: "+J.ALIGN_CONTENT.join(","));this._alignContent=t,this._changedContents()}}get justifyContent(){return this._justifyContent}set justifyContent(t){if(this._justifyContent!==t){if(-1===J.JUSTIFY_CONTENT.indexOf(t))throw new Error("Unknown justifyContent, options: "+J.JUSTIFY_CONTENT.join(","));this._justifyContent=t,this._changedContents()}}set padding(t){this.paddingLeft=t,this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t}get padding(){return this.paddingLeft}set paddingLeft(t){this._paddingLeft=t,this._changedDimensions()}get paddingLeft(){return this._paddingLeft}set paddingTop(t){this._paddingTop=t,this._changedDimensions()}get paddingTop(){return this._paddingTop}set paddingRight(t){this._paddingRight=t,this._changedDimensions()}get paddingRight(){return this._paddingRight}set paddingBottom(t){this._paddingBottom=t,this._changedDimensions()}get paddingBottom(){return this._paddingBottom}patch(t){H.patchObject(this,t)}}J.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"],J.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"],J.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];class tt{constructor(t){this._ctr=null,this._item=t,this._grow=0,this._shrink=tt.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}get item(){return this._item}get grow(){return this._grow}set grow(t){this._grow!==t&&(this._grow=parseInt(t)||0,this._changed())}get shrink(){return this._shrink===tt.SHRINK_AUTO?this._getDefaultShrink():this._shrink}_getDefaultShrink(){return this.item.isFlexEnabled()?1:0}set shrink(t){this._shrink!==t&&(this._shrink=parseInt(t)||0,this._changed())}get alignSelf(){return this._alignSelf}set alignSelf(t){if(this._alignSelf!==t){if(void 0===t)this._alignSelf=void 0;else{if(-1===J.ALIGN_ITEMS.indexOf(t))throw new Error("Unknown alignSelf, options: "+J.ALIGN_ITEMS.join(","));this._alignSelf=t}this._changed()}}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth=Math.max(0,t),this._item.changedDimensions(!0,!1)}get maxHeight(){return this._maxHeight}set maxHeight(t){this._maxHeight=Math.max(0,t),this._item.changedDimensions(!1,!0)}set margin(t){this.marginLeft=t,this.marginTop=t,this.marginRight=t,this.marginBottom=t}get margin(){return this.marginLeft}set marginLeft(t){this._marginLeft=t,this._changed()}get marginLeft(){return this._marginLeft}set marginTop(t){this._marginTop=t,this._changed()}get marginTop(){return this._marginTop}set marginRight(t){this._marginRight=t,this._changed()}get marginRight(){return this._marginRight}set marginBottom(t){this._marginBottom=t,this._changed()}get marginBottom(){return this._marginBottom}_changed(){this.ctr&&this.ctr._changedContents()}set ctr(t){this._ctr=t}get ctr(){return this._ctr}patch(t){H.patchObject(this,t)}_resetLayoutSize(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}_resetCrossAxisLayoutSize(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}_resetHorizontalAxisLayoutSize(){let t=X.getRelAxisSize(this.item,!0);this._minWidth&&(t=Math.max(this._minWidth,t)),this._maxWidth&&(t=Math.min(this._maxWidth,t)),X.setAxisLayoutSize(this.item,!0,t)}_resetVerticalAxisLayoutSize(){let t=X.getRelAxisSize(this.item,!1);this._minHeight&&(t=Math.max(this._minHeight,t)),this._maxHeight&&(t=Math.min(this._maxHeight,t)),X.setAxisLayoutSize(this.item,!1,t)}_getCrossAxisMinSizeSetting(){return this._getMinSizeSetting(!this.ctr._horizontal)}_getCrossAxisMaxSizeSetting(){return this._getMaxSizeSetting(!this.ctr._horizontal)}_getMainAxisMaxSizeSetting(){return this._getMaxSizeSetting(this.ctr._horizontal)}_getMinSizeSetting(t){return t?this._minWidth:this._minHeight}_getMaxSizeSetting(t){return t?this._maxWidth:this._maxHeight}_getMainAxisMinSize(){return X.getAxisMinSize(this.item,this.ctr._horizontal)}_getCrossAxisMinSize(){return X.getAxisMinSize(this.item,!this.ctr._horizontal)}_getMainAxisLayoutSize(){return X.getAxisLayoutSize(this.item,this.ctr._horizontal)}_getMainAxisLayoutPos(){return X.getAxisLayoutPos(this.item,this.ctr._horizontal)}_setMainAxisLayoutPos(t){return X.setAxisLayoutPos(this.item,this.ctr._horizontal,t)}_setCrossAxisLayoutPos(t){return X.setAxisLayoutPos(this.item,!this.ctr._horizontal,t)}_getCrossAxisLayoutSize(){return X.getAxisLayoutSize(this.item,!this.ctr._horizontal)}_resizeCrossAxis(t){return X.resizeAxis(this.item,!this.ctr._horizontal,t)}_resizeMainAxis(t){return X.resizeAxis(this.item,this.ctr._horizontal,t)}_getMainAxisPadding(){return X.getTotalPadding(this.item,this.ctr._horizontal)}_getCrossAxisPadding(){return X.getTotalPadding(this.item,!this.ctr._horizontal)}_getMainAxisMargin(){return X.getTotalMargin(this.item,this.ctr._horizontal)}_getCrossAxisMargin(){return X.getTotalMargin(this.item,!this.ctr._horizontal)}_getHorizontalMarginOffset(){return X.getMarginOffset(this.item,!0)}_getVerticalMarginOffset(){return X.getMarginOffset(this.item,!1)}_getMainAxisMinSizeWithPaddingAndMargin(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisMinSizeWithPaddingAndMargin(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_getMainAxisLayoutSizeWithPaddingAndMargin(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisLayoutSizeWithPaddingAndMargin(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_hasFixedCrossAxisSize(){return!X.isZeroAxisSize(this.item,!this.ctr._horizontal)}_hasRelCrossAxisSize(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}tt.SHRINK_AUTO=-1;class et{constructor(t){this._target=t,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}get flexLayout(){return this.flex?this.flex._layout:null}layoutFlexTree(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}get target(){return this._target}get flex(){return this._flex}set flex(t){t?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(t)):this.isFlexEnabled()&&this._disableFlex()}get flexItem(){return!this._flexItemDisabled&&(this._ensureFlexItem(),this._flexItem)}set flexItem(t){if(!1===t){if(!this._flexItemDisabled){const t=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),t&&(t._clearFlexItemsCache(),t.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(t),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();const t=this.flexParent;t&&(t._clearFlexItemsCache(),t.changedContents())}}_enableFlex(){this._flex=new J(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}_disableFlex(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}_enableChildrenAsFlexItems(){const t=this._target._children;if(t)for(let e=0,i=t.length;e<i;e++)t[e].layout._enableFlexItem()}_disableChildrenAsFlexItems(){const t=this._target._children;if(t)for(let e=0,i=t.length;e<i;e++)t[e].layout._disableFlexItem()}_enableFlexItem(){this._ensureFlexItem();const t=this._target._parent._layout;this._flexItem.ctr=t._flex,t.changedContents(),this._checkEnabled()}_disableFlexItem(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}_resetOffsets(){this.x=0,this.y=0}_ensureFlexItem(){this._flexItem||(this._flexItem=new tt(this))}_checkEnabled(){const t=this.isEnabled();this._enabled!==t&&(t?this._enable():this._disable(),this._enabled=t)}_enable(){this._setupTargetForFlex(),this._target.enableFlexLayout()}_disable(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}isEnabled(){return this.isFlexEnabled()||this.isFlexItemEnabled()}isFlexEnabled(){return null!==this._flex}isFlexItemEnabled(){return null!==this.flexParent}_restoreTargetToNonFlex(){const t=this._target;t.x=this._originalX,t.y=this._originalY,t.setDimensions(this._originalWidth,this._originalHeight)}_setupTargetForFlex(){const t=this._target;this._originalX=t._x,this._originalY=t._y,this._originalWidth=t._w,this._originalHeight=t._h}setParent(t,e){t&&t.isFlexContainer()&&t._layout._changedChildren(),e&&e.isFlexContainer()&&(this._enableFlexItem(),e._layout._changedChildren()),this._checkEnabled()}get flexParent(){if(this._flexItemDisabled)return null;const t=this._target._parent;return t&&t.isFlexContainer()?t._layout:null}setVisible(t){const e=this.flexParent;e&&e._changedChildren()}get items(){return this._items||(this._items=this._getFlexItems()),this._items}_getFlexItems(){const t=[],e=this._target._children;if(e)for(let i=0,r=e.length;i<r;i++){const r=e[i];r.visible&&r.isFlexItem()&&t.push(r.layout)}return t}_changedChildren(){this._clearFlexItemsCache(),this.changedContents()}_clearFlexItemsCache(){this._items=null}setLayout(t,e,i,r){let s=this._originalX,n=this._originalY;this.funcX&&(s=this.funcX(X.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(n=this.funcY(X.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(t+s,e+n,i,r):this.target.setLayout(s,n,i,r)}changedDimensions(t=!0,e=!0){this._updateRecalc(t,e)}changedContents(){this._updateRecalc()}forceLayout(){this._updateRecalc()}isChanged(){return this._recalc>0}_updateRecalc(t=!1,e=!1){if(this.isFlexEnabled()){const i=this._flex._layout;t=t||i.isAxisFitToContents(!0),e=e||i.isAxisFitToContents(!1)}const i=1+(t?2:0)+(e?4:0),r=this.getNewRecalcFlags(i);this._recalc|=i,r>1&&this.flexParent?this.flexParent._updateRecalcBottomUp(i):this._target.triggerLayout()}getNewRecalcFlags(t){return 7-this._recalc&t}_updateRecalcBottomUp(t){const e=this._getRecalcFromChangedChildRecalc(t),i=this.getNewRecalcFlags(e);if(this._recalc|=e,i>1){const t=this.flexParent;t?t._updateRecalcBottomUp(e):this._target.triggerLayout()}else this._target.triggerLayout()}_getRecalcFromChangedChildRecalc(t){const e=this._flex._layout,i=e._horizontal?1:2,r=e._horizontal?2:1;t&r||t&i&&e.isWrapping()&&e.isCrossAxisFitToContents()&&(t+=r);let s=e.isAxisFitToContents(!0),n=e.isAxisFitToContents(!1);return e.shrunk&&(e._horizontal?s=!0:n=!0),t&1+(s?2:0)+(n?4:0)}get recalc(){return this._recalc}clearRecalcFlag(){this._recalc=0}enableLocalRecalcFlag(){this._recalc=1}get originalX(){return this._originalX}setOriginalXWithoutUpdatingLayout(t){this._originalX=t}get originalY(){return this._originalY}setOriginalYWithoutUpdatingLayout(t){this._originalY=t}get originalWidth(){return this._originalWidth}set originalWidth(t){this._originalWidth!==t&&(this._originalWidth=t,this.changedDimensions(!0,!1))}get originalHeight(){return this._originalHeight}set originalHeight(t){this._originalHeight!==t&&(this._originalHeight=t,this.changedDimensions(!1,!0))}get funcX(){return this._target.funcX}get funcY(){return this._target.funcY}get funcW(){return this._target.funcW}get funcH(){return this._target.funcH}}class it{constructor(t,e=null){this.id=it.id++,this.manager=t,this.stage=t.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=e,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null}get loadError(){return this._loadError}addTexture(t){this.textures.has(t)||this.textures.add(t)}removeTexture(t){this.textures.delete(t)}incActiveTextureCount(){this._activeTextureCount++,1===this._activeTextureCount&&this.becomesUsed()}decActiveTextureCount(){this._activeTextureCount--,0===this._activeTextureCount&&this.becomesUnused()}get isResultTexture(){return this._isResultTexture}set isResultTexture(t){this._isResultTexture=t}forEachEnabledElement(t){this.textures.forEach((e=>{e.elements.forEach(t)}))}hasEnabledElements(){return this.textures.size>0}forEachActiveElement(t){this.textures.forEach((e=>{e.elements.forEach((e=>{e.active&&t(e)}))}))}getRenderWidth(){return this.w}getRenderHeight(){return this.h}allowCleanup(){return!this.permanent&&!this.isUsed()}becomesUsed(){this.load()}becomesUnused(){this.cancel()}cancel(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}isLoaded(){return!!this._nativeTexture}isLoading(){return this.loadingSince>0}isError(){return!!this._loadError}reload(){this.free(),this.isUsed()&&this.load()}load(t=!1){this.isResultTexture||this._nativeTexture||this.isLoading()||(this.loadingSince=(new Date).getTime(),this._cancelCb=this.loader(((e,i)=>{if(this.isLoading()){if(this._cancelCb=null,this.manager.stage.destroyed)return;if(e)this.onError(e);else if(i&&i.source)if(this.stage.isUpdatingFrame()||t||!1===i.throttle)this.processLoadedSource(i);else{const t=this.stage.textureThrottler;this._cancelCb=t.genericCancelCb,t.add(this,i)}}}),this))}processLoadedSource(t){this.loadingSince=0,this.setSource(t)}setSource(t){const e=t.source;this.w=e.width||t&&t.w||0,this.h=e.height||t&&t.h||0,t&&t.renderInfo&&(this.renderInfo=t.renderInfo),this.permanent=!!t.permanent,t&&t.imageRef&&(this._imageRef=t.imageRef),t&&t.flipTextureY?this._flipTextureY=t.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(e)?(this._nativeTexture=e,this.w=this.w||e.w,this.h=this.h||e.h,this.permanent=!t.hasOwnProperty("permanent")||t.permanent):this.manager.uploadTextureSource(this,t),this._loadError=null,this.onLoad()}isUsed(){return this._activeTextureCount>0}onLoad(){this.isUsed()&&this.textures.forEach((t=>{t.onLoad()}))}forceRenderUpdate(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement((function(t){t.forceRenderUpdate()}))}forceUpdateRenderCoords(){this.forEachActiveElement((function(t){t._updateTextureCoords()}))}get nativeTexture(){return this._nativeTexture}clearNativeTexture(){this._nativeTexture=null,this._imageRef=null}replaceNativeTexture(t,e,i){let r=this._nativeTexture;this._nativeTexture=t,this.w=e,this.h=i,!r&&this._nativeTexture&&this.forEachActiveElement((t=>t.onTextureSourceLoaded())),this._nativeTexture||this.forEachActiveElement((t=>t._setDisplayedTexture(null))),this.forEachEnabledElement((t=>t._updateDimensions()))}onError(t){this._loadError=t,this.loadingSince=0,console.error("[Lightning] texture load error",t,this.lookupId),this.forEachActiveElement((e=>e.onTextureSourceLoadError(t)))}free(){this.isLoaded()&&this.manager.freeTextureSource(this)}_isNativeTexture(t){return W.isNode?"WebGLTexture"===t.constructor.name:"WebGLTexture"in window&&t instanceof WebGLTexture}}it.prototype.isTextureSource=!0,it.id=1;class rt{constructor(t){this._element=t.element,this._core=t,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._core.updateRenderToTextureEnabled()}get renderOffscreen(){return this._renderOffscreen}set renderOffscreen(t){this._renderOffscreen=t,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}get colorize(){return this._colorize}set colorize(t){this._colorize!==t&&(this._colorize=t,this._core.setHasRenderUpdates(1))}_getTextureSource(){return this._resultTextureSource||(this._resultTextureSource=new it(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}hasResultTexture(){return!!this._resultTextureSource}resultTextureInUse(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}updateResultTexture(){let t=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==t){let e=t?t.w:0,i=t?t.h:0;this._resultTextureSource.replaceNativeTexture(t,e,i)}this._resultTextureSource.forEachEnabledElement((t=>{t._updateDimensions(),t.core.setHasRenderUpdates(3)}))}}mustRenderToTexture(){return!(!this._enabled||this.lazy)||!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}deactivate(){this.release()}get renderTextureReused(){return this._renderTextureReused}release(){this.releaseRenderTexture()}releaseRenderTexture(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}reuseTextureAsRenderTexture(t){this._renderTexture!==t&&(this.releaseRenderTexture(),this._renderTexture=t,this._renderTextureReused=!0)}hasRenderTexture(){return!!this._renderTexture}getRenderTexture(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}getResultTexture(){return this._renderTexture}}class st{constructor(t){this._element=t,this.ctx=t.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new nt,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}get offsetX(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x}set offsetX(t){W.isFunction(t)?this.funcX=t:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=t-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(t)):this.x=t)}get x(){return this._x}set x(t){t!==this._x&&(this._updateLocalTranslateDelta(t-this._x,0),this._x=t)}get funcX(){return 1&this._optFlags?this._funcX:null}set funcX(t){this._funcX!==t&&(this._optFlags|=1,this._funcX=t,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}_disableFuncX(){this._optFlags=65534&this._optFlags,this._funcX=null}get offsetY(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y}set offsetY(t){W.isFunction(t)?this.funcY=t:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=t-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(t)):this.y=t)}get y(){return this._y}set y(t){t!==this._y&&(this._updateLocalTranslateDelta(0,t-this._y),this._y=t)}get funcY(){return 2&this._optFlags?this._funcY:null}set funcY(t){this._funcY!==t&&(this._optFlags|=2,this._funcY=t,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}_disableFuncY(){this._optFlags=65533&this._optFlags,this._funcY=null}get funcW(){return 4&this._optFlags?this._funcW:null}set funcW(t){this._funcW!==t&&(this._optFlags|=4,this._funcW=t,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}disableFuncW(){this._optFlags=65531&this._optFlags,this._funcW=null}get funcH(){return 8&this._optFlags?this._funcH:null}set funcH(t){this._funcH!==t&&(this._optFlags|=8,this._funcH=t,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}disableFuncH(){this._optFlags=65527&this._optFlags,this._funcH=null}get w(){return this._w}getRenderWidth(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}get h(){return this._h}getRenderHeight(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this._updateLocalTransform())}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this._updateLocalTransform())}get scale(){return this.scaleX}set scale(t){this._scaleX===t&&this._scaleY===t||(this._scaleX=t,this._scaleY=t,this._updateLocalTransform())}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX!==t&&(this._pivotX=t,this._updateLocalTranslate())}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY!==t&&(this._pivotY=t,this._updateLocalTranslate())}get pivot(){return this._pivotX}set pivot(t){this._pivotX===t&&this._pivotY===t||(this._pivotX=t,this._pivotY=t,this._updateLocalTranslate())}get mountX(){return this._mountX}set mountX(t){this._mountX!==t&&(this._mountX=t,this._updateLocalTranslate())}get mountY(){return this._mountY}set mountY(t){this._mountY!==t&&(this._mountY=t,this._updateLocalTranslate())}get mount(){return this._mountX}set mount(t){this._mountX===t&&this._mountY===t||(this._mountX=t,this._mountY=t,this._updateLocalTranslate())}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._updateLocalTransform())}get alpha(){return this._alpha}set alpha(t){if(t=t>1?1:t<1e-14?0:t,this._alpha!==t){let e=this._alpha;this._alpha=t,this._updateLocalAlpha(),0===e!=(0===t)&&this._element._updateEnabledFlag()}}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(t))}_updateLocalTransform(){if(0!==this._rotation&&this._rotation%(2*Math.PI)){let t=Math.sin(this._rotation),e=Math.cos(this._rotation);this._setLocalTransform(e*this._scaleX,-t*this._scaleY,t*this._scaleX,e*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}_updateLocalTranslate(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}_recalcLocalTranslate(){let t=this._pivotX*this._w,e=this._pivotY*this._h,i=this._x-(t*this._localTa+e*this._localTb)+t,r=this._y-(t*this._localTc+e*this._localTd)+e;i-=this._mountX*this._w,r-=this._mountY*this._h,this._localPx=i,this._localPy=r}_updateLocalTranslateDelta(t,e){this._addLocalTranslate(t,e)}_updateLocalAlpha(){this._setLocalAlpha(this._visible?this._alpha:0)}setHasRenderUpdates(t){if(this._worldContext.alpha){let e=this;for(e._hasRenderUpdates=Math.max(t,e._hasRenderUpdates);(e=e._parent)&&3!==e._hasRenderUpdates;)e._hasRenderUpdates=3}}_setRecalc(t){this._recalc|=t,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}_setHasUpdates(){let t=this;for(;t&&!t._hasUpdates;)t._hasUpdates=!0,t=t._parent}getParent(){return this._parent}setParent(t){if(t!==this._parent){let e=this.isZContext(),i=this._parent;if(this._parent=t,(this._layout||t&&t.isFlexContainer())&&this.layout.setParent(i,t),i&&i.setHasRenderUpdates(3),this._setRecalc(7),this._parent&&this._parent._setHasUpdates(),0===this._zIndex?this.setZParent(t):this.setZParent(t?t.findZContext():null),e!==this.isZContext()&&(this.isZContext()?this.enableZContext(i.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){let e=t&&!t._renderToTextureEnabled?t._shaderOwner:null;e!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(e))}}}enableZSort(t=!1){!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,t&&this.ctx.forceZSort(this))}addChildAt(t,e){this._children||(this._children=[]),this._children.splice(t,0,e),e.setParent(this)}setChildAt(t,e){this._children||(this._children=[]),this._children[t].setParent(null),this._children[t]=e,e.setParent(this)}removeChildAt(t){let e=this._children[t];this._children.splice(t,1),e.setParent(null)}removeChildren(){if(this._children){for(let t=0,e=this._children.length;t<e;t++)this._children[t].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}syncChildren(t,e,i){this._children=i;for(let e=0,i=t.length;e<i;e++)t[e].setParent(null);for(let t=0,i=e.length;t<i;t++)e[t].setParent(this)}moveChild(t,e){let i=this._children[t];this._children.splice(t,1),this._children.splice(e,0,i),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}_setLocalTransform(t,e,i,r){this._setRecalc(4),this._localTa=t,this._localTb=e,this._localTc=i,this._localTd=r,this._isComplex=0!==e||0!==i||t<0||r<0}_addLocalTranslate(t,e){this._localPx+=t,this._localPy+=e,this._triggerRecalcTranslate()}_setLocalAlpha(t){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&t?this._setRecalc(129):this._setRecalc(1),t<1e-14&&(t=0),this._localAlpha=t}setDimensions(t,e,i=this._dimsUnknown){if(this._dimsUnknown=i,this.hasFlexLayout())this._layout.originalWidth=t,this._layout.originalHeight=e;else if(this._w!==t||this._h!==e)return this._updateDimensions(t,e),!0;return!1}_updateDimensions(t,e){this._w===t&&this._h===e||(this._w=t,this._h=e,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}setTextureCoords(t,e,i,r){this.setHasRenderUpdates(3),this._ulx=t,this._uly=e,this._brx=i,this._bry=r}get displayedTextureSource(){return this._displayedTextureSource}setDisplayedTextureSource(t){this.setHasRenderUpdates(3),this._displayedTextureSource=t}get isRoot(){return this._isRoot}setAsRoot(){this._parent=new st(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(7)}isAncestorOf(t){let e=t;for(;e=e._parent;)if(this===e)return!0;return!1}isZContext(){return this._forceZIndexContext||this._renderToTextureEnabled||0!==this._zIndex||this._isRoot||!this._parent}findZContext(){return this.isZContext()?this:this._parent.findZContext()}setZParent(t){if(this._zParent!==t){if(null!==this._zParent&&(0!==this._zIndex&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),null!==t){let e=t._zContextUsage>0;0!==this._zIndex&&t.incZContextUsage(),t._zContextUsage>0&&((e||this._parent!==t)&&t._zIndexedChildren.push(this),t.enableZSort())}this._zParent=t,this._zIndexResort=!0}}incZContextUsage(){if(this._zContextUsage++,1===this._zContextUsage&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(let t=0,e=this._children.length;t<e;t++)this._zIndexedChildren.push(this._children[t]);this._zSort=!1}}decZContextUsage(){this._zContextUsage--,0===this._zContextUsage&&(this._zSort=!1,this._zIndexedChildren.splice(0))}get zIndex(){return this._zIndex}set zIndex(t){if(this._zIndex!==t){this.setHasRenderUpdates(1);let e=this._zParent,i=this.isZContext();0===t&&0!==this._zIndex?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():e=this._parent:0!==t&&0===this._zIndex?(e=this._parent?this._parent.findZContext():null,e===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort())):t!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),e!==this._zParent&&this.setZParent(null),this._zIndex=t,e!==this._zParent&&this.setZParent(e),i!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}get forceZIndexContext(){return this._forceZIndexContext}set forceZIndexContext(t){this.setHasRenderUpdates(1);let e=this.isZContext();this._forceZIndexContext=t,e!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}enableZContext(t){t&&t._zContextUsage>0&&this._getZIndexedDescs().forEach((t=>{this.isAncestorOf(t)&&0!==t._zIndex&&t.setZParent(this)}))}_getZIndexedDescs(){const t=[];if(this._children)for(let e=0,i=this._children.length;e<i;e++)this._children[e]._getZIndexedDescsRec(t);return t}_getZIndexedDescsRec(t){if(this._zIndex)t.push(this);else if(this._children&&!this.isZContext())for(let e=0,i=this._children.length;e<i;e++)this._children[e]._getZIndexedDescsRec(t)}disableZContext(){if(this._zContextUsage>0){let t=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach((function(e){0!==e._zIndex&&e.setZParent(t)}))}}get colorUl(){return this._colorUl}set colorUl(t){this._colorUl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=t)}get colorUr(){return this._colorUr}set colorUr(t){this._colorUr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=t)}get colorBl(){return this._colorBl}set colorBl(t){this._colorBl!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=t)}get colorBr(){return this._colorBr}set colorBr(t){this._colorBr!==t&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=t)}set onUpdate(t){this._onUpdate=t,this._setRecalc(7)}set onAfterUpdate(t){this._onAfterUpdate=t,this._setRecalc(7)}set onAfterCalcs(t){this._onAfterCalcs=t,this._setRecalc(7)}get shader(){return this._shader}set shader(t){this.setHasRenderUpdates(1);let e=this._shader;if(this._shader=t,!t&&e){let t=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(t)}else t&&this._setShaderOwnerRecursive(this)}get activeShader(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}get activeShaderOwner(){return this._shaderOwner}get clipping(){return this._clipping}set clipping(t){this._clipping!==t&&(this._clipping=t,this._setRecalc(3))}get clipbox(){return this._clipbox}set clipbox(t){this._clipbox=t}_setShaderOwnerRecursive(t){if(this._shaderOwner=t,this._children&&!this._renderToTextureEnabled)for(let e=0,i=this._children.length;e<i;e++){let i=this._children[e];i._shader||(i._setShaderOwnerRecursive(t),i._hasRenderUpdates=3)}}_setShaderOwnerChildrenRecursive(t){if(this._children)for(let e=0,i=this._children.length;e<i;e++){let i=this._children[e];i._shader||(i._setShaderOwnerRecursive(t),i._hasRenderUpdates=3)}}_hasRenderContext(){return this._renderContext!==this._worldContext}get renderContext(){return this._renderContext}updateRenderToTextureEnabled(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}_enableRenderToTexture(){if(!this._renderToTextureEnabled){let t=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new nt,this._setShaderOwnerChildrenRecursive(null),t||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}_disableRenderToTexture(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}isWhite(){return 4294967295===this._colorUl&&4294967295===this._colorUr&&4294967295===this._colorBl&&4294967295===this._colorBr}hasSimpleTexCoords(){return 0===this._ulx&&0===this._uly&&1===this._brx&&1===this._bry}_stashTexCoords(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}_unstashTexCoords(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}_stashColors(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}_unstashColors(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}isVisible(){return this._localAlpha>1e-14}get outOfBounds(){return this._outOfBounds}set boundsMargin(t){this._boundsMargin=t?t.slice():null,this._triggerRecalcTranslate()}get boundsMargin(){return this._boundsMargin}update(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?256&this._recalc&&this._layout.layoutFlexTree():2&this._recalc&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));const t=this._parent._worldContext;let e=this._worldContext;const i=t.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&i||e.alpha&&!i){let r=this._recalc;1&r&&(!e.alpha&&i&&(this._hasRenderUpdates=3),e.alpha=t.alpha*this._localAlpha,e.alpha<1e-14&&(e.alpha=0)),6&r&&(e.px=t.px+this._localPx*t.ta,e.py=t.py+this._localPy*t.td,0!==t.tb&&(e.px+=this._localPy*t.tb),0!==t.tc&&(e.py+=this._localPx*t.tc)),4&r&&(e.ta=this._localTa*t.ta,e.tb=this._localTd*t.tb,e.tc=this._localTa*t.tc,e.td=this._localTd*t.td,this._isComplex&&(e.ta+=this._localTc*t.tb,e.tb+=this._localTb*t.ta,e.tc+=this._localTc*t.td,e.td+=this._localTb*t.tc));const s=this._parent._renderContext;if(this._parent._hasRenderContext()){const t=this._renderContext===this._worldContext;t&&(this._renderContext=new nt);const e=this._renderContext;(t||1&r)&&(e.alpha=s.alpha*this._localAlpha,e.alpha<1e-14&&(e.alpha=0)),(t||6&r)&&(e.px=s.px+this._localPx*s.ta,e.py=s.py+this._localPy*s.td,0!==s.tb&&(e.px+=this._localPy*s.tb),0!==s.tc&&(e.py+=this._localPx*s.tc)),t&&(r|=2),(t||4&r)&&(e.ta=this._localTa*s.ta,e.tb=this._localTd*s.tb,e.tc=this._localTa*s.tc,e.td=this._localTd*s.td,this._isComplex&&(e.ta+=this._localTc*s.tb,e.tb+=this._localTb*s.ta,e.tc+=this._localTc*s.td,e.td+=this._localTb*s.tc))}else this._renderContext=this._worldContext;-1===this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;const n=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==n&&(this._recalc|=6,r|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=n;const o=this._renderContext,a=this._dimsUnknown?2048:this._w,h=this._dimsUnknown?2048:this._h;let l,c,u,d;const _=0!==o.tb||0!==o.tc||o.ta<0||o.td<0;if(_?(l=Math.min(0,a*o.ta,a*o.ta+h*o.tb,h*o.tb)+o.px,u=Math.max(0,a*o.ta,a*o.ta+h*o.tb,h*o.tb)+o.px,c=Math.min(0,a*o.tc,a*o.tc+h*o.td,h*o.td)+o.py,d=Math.max(0,a*o.tc,a*o.tc+h*o.td,h*o.td)+o.py):(l=o.px,u=o.px+o.ta*a,c=o.py,d=o.py+o.td*h),this._dimsUnknown&&(_||this._localTa<1||this._localTb<1)){const t=this._x*s.ta+this._y*s.tb+s.px,e=this._x*s.tc+this._y*s.td+s.py;t<l&&(l=t),e<c&&(c=e),t>u&&(u=t),e>d&&(d=e)}if(6&r||!this._scissor)if(this._clipping&&o.isSquare()){const t=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(t){const e=Math.max(t[0],l),i=Math.max(t[1],c);this._scissor=[e,i,Math.min(t[2]+t[0],u)-e,Math.min(t[3]+t[1],d)-i]}else this._scissor=[l,c,u-l,d-c]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(_?(l=Math.min(0,a*o.ta,a*o.ta+h*o.tb,h*o.tb)+o.px,u=Math.max(0,a*o.ta,a*o.ta+h*o.tb,h*o.tb)+o.px,c=Math.min(0,a*o.tc,a*o.tc+h*o.td,h*o.td)+o.py,d=Math.max(0,a*o.tc,a*o.tc+h*o.td,h*o.td)+o.py):(l=o.px,u=o.px+o.ta*a,c=o.py,d=o.py+o.td*h),this._dimsUnknown&&(_||this._localTa<1||this._localTb<1))){const t=this._x*s.ta+this._y*s.tb+s.px,e=this._x*s.tc+this._y*s.td+s.py;t<l&&(l=t),e<c&&(c=e),t>u&&(u=t),e>d&&(d=e)}if(2===this._parent._outOfBounds)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(6&r){this._outOfBounds=0;let t=!0;if(this._renderToTextureEnabled&&this._texturizer&&this._texturizer.renderOffscreen||(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>u||this._scissor[1]>d||l>this._scissor[0]+this._scissor[2]||c>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&a&&h)&&(this._outOfBounds=2)),t=0===this._outOfBounds,t||(t=this._recBoundsMargin?!(u<this._scissor[0]-this._recBoundsMargin[2]||d<this._scissor[1]-this._recBoundsMargin[3]||l>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||c>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):!(u<this._scissor[0]-100||d<this._scissor[1]-100||l>this._scissor[0]+this._scissor[2]+100||c>this._scissor[1]+this._scissor[3]+100),t&&2===this._outOfBounds&&(this._outOfBounds=1))),this._withinBoundsMargin!==t)if(this._withinBoundsMargin=t,this._withinBoundsMargin){this._hasUpdates=!0;const t=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=t}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=a,this._viewport[3]=h):this._viewport=[0,0,a,h]),this._pRecalc=135&this._recalc,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=nt.IDENTITY),this._children)for(let t=0,e=this._children.length;t<e;t++)this._children[t].update();this._useRenderToTexture&&(this._renderContext=o)}else if(this._children)for(let t=0,e=this._children.length;t<e;t++)this._children[t]._hasUpdates?this._children[t].update():(this._children[t]._recalc|=this._pRecalc,this._children[t].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else-1===this.ctx.updateTreeOrder||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}_applyRelativeDimFuncs(){if(1&this._optFlags){const t=this._funcX(this._parent.w);t!==this._x&&(this._localPx+=t-this._x,this._x=t)}if(2&this._optFlags){const t=this._funcY(this._parent.h);t!==this._y&&(this._localPy+=t-this._y,this._y=t)}let t=!1;if(4&this._optFlags){const e=this._funcW(this._parent.w);e!==this._w&&(this._w=e,t=!0)}if(8&this._optFlags){const e=this._funcH(this._parent.h);e!==this._h&&(this._h=e,t=!0)}t&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}updateOutOfBounds(){if(2!==this._outOfBounds&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(let t=0,e=this._children.length;t<e;t++)this._children[t].updateOutOfBounds()}updateTreeOrder(){if(this._localAlpha&&2!==this._outOfBounds&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(let t=0,e=this._children.length;t<e;t++)this._children[t].updateTreeOrder()}_renderSimple(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let t=this.renderState;if(0===this._outOfBounds&&this._displayedTextureSource&&(t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(let t=0,e=this._zIndexedChildren.length;t<e;t++)this._zIndexedChildren[t].render();else for(let t=0,e=this._children.length;t<e;t++)0===this._children[t]._zIndex&&this._children[t].render()}}_renderAdvanced(){const t=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let e,i,r=this.renderState,s=!0;if(this._useRenderToTexture){if(0===this._w||0===this._h)return;if(!this._texturizer.hasRenderTexture()||t>=3){if(this.ctx.renderToTextureCount++,r.setShader(r.defaultShader,this),i=r.renderTextureInfo,e={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!r.isCachingTexturizer&&t<3)&&(e.cache=!0,r.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),r.setRenderTextureInfo(e),r.setScissor(null),this._displayedTextureSource){let t=this._renderContext;this._renderContext=nt.IDENTITY,this.renderState.addQuad(this),this._renderContext=t}}else s=!1}else 0===this._outOfBounds&&this._displayedTextureSource&&(r.setShader(this.activeShader,this._shaderOwner),r.setScissor(this._scissor),this.renderState.addQuad(this));if(s&&this._children)if(this._zContextUsage)for(let t=0,e=this._zIndexedChildren.length;t<e;t++)this._zIndexedChildren[t].render();else for(let t=0,e=this._children.length;t<e;t++)0===this._children[t]._zIndex&&this._children[t].render();if(this._useRenderToTexture){let t=!1;if(s&&(r.finishedRenderTexture(),this._texturizer.empty=e.empty,e.empty?this._texturizer.releaseRenderTexture():e.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(e.nativeTexture),e.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),e.nativeTexture=this._texturizer.getRenderTexture()),r.setRenderTextureInfo(i),t=!0),!this._texturizer.empty){let i=this._texturizer.getResultTexture();if(t&&(i&&(i.update=r.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){r.setShader(this.activeShader,this._shaderOwner),r.setScissor(this._scissor);const t=!e||e.cache;r.setTexturizer(this._texturizer,t),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),r.setTexturizer(null)}}}e&&e.cache&&(r.isCachingTexturizer=!1)}}get zSort(){return this._zSort}sortZIndexedChildren(){const t=this._zIndexedChildren.length;let e=0;const i=this._zIndexedChildren,r=[];for(let s=0;s<t;s++)i[s]._zParent===this&&(i[s]._zIndexResort?r.push(i[s]):(e!==s&&(i[e]=i[s]),e++));const s=r.length;if(s){for(let t=0;t<s;t++)r[t]._zIndexResort=!1;r.sort(st.sortZIndexedChildren);const t=e;if(t){e=0;let n=0,o=0;const a=[];for(;;){const h=(i[n]._zIndex===r[o]._zIndex?i[n]._updateTreeOrder-r[o]._updateTreeOrder:i[n]._zIndex-r[o]._zIndex)>0?r[o++]:i[n++];if(0!==e&&a[e-1]===h||(a[e++]=h),n>=t){do{const t=r[o++];0!==e&&a[e-1]===t||(a[e++]=t)}while(o<s);break}if(o>=s){do{const t=i[n++];0!==e&&a[e-1]===t||(a[e++]=t)}while(n<t);break}}this._zIndexedChildren=a}else{e=0;let t=0;do{i[e++]=r[t++]}while(t<s);i.length>e&&i.splice(e)}}else i.length>e&&i.splice(e);this._zSort=!1}get localTa(){return this._localTa}get localTb(){return this._localTb}get localTc(){return this._localTc}get localTd(){return this._localTd}get element(){return this._element}get renderUpdates(){return this._hasRenderUpdates}get texturizer(){return this._texturizer||(this._texturizer=new rt(this)),this._texturizer}getCornerPoints(){let t=this._worldContext;return[t.px,t.py,t.px+this._w*t.ta,t.py+this._w*t.tc,t.px+this._w*t.ta+this._h*t.tb,t.py+this._w*t.tc+this._h*t.td,t.px+this._h*t.tb,t.py+this._h*t.td]}getRenderTextureCoords(t,e){let i=this._renderContext;return[i.px+i.ta*t+i.tb*e,i.py+i.tc*t+i.td*e]}getAbsoluteCoords(t,e){let i=this._renderContext;return[i.px+i.ta*t+i.tb*e,i.py+i.tc*t+i.td*e]}collectAtCoord(t,e,i){if(0!==this._renderContext.alpha){if(this.inBound(t,e)&&(this._scissor?this.inScissor()&&i.push(this):i.push(this)),this._children){const r=this._children.length;for(let s=0;s<r;s++)this._children[s].collectAtCoord(t,e,i)}return i.sort(st.sortZIndexedChildren)}}inBound(t,e){const i=this.getCornerPoints();return t>i[0]&&t<i[2]&&e>i[1]&&e<i[7]}inScissor(){const t=this._scissor,e=this.getCornerPoints();return e[2]>=t[0]&&e[0]<=t[0]+t[2]&&e[7]>=t[1]&&e[1]<=t[1]+t[3]}get layout(){return this._ensureLayout(),this._layout}get flex(){return this._layout?this._layout.flex:null}set flex(t){this.layout.flex=t}get flexItem(){return this._layout?this._layout.flexItem:null}set flexItem(t){this.layout.flexItem=t}isFlexItem(){return!!this._layout&&this._layout.isFlexItemEnabled()}isFlexContainer(){return!!this._layout&&this._layout.isFlexEnabled()}enableFlexLayout(){this._ensureLayout()}_ensureLayout(){this._layout||(this._layout=new et(this))}disableFlexLayout(){this._triggerRecalcTranslate()}hasFlexLayout(){return this._layout&&this._layout.isEnabled()}setLayout(t,e,i,r){this.x=t,this.y=e,this._updateDimensions(i,r)}triggerLayout(){this._setRecalc(256)}_triggerRecalcTranslate(){this._setRecalc(2)}}class nt{constructor(){this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}isIdentity(){return 1===this.alpha&&0===this.px&&0===this.py&&1===this.ta&&0===this.tb&&0===this.tc&&1===this.td}isSquare(){return 0===this.tb&&0===this.tc}}nt.IDENTITY=new nt,st.sortZIndexedChildren=function(t,e){return t._zIndex===e._zIndex?t._updateTreeOrder-e._updateTreeOrder:t._zIndex-e._zIndex};class ot{constructor(){this._hasEventListeners=!1}on(t,e){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[t]?this._eventFunction[t]!==ot.combiner?(this._eventListeners[t]=[this._eventFunction[t],e],this._eventFunction[t]=ot.combiner):this._eventListeners[t].push(e):this._eventFunction[t]=e}once(t,e){const i=(r,s,n)=>{e(r,s,n),this.off(t,i)};i.__originalFunc=e,this.on(t,i)}has(t,e){if(this._hasEventListeners){const i=this._eventFunction[t];if(i)if(i===ot.combiner){const i=this._eventListeners[t];for(const t of i)if(t===e||t.__originalFunc==e)return!0}else if(this._eventFunction[t]===e||this._eventFunction[t].__originalFunc===e)return!0}return!1}off(t,e){if(this._hasEventListeners){const i=this._eventFunction[t];if(i)if(i===ot.combiner){const i=this._eventListeners[t];let r=i.indexOf(e);r>=0&&i.splice(r,1),r=i.map((t=>t.__originalFunc)).indexOf(e),r>=0&&i.splice(r,1),1===i.length&&(this._eventFunction[t]=i[0],this._eventListeners[t]=void 0)}else this._eventFunction[t]!==e&&this._eventFunction[t].__originalFunc!==e||(this._eventFunction[t]=void 0)}}removeListener(t,e){this.off(t,e)}emit(t,e,i,r){if(this._hasEventListeners){const s=this._eventFunction[t];s&&(s===ot.combiner?s(this,t,e,i,r):s(e,i,r))}}listenerCount(t){if(this._hasEventListeners){const e=this._eventFunction[t];if(e)return e===ot.combiner?this._eventListeners[t].length:1}return 0}removeAllListeners(t){this._hasEventListeners&&(delete this._eventFunction[t],delete this._eventListeners[t])}}ot.combiner=function(t,e,i,r,s){const n=t._eventListeners[e];if(n)for(const t of[...n])t(i,r,s)},ot.addAsMixin=function(t){t.prototype.on=ot.prototype.on,t.prototype.once=ot.prototype.once,t.prototype.has=ot.prototype.has,t.prototype.off=ot.prototype.off,t.prototype.removeListener=ot.prototype.removeListener,t.prototype.emit=ot.prototype.emit,t.prototype.listenerCount=ot.prototype.listenerCount,t.prototype.removeAllListeners=ot.prototype.removeAllListeners};class at{constructor(t){this._initialized=!1,this.ctx=t,this._elements=new Set}static create(t,e){let i;if(W.isObjectLiteral(e))i=e.type?t.renderer.createShader(t.ctx,e):this.shader,i&&H.patchObject(i,e);else if(null===e)i=t.ctx.renderState.defaultShader;else if(void 0===e)i=null;else{if(!e.isShader)return void console.error("[Lightning] Please specify a shader type.");t.renderer.isValidShaderType(e.constructor)||(console.error("[Lightning] Invalid shader type"),e=null),i=e}return i}static getWebGL(){}static getC2d(){}addElement(t){this._elements.add(t)}removeElement(t){this._elements.delete(t),this._elements||this.cleanup()}redraw(){this._elements.forEach((t=>{t.setHasRenderUpdates(2)}))}patch(t){H.patchObject(this,t)}useDefault(){return!1}addEmpty(){return!1}cleanup(){}get isShader(){return!0}}class ht{constructor(t){this.stage=t,this.manager=this.stage.textureManager,this.id=ht.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}get source(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}addElement(t){this.elements.has(t)||(this.elements.add(t),1===this.elements.size&&this._source&&this._source.addTexture(this),t.active&&this.incActiveCount())}removeElement(t){this.elements.delete(t)&&(0===this.elements.size&&this._source&&this._source.removeTexture(this),t.active&&this.decActiveCount())}incActiveCount(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,1===this._activeCount&&this.becomesUsed()}decActiveCount(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}becomesUsed(){this.source&&this.source.incActiveTextureCount()}onLoad(){this._resizeMode&&this._applyResizeMode(),this.elements.forEach((t=>{t.active&&t.onTextureSourceLoaded()}))}_checkForNewerReusableTextureSource(){const t=this.source;if(t.isLoaded())this._resizeMode&&this._applyResizeMode();else{const e=this._getReusableTextureSource();e&&e.isLoaded()&&e!==t&&this._replaceTextureSource(e)}}becomesUnused(){this.source&&this.source.decActiveTextureCount()}isUsed(){return this._activeCount>0}_getLookupId(){return null}_getSourceLoader(){throw new Error("Texture.generate must be implemented.")}get isValid(){return this._getIsValid()}_getIsValid(){return!0}_changed(){this.isUsed()?this._updateSource():this._mustUpdate=!0}_updateSource(){this.stage.addUpdateSourceTexture(this)}_performUpdateSource(t=!1){if(t||this.isUsed()){this._mustUpdate=!1;let t=this._getTextureSource();this._replaceTextureSource(t)}}_getTextureSource(){let t=null;if(this._getIsValid()){const e=this._getLookupId();t=this._getReusableTextureSource(e),t||(t=this.manager.getTextureSource(this._getSourceLoader(),e))}return t}_getReusableTextureSource(t=this._getLookupId()){return this._getIsValid()&&t?this.manager.getReusableTextureSource(t):null}_replaceTextureSource(t=null){let e=this._source;if(this._source=t,this.elements.size&&(e&&(this._activeCount&&e.decActiveTextureCount(),e.removeTexture(this)),t&&(t.addTexture(this),this._activeCount&&t.incActiveTextureCount())),this.isUsed())if(t)if(t.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach((t=>{t.active&&t._setDisplayedTexture(this)}));else{const e=t.loadError;e&&this.elements.forEach((t=>{t.active&&t.onTextureSourceLoadError(e)}))}else this.elements.forEach((t=>{t.active&&t._setDisplayedTexture(null)}))}load(){this.source&&(this.isLoaded()||this.source.load(!0))}isLoaded(){return this._source&&this._source.isLoaded()}get loadError(){return this._source&&this._source.loadError}free(){this._source&&this._source.free()}set resizeMode({type:t="cover",w:e=0,h:i=0,clipX:r=.5,clipY:s=.5}){this._resizeMode={type:t,w:e,h:i,clipX:r,clipY:s},this.isLoaded()&&this._applyResizeMode()}get resizeMode(){return this._resizeMode}_clearResizeMode(){this._resizeMode=null}_applyResizeMode(){"cover"===this._resizeMode.type?this._applyResizeCover():"contain"===this._resizeMode.type&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}_applyResizeCover(){const t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h;let i=Math.max(t,e);if(i){if(this._precision=1/i,t&&t<i){const t=this._precision*this._resizeMode.w,e=this._source.w-t;this._x=e*this._resizeMode.clipX,this._w=this._source.w-e}if(e&&e<i){const t=this._precision*this._resizeMode.h,e=this._source.h-t;this._y=e*this._resizeMode.clipY,this._h=this._source.h-e}}}_applyResizeContain(){const t=this._resizeMode.w/this._source.w,e=this._resizeMode.h/this._source.h;let i=t;(!i||e<i)&&(i=e),i&&(this._precision=1/i)}enableClipping(t,e,i,r){this._clearResizeMode(),t*=this._precision,e*=this._precision,i*=this._precision,r*=this._precision,this._x===t&&this._y===e&&this._w===i&&this._h===r||(this._x=t,this._y=e,this._w=i,this._h=r,this._updateClipping(!0))}disableClipping(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}_updateClipping(){this.clipping=!!(this._x||this._y||this._w||this._h);let t=this;this.elements.forEach((function(e){e.displayedTexture===t&&e.onDisplayedTextureClippingChanged()}))}_updatePrecision(){let t=this;this.elements.forEach((function(e){e.displayedTexture===t&&e.onPrecisionChanged()}))}getNonDefaults(){let t={};return t.type=this.constructor.name,0!==this.x&&(t.x=this.x),0!==this.y&&(t.y=this.y),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),1!==this.precision&&(t.precision=this.precision),t}get px(){return this._x}get py(){return this._y}get pw(){return this._w}get ph(){return this._h}get x(){return this._x/this._precision}set x(t){this._clearResizeMode(),t*=this._precision,this._x!==t&&(this._x=t,this._updateClipping())}get y(){return this._y/this._precision}set y(t){this._clearResizeMode(),t*=this._precision,this._y!==t&&(this._y=t,this._updateClipping())}get w(){return this._w/this._precision}set w(t){this._clearResizeMode(),t*=this._precision,this._w!==t&&(this._w=t,this._updateClipping())}get h(){return this._h/this._precision}set h(t){this._clearResizeMode(),t*=this._precision,this._h!==t&&(this._h=t,this._updateClipping())}get precision(){return this._precision}set precision(t){this._clearResizeMode(),this._precision!==t&&(this._precision=t,this._updatePrecision())}isAutosizeTexture(){return!0}getRenderWidth(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}getRenderHeight(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}patch(t){H.patchObject(this,t)}}ht.prototype.isTexture=!0,ht.id=0;class lt extends ht{constructor(t){super(t),this._src=void 0,this._hasAlpha=!1}get src(){return this._src}set src(t){this._src!==t&&(this._src=t,this._changed())}get hasAlpha(){return this._hasAlpha}set hasAlpha(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._changed())}_getIsValid(){return!!this._src}_getLookupId(){return this._src}_getSourceLoader(){let t=this._src,e=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var i=t.charCodeAt(0);-1===t.indexOf("//")&&(i>=65&&i<=90||i>=97&&i<=122||46==i)&&(t=this.stage.getOption("srcBasePath")+t)}return i=>this.stage.platform.loadSrcTexture({src:t,hasAlpha:e},i)}getNonDefaults(){const t=super.getNonDefaults();return this._src&&(t.src=this._src),t}}class ct{constructor(t,e,i){this._stage=t,this._canvas=e,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=W.isSpark?this._stage.platform.getFontSetting(this):this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){let t=this._settings.fontFace;Array.isArray(t)||(t=[t]);let e=[];for(let i=0,r=t.length;i<r;i++)"serif"===t[i]||"sans-serif"===t[i]?e.push(t[i]):e.push(`"${t[i]}"`);return`${this._settings.fontStyle} ${this._settings.fontSize*this.getPrecision()}px ${e.join(",")}`}_load(){if(W.isWeb&&document.fonts){const t=this._getFontSetting();try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch((e=>{console.warn("[Lightning] Font load error",e,t)})).then((()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)}))}catch(e){console.warn("[Lightning] Can't check font loading for "+t)}}}draw(){const t=this._load();return t?t.then((()=>W.isSpark?this._stage.platform.drawText(this):this._draw())):W.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let t={};const e=this.getPrecision(),i=this._settings.paddingLeft*e,r=this._settings.paddingRight*e,s=this._settings.fontSize*e;let n=null===this._settings.offsetY?null:this._settings.offsetY*e,o=this._settings.lineHeight*e;const a=this._settings.w*e,h=this._settings.h*e;let l=this._settings.wordWrapWidth*e;const c=this._settings.cutSx*e,u=this._settings.cutEx*e,d=this._settings.cutSy*e,_=this._settings.cutEy*e,g=(this._settings.letterSpacing||0)*e,f=this._settings.textIndent*e;this.setFontProperties();let p,x=a||2048/this.getPrecision(),m=x-i;if(m<10&&(x+=10-m,m=10),l||(l=m),this._settings.textOverflow&&!this._settings.wordWrap){let t;switch(this._settings.textOverflow){case"clip":t="";break;case"ellipsis":t=this._settings.maxLinesSuffix;break;default:t=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,l-f,t)}if(this._settings.wordWrap)p=this.wrapText(this._settings.text,l,g,f);else{p={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};let t=p.l.length;for(let e=0;e<t-1;e++)p.n.push(e)}let y=p.l;if(this._settings.maxLines&&y.length>this._settings.maxLines){let e=y.slice(0,this._settings.maxLines),i=null;if(this._settings.maxLinesSuffix){let t=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,r=this.wrapText(e[e.length-1],l-t,g,f);e[e.length-1]=r.l[0]+this._settings.maxLinesSuffix,i=[r.l.length>1?r.l[1]:""]}else i=[""];let r,s=y.length,n=0,o=p.n.length;for(r=this._settings.maxLines;r<s;r++)i[n]+=(i[n]?" ":"")+y[r],r+1<o&&p.n[r+1]&&n++;t.remainingText=i.join("\n"),t.moreTextLines=!0,y=e}else t.moreTextLines=!1,t.remainingText="";let v,S=0,T=[];for(let t=0;t<y.length;t++){let e=this.measureText(y[t],g)+(0===t?f:0);T.push(e),S=Math.max(S,e)}if(t.lineWidths=T,a||(x=S+i+r,m=S),o=o||s,h)v=h;else{const t="bottom"!=this._settings.textBaseline?.5*s:0;v=o*(y.length-1)+t+Math.max(o,s)+n}return null===n&&(n=s),t.w=x,t.h=v,t.lines=y,t.precision=e,x||(x=1),v||(v=1),(c||u)&&(x=Math.min(x,u-c)),(d||_)&&(v=Math.min(v,_-d)),t.width=x,t.innerWidth=m,t.height=v,t.fontSize=s,t.cutSx=c,t.cutSy=d,t.cutEx=u,t.cutEy=_,t.lineHeight=o,t.lineWidths=T,t.offsetY=n,t.paddingLeft=i,t.paddingRight=r,t.letterSpacing=g,t.textIndent=f,t}_draw(){const t=this._calculateRenderInfo(),e=this.getPrecision();let i,r;this._canvas.width=Math.ceil(t.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(t.height),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let s=[];for(let e=0,n=t.lines.length;e<n;e++)i=0===e?t.textIndent:0,r=e*t.lineHeight+t.offsetY,"middle"==this._settings.verticalAlign?r+=(t.lineHeight-t.fontSize)/2:"bottom"==this._settings.verticalAlign&&(r+=t.lineHeight-t.fontSize),"right"===this._settings.textAlign?i+=t.innerWidth-t.lineWidths[e]:"center"===this._settings.textAlign&&(i+=(t.innerWidth-t.lineWidths[e])/2),i+=t.paddingLeft,s.push({text:t.lines[e],x:i,y:r,w:t.lineWidths[e]});if(this._settings.highlight){let i=this._settings.highlightColor||0,r=this._settings.highlightHeight*e||1.5*t.fontSize;const n=this._settings.highlightOffset*e,o=null!==this._settings.highlightPaddingLeft?this._settings.highlightPaddingLeft*e:t.paddingLeft,a=null!==this._settings.highlightPaddingRight?this._settings.highlightPaddingRight*e:t.paddingRight;this._context.fillStyle=U.getRgbaString(i);for(let e=0;e<s.length;e++){let i=s[e];this._context.fillRect(i.x-o,i.y-t.offsetY+n,i.w+a+o,r)}}let n=null;this._settings.shadow&&(n=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=U.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*e,this._context.shadowOffsetY=this._settings.shadowOffsetY*e,this._context.shadowBlur=this._settings.shadowBlur*e),this._context.fillStyle=U.getRgbaString(this._settings.textColor);for(let e=0,i=s.length;e<i;e++){let i=s[e];if(0===t.letterSpacing)this._context.fillText(i.text,i.x,i.y);else{const e=i.text.split("");let r=i.x;for(let s=0,n=e.length;s<n;s++)this._context.fillText(e[s],r,i.y),r+=this.measureText(e[s],t.letterSpacing)}}n&&(this._context.shadowColor=n[0],this._context.shadowOffsetX=n[1],this._context.shadowOffsetY=n[2],this._context.shadowBlur=n[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),this.renderInfo=t}wrapWord(t,e,i){const r=this._context.measureText(i).width,s=t.length,n=this._context.measureText(t).width;if(n<=e)return t;let o=Math.floor(e*s/n),a=this._context.measureText(t.substring(0,o)).width+r;if(a>e)for(;o>0&&(a=this._context.measureText(t.substring(0,o)).width+r,a>e);)o-=1;else for(;o<s;){if(a=this._context.measureText(t.substring(0,o)).width+r,!(a<e)){o-=1;break}o+=1}return t.substring(0,o)+(e>=r?i:"")}wrapText(t,e,i,r=0){let s=t.split(/\r?\n/g),n=[],o=[];for(let t=0;t<s.length;t++){let a=[],h="",l=e-r,c=s[t].split(" ");for(let t=0;t<c.length;t++){const s=this.measureText(c[t],i),n=s+this.measureText(" ",i);0===t||n>l?(t>0&&(a.push(h),h=""),h+=c[t],l=e-s-(0===t?r:0)):(l-=n,h+=" "+c[t])}a.push(h),h="",n=n.concat(a),t<s.length-1&&o.push(n.length)}return{l:n,n:o}}measureText(t,e=0){return e?t.split("").reduce(((t,i)=>t+this._context.measureText(i).width+e),0):this._context.measureText(t).width}}class ut{constructor(t,e,i){this._stage=t,this._canvas=e,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){const t=W.isSpark?this._stage.platform.getFontSetting(this):this._getFontSetting();return this._context.font=t,this._context.textBaseline=this._settings.textBaseline,t}_getFontSetting(){let t=this._settings.fontFace;Array.isArray(t)||(t=[t]);let e=[];for(let i=0,r=t.length;i<r;i++)"serif"===t[i]||"sans-serif"===t[i]?e.push(t[i]):e.push(`"${t[i]}"`);return`${this._settings.fontStyle} ${this._settings.fontSize*this.getPrecision()}px ${e.join(",")}`}_load(){if(W.isWeb&&document.fonts){const t=this._getFontSetting();try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch((e=>{console.warn("Font load error",e,t)})).then((()=>{document.fonts.check(t,this._settings.text)||console.warn("Font not found",t)}))}catch(e){console.warn("Can't check font loading for "+t)}}}draw(){const t=this._load();return t?t.then((()=>W.isSpark?this._stage.platform.drawText(this):this._draw())):W.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let t={};const e=this.getPrecision(),i=this._settings.paddingLeft*e,r=this._settings.paddingRight*e,s=this._settings.fontSize*e,n=this._settings.lineHeight*e||s,o=0!=this._settings.w?this._settings.w*e:2048/e,a=this._settings.wordWrapWidth*e,h=this._settings.cutSx*e,l=this._settings.cutEx*e,c=this._settings.cutSy*e,u=this._settings.cutEy*e,d=this._settings.letterSpacing||0;t.baseFont=this.setFontProperties(),t.w=o,t.width=o,t.text=this._settings.text,t.precision=e,t.fontSize=s,t.fontBaselineRatio=this._settings.fontBaselineRatio,t.lineHeight=n,t.letterSpacing=d,t.textAlign=this._settings.textAlign,t.textColor=this._settings.textColor,t.verticalAlign=this._settings.verticalAlign,t.highlight=this._settings.highlight,t.highlightColor=this._settings.highlightColor,t.highlightHeight=this._settings.highlightHeight,t.highlightPaddingLeft=this._settings.highlightPaddingLeft,t.highlightPaddingRight=this._settings.highlightPaddingRight,t.highlightOffset=this._settings.highlightOffset,t.paddingLeft=this._settings.paddingLeft,t.paddingRight=this._settings.paddingRight,t.maxLines=this._settings.maxLines,t.maxLinesSuffix=this._settings.maxLinesSuffix,t.textOverflow=this._settings.textOverflow,t.wordWrap=this._settings.wordWrap,t.wordWrapWidth=a,t.shadow=this._settings.shadow,t.shadowColor=this._settings.shadowColor,t.shadowOffsetX=this._settings.shadowOffsetX,t.shadowOffsetY=this._settings.shadowOffsetY,t.shadowBlur=this._settings.shadowBlur,t.cutSx=h,t.cutEx=l,t.cutSy=c,t.cutEy=u,t.textIndent=this._settings.textIndent*e,t.wordBreak=this._settings.wordBreak;let _=t.text,g=t.wordWrap&&t.wordWrapWidth||t.width;if(t.textOverflow&&!t.wordWrap){let e;switch(this._settings.textOverflow){case"clip":e="";break;case"ellipsis":e=this._settings.maxLinesSuffix;break;default:e=this._settings.textOverflow}_=this.wrapWord(_,a||t.w,e)}_=this.tokenize(_),_=this.parse(_),_=this.measure(_,d,t.baseFont),t.textIndent&&(_=this.indent(_,t.textIndent)),t.wordBreak&&(_=_.reduce(((e,i)=>e.concat(this.wordBreak(i,g,t.baseFont))),[]),this.resetFontStyle());let f=i,p=0;for(const e of _)(t.wordWrap&&f+e.width>g||"\n"==e.text)&&(f=i,p+=1),e.lineNo=p,"\n"!=e.text&&(e.x=f,f+=e.width);t.lineNum=p+1,this._settings.h?t.h=this._settings.h:t.maxLines&&t.maxLines<t.lineNum?t.h=t.maxLines*t.lineHeight+s/2:t.lineHeight>s?t.h=t.lineNum*t.lineHeight:t.h=t.lineNum*t.lineHeight+s/2;const x=t.fontBaselineRatio*t.fontSize;let m=0;"top"==t.verticalAlign&&"alphabetic"==this._context.textBaseline?m=-x:"middle"==t.verticalAlign?m=(t.lineHeight-t.fontSize-x)/2:"bottom"==this._settings.verticalAlign&&(m=t.lineHeight-t.fontSize),t.lines=[];for(let e=0;e<t.lineNum;e++)t.lines[e]={width:0,x:0,y:t.lineHeight*e+m,text:[]};for(let e of _)t.lines[e.lineNo].text.push(e);for(const e of t.lines){if(0==e.text.length)continue;const t=e.text[0].text,i=e.text[e.text.length-1].text;"\n"==t&&e.text.shift()," "!=i&&"\n"!=i||e.text.pop()}for(let e of t.lines)e.width=e.text.reduce(((t,e)=>t+e.width),0);if(t.width=0!=this._settings.w?this._settings.w*e:Math.max(...t.lines.map((t=>t.width)))+r,t.w=t.width,t.maxLines&&t.lineNum>t.maxLines&&t.maxLinesSuffix){const e=t.maxLines-1;let i=_.filter((t=>t.lineNo==e)),r=t.maxLinesSuffix;r=this.tokenize(r),r=this.parse(r),r=this.measure(r,t.letterSpacing,t.baseFont)[0],r.lineNo=e,i.length?r.x=i[i.length-1].x+i[i.length-1].width:r.x=0,i.push(r);let s=i.reduce(((t,e)=>t+e.width),0);for(;s>t.width||" "==i[i.length-2].text;){i.splice(i.length-2,1),s=i.reduce(((t,e)=>t+e.width),0);const t=i[i.length-2]||{x:0,width:0};if(r.x=t.x+t.width,i.length<2)break}t.lines[e].text=i,t.lines[e].width=s}if("center"==t.textAlign)for(let e of t.lines)e.x=(t.width-e.width-i)/2;else if("right"==t.textAlign)for(let e of t.lines)e.x=t.width-e.width-i;return t}_draw(){const t=this._calculateRenderInfo(),e=this.getPrecision(),i=t.paddingLeft*e;let r=t.w||t.width;(t.cutSx||t.cutEx)&&(r=Math.min(t.w,t.cutEx-t.cutSx));let s=t.h;if((t.cutSy||t.cutEy)&&(s=Math.min(t.h,t.cutEy-t.cutSy)),this._canvas.width=Math.ceil(r+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(s),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy),t.highlight){const r=t.highlightColor||0,s=t.highlightHeight?t.highlightHeight*e:1.5*t.fontSize,n=t.highlightOffset?t.highlightOffset*e:0,o=null!==t.highlightPaddingLeft?t.highlightPaddingLeft*e:t.paddingLeft,a=null!==t.highlightPaddingRight?t.highlightPaddingRight*e:t.paddingRight;this._context.fillStyle=U.getRgbaString(r);const h=t.maxLines?Math.min(t.maxLines,t.lineNum):t.lineNum;for(let e=0;e<h;e++){const r=t.lines[e];this._context.fillRect(r.x-o+i,r.y+n,r.width+o+a,s)}}let n=null;this._settings.shadow&&(n=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=U.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*e,this._context.shadowOffsetY=this._settings.shadowOffsetY*e,this._context.shadowBlur=this._settings.shadowBlur*e);const o=U.getRgbaString(this._settings.textColor);let a=o;this._context.fillStyle=o;for(const e of t.lines)for(const i of e.text){let e=0;if("\n"!=i.text&&!(t.maxLines&&i.lineNo>=t.maxLines))if(i.color!=a&&(a=i.color,this._context.fillStyle=a),this._context.font=i.fontStyle,i.letters)for(let r of i.letters){const s=t.lines[i.lineNo].x+i.x+e;this._context.fillText(r.text,s,t.lines[i.lineNo].y+t.fontSize),e+=r.width}else{const e=t.lines[i.lineNo].x+i.x;this._context.fillText(i.text,e,t.lines[i.lineNo].y+t.fontSize)}}n&&(this._context.shadowColor=n[0],this._context.shadowOffsetX=n[1],this._context.shadowOffsetY=n[2],this._context.shadowBlur=n[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy),t.lines=t.lines.map((t=>t.text.reduce(((t,e)=>t+e.text),""))),t.maxLines&&(t.lines=t.lines.slice(0,t.maxLines)),this.renderInfo=t}measureText(t,e=0){return e?t.split("").reduce(((t,i)=>t+this._context.measureText(i).width+e),0):this._context.measureText(t).width}tokenize(t){const e=/ |\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,i=t.match(e)||[],r=t.split(e)||[];let s=[];for(let t=0;t<r.length;t++)s.push(r[t],i[t]);return s.pop(),s.filter((t=>""!=t))}parse(t){let e=0,i=0,r=[U.getRgbaString(this._settings.textColor)],s=0;const n=/<color=(0[xX][0-9a-fA-F]{8})>/;return t.map((t=>{if("<i>"==t)e+=1,t="";else if("</i>"==t&&e>0)e-=1,t="";else if("<b>"==t)i+=1,t="";else if("</b>"==t&&i>0)i-=1,t="";else if("</color>"==t)r.length>1&&(s-=1,r.pop()),t="";else if(n.test(t)){const e=n.exec(t);r.push(U.getRgbaString(parseInt(e[1]))),s+=1,t=""}return{text:t,italic:e,bold:i,color:r[s]}})).filter((t=>""!=t.text))}applyFontStyle(t,e){let i=e;t.bold&&(i="bold "+i),t.italic&&(i="italic "+i),this._context.font=i,t.fontStyle=i}resetFontStyle(t){this._context.font=t}measure(t,e=0,i){for(const r of t)if(this.applyFontStyle(r,i),r.width=this.measureText(r.text,e),e>0){r.letters=r.text.split("").map((t=>({text:t})));for(let t of r.letters)t.width=this.measureText(t.text,e)}return this.resetFontStyle(i),t}indent(t,e){return t.splice(0,0,{text:"",width:e}),t}wrapWord(t,e,i){const r=this._context.measureText(i).width,s=t.length,n=this._context.measureText(t).width;if(n<=e)return t;let o=Math.floor(e*s/n),a=this._context.measureText(t.substring(0,o)).width+r;if(a>e)for(;o>0&&(a=this._context.measureText(t.substring(0,o)).width+r,a>e);)o-=1;else for(;o<s;){if(a=this._context.measureText(t.substring(0,o)).width+r,!(a<e)){o-=1;break}o+=1}return t.substring(0,o)+(e>=r?i:"")}_getBreakIndex(t,e){const i=t.length,r=this.measureText(t);if(r<=e)return{breakIndex:t.length,truncWordWidth:r};let s=Math.floor(e*i/r),n=this.measureText(t.substring(0,s));if(n>e)for(;s>0&&(n=this.measureText(t.substring(0,s)),n>e);)s-=1;else for(;s<i;){if(n=this.measureText(t.substring(0,s)),!(n<e)){s-=1,n=this.measureText(t.substring(0,s));break}s+=1}return{breakIndex:s,truncWordWidth:n}}wordBreak(t,e,i){if(!t.text)return t;this.applyFontStyle(t,i);const r=[];let s=t.text;if(t.letters){let i=0,n=[],o=0;for(const a of t.letters)i+a.width>=e?(r.push({...t}),r[r.length-1].text=s.slice(0,o),r[r.length-1].width=i,r[r.length-1].letters=n,s=s.slice(o),i=0,n=[],o=0):(o+=1,n.push(a),i+=a.width);i>0&&(r.push({...t}),r[r.length-1].text=s.slice(0,o),r[r.length-1].width=i,r[r.length-1].letters=n)}else for(;;){const{breakIndex:i,truncWordWidth:n}=this._getBreakIndex(s,e);if(r.push({...t}),r[r.length-1].text=s.slice(0,i),r[r.length-1].width=n,i===s.length)break;s=s.slice(i)}return r}}class dt extends ht{constructor(t){super(t),this._precision=this.stage.getOption("precision")}static renderer(t,e,i){return this.advancedRenderer?new ut(t,e,i):new ct(t,e,i)}get text(){return this._text}set text(t){this._text!==t&&(this._text=""+t,this._changed())}get w(){return this._w}set w(t){this._w!==t&&(this._w=t,this._changed())}get h(){return this._h}set h(t){this._h!==t&&(this._h=t,this._changed())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this._changed())}get fontBaselineRatio(){return this._fontBaselineRatio}set fontBaselineRatio(t){this._fontBaselineRatio!==t&&(this._fontBaselineRatio=t,this._changed())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this._changed())}get fontFace(){return this._fontFace}set fontFace(t){this._fontFace!==t&&(this._fontFace=t,this._changed())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this._changed())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this._changed())}get wordBreak(){return this._wordBreak}set wordBreak(t){this._wordBreak!==t&&(this._wordBreak=t,this._changed())}get textOverflow(){return this._textOverflow}set textOverflow(t){t!=this._textOverflow&&(this._textOverflow=t,this._changed())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this._changed())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this._changed())}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign!==t&&(this._textAlign=t,this._changed())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._changed())}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY!==t&&(this._offsetY=t,this._changed())}get maxLines(){return this._maxLines}set maxLines(t){this._maxLines!==t&&(this._maxLines=t,this._changed())}get maxLinesSuffix(){return this._maxLinesSuffix}set maxLinesSuffix(t){this._maxLinesSuffix!==t&&(this._maxLinesSuffix=t,this._changed())}get textColor(){return this._textColor}set textColor(t){this._textColor!==t&&(this._textColor=t,this._changed())}get paddingLeft(){return this._paddingLeft}set paddingLeft(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._changed())}get paddingRight(){return this._paddingRight}set paddingRight(t){this._paddingRight!==t&&(this._paddingRight=t,this._changed())}get shadow(){return this._shadow}set shadow(t){this._shadow!==t&&(this._shadow=t,this._changed())}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._changed())}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._changed())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._changed())}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._changed())}get highlight(){return this._highlight}set highlight(t){this._highlight!==t&&(this._highlight=t,this._changed())}get highlightHeight(){return this._highlightHeight}set highlightHeight(t){this._highlightHeight!==t&&(this._highlightHeight=t,this._changed())}get highlightColor(){return this._highlightColor}set highlightColor(t){this._highlightColor!==t&&(this._highlightColor=t,this._changed())}get highlightOffset(){return this._highlightOffset}set highlightOffset(t){this._highlightOffset!==t&&(this._highlightOffset=t,this._changed())}get highlightPaddingLeft(){return this._highlightPaddingLeft}set highlightPaddingLeft(t){this._highlightPaddingLeft!==t&&(this._highlightPaddingLeft=t,this._changed())}get highlightPaddingRight(){return this._highlightPaddingRight}set highlightPaddingRight(t){this._highlightPaddingRight!==t&&(this._highlightPaddingRight=t,this._changed())}get cutSx(){return this._cutSx}set cutSx(t){this._cutSx!==t&&(this._cutSx=t,this._changed())}get cutEx(){return this._cutEx}set cutEx(t){this._cutEx!==t&&(this._cutEx=t,this._changed())}get cutSy(){return this._cutSy}set cutSy(t){this._cutSy!==t&&(this._cutSy=t,this._changed())}get cutEy(){return this._cutEy}set cutEy(t){this._cutEy!==t&&(this._cutEy=t,this._changed())}get advancedRenderer(){return this._advancedRenderer}set advancedRenderer(t){this._advancedRenderer!==t&&(this._advancedRenderer=t,this._changed())}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this._changed())}get letterSpacing(){return this._letterSpacing}set textIndent(t){this._textIndent!==t&&(this._textIndent=t,this._changed())}get textIndent(){return this._textIndent}get precision(){return super.precision}set precision(t){this.precision!==t&&(super.precision=t,this._changed())}_getIsValid(){return!!this.text}_getLookupId(){let t=[];return 0!==this.w&&t.push("w "+this.w),0!==this.h&&t.push("h "+this.h),"normal"!==this.fontStyle&&t.push("fS"+this.fontStyle),40!==this.fontSize&&t.push("fs"+this.fontSize),0!==this.fontBaselineRatio&&t.push("fb"+this.fontBaselineRatio),null!==this.fontFace&&t.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),!0!==this.wordWrap&&t.push("wr"+(this.wordWrap?1:0)),0!==this.wordWrapWidth&&t.push("ww"+this.wordWrapWidth),!1!==this.wordBreak&&t.push((this.wordBreak,1)),""!=this.textOverflow&&t.push("to"+this.textOverflow),null!==this.lineHeight&&t.push("lh"+this.lineHeight),"alphabetic"!==this.textBaseline&&t.push("tb"+this.textBaseline),"left"!==this.textAlign&&t.push("ta"+this.textAlign),"top"!==this.verticalAlign&&t.push("va"+this.verticalAlign),null!==this.offsetY&&t.push("oy"+this.offsetY),0!==this.maxLines&&t.push("ml"+this.maxLines),".."!==this.maxLinesSuffix&&t.push("ms"+this.maxLinesSuffix),t.push("pc"+this.precision),4294967295!==this.textColor&&t.push("co"+this.textColor.toString(16)),0!==this.paddingLeft&&t.push("pl"+this.paddingLeft),0!==this.paddingRight&&t.push("pr"+this.paddingRight),!1!==this.shadow&&t.push("sh"+(this.shadow?1:0)),4278190080!==this.shadowColor&&t.push("sc"+this.shadowColor.toString(16)),0!==this.shadowOffsetX&&t.push("sx"+this.shadowOffsetX),0!==this.shadowOffsetY&&t.push("sy"+this.shadowOffsetY),5!==this.shadowBlur&&t.push("sb"+this.shadowBlur),!1!==this.highlight&&t.push("hL"+(this.highlight?1:0)),0!==this.highlightHeight&&t.push("hh"+this.highlightHeight),4278190080!==this.highlightColor&&t.push("hc"+this.highlightColor.toString(16)),null!==this.highlightOffset&&t.push("ho"+this.highlightOffset),null!==this.highlightPaddingLeft&&t.push("hl"+this.highlightPaddingLeft),null!==this.highlightPaddingRight&&t.push("hr"+this.highlightPaddingRight),null!==this.letterSpacing&&t.push("ls"+this.letterSpacing),null!==this.textIndent&&t.push("ti"+this.textIndent),this.cutSx&&t.push("csx"+this.cutSx),this.cutEx&&t.push("cex"+this.cutEx),this.cutSy&&t.push("csy"+this.cutSy),this.cutEy&&t.push("cey"+this.cutEy),this.advancedRenderer&&t.push((this.advancedRenderer,1)),"TX$"+t.join("|")+":"+this.text}_getSourceLoader(){const t=this.cloneArgs();null===t.fontFace&&(t.fontFace=this.stage.getOption("defaultFontFace"));const e=this.stage.gl;return function(i){const r=this.stage.platform.getDrawingCanvas(),s=t.advancedRenderer?new ut(this.stage,r,t):new ct(this.stage,r,t),n=s.draw(),o={},a=this.stage.getOption("fontSharp");let h=!1;W.isBoolean(a)?h=a:W.isObject(a)&&(h=this.stage.getRenderPrecision()<=a.precision&&t.fontSize<=a.fontSize),e&&h&&(o[e.TEXTURE_MAG_FILTER]=e.NEAREST),n?n.then((()=>{i(null,Object.assign({renderInfo:s.renderInfo,throttle:!1,texParams:o},this.stage.platform.getTextureOptionsForDrawingCanvas(r)))})).catch((t=>{i(t)})):i(null,Object.assign({renderInfo:s.renderInfo,throttle:!1,texParams:o},this.stage.platform.getTextureOptionsForDrawingCanvas(r)))}}getNonDefaults(){const t=super.getNonDefaults();return""!==this.text&&(t.text=this.text),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),"normal"!==this.fontStyle&&(t.fontStyle=this.fontStyle),40!==this.fontSize&&(t.fontSize=this.fontSize),0!==this.fontBaselineRatio&&(t.fontBaselineRatio=this.fontBaselineRatio),null!==this.fontFace&&(t.fontFace=this.fontFace),!0!==this.wordWrap&&(t.wordWrap=this.wordWrap),0!==this.wordWrapWidth&&(t.wordWrapWidth=this.wordWrapWidth),!1!==this.wordBreak&&(t.wordBreak=this.wordBreak),""!=this.textOverflow&&(t.textOverflow=this.textOverflow),null!==this.lineHeight&&(t.lineHeight=this.lineHeight),"alphabetic"!==this.textBaseline&&(t.textBaseline=this.textBaseline),"left"!==this.textAlign&&(t.textAlign=this.textAlign),"top"!==this.verticalAlign&&(t.verticalAlign=this.verticalAlign),null!==this.offsetY&&(t.offsetY=this.offsetY),0!==this.maxLines&&(t.maxLines=this.maxLines),".."!==this.maxLinesSuffix&&(t.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(t.precision=this.precision),4294967295!==this.textColor&&(t.textColor=this.textColor),0!==this.paddingLeft&&(t.paddingLeft=this.paddingLeft),0!==this.paddingRight&&(t.paddingRight=this.paddingRight),!1!==this.shadow&&(t.shadow=this.shadow),4278190080!==this.shadowColor&&(t.shadowColor=this.shadowColor),0!==this.shadowOffsetX&&(t.shadowOffsetX=this.shadowOffsetX),0!==this.shadowOffsetY&&(t.shadowOffsetY=this.shadowOffsetY),5!==this.shadowBlur&&(t.shadowBlur=this.shadowBlur),!1!==this.highlight&&(t.highlight=this.highlight),0!==this.highlightHeight&&(t.highlightHeight=this.highlightHeight),4278190080!==this.highlightColor&&(t.highlightColor=this.highlightColor),0!==this.highlightOffset&&(t.highlightOffset=this.highlightOffset),0!==this.highlightPaddingLeft&&(t.highlightPaddingLeft=this.highlightPaddingLeft),0!==this.highlightPaddingRight&&(t.highlightPaddingRight=this.highlightPaddingRight),0!==this.letterSpacing&&(t.letterSpacing=this.letterSpacing),0!==this.textIndent&&(t.textIndent=this.textIndent),this.cutSx&&(t.cutSx=this.cutSx),this.cutEx&&(t.cutEx=this.cutEx),this.cutSy&&(t.cutSy=this.cutSy),this.cutEy&&(t.cutEy=this.cutEy),this.advancedRenderer&&(t.renderer=this.advancedRenderer),t}cloneArgs(){let t={};return t.text=this._text,t.w=this._w,t.h=this._h,t.fontStyle=this._fontStyle,t.fontSize=this._fontSize,t.fontBaselineRatio=this._fontBaselineRatio,t.fontFace=this._fontFace,t.wordWrap=this._wordWrap,t.wordWrapWidth=this._wordWrapWidth,t.wordBreak=this._wordBreak,t.textOverflow=this._textOverflow,t.lineHeight=this._lineHeight,t.textBaseline=this._textBaseline,t.textAlign=this._textAlign,t.verticalAlign=this._verticalAlign,t.offsetY=this._offsetY,t.maxLines=this._maxLines,t.maxLinesSuffix=this._maxLinesSuffix,t.precision=this._precision,t.textColor=this._textColor,t.paddingLeft=this._paddingLeft,t.paddingRight=this._paddingRight,t.shadow=this._shadow,t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur,t.highlight=this._highlight,t.highlightHeight=this._highlightHeight,t.highlightColor=this._highlightColor,t.highlightOffset=this._highlightOffset,t.highlightPaddingLeft=this._highlightPaddingLeft,t.highlightPaddingRight=this._highlightPaddingRight,t.letterSpacing=this._letterSpacing,t.textIndent=this._textIndent,t.cutSx=this._cutSx,t.cutEx=this._cutEx,t.cutSy=this._cutSy,t.cutEy=this._cutEy,t.advancedRenderer=this._advancedRenderer,t}}let _t=dt.prototype;_t._text="",_t._w=0,_t._h=0,_t._fontStyle="normal",_t._fontSize=40,_t._fontFace=null,_t._wordWrap=!0,_t._wordWrapWidth=0,_t._wordBreak=!1,_t._textOverflow="",_t._lineHeight=null,_t._textBaseline="alphabetic",_t._textAlign="left",_t._verticalAlign="top",_t._offsetY=null,_t._maxLines=0,_t._maxLinesSuffix="..",_t._textColor=4294967295,_t._paddingLeft=0,_t._paddingRight=0,_t._shadow=!1,_t._shadowColor=4278190080,_t._shadowOffsetX=0,_t._shadowOffsetY=0,_t._shadowBlur=5,_t._highlight=!1,_t._highlightHeight=0,_t._highlightColor=4278190080,_t._highlightOffset=0,_t._highlightPaddingLeft=0,_t._highlightPaddingRight=0,_t._letterSpacing=0,_t._textIndent=0,_t._cutSx=0,_t._cutEx=0,_t._cutSy=0,_t._cutEy=0,_t._advancedRenderer=!1,_t._fontBaselineRatio=0;class gt extends ht{constructor(t){super(t),this._textureSource=void 0}get textureSource(){return this._textureSource}set textureSource(t){t!==this._textureSource&&(t.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=t,this._changed())}_getTextureSource(){return this._textureSource}}class ft extends ot{constructor(t,e,i,r){super(),this.manager=t,this._settings=e,this._element=i,this._getter=i.constructor.getGetter(r),this._setter=i.constructor.getSetter(r),this._merger=e.merger,this._merger||(this._merger=i.constructor.getMerger(r)),this._startValue=this._getter(this._element),this._targetValue=this._startValue,this._p=1,this._delayLeft=0}start(t){this._startValue=this._getter(this._element),this.isAttached()?t===this._startValue?this.reset(t,1):(this._targetValue=t,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=t,this._p=1,this._updateDrawValue())}finish(){this._p<1&&(this._p=1)}stop(){this.emit("stop"),this.manager.removeActive(this)}pause(){this.stop()}play(){this.manager.addActive(this)}reset(t,e){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=t,this._p=e,this.add()):(this._startValue=this._getter(this._element),this._targetValue=t,this._p=1,this._updateDrawValue())}_updateDrawValue(){this._setter(this._element,this.getDrawValue())}add(){this.manager.addActive(this)}isAttached(){return this._element.attached}isRunning(){return this._p<1}progress(t){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0){if(this._delayLeft-=t,!(this.delayLeft<0))return;t=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd")}0==this._settings.duration?this._p=1:this._p+=t/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}invokeListeners(){this.emit("progress",this.p),1===this.p&&this.emit("finish")}updateTargetValue(t){let e=this._settings.timingFunctionImpl(this.p);1===e?this._targetValue=t:0===e?(this._startValue=this._targetValue,this._targetValue=t):(this._startValue=t-(t-this._targetValue)/(1-e),this._targetValue=t)}getDrawValue(){if(this.p>=1)return this.targetValue;{let t=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,t)}}skipDelay(){this._delayLeft=0}get startValue(){return this._startValue}get targetValue(){return this._targetValue}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get settings(){return this._settings}set settings(t){this._settings=t}}ft.prototype.isTransition=!0;class pt{constructor(){this._items=[],this._refs={}}get(){return this._items}get first(){return this._items[0]}get last(){return this._items.length?this._items[this._items.length-1]:void 0}add(t){this.addAt(t,this._items.length)}addAt(t,e){if(!(e>=0&&e<=this._items.length))throw new Error("addAt: The index "+e+" is out of bounds "+this._items.length);{let i=this._items.indexOf(t);if(i===e)return t;if(W.isObjectLiteral(t)){const e=t;(t=this.createItem(e)).patch(e)}-1!=i?this.setAt(t,e):(t.ref&&(this._refs[t.ref]=t),this._items.splice(e,0,t),this.onAdd(t,e))}}replaceByRef(t){if(!t.ref)throw new Error("replaceByRef: no ref specified in item");{const e=this.getByRef(t.ref);if(!e)throw new Error("replaceByRef: no item found with reference: "+t.ref);this.replace(t,e)}this.addAt(t,this._items.length)}replace(t,e){const i=this.getIndex(e);if(-1===i)throw new Error("replace: The previous item does not exist");this.setAt(t,i)}setAt(t,e){if(!(e>=0&&e<this._items.length))throw new Error("setAt: The index "+e+" is out of bounds "+this._items.length);{if(W.isObjectLiteral(t)){const e=t;(t=this.createItem(e)).patch(e)}let i=this._items.indexOf(t);if(-1!=i){if(i!==e){const r=i;r!==e&&(this._items.splice(r,1),this._items.splice(e,0,t),this.onMove(t,r,e))}}else{e<this._items.length&&this._items[e].ref&&(this._refs[this._items[e].ref]=void 0);const i=this._items[e];this._items[e]=t,t.ref&&(this._refs[t.ref]=t),this.onSet(t,e,i)}}}getAt(t){return this._items[t]}getIndex(t){return this._items.indexOf(t)}remove(t){let e=this._items.indexOf(t);-1!==e&&this.removeAt(e)}removeAt(t){if(t>=0&&t<this._items.length){const e=this._items[t];return e.ref&&(this._refs[e.ref]=void 0),this._items.splice(t,1),this.onRemove(e,t),e}throw new Error(`removeAt: The index ${t} is out of bounds ${this._items.length-1}`)}clear(){if(this._items.length){let t=this._items;this._items=[],this._refs={},this.onSync(t,[],[])}}a(t){if(W.isObjectLiteral(t)){let e=this.createItem(t);return e.patch(t),this.add(e),e}if(Array.isArray(t)){for(let e=0,i=t.length;e<i;e++)this.a(t[e]);return null}if(this.isItem(t))return this.add(t),t}get length(){return this._items.length}_getRefs(){return this._refs}getByRef(t){return this._refs[t]}clearRef(t){delete this._refs[t]}setRef(t,e){this._refs[t]=e}patch(t){W.isObjectLiteral(t)?this._setByObject(t):Array.isArray(t)&&this._setByArray(t)}_setByObject(t){let e=this._getRefs(),i=Object.keys(t);for(let r=0,s=i.length;r<s;r++){let s=i[r],n=t[s],o=e[s];if(o)if(this.isItem(n)){if(o!==n){let t=this.getIndex(o);n.ref=s,this.setAt(n,t)}}else o.patch(n);else this.isItem(n)?(n.ref=s,this.add(n)):(o=this.createItem(n),o.ref=s,o.patch(n),this.add(o))}}_equalsArray(t){let e=!0;if(t.length===this._items.length)for(let i=0,r=this._items.length;i<r&&e;i++)e=e&&this._items[i]===t[i];else e=!1;return e}_setByArray(t){if(this._equalsArray(t))return;for(let t=0,e=this._items.length;t<e;t++)this._items[t].marker=!0;let e,i=[];for(let r=0,s=t.length;r<s;r++){let s=t[r];if(this.isItem(s))s.marker=!1,i.push(s);else{let t,r=s.ref;r&&(e||(e=this._getRefs()),t=e[r]),t?t.marker=!1:t=this.createItem(s),W.isObjectLiteral(s)&&t.patch(s),i.push(t)}}this._setItems(i)}_setItems(t){let e=this._items;this._items=t;let i=e.filter((t=>{let e=t.marker;return delete t.marker,e})),r=t.filter((t=>-1===e.indexOf(t)));if(i.length||r.length){this._refs={};for(let t=0,e=this._items.length;t<e;t++){let e=this._items[t].ref;e&&(this._refs[e]=this._items[t])}}this.onSync(i,r,t)}sort(t){const e=this._items.slice();e.sort(t),this._setByArray(e)}onAdd(t,e){}onRemove(t,e){}onSync(t,e,i){}onSet(t,e,i){}onMove(t,e,i){}createItem(t){throw new Error("ObjectList.createItem must create and return a new object")}isItem(t){return!1}forEach(t){this.get().forEach(t)}}class xt extends pt{constructor(t){super(),this._element=t}_connectParent(t){const e=t.parent;if(e&&e!==this._element){const i=t.parent.childList,r=i.getIndex(t);t.ref&&(i._refs[t.ref]=void 0),i._items.splice(r,1),e.core.removeChildAt(r)}t._setParent(this._element)}onAdd(t,e){this._connectParent(t),this._element.core.addChildAt(e,t.core)}onRemove(t,e){t._setParent(null),this._element.core.removeChildAt(e)}onSync(t,e,i){for(let e=0,i=t.length;e<i;e++)t[e]._setParent(null);for(let t=0,i=e.length;t<i;t++)this._connectParent(e[t]);let r=t=>t.core;this._element.core.syncChildren(t.map(r),e.map(r),i.map(r))}onSet(t,e,i){i._setParent(null),this._connectParent(t),this._element.core.setChildAt(e,t.core)}onMove(t,e,i){this._element.core.moveChild(e,i)}createItem(t){return t.type?new t.type(this._element.stage):this._element.stage.createElement()}isItem(t){return t.isElement}}class mt{constructor(t){this.stage=t,this.__id=mt.id++,this.__start(),this._hasEventListeners=!1,this.__core=new st(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}__start(){}get id(){return this.__id}set ref(t){if(this.__ref!==t){const e=t.charCodeAt(0);W.isUcChar(e)||this._throwError("Ref must start with an upper case character: "+t),null!==this.__ref&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=t,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}get ref(){return this.__ref}get core(){return this.__core}setAsRoot(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}get isRoot(){return this.__core.isRoot}_setParent(t){this.__parent!==t&&(this.__parent&&this._unsetTagsParent(),this.__parent=t,t&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&t&&this._throwError("Root should not be added as a child! Results are unspecified!"))}getDepth(){let t=0,e=this.__parent;for(;e;)t++,e=e.__parent;return t}getAncestor(t){let e=this;for(;t>0&&e.__parent;)e=e.__parent,t--;return e}getAncestors(){const t=[];let e=this;for(;e;)t.push(e),e=e.__parent;return t}getAncestorAtDepth(t){let e=this.getDepth()-t;return e<0?null:this.getAncestor(e)}isAncestorOf(t){let e=t;for(;e=e.parent;)if(this===e)return!0;return!1}getSharedAncestor(t){let e=this,i=t,r=e.getDepth(),s=i.getDepth();r>s?e=e.getAncestor(r-s):s>r&&(i=i.getAncestor(s-r));do{if(e===i)return e;e=e.__parent,i=i.__parent}while(e&&i);return null}get attached(){return this.__attached}get enabled(){return this.__enabled}get active(){return this.__active}_isAttached(){return this.__parent?this.__parent.__attached:this.stage.root===this}_isEnabled(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}_isActive(){return this._isEnabled()&&this.withinBoundsMargin}_updateAttachedFlag(){let t=this._isAttached();if(this.__attached!==t){this.__attached=t,t&&this._onSetup();let e=this._children.get();if(e){let t=e.length;if(t>0)for(let i=0;i<t;i++)e[i]._updateAttachedFlag()}t?this._onAttach():this._onDetach()}}_updateEnabledFlag(){let t=this._isEnabled();if(this.__enabled!==t){t?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());let e=this._children.get();if(e){let t=e.length;if(t>0)for(let i=0;i<t;i++)e[i]._updateEnabledFlag()}}}_setEnabledFlag(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}_unsetEnabledFlag(){this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach((t=>t.removeElement(this.__core))),this.__enabled=!1}_setActiveFlag(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}_unsetActiveFlag(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}_onSetup(){}_onAttach(){}_onDetach(){}_onEnabled(){}_onDisabled(){}_onActive(){}_onInactive(){}_onResize(){}_getRenderWidth(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}_getRenderHeight(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}get renderWidth(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}get renderHeight(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}get finalX(){return this.__core.x}get finalY(){return this.__core.y}get finalW(){return this.__core.w}get finalH(){return this.__core.h}textureIsLoaded(){return this.__texture&&this.__texture.isLoaded()}loadTexture(){this.__texture&&(this.__texture.load(),this.__texture.isUsed()&&this._isEnabled()||this._updateDimensions())}_enableTextureError(){const t=this.__texture.loadError;t&&this.emit("txError",t,this.__texture._source)}_enableTexture(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}_disableTexture(){this._setDisplayedTexture(null)}get texture(){return this.__texture}set texture(t){let e;if(W.isObjectLiteral(t))e=t.type?new t.type(this.stage):this.texture,e&&H.patchObject(e,t);else if(t)if(t.isTexture)e=t;else{if(!t.isTextureSource)return void console.error("[Lightning] Please specify a texture type.");e=new gt(this.stage),e.textureSource=t}else e=null;const i=this.__texture;e!==i&&(this.__texture=e,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),i&&i!==this.__displayedTexture&&i.removeElement(this),this._updateDimensions())}get displayedTexture(){return this.__displayedTexture}_setDisplayedTexture(t){let e=this.__displayedTexture;e&&t!==e&&this.__texture!==e&&e.removeElement(this);const i=this.__core.displayedTextureSource?this.__core.displayedTextureSource._source:null,r=(t?t._source:null)!==i;this.__displayedTexture=t,this._updateDimensions(),this.__displayedTexture?r&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),r&&(this.__displayedTexture?this.emit("txLoaded",this.__displayedTexture):this.emit("txUnloaded",this.__displayedTexture))}onTextureSourceLoaded(){this.active&&this._setDisplayedTexture(this.__texture)}onTextureSourceLoadError(t){this.emit("txError",t,this.__texture._source)}forceRenderUpdate(){this.__core.setHasRenderUpdates(3)}onDisplayedTextureClippingChanged(){this._updateDimensions(),this._updateTextureCoords()}onPrecisionChanged(){this._updateDimensions()}onDimensionsChanged(t,e){this.texture instanceof dt&&(this.texture.w=t,this.texture.h=e,this.w=t,this.h=e)}_updateDimensions(){let t=this._getRenderWidth(),e=this._getRenderHeight(),i=!1;t&&e||!this.__displayedTexture&&this.__texture&&(t=t||this.__texture.mw,e=e||this.__texture.mh,t&&e||!this.__texture.isAutosizeTexture()||(i=!0)),this.__core.setDimensions(t,e,i)&&this._onResize()}_updateTextureCoords(){if(this.displayedTexture&&this.displayedTexture._source){let t=this.displayedTexture,e=this.displayedTexture._source,i=0,r=0,s=1,n=1;if(t.clipping){let o,a,h,l,c=e.getRenderWidth(),u=e.getRenderHeight();o=1/c,a=1/u,h=t.pw?t.pw*o:(c-t.px)*o,l=t.ph?t.ph*a:(u-t.py)*a,o*=t.px,a*=t.py,i=o,r=a,s=s*h+o,n=n*l+a,i=Math.max(0,i),r=Math.max(0,r),s=Math.min(1,s),n=Math.min(1,n)}if(e._flipTextureY){let t=n;n=r,r=t}this.__core.setTextureCoords(i,r,s,n)}}getCornerPoints(){return this.__core.getCornerPoints()}_unsetTagsParent(){this.__tags&&this.__tags.forEach((t=>{let e=this;for(;(e=e.__parent)&&(e.__treeTags.get(t).delete(this),!e.__tagRoot););}));let t=null,e=0;if(this.__treeTags&&!this.__tagRoot&&(t=W.iteratorToArray(this.__treeTags.keys()),e=t.length,e>0))for(let i=0;i<e;i++){let e=this.__treeTags.get(t[i]),r=this;for(;r=r.__parent;){let s=r.__treeTags.get(t[i]);if(e.forEach((function(t){s.delete(t)})),r.__tagRoot)break}}}_setTagsParent(){this.__tags&&this.__tags.forEach((t=>{let e=this;for(;e=e.__parent;){e.__treeTags||(e.__treeTags=new Map);let i=e.__treeTags.get(t);if(i||(i=new Set,e.__treeTags.set(t,i)),i.add(this),e.__tagRoot)break}})),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach(((t,e)=>{let i=this;for(;!i.__tagRoot&&(i=i.__parent);){i.__tagRoot,i.__treeTags||(i.__treeTags=new Map);let r=i.__treeTags.get(e);r||(r=new Set,i.__treeTags.set(e,r)),t.forEach((function(t){r.add(t)}))}})))}_getByTag(t){if(!this.__treeTags)return[];let e=this.__treeTags.get(t);return e?W.setToArray(e):[]}getTags(){return this.__tags?this.__tags:[]}setTags(t){t=t.reduce(((t,e)=>t.concat(e.split(" "))),[]),this.__ref&&t.push(this.__ref);let e,i=t.length,r=[],s=[];for(e=0;e<i;e++)this.hasTag(t[e])||s.push(t[e]);let n=this.tags||[];for(i=n.length,e=0;e<i;e++)-1==t.indexOf(n[e])&&r.push(n[e]);for(e=0;e<r.length;e++)this.removeTag(r[e]);for(e=0;e<s.length;e++)this.addTag(s[e])}addTag(t){if(-1===t.indexOf(" "))W.isUcChar(t.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(t);else{const e=t.split(" ");for(let t=0,i=e.length;t<i;t++){const i=e[t];W.isUcChar(i.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(i)}}}_addTag(t){if(this.__tags||(this.__tags=[]),-1===this.__tags.indexOf(t)){this.__tags.push(t);let e=this.__parent;if(e)do{e.__treeTags||(e.__treeTags=new Map);let i=e.__treeTags.get(t);i||(i=new Set,e.__treeTags.set(t,i)),i.add(this)}while(!e.__tagRoot&&(e=e.__parent))}}removeTag(t){let e=this.__tags.indexOf(t);if(-1!==e){this.__tags.splice(e,1);let i=this.__parent;if(i)do{let e=i.__treeTags.get(t);e&&e.delete(this)}while(!i.__tagRoot&&(i=i.__parent))}}hasTag(t){return this.__tags&&-1!==this.__tags.indexOf(t)}_tag(t){if(-1!==t.indexOf("."))return this.mtag(t)[0];if(this.__treeTags){let e=this.__treeTags.get(t);if(e){const t=e.values().next();return t?t.value:void 0}}}get tag(){return this._tag}set tag(t){this.tags=t}mtag(t){if(t.indexOf(".")>=0){let e=t.split("."),i=this._getByTag(e[0]),r=1,s=e.length;for(;i.length&&r<s;){let t=[];for(let s=0,n=i.length;s<n;s++)t=t.concat(i[s]._getByTag(e[r]));i=t,r++}return i}return this._getByTag(t)}stag(t,e){let i=this.mtag(t),r=i.length;for(let t=0;t<r;t++)H.patchObject(i[t],e)}get tagRoot(){return this.__tagRoot}set tagRoot(t){this.__tagRoot!==t&&(t?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=t)}sel(t){const e=this.select(t);return e.length?e[0]:void 0}select(t){if(-1!==t.indexOf(",")){let e=t.split(","),i=[];for(let t=0;t<e.length;t++)i=i.concat(this._select(e[t]));return i}return this._select(t)}_select(t){if(""===t)return[this];let e,i=t.indexOf("."),r=t.indexOf(">");return-1===i&&-1===r?this.mtag(t):(0===r?(e=!0,t=t.substr(1)):0===i?(e=!1,t=t.substr(1)):e=!1,this._selectChilds(t,e))}_selectChilds(t,e){const i=t.indexOf("."),r=t.indexOf(">");if(-1===i&&-1===r){if(e){const e=this.getByRef(t);return e?[e]:[]}return this.mtag(t)}if(-1===r||-1!==i&&i<r){let r;const s=t.substr(0,i);if(e){const t=this.getByRef(s);r=t?[t]:[]}else r=this.mtag(s);let n=[];const o=t.substr(i+1);for(let t=0,e=r.length;t<e;t++)n=n.concat(r[t]._selectChilds(o,!1));return n}{let i;const s=t.substr(0,r);if(e){const t=this.getByRef(s);i=t?[t]:[]}else i=this.mtag(s);let n=[];const o=t.substr(r+1);for(let t=0,e=i.length;t<e;t++)n=n.concat(i[t]._selectChilds(o,!0));return n}}getByRef(t){return this.childList.getByRef(t)}getLocationString(){let t;t=this.__parent?this.__parent._children.getIndex(this):"R";let e=this.getTags(),i=this.__parent?this.__parent.getLocationString():"";return this.ref?i+=":["+t+"]"+this.ref:e.length?i+=":["+t+"]"+e.join(","):i+=":["+t+"]#"+this.id,i}toString(){let t=this.getSettings();return mt.getPrettyString(t,"")}static getPrettyString(t,e){let i=t.children;delete t.children;let r=["color","colorUl","colorUr","colorBl","colorBr"],s=JSON.stringify(t,(function(t,e){return-1!==r.indexOf(t)?"COLOR["+e.toString(16)+"]":e}));if(s=s.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),i){let t="";if(W.isObjectLiteral(i)){let r=Object.keys(i);t="";for(let s=0,n=r.length;s<n;s++)t+=`\n${e}  "${r[s]}":`,delete i[r[s]].ref,t+=mt.getPrettyString(i[r[s]],e+"  ")+(s<n-1?",":"");let n="{}"===s;s=s.substr(0,s.length-1)+(n?"":",")+t+"\n"+e+"}"}else{let r=i.length;t="[";for(let s=0;s<r;s++)t+=mt.getPrettyString(i[s],e+"  ")+(s<r-1?",":"")+"\n";t+=e+"]}";let n="{}"===s;s=s.substr(0,s.length-1)+(n?"":",")+'"children":\n'+e+t+"}"}}return s}getSettings(){let t=this.getNonDefaults(),e=this._children.get();if(e){let i=e.length;if(i){const r=[];let s=!1;for(let t=0;t<i;t++)r.push(e[t].getSettings()),s=s||!e[t].ref;s?t.children=r:(t.children={},r.forEach((e=>{t.children[e.ref]=e})))}}return t.id=this.id,t}getNonDefaults(){let t={};if(this.constructor!==mt&&(t.type=this.constructor.name),this.__ref&&(t.ref=this.__ref),this.__tags&&this.__tags.length&&(t.tags=this.__tags),0!==this.x&&(t.x=this.x),0!==this.y&&(t.y=this.y),0!==this.w&&(t.w=this.w),0!==this.h&&(t.h=this.h),this.scaleX===this.scaleY?1!==this.scaleX&&(t.scale=this.scaleX):(1!==this.scaleX&&(t.scaleX=this.scaleX),1!==this.scaleY&&(t.scaleY=this.scaleY)),this.pivotX===this.pivotY?.5!==this.pivotX&&(t.pivot=this.pivotX):(.5!==this.pivotX&&(t.pivotX=this.pivotX),.5!==this.pivotY&&(t.pivotY=this.pivotY)),this.mountX===this.mountY?0!==this.mountX&&(t.mount=this.mountX):(0!==this.mountX&&(t.mountX=this.mountX),0!==this.mountY&&(t.mountY=this.mountY)),1!==this.alpha&&(t.alpha=this.alpha),this.visible||(t.visible=!1),0!==this.rotation&&(t.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?4294967295!==this.colorUl&&(t.color=this.colorUl.toString(16)):(4294967295!==this.colorUl&&(t.colorUl=this.colorUl.toString(16)),4294967295!==this.colorUr&&(t.colorUr=this.colorUr.toString(16)),4294967295!==this.colorBl&&(t.colorBl=this.colorBl.toString(16)),4294967295!==this.colorBr&&(t.colorBr=this.colorBr.toString(16))),this.zIndex&&(t.zIndex=this.zIndex),this.forceZIndexContext&&(t.forceZIndexContext=!0),this.clipping&&(t.clipping=this.clipping),this.clipbox||(t.clipbox=this.clipbox),this.__texture){let e=this.__texture.getNonDefaults();Object.keys(e).length&&(t.texture=e)}if(this.shader&&W.isFunction(this.shader.getNonDefaults)){let e=this.shader.getNonDefaults();Object.keys(e).length&&(t.shader=e)}return this._hasTexturizer()&&(this.texturizer.enabled&&(t.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(t.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(t.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(t.renderOffscreen=this.texturizer.renderOffscreen)),t}static getGetter(t){let e=mt.PROP_GETTERS.get(t);return e||(e=new Function("obj","return obj."+t),mt.PROP_GETTERS.set(t,e)),e}static getSetter(t){let e=mt.PROP_SETTERS.get(t);return e||(e=new Function("obj","v","obj."+t+" = v"),mt.PROP_SETTERS.set(t,e)),e}get withinBoundsMargin(){return this.__core._withinBoundsMargin}_enableWithinBoundsMargin(){this.__enabled&&this._setActiveFlag()}_disableWithinBoundsMargin(){this.__active&&this._unsetActiveFlag()}set boundsMargin(t){if(!Array.isArray(t)&&null!==t)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=t}get boundsMargin(){return this.__core.boundsMargin}get x(){return this.__core.offsetX}set x(t){this.__core.offsetX=t}get y(){return this.__core.offsetY}set y(t){this.__core.offsetY=t}get w(){return this._w}set w(t){W.isFunction(t)?(this._w=0,this.__core.funcW=t):(t=Math.max(t,0),this._w!==t&&(this.__core.disableFuncW(),this._w=t,this._updateDimensions()))}get h(){return this._h}set h(t){W.isFunction(t)?(this._h=0,this.__core.funcH=t):(t=Math.max(t,0),this._h!==t&&(this.__core.disableFuncH(),this._h=t,this._updateDimensions()))}get collision(){return this._collision}set collision(t){this._collision=t}_updateCollision(){this.collision&&this.__parent&&void 0===this.__parent.collision&&(this.__parent.collision=2)}get scaleX(){return this.__core.scaleX}set scaleX(t){this.__core.scaleX=t}get scaleY(){return this.__core.scaleY}set scaleY(t){this.__core.scaleY=t}get scale(){return this.__core.scale}set scale(t){this.__core.scale=t}get pivotX(){return this.__core.pivotX}set pivotX(t){this.__core.pivotX=t}get pivotY(){return this.__core.pivotY}set pivotY(t){this.__core.pivotY=t}get pivot(){return this.__core.pivot}set pivot(t){this.__core.pivot=t}get mountX(){return this.__core.mountX}set mountX(t){this.__core.mountX=t}get mountY(){return this.__core.mountY}set mountY(t){this.__core.mountY=t}get mount(){return this.__core.mount}set mount(t){this.__core.mount=t}get rotation(){return this.__core.rotation}set rotation(t){this.__core.rotation=t}get alpha(){return this.__core.alpha}set alpha(t){this.__core.alpha=t}get visible(){return this.__core.visible}set visible(t){this.__core.visible=t}get colorUl(){return this.__core.colorUl}set colorUl(t){this.__core.colorUl=t}get colorUr(){return this.__core.colorUr}set colorUr(t){this.__core.colorUr=t}get colorBl(){return this.__core.colorBl}set colorBl(t){this.__core.colorBl=t}get colorBr(){return this.__core.colorBr}set colorBr(t){this.__core.colorBr=t}get color(){return this.__core.colorUl}set color(t){this.colorUl===t&&this.colorUr===t&&this.colorBl===t&&this.colorBr===t||(this.colorUl=t,this.colorUr=t,this.colorBl=t,this.colorBr=t)}get colorTop(){return this.colorUl}set colorTop(t){this.colorUl===t&&this.colorUr===t||(this.colorUl=t,this.colorUr=t)}get colorBottom(){return this.colorBl}set colorBottom(t){this.colorBl===t&&this.colorBr===t||(this.colorBl=t,this.colorBr=t)}get colorLeft(){return this.colorUl}set colorLeft(t){this.colorUl===t&&this.colorBl===t||(this.colorUl=t,this.colorBl=t)}get colorRight(){return this.colorUr}set colorRight(t){this.colorUr===t&&this.colorBr===t||(this.colorUr=t,this.colorBr=t)}get zIndex(){return this.__core.zIndex}set zIndex(t){this.__core.zIndex=t}get forceZIndexContext(){return this.__core.forceZIndexContext}set forceZIndexContext(t){this.__core.forceZIndexContext=t}get clipping(){return this.__core.clipping}set clipping(t){this.__core.clipping=t}get clipbox(){return this.__core.clipbox}set clipbox(t){this.__core.clipbox=t}get tags(){return this.getTags()}set tags(t){Array.isArray(t)||(t=[t]),this.setTags(t)}set t(t){this.tags=t}get _children(){return this.__childList||(this.__childList=new xt(this,!1)),this.__childList}get childList(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}hasChildren(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}_allowChildrenAccess(){return!0}get children(){return this.childList.get()}set children(t){this.childList.patch(t)}add(t){return this.childList.a(t)}get p(){return this.__parent}get parent(){return this.__parent}get src(){return this.texture&&this.texture instanceof lt?this.texture._src:void 0}set src(t){const e=new lt(this.stage);e.src=t,this.texture=e}set mw(t){this.texture?(this.texture.mw=t,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}set mh(t){this.texture?(this.texture.mh=t,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}get rect(){return this.texture===this.stage.rectangleTexture}set rect(t){this.texture=t?this.stage.rectangleTexture:null}enableTextTexture(){return this.texture&&this.texture instanceof dt||(this.texture=new dt(this.stage),this.texture.w||this.texture.h||(this.texture.w=this.w,this.texture.h=this.h)),this.texture}get text(){return this.texture&&this.texture instanceof dt?this.texture:null}set text(t){this.texture&&this.texture instanceof dt||this.enableTextTexture(),W.isString(t)?this.texture.text=t:this.texture.patch(t)}set onUpdate(t){this.__core.onUpdate=t}set onAfterCalcs(t){this.__core.onAfterCalcs=t}set onAfterUpdate(t){this.__core.onAfterUpdate=t}forceUpdate(){this.__core._setHasUpdates()}get shader(){return this.__core.shader}set shader(t){if(W.isObjectLiteral(t)&&!t.type)this.shader&&this.shader.patch(t);else{const e=at.create(this.stage,t);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=e,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}_hasTexturizer(){return!!this.__core._texturizer}get renderToTexture(){return this.rtt}set renderToTexture(t){this.rtt=t}get rtt(){return this._hasTexturizer()&&this.texturizer.enabled}set rtt(t){this.texturizer.enabled=t}get rttLazy(){return this._hasTexturizer()&&this.texturizer.lazy}set rttLazy(t){this.texturizer.lazy=t}get renderOffscreen(){return this._hasTexturizer()&&this.texturizer.renderOffscreen}set renderOffscreen(t){this.texturizer.renderOffscreen=t}get colorizeResultTexture(){return this._hasTexturizer()&&this.texturizer.colorize}set colorizeResultTexture(t){this.texturizer.colorize=t}getTexture(){return this.texturizer._getTextureSource()}get texturizer(){return this.__core.texturizer}patch(t){let e=Object.keys(t);for(let i=0,r=e.length;i<r;i++){let r=e[i];const s=t[r],n=r.charCodeAt(0);if(W.isUcChar(n)){const t=this.getByRef(r);if(t)void 0===s?t.parent&&t.parent.childList.remove(t):W.isObjectLiteral(s)?t.patch(s):s.isElement?(s.ref=r,this.childList.replace(s,t)):this._throwError("Unexpected value for path: "+r);else if(void 0!==s){let t;W.isObjectLiteral(s)?(t=this.childList.createItem(s),t.patch(s)):W.isObject(s)&&(t=s),t.isElement&&(t.ref=r),this.childList.a(t)}}else H.patchObjectProperty(this,r,s)}}_throwError(t){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+t)}animation(t){return this.stage.animations.createAnimation(this,t)}transition(t,e=null){return null===e?this._getTransition(t):(this._setTransition(t,e),null)}set transitions(t){Object.keys(t).forEach((e=>{this.transition(e,t[e])}))}set smooth(t){Object.keys(t).forEach((e=>{let i=t[e];Array.isArray(i)?this.setSmooth(e,i[0],i[1]):this.setSmooth(e,i)}))}fastForward(t){if(this._transitions){let e=this._transitions[t];e&&e.isTransition&&e.finish()}}_getTransition(t){this._transitions||(this._transitions={});let e=this._transitions[t];return e?e.isTransitionSettings&&(e=new ft(this.stage.transitions,e,this,t)):e=new ft(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,t),this._transitions[t]=e,e}_setTransition(t,e){if(e){W.isObjectLiteral(e)&&(e=this.stage.transitions.createSettings(e)),this._transitions||(this._transitions={});let i=this._transitions[t];if(i&&i.isTransition)return i.settings=e,i;this._transitions[t]=e}else this._removeTransition(t)}_removeTransition(t){this._transitions&&delete this._transitions[t]}getSmooth(t,e){let i=this._getTransition(t);return i&&i.isAttached()?i.targetValue:e}setSmooth(t,e,i){i&&this._setTransition(t,i);let r=this._getTransition(t);return r.start(e),r}get flex(){return this.__core.flex}set flex(t){this.__core.flex=t}get flexItem(){return this.__core.flexItem}set flexItem(t){this.__core.flexItem=t}static isColorProperty(t){return t.toLowerCase().indexOf("color")>=0}static getMerger(t){return mt.isColorProperty(t)?U.mergeColors:U.mergeNumbers}toJSON(){const t=[`${this.constructor.name}`],e={};return e[t]={},this.hasChildren()?mt.collectChildren(e[t],this.__childList):e[t]={...mt.getProperties(this)},e}static collectChildren(t,e){const i=e;for(let e=0,r=i.length;e<r;e++){const r=i.getAt(e),s=`${r.__ref||`Element-${r.id}`}`,n=this.getProperties(r);t[s]={...n},r.hasChildren()&&(t[s].children={},this.collectChildren(t[s].children,r.__childList))}}static getProperties(t){const e={},i=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOfScreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"];let r=i.length;for(;r--;){let s=i[r];const n=/\(\)$/;/^!{2}/.test(s)?(s=s.substring(2,s.length),e[s]=!!t[s]):n.test(s)?(s=s.substring(0,s.length-2),"function"==typeof t[s]&&(e[s]=t[s]())):e[s]=t[s]}return{...e,...t.getNonDefaults()}}}ot.addAsMixin(mt),mt.prototype.isElement=1,mt.id=1,mt.PROP_GETTERS=new Map,mt.PROP_SETTERS=new Map;class yt{constructor(){yt.setupStateMachine(this)}static setupStateMachine(t){const e=t.constructor,i=yt.create(e);Object.setPrototypeOf(t,i.prototype),t.constructor=e,t._initStateMachine()}static create(t){if(!t.hasOwnProperty("_sm")){const e=new vt(t);t._sm=e}return t._sm.router}fire(t,...e){if(this._hasMethod(t))return this[t](...e)}_getState(){return this._state.__path}_inState(t,e=this._state.__path){const i=this._sm.getStateByPath(t),r=this._sm.getStateByPath(e),s=i.__level;return yt._getStateAtLevel(r,s)===i}_hasMember(t){return!!this.constructor.prototype[t]}_hasMethod(t){const e=this.constructor.prototype[t];return!!e&&"function"==typeof e}_setState(t,e){const i=++this._setStateCounter;if(this._setStateId=i,this._state.__path!==t){let r=this._sm._stateMap[t];r||(r=this._sm.getStateByPath(t));const s=this._state,n=r.prototype.$enter!==this._state.prototype.$enter,o=r.prototype.$exit!==this._state.prototype.$exit;if(n||o){const t=yt._getSharedState(this._state,r),a={newState:r.__path,prevState:s.__path,sharedState:t.__path},h=t.__level;if(o){const t=yt._getStatesUntilLevel(this._state,h);for(let r=0,s=t.length;r<s;r++)if(this.__setState(t[r]),this._callExit(this._state,e,a),this._setStateId!==i)return}if(n){const t=yt._getStatesUntilLevel(r,h).reverse();for(let r=0,s=t.length;r<s;r++)if(this.__setState(t[r]),this._callEnter(this._state,e,a),this._setStateId!==i)return}}if(this.__setState(r),this._changedState){const t={newState:r.__path,prevState:s.__path};e?this._changedState(t,...e):this._changedState(t)}if(this._onStateChange){const t={newState:r.__path,prevState:s.__path};this._onStateChange(t)}}}_callEnter(t,e=[],i){const r=!!t.__parent;t.prototype.$enter&&(r&&t.__parent.prototype.$enter===t.prototype.$enter||t.prototype.$enter.apply(this,[i,...e]))}_callExit(t,e=[],i){const r=!!t.__parent;t.prototype.$exit&&(r&&t.__parent.prototype.$exit===t.prototype.$exit||t.prototype.$exit.apply(this,[i,...e]))}__setState(t){this._state=t,this._stateIndex=t.__index,this.constructor=t}_initStateMachine(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));this._callEnter(this._state,[],{newState:"",prevState:void 0,sharedState:void 0}),this._onStateChange=void 0}_getMostSpecificHandledMember(t){let e=this._state;do{for(let i=0,r=t.length;i<r;i++){const r=t[i];if(e.__parent){if(this[vt.getStateMemberAlias(e.__path,r)])return r}else if(e.prototype[r])return r}e=e.__parent}while(e)}static _getStatesUntilLevel(t,e){const i=[];for(;t.__level>e;)i.push(t),t=t.__parent;return i}static _getSharedState(t,e){const i=yt._getAncestorStates(t),r=yt._getAncestorStates(e),s=Math.min(i.length,r.length);for(let t=0;t<s;t++)if(i[t]!==r[t])return i[t-1];return i[s-1]}static _getAncestorStates(t){const e=[];do{e.push(t)}while(t=t.__parent);return e.reverse()}static _getStateAtLevel(t,e){if(!(e>t.__level)){for(;e<t.__level;)t=t.__parent;return t}}}class vt{constructor(t){this._type=t,this._router=null,this.init()}get router(){return this._router}init(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}_createRouter(){const t=this._type,e=class extends t{constructor(){if(super(...arguments),!this.constructor.hasOwnProperty("_isRouter"))throw new Error(`You need to extend ${t.name}.original instead of ${t.name}.`)}};return e._isRouter=!0,e.prototype._routedType=t,e.original=t,this._mixinStateMachineMethods(e),e}_mixinStateMachineMethods(t){const e=Object.getOwnPropertyNames(yt.prototype);for(let i=0,r=e.length;i<r;i++){const r=e[i];if("constructor"!==r){const e=Object.getOwnPropertyDescriptor(yt.prototype,r);Object.defineProperty(t.prototype,r,e)}}}_addStateMemberDelegatorsToRouter(){this._getAllMemberNames().forEach((t=>{this._addMemberRouter(t)}))}_addMemberRouter(t){const e=Object.keys(this._stateMap),i=[],r=[];let s;switch(e.forEach(((e,s)=>{const n=this._stateMap[e],o=this._getDescriptor(n,t);if(o){i[s]=o;const e=vt.getStateMemberAlias(o._source.__path,t);r[s]=e,this._router.prototype.hasOwnProperty(e)||Object.defineProperty(this._router.prototype,e,o)}else i[s]=null,r[s]=null})),i.forEach((e=>{if(e){const i=this._getDescriptorType(e);if(s&&s!==i)return void console.warn(`[Lightning] Member ${t} in ${this._type.name} has inconsistent types.`);s=i}})),s){case"method":this._addMethodRouter(t,i,r);break;case"getter":this._addGetterSetterRouters(t);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!")}}_getDescriptor(t,e,i=(()=>!0)){let r=t,s=t;do{const t=Object.getOwnPropertyDescriptor(r.prototype,e);if(t&&i(t))return t._source=s,t;r=Object.getPrototypeOf(r),r&&r.hasOwnProperty("__state")&&(s=r)}while(r&&r.prototype)}_getDescriptorType(t){return t.get||t.set?"getter":"function"==typeof t.value?"method":"property"}static _supportsSpread(){if(void 0===this.__supportsSpread){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch(t){}}return this.__supportsSpread}_addMethodRouter(t,e,i){const r=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let s=i[0];const n=vt._supportsSpread();for(let t=1,e=i.length;t<e;t++){const e=i[t];e!==s&&(s?n?r.push(`if (i < ${t}) return this["${s}"](...arguments); else`):r.push(`if (i < ${t}) return this["${s}"].apply(this, arguments); else`):r.push(`if (i < ${t}) return ; else`)),s=e}s?n?r.push(`return this["${s}"](...arguments);`):r.push(`return this["${s}"].apply(this, arguments);`):r.push(";");const o=r.join("\n"),a={value:new Function([],o)};Object.defineProperty(this._router.prototype,t,a)}_addGetterSetterRouters(t){const e={get:this._getGetterRouter(t),set:this._getSetterRouter(t)};Object.defineProperty(this._router.prototype,t,e)}_getGetterRouter(t){const e=Object.keys(this._stateMap),i=[],r=[];e.forEach(((e,s)=>{const n=this._stateMap[e],o=this._getDescriptor(n,t,(t=>t.get));if(o){i[s]=o;const e=vt.getStateMemberAlias(o._source.__path,t);r[s]=e,this._router.prototype.hasOwnProperty(e)||Object.defineProperty(this._router.prototype,e,o)}else i[s]=null,r[s]=null}));const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let n=r[0];for(let t=1,e=r.length;t<e;t++){const e=r[t];e!==n&&(n?s.push(`if (i < ${t}) return this["${n}"]; else`):s.push(`if (i < ${t}) return ; else`)),n=e}n?s.push(`return this["${n}"];`):s.push(";");const o=s.join("\n");return new Function([],o)}_getSetterRouter(t){const e=Object.keys(this._stateMap),i=[],r=[];e.forEach(((e,s)=>{const n=this._stateMap[e],o=this._getDescriptor(n,t,(t=>t.set));if(o){i[s]=o;const e=vt.getStateMemberAlias(o._source.__path,t);r[s]=e,this._router.prototype.hasOwnProperty(e)||Object.defineProperty(this._router.prototype,e,o)}else i[s]=null,r[s]=null}));const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let n=r[0];for(let t=1,e=r.length;t<e;t++){const e=r[t];e!==n&&(n?s.push(`if (i < ${t}) this["${n}"] = arg; else`):s.push(`if (i < ${t}) ; else`)),n=e}n?s.push(`this["${n}"] = arg;`):s.push(";");const o=s.join("\n");return new Function(["arg"],o)}static getStateMemberAlias(t,e){return"$"+(t?t+".":"")+e}_getAllMemberNames(){const t=this._stateMap,e=Object.keys(t);let i=new Set;return e.forEach((e=>{if(""===e)return;const r=t[e];this._getStateMemberNames(r).forEach((t=>{i.add(t)}))})),[...i]}_getStateMemberNames(t){let e=t,i=new Set;const r=this._type===t;do{this._getStateMemberNamesForType(e).forEach((t=>{i.add(t)})),e=Object.getPrototypeOf(e)}while(e&&e.prototype&&(!e.hasOwnProperty("__state")||r));return i}_getStateMemberNamesForType(t){return Object.getOwnPropertyNames(t.prototype).filter((t=>"constructor"!==t&&!vt._isStateLocalMember(t)))}static _isStateLocalMember(t){return"$enter"===t||"$exit"===t}getStateByPath(t){if(this._stateMap[t])return this._stateMap[t];const e=t.split(".");for(;e.pop();){const t=e.join(".");if(this._stateMap[t])return this._stateMap[t]}}_getStateMap(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}_createStateMap(){const t={};return this._addState(this._type,null,"",t),t}_addState(t,e,i,r){t.__state=!0,t.__name=i,this._addStaticStateProperty(t,e);const s=e?e.__path:"";let n=(s?s+".":"")+i;t.__path=n,t.__level=e?e.__level+1:0,t.__parent=e,t.__index=Object.keys(r).length,r[n]=t;const o=t._states;o&&(e&&e._states===o||t._states().forEach((e=>{const i=vt._getStateName(e);this._addState(e,t,i,r)})))}static _getStateName(t){const e=t.name,i=e.indexOf("$");return i>0?e.substr(0,i):e}_addStaticStateProperty(t,e){e&&(e&&!e.__parent?this._router[t.__name]=t:e[t.__name]=t)}}class St extends mt{constructor(t,e){super(t),this.tagRoot=!0,W.isObjectLiteral(e)&&Object.assign(this,e),this.__initialized=!1,this.__firstActive=!1,this.__firstEnable=!1,this.__signals=void 0,this.__passSignals=void 0,this.__construct();const i=this.constructor.getTemplateFunc(this);i.f(this,i.a),this._build()}__start(){yt.setupStateMachine(this),this._onStateChange=St.prototype.__onStateChange}get state(){return this._getState()}__onStateChange(){this.application&&this.application.updateFocusPath()}_refocus(){this.application&&this.application.updateFocusPath()}static bindProp(t,e=null){return{__propertyBinding:!0,__name:t,__func:e}}__bindProperty(t,e,i){const r=e,s=i,n=Array.isArray(t.__name)?t.__name:[t.__name];for(let e=0;e<n.length;e++){const i=n[e],o=t.__func?t.__func:t=>t[i];this.hasOwnProperty(i)?this[`__prop_bindings_${i}`].push({__obj:r,__prop:s,__func:o}):(this[`__prop_bindings_${i}`]=[{__obj:r,__prop:s,__func:o}],Object.defineProperty(this,i,{set:t=>{this[`__prop_${i}`]=t;for(const{__obj:t,__prop:e,__func:r}of this[`__prop_bindings_${i}`])t[e]=r(this)},get:()=>this[`__prop_${i}`]}))}}static getTemplateFunc(t){const e="_templateFunc",i="__has"+e;return this[i]!==this&&(this[i]=this,this[e]=this.parseTemplate(this._template(t))),this[e]}static parseTemplate(t){const e={loc:[],store:[],rid:0};this.parseTemplateRec(t,e,"element");const i=e.loc.join(";\n");return{f:new Function("element","store",i),a:e.store}}static parseTemplateRec(t,e,i){const r=e.store,s=e.loc;Object.keys(t).forEach((n=>{let o=t[n];if(W.isUcChar(n.charCodeAt(0)))if(W.isObjectLiteral(o)){const t=`r${n.replace(/[^a-z0-9]/gi,"")+e.rid}`;let a=o.type?o.type:mt;a===mt?s.push(`var ${t} = element.stage.createElement()`):(r.push(a),s.push(`var ${t} = new store[${r.length-1}](${i}.stage)`)),s.push(`${t}.ref = "${n}"`),e.rid++,this.parseTemplateRec(o,e,t),s.push(`${i}.childList.add(${t})`)}else W.isObject(o)&&(r.push(o),s.push(`${i}.childList.add(store[${r.length-1}])`));else if("text"===n){const t=i+"__text";s.push(`var ${t} = ${i}.enableTextTexture()`),!0===o.__propertyBinding?(r.push(o),s.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${n}")`)):this.parseTemplatePropRec(o,e,t)}else if("shader"===n&&W.isObjectLiteral(o)){const t=`${i}["shader"]`;r.push(o),s.push(`${i}["${n}"] = store[${r.length-1}]`),this.parsePropertyBindings(o,e,t)}else if("texture"===n&&W.isObjectLiteral(o)){const t=i+"__texture",a=o.type;a?(r.push(a),s.push(`var ${t} = new store[${r.length-1}](${i}.stage)`),this.parseTemplatePropRec(o,e,t),s.push(`${i}["${n}"] = ${t}`)):(s.push(`${t} = ${i}.texture`),this.parseTemplatePropRec(o,e,t))}else W.isObjectLiteral(o)&&!0===o.__propertyBinding?(r.push(o),s.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${n}")`)):W.isNumber(o)?s.push(`${i}["${n}"] = ${o}`):W.isBoolean(o)?s.push(`${i}["${n}"] = ${o?"true":"false"}`):W.isObject(o)||Array.isArray(o)?(r.push(o),s.push(`${i}["${n}"] = store[${r.length-1}]`)):s.push(`${i}["${n}"] = ${JSON.stringify(o)}`)}))}static parseTemplatePropRec(t,e,i){const r=e.store,s=e.loc;Object.keys(t).forEach((e=>{if("type"!==e){const n=t[e];W.isNumber(n)?s.push(`${i}["${e}"] = ${n}`):W.isBoolean(n)?s.push(`${i}["${e}"] = ${n?"true":"false"}`):W.isObject(n)&&!0===n.__propertyBinding?(r.push(n),s.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${e}")`)):W.isObject(n)||Array.isArray(n)?(r.push(n),s.push(`${i}["${e}"] = store[${r.length-1}]`)):s.push(`${i}["${e}"] = ${JSON.stringify(n)}`)}}))}static parsePropertyBindings(t,e,i){const r=e.store,s=e.loc;Object.keys(t).forEach((e=>{if("type"!==e){const n=t[e];W.isObjectLiteral(n)&&!0===n.__propertyBinding&&(r.push(n),s.push(`element.__bindProperty(store[${r.length-1}], ${i}, "${e}")`))}}))}_onSetup(){this.__initialized||this._setup()}_setup(){}_onAttach(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}_attach(){}_onDetach(){this._detach()}_detach(){}_onEnabled(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}_firstEnable(){}_enable(){}_onDisabled(){this._disable()}_disable(){}_onActive(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}_firstActive(){}_active(){}_onInactive(){this._inactive()}_inactive(){}get application(){return this.stage.application}__construct(){this._construct()}_construct(){}_build(){}__init(){this._init()}_init(){}_focus(t,e){}_unfocus(t){}_focusChange(t,e){}_getFocused(){return this}_setFocusSettings(t){}_handleFocusSettings(t){}static _template(){return{}}hasFinalFocus(){let t=this.application._focusPath;return t&&t.length&&t[t.length-1]===this}hasFocus(){let t=this.application._focusPath;return t&&t.indexOf(this)>=0}get cparent(){return St.getParent(this)}seekAncestorByType(t){let e=this.cparent;for(;e;){if(e.constructor===t)return e;e=e.cparent}}getSharedAncestorComponent(t){let e=this.getSharedAncestor(t);for(;e&&!e.isComponent;)e=e.parent;return e}get signals(){return this.__signals}set signals(t){W.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=t}set alterSignals(t){W.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={});for(let e in t)void 0===t[e]?delete this.__signals[e]:this.__signals[e]=t}get passSignals(){return this.__passSignals||{}}set passSignals(t){this.__passSignals=Object.assign(this.__passSignals||{},t)}set alterPassSignals(t){W.isObjectLiteral(t)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={});for(let e in t)void 0===t[e]?delete this.__passSignals[e]:this.__passSignals[e]=t}signal(t,...e){return this._signal(t,e)}_signal(t,e){const i=this._getParentSignalHandler();if(i){if(this.__signals){let r=this.__signals[t];if(!1===r)return;if(r){if(!0===r&&(r=t),W.isFunction(r))return r(...e);if(i._hasMethod(r))return i[r](...e)}}let r=this.__passSignals&&this.__passSignals[t];if(r)return r&&!0!==r&&(t=r),i._signal(t,e)}}_getParentSignalHandler(){return this.cparent?this.cparent._getSignalHandler():null}_getSignalHandler(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}get _signalProxy(){return!1}fireAncestors(t,...e){if(!t.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");const i=this._getParentSignalHandler();if(i)return i._doFireAncestors(t,e)}_doFireAncestors(t,e){if(this._hasMethod(t))return this.fire(t,...e);{const i=this._getParentSignalHandler();if(i)return i._doFireAncestors(t,e)}}static collectSubComponents(t,e){if(e.hasChildren()){const i=e.__childList;for(let e=0,r=i.length;e<r;e++){const r=i.getAt(e);r.isComponent?t.push(r):St.collectSubComponents(t,r)}}}static getComponent(t){let e=t;for(;e&&!e.isComponent;)e=e.parent;return e}static getParent(t){return St.getComponent(t.parent)}}St.prototype.isComponent=!0;class Tt{constructor(t){this.ctx=t,this.quadTextures=[],this.quadElements=[]}get length(){return this.quadTextures.length}reset(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}getElement(t){return this.quadElements[t]._element}getElementCore(t){return this.quadElements[t]}getTexture(t){return this.quadTextures[t]}getTextureWidth(t){let e=this.quadTextures[t];return e.w?e.w:this.quadElements[t]._displayedTextureSource.w}getTextureHeight(t){let e=this.quadTextures[t];return e.h?e.h:this.quadElements[t]._displayedTextureSource.h}}class bt extends Tt{constructor(t){super(t);const e=t.stage.getOption("bufferMemory");this.dataLength=0,this.data=new ArrayBuffer(e),this.floats=new Float32Array(this.data),this.uints=new Uint32Array(this.data)}getAttribsDataByteOffset(t){return 80*t}getQuadContents(){let t=this.floats,e=this.uints,i=[];for(let r=1;r<=this.length;r++){let s="entry "+r+": ";for(let i=0;i<4;i++){let n=20*r+4*i;s+=t[n]+","+t[n+1]+":"+t[n+2]+","+t[n+3]+"["+e[n+4].toString(16)+"] "}i.push(s)}return i}}class wt{constructor(t,e,i,r,s,n){this.ctx=t,this.shader=e,this.shaderOwner=i,this.renderTextureInfo=r,this.scissor=s,this.index=n,this.length=0}get quads(){return this.ctx.renderState.quads}getTexture(t){return this.quads.getTexture(this.index+t)}getElementCore(t){return this.quads.getElementCore(this.index+t)}getElement(t){return this.quads.getElement(this.index+t)}getElementWidth(t){return this.getElement(t).renderWidth}getElementHeight(t){return this.getElement(t).renderHeight}getTextureWidth(t){return this.quads.getTextureWidth(this.index+t)}getTextureHeight(t){return this.quads.getTextureHeight(this.index+t)}getRenderWidth(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}getRenderHeight(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}class Ct extends wt{constructor(t,e,i,r,s,n){super(t,e,i,r,s,n),this.extraAttribsDataByteOffset=0}getAttribsDataByteOffset(t){return this.quads.getAttribsDataByteOffset(this.index+t)}getNormalRenderTextureCoords(t,e){let i=this.shaderOwner.getRenderTextureCoords(t,e);return i[0]/=this.getRenderWidth(),i[1]/=this.getRenderHeight(),i[0]=2*i[0]-1,i[1]=1-2*i[1],i}getProjection(){return null===this.renderTextureInfo?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}class At{constructor(t){this.ctx=t,this.renderState=t.renderState,this.gl=this.ctx.stage.gl}destroy(){}_reset(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}execute(){this._reset();let t=this.renderState.quadOperations,e=0,i=t.length;for(;e<i;)this._processQuadOperation(t[e]),e++}_processQuadOperation(t){t.renderTextureInfo&&t.renderTextureInfo.ignore||(this._setupQuadOperation(t),this._execQuadOperation(t))}_setupQuadOperation(t){}_execQuadOperation(t){let e=t.renderTextureInfo?t.renderTextureInfo.nativeTexture:null;this._renderTexture!==e&&this._bindRenderTexture(e),t.renderTextureInfo&&!t.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),t.renderTextureInfo.cleared=!0,this._setScissor(t.scissor)):this._setScissor(t.scissor),this._renderQuadOperation(t)}_renderQuadOperation(t){}_bindRenderTexture(t){this._renderTexture=t}_clearRenderTexture(t){}_setScissor(t){}}class Rt extends At{constructor(t){super(t),this.gl=this.ctx.stage.gl,this.init()}init(){let t=this.gl;this._attribsBuffer=t.createBuffer();let e=Math.floor(this.renderState.quads.data.byteLength/80),i=new Uint16Array(6*e);for(let t=0,r=0;t<e;t+=6,r+=4)i[t]=r,i[t+1]=r+1,i[t+2]=r+2,i[t+3]=r,i[t+4]=r+2,i[t+5]=r+3;this._quadsBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}destroy(){super.destroy(),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer)}_reset(){super._reset();let t=this.gl;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}_setupBuffers(){let t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);let e=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);t.bindBuffer(t.ARRAY_BUFFER,this._attribsBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW)}_setupQuadOperation(t){super._setupQuadOperation(t),this._useShaderProgram(t.shader,t)}_renderQuadOperation(t){let e=t.shader;(t.length||t.shader.addEmpty())&&(e.beforeDraw(t),e.draw(t),e.afterDraw(t))}_useShaderProgram(t,e){t.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),t.useProgram(),this._currentShaderProgram=t),t.setupUniforms(e)}_stopShaderProgram(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}_bindRenderTexture(t){super._bindRenderTexture(t);let e=this.gl;this._renderTexture?(e.bindFramebuffer(e.FRAMEBUFFER,this._renderTexture.framebuffer),e.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}_clearRenderTexture(){super._clearRenderTexture();let t=this.gl;if(this._renderTexture)t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);else{let e=this.ctx.stage.getClearColor();e&&(t.clearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]),t.clear(t.COLOR_BUFFER_BIT))}}_setScissor(t){if(super._setScissor(t),this._scissor===t)return;this._scissor=t;let e=this.gl;if(t){e.enable(e.SCISSOR_TEST);let i=this.ctx.stage.getRenderPrecision(),r=t[1];null===this._renderTexture&&(r=this.ctx.stage.h/i-(t[1]+t[3])),e.scissor(Math.round(t[0]*i),Math.round(r*i),Math.round(t[2]*i),Math.round(t[3]*i))}else e.disable(e.SCISSOR_TEST)}}class Et{constructor(t){this.ctx=t,this.stage=t.stage,this.defaultShader=this.stage.renderer.getDefaultShader(t),this.renderer=t.stage.renderer,this.quads=this.renderer.createCoreQuadList(t)}reset(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}get length(){return this.quads.quadTextures.length}setShader(t,e){this._shaderOwner===e&&this._realShader===t||(this._realShader=t,t.useDefault()&&(t=this.defaultShader),this._shader===t&&this._shaderOwner===e||(this._shader=t,this._shaderOwner=e,this._check=!0))}get renderTextureInfo(){return this._renderTextureInfo}setScissor(t){this._scissor!==t&&(this._scissor=t||null,this._check=!0)}getScissor(){return this._scissor}setRenderTextureInfo(t){this._renderTextureInfo!==t&&(this._renderTextureInfo=t,this._scissor=null,this._check=!0)}setTexturizer(t,e=!1){this._texturizer=t,this._cacheTexturizer=e}set isCachingTexturizer(t){this._isCachingTexturizer=t}get isCachingTexturizer(){return this._isCachingTexturizer}addQuad(t){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();let e=null;this._texturizer&&(e=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),e||(e=t._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=e,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(e),this.quads.quadElements.push(t),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}finishedRenderTexture(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}_isRenderTextureReusable(){const t=this._renderTextureInfo.offset;return this.quads.quadTextures[t].w===this._renderTextureInfo.w&&this.quads.quadTextures[t].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}_hasChanges(){let t=this._quadOperation;return this._shader!==t.shader||this._shaderOwner!==t.shaderOwner||this._renderTextureInfo!==t.renderTextureInfo||this._scissor!==t.scissor&&(this._scissor[0]!==t.scissor[0]||this._scissor[1]!==t.scissor[1]||this._scissor[2]!==t.scissor[2]||this._scissor[3]!==t.scissor[3])}_finishQuadOperation(t=!0){if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(let t=0,e=this._temporaryTexturizers.length;t<e;t++)this._temporaryTexturizers[t].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}t&&this._createQuadOperation()}_createQuadOperation(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}finish(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}class Lt{constructor(t,e){this.vertexShaderSource=t,this.fragmentShaderSource=e,this._program=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}compile(t){if(this._program)return;this.gl=t,this._program=t.createProgram();let e=this._glCompile(t.VERTEX_SHADER,this.vertexShaderSource),i=this._glCompile(t.FRAGMENT_SHADER,this.fragmentShaderSource);t.attachShader(this._program,e),t.attachShader(this._program,i),t.linkProgram(this._program),t.getProgramParameter(this._program,t.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",t.getProgramParameter(this._program,t.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",t.getError()),""!==t.getProgramInfoLog(this._program)&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(this._program)),t.deleteProgram(this._program),this._program=null),t.deleteShader(e),t.deleteShader(i)}_glCompile(t,e){let i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(i));let r=0;return console.error("[Lightning]","========== source ==========\n"+e.split("\n").map((t=>++r+": "+t)).join("\n")),null}return i}getUniformLocation(t){let e=this._uniformLocations.get(t);return void 0===e&&(e=this.gl.getUniformLocation(this._program,t),this._uniformLocations.set(t,e)),e}getAttribLocation(t){let e=this._attributeLocations.get(t);return void 0===e&&(e=this.gl.getAttribLocation(this._program,t),this._attributeLocations.set(t,e)),e}destroy(){this._program&&(this.gl.deleteProgram(this._program),this._program=null)}get glProgram(){return this._program}get compiled(){return!!this._program}_valueEquals(t,e){if(t.length&&e.length){for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}return t===e}_valueClone(t){return t.length?t.slice(0):t}setUniformValue(t,e,i){let r=this._currentUniformValues[t];if(void 0===r||!this._valueEquals(r,e)){let r=this._valueClone(e);this._currentUniformValues[t]=r;let s=this.getUniformLocation(t);s&&(i===this.gl.uniformMatrix2fv||i===this.gl.uniformMatrix3fv||i===this.gl.uniformMatrix4fv?i.call(this.gl,s,!1,r):i.call(this.gl,s,r))}}}class Pt extends at{constructor(t){super(t);const e=t.stage;this._program=e.renderer.shaderPrograms.get(this.constructor),this._program||(this._program=new Lt(this.constructor.vertexShaderSource,this.constructor.fragmentShaderSource),e.renderer.shaderPrograms.set(this.constructor,this._program)),this.gl=e.gl}get glProgram(){return this._program.glProgram}_init(){this._initialized||(this.initialize(),this._initialized=!0)}initialize(){this._program.compile(this.gl)}get initialized(){return this._initialized}_uniform(t){return this._program.getUniformLocation(t)}_attrib(t){return this._program.getAttribLocation(t)}_setUniform(t,e,i){this._program.setUniformValue(t,e,i)}useProgram(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}stopProgram(){this.afterUsage(),this.disableAttribs()}hasSameProgram(t){return t&&(t===this||t._program===this._program)}beforeUsage(){}afterUsage(){}enableAttribs(){}disableAttribs(){}getExtraAttribBytesPerVertex(){return 0}getVertexAttribPointerOffset(t){return t.extraAttribsDataByteOffset-4*t.index*this.getExtraAttribBytesPerVertex()}setExtraAttribsInBuffer(t){}setupUniforms(t){}_getProjection(t){return t.getProjection()}getFlipY(t){return this._getProjection(t)[1]<0}beforeDraw(t){}draw(t){}afterDraw(t){}cleanup(){this._initialized=!1}}class It extends Pt{enableAttribs(){let t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&t.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}draw(t){let e=this.gl,i=t.length;if(i){let r=t.getTexture(0),s=0;for(let n=0;n<i;n++){let i=t.getTexture(n);r!==i&&(e.bindTexture(e.TEXTURE_2D,r),e.drawElements(e.TRIANGLES,6*(n-s),e.UNSIGNED_SHORT,6*(s+t.index)*2),r=i,s=n)}s<i&&(e.bindTexture(e.TEXTURE_2D,r),e.drawElements(e.TRIANGLES,6*(i-s),e.UNSIGNED_SHORT,6*(s+t.index)*2))}}}It.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",It.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";class Ot{constructor(t){this.stage=t,this._defaultShader=void 0}gc(t){}destroy(){}getDefaultShader(t=this.stage.ctx){return this._defaultShader||(this._defaultShader=this._createDefaultShader(t)),this._defaultShader}_createDefaultShader(t){}isValidShaderType(t){return t.prototype instanceof this._getShaderBaseType()}createShader(t,e){const i=e.type;if(this.isValidShaderType(i)){const r=new i(t);return H.patchObject(this,e),r}{const e=this._getShaderAlternative(i);return e?new e(t):(console.warn("[Lightning] Shader has no implementation for render target: "+i.name),this._createDefaultShader(t))}}_getShaderBaseType(){}_getShaderAlternative(t){return this.getDefaultShader()}copyRenderTexture(t,e,i){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}class Ft extends Ot{constructor(t){super(t),this.shaderPrograms=new Map}destroy(){this.shaderPrograms.forEach((t=>t.destroy()))}_createDefaultShader(t){return new It(t)}_getShaderBaseType(){return Pt}_getShaderAlternative(t){return t.getWebGL&&t.getWebGL()}createCoreQuadList(t){return new bt(t)}createCoreQuadOperation(t,e,i,r,s,n){return new Ct(t,e,i,r,s,n)}createCoreRenderExecutor(t){return new Rt(t)}createCoreRenderState(t){return new Et(t)}createRenderTexture(t,e,i,r){const s=this.stage.gl,n=s.createTexture();return s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,i,r,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n.params={},n.params[s.TEXTURE_MAG_FILTER]=s.LINEAR,n.params[s.TEXTURE_MIN_FILTER]=s.LINEAR,n.params[s.TEXTURE_WRAP_S]=s.CLAMP_TO_EDGE,n.params[s.TEXTURE_WRAP_T]=s.CLAMP_TO_EDGE,n.options={format:s.RGBA,internalFormat:s.RGBA,type:s.UNSIGNED_BYTE},n.framebuffer=s.createFramebuffer(),n.projection=new Float32Array([2/t,2/e]),s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),n}freeRenderTexture(t){let e=this.stage.gl;e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t)}uploadTextureSource(t,e){const i=this.stage.gl,r=e.source,s={premultiplyAlpha:!0,hasAlpha:!0};e&&e.hasOwnProperty("premultiplyAlpha")&&(s.premultiplyAlpha=e.premultiplyAlpha),e&&e.hasOwnProperty("flipBlueRed")&&(s.flipBlueRed=e.flipBlueRed),e&&e.hasOwnProperty("hasAlpha")&&(s.hasAlpha=e.hasAlpha),s.hasAlpha||(s.premultiplyAlpha=!1),s.texParams=e.texParams||{},s.texOptions=e.texOptions||{};let n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),W.isNode&&i.pixelStorei(i.UNPACK_FLIP_BLUE_RED,!!s.flipBlueRed);const o=s.texParams;o[i.TEXTURE_MAG_FILTER]||(o[i.TEXTURE_MAG_FILTER]=i.LINEAR),o[i.TEXTURE_MIN_FILTER]||(o[i.TEXTURE_MIN_FILTER]=i.LINEAR),o[i.TEXTURE_WRAP_S]||(o[i.TEXTURE_WRAP_S]=i.CLAMP_TO_EDGE),o[i.TEXTURE_WRAP_T]||(o[i.TEXTURE_WRAP_T]=i.CLAMP_TO_EDGE),Object.keys(o).forEach((t=>{const e=o[t];i.texParameteri(i.TEXTURE_2D,parseInt(t),e)}));const a=s.texOptions;return a.format=a.format||(s.hasAlpha?i.RGBA:i.RGB),a.type=a.type||i.UNSIGNED_BYTE,a.internalFormat=a.internalFormat||a.format,e&&e.imageRef&&(a.imageRef=e.imageRef),this.stage.platform.uploadGlTexture(i,t,r,a),n.params=W.cloneObjShallow(o),n.options=W.cloneObjShallow(a),n}freeTextureSource(t){this.stage.gl.deleteTexture(t.nativeTexture)}addQuad(t,e,i){let r=20*i;const s=e.quadElements[i];let n=s._renderContext,o=t.quads.floats,a=t.quads.uints;const h=U.mergeColorAlpha;if(0!==n.tb||0!==n.tc)o[r++]=n.px,o[r++]=n.py,o[r++]=s._ulx,o[r++]=s._uly,a[r++]=h(s._colorUl,n.alpha),o[r++]=n.px+s._w*n.ta,o[r++]=n.py+s._w*n.tc,o[r++]=s._brx,o[r++]=s._uly,a[r++]=h(s._colorUr,n.alpha),o[r++]=n.px+s._w*n.ta+s._h*n.tb,o[r++]=n.py+s._w*n.tc+s._h*n.td,o[r++]=s._brx,o[r++]=s._bry,a[r++]=h(s._colorBr,n.alpha),o[r++]=n.px+s._h*n.tb,o[r++]=n.py+s._h*n.td,o[r++]=s._ulx,o[r++]=s._bry,a[r]=h(s._colorBl,n.alpha);else{let t=n.px+s._w*n.ta,e=n.py+s._h*n.td;o[r++]=n.px,o[r++]=n.py,o[r++]=s._ulx,o[r++]=s._uly,a[r++]=h(s._colorUl,n.alpha),o[r++]=t,o[r++]=n.py,o[r++]=s._brx,o[r++]=s._uly,a[r++]=h(s._colorUr,n.alpha),o[r++]=t,o[r++]=e,o[r++]=s._brx,o[r++]=s._bry,a[r++]=h(s._colorBr,n.alpha),o[r++]=n.px,o[r++]=e,o[r++]=s._ulx,o[r++]=s._bry,a[r]=h(s._colorBl,n.alpha)}}isRenderTextureReusable(t,e){let i=80*t._renderTextureInfo.offset/4,r=t.quads.floats,s=t.quads.uints;return 0===r[i]&&0===r[i+1]&&0===r[i+2]&&0===r[i+3]&&4294967295===s[i+4]&&r[i+5]===e.w&&0===r[i+6]&&1===r[i+7]&&0===r[i+8]&&4294967295===s[i+9]&&r[i+10]===e.w&&r[i+11]===e.h&&1===r[i+12]&&1===r[i+13]&&4294967295===s[i+14]&&0===r[i+15]&&r[i+16]===e.h&&0===r[i+17]&&1===r[i+18]&&4294967295===s[i+19]}finishRenderState(t){let e=80*t.length;for(let i=0,r=t.quadOperations.length;i<r;i++){t.quadOperations[i].extraAttribsDataByteOffset=e;let r=4*t.quadOperations[i].shader.getExtraAttribBytesPerVertex()*t.quadOperations[i].length;e+=r,r&&t.quadOperations[i].shader.setExtraAttribsInBuffer(t.quadOperations[i],t.quads)}t.quads.dataLength=e}copyRenderTexture(t,e,i){const r=this.stage.gl;r.bindTexture(r.TEXTURE_2D,e),r.bindFramebuffer(r.FRAMEBUFFER,t.framebuffer);const s=t.precision;r.copyTexSubImage2D(r.TEXTURE_2D,0,s*(i.sx||0),s*(i.sy||0),s*(i.x||0),s*(i.y||0),s*(i.w||t.ow),s*(i.h||t.oh))}}class kt extends Tt{constructor(t){super(t),this.renderContexts=[],this.modes=[]}setRenderContext(t,e){this.renderContexts[t]=e}setSimpleTc(t,e){e?this.modes[t]|=1:this.modes[t]-=1&this.modes[t]}setWhite(t,e){e?this.modes[t]|=2:this.modes[t]-=2&this.modes[t]}getRenderContext(t){return this.renderContexts[t]}getSimpleTc(t){return 1&this.modes[t]}getWhite(t){return 2&this.modes[t]}}class zt extends wt{getRenderContext(t){return this.quads.getRenderContext(this.index+t)}getSimpleTc(t){return this.quads.getSimpleTc(this.index+t)}getWhite(t){return this.quads.getWhite(this.index+t)}}class Mt extends At{init(){this._mainRenderTexture=this.ctx.stage.getCanvas()}_renderQuadOperation(t){let e=t.shader;if(t.length||t.shader.addEmpty()){const i=this._renderTexture||this._mainRenderTexture;e.beforeDraw(t,i),e.draw(t,i),e.afterDraw(t,i)}}_clearRenderTexture(){const t=this._getContext();let e=[0,0,0,0];this._mainRenderTexture.ctx===t&&(e=this.ctx.stage.getClearColor());const i=t.canvas;t.setTransform(1,0,0,1,0,0),e[0]||e[1]||e[2]||e[3]?(t.fillStyle=U.getRgbaStringFromArray(e),t.globalCompositeOperation="copy",t.beginPath(),t.rect(0,0,i.width,i.height),t.closePath(),t.fill(),t.globalCompositeOperation="source-over"):t.clearRect(0,0,i.width,i.height)}_getContext(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}_restoreContext(){const t=this._getContext();t.restore(),t.save(),t._scissor=null}_setScissor(t){const e=this._getContext();if(!Mt._equalScissorAreas(e.canvas,e._scissor,t)){this._restoreContext();let i=this.ctx.stage.getRenderPrecision();t&&(e.beginPath(),e.rect(Math.round(t[0]*i),Math.round(t[1]*i),Math.round(t[2]*i),Math.round(t[3]*i)),e.closePath(),e.clip()),e._scissor=t}}static _equalScissorAreas(t,e,i){return e||(e=[0,0,t.width,t.height]),i||(i=[0,0,t.width,t.height]),W.equalValues(e,i)}}class Bt extends at{beforeDraw(t){}draw(t){}afterDraw(t){}}class Dt extends Bt{constructor(t){super(t),this._rectangleTexture=t.stage.rectangleTexture.source.nativeTexture,this._tintManager=this.ctx.stage.renderer.tintManager}draw(t,e){const i=e.ctx;let r=t.length;for(let s=0;s<r;s++){const r=t.getTexture(s),n=t.getElementCore(s),o=t.getRenderContext(s),a=t.getWhite(s),h=t.getSimpleTc(s),l=this.ctx.stage.getRenderPrecision();i.setTransform(o.ta*l,o.tc*l,o.tb*l,o.td*l,o.px*l,o.py*l);const c=r===this._rectangleTexture,u={operation:t,target:e,index:s,rect:c};if(c)a?i.fillStyle="white":this._setColorGradient(i,n),i.globalAlpha=o.alpha,this._beforeDrawEl(u),i.fillRect(0,0,n.w,n.h),this._afterDrawEl(u),i.globalAlpha=1;else{i.globalAlpha=o.alpha,this._beforeDrawEl(u);const t=h?0:n._ulx*r.w,e=h?0:n._uly*r.h,s=(h?1:n._brx-n._ulx)*r.w,l=(h?1:n._bry-n._uly)*r.h;if(a)i.fillStyle="white",i.drawImage(r,t,e,s,l,0,0,n.w,n.h);else{let o=n._colorUl;n._colorUl===n._colorUr&&n._colorUr===n._colorBl&&n._colorBr===n._colorBl||(o=U.mergeMultiColorsEqual([n._colorUl,n._colorUr,n._colorBl,n._colorBr]));const a=(o/16777216|0)/255;i.globalAlpha*=a;const h=16777215&o,c=this._tintManager.getTintTexture(r,h);i.fillStyle="white",i.drawImage(c,t,e,s,l,0,0,n.w,n.h)}this._afterDrawEl(u),i.globalAlpha=1}}}_setColorGradient(t,e,i=e.w,r=e.h,s=!0){let n,o=e._colorUl;e._colorUl===e._colorUr?e._colorBl===e._colorBr&&(e._colorUl===e.colorBl||(n=t.createLinearGradient(0,0,0,r),s?(n.addColorStop(0,U.getRgbaString(e._colorUl)),n.addColorStop(1,U.getRgbaString(e._colorBl))):(n.addColorStop(0,U.getRgbString(e._colorUl)),n.addColorStop(1,U.getRgbString(e._colorBl))))):e._colorUl===e._colorBl&&e._colorUr===e._colorBr&&(n=t.createLinearGradient(0,0,i,0),s?(n.addColorStop(0,U.getRgbaString(e._colorUl)),n.addColorStop(1,U.getRgbaString(e._colorBr))):(n.addColorStop(0,U.getRgbString(e._colorUl)),n.addColorStop(1,U.getRgbString(e._colorBr)))),t.fillStyle=n||(s?U.getRgbaString(o):U.getRgbString(o))}_beforeDrawEl(t){}_afterDrawEl(t){}}class Ut{constructor(t){this.stage=t,this._usedMemory=0,this._cachedNativeTextures=new Set}destroy(){this.gc(!0)}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}delete(t){if(this._hasCache(t)){const e=this._getCache(t),i=e.memoryUsage;e.clear(),this._cachedNativeTextures.delete(t),this._addMemoryUsage(e.memoryUsage-i)}}getTintTexture(t,e){const i=this.stage.frameCounter;this._cachedNativeTextures.add(t);const r=this._getCache(t),s=r.get(e);if(s.lf=i,s.tx)return t.update>s.u&&this._tintTexture(s.tx,t,e),s.tx;{const s=r.memoryUsage;let n=r.reuseTexture(i);n?n.ctx.clearRect(0,0,n.width,n.height):(n=document.createElement("canvas"),n.width=t.w,n.height=t.h,n.ctx=n.getContext("2d")),this._tintTexture(n,t,e),r.set(e,n,i);const o=r.memoryUsage;return o!==s&&this._addMemoryUsage(o-s),n}}_tintTexture(t,e,i){let r=i.toString(16);for(;r.length<6;)r="0"+r;t.ctx.fillStyle="#"+r,t.ctx.globalCompositeOperation="copy",t.ctx.fillRect(0,0,e.w,e.h),t.ctx.globalCompositeOperation="multiply",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height),t.ctx.globalCompositeOperation="destination-in",t.ctx.drawImage(e,0,0,e.w,e.h,0,0,t.width,t.height)}_hasCache(t){return!!t._tintCache}_getCache(t){return t._tintCache||(t._tintCache=new Wt(t)),t._tintCache}gc(t=!1){const e=this.stage.frameCounter;let i=0;this._cachedNativeTextures.forEach((r=>{const s=this._getCache(r);if(t)i+=s.memoryUsage,s.clear();else{const t=s.memoryUsage;s.cleanup(e),s.releaseBlancoTextures(),i+=s.memoryUsage-t}})),t&&this._cachedNativeTextures.clear(),i&&this._addMemoryUsage(i)}}class Wt{constructor(t){this._tx=t,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}get memoryUsage(){return this._memTextures*this._tx.w*this._tx.h}releaseBlancoTextures(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}clear(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}get(t){let e=this._colors.get(t);return e||(e={lf:-1,tx:void 0,u:-1},this._colors.set(t,e)),e}set(t,e,i){const r=this.get(t);r.lf=i,r.tx=e,r.u=i,this._memTextures++}cleanup(t){this._lastCleanupFrame!==t&&(this._blancoTextures=[],this._colors.forEach(((e,i)=>{e.lf<t-1&&(e.tx&&this._blancoTextures.push(e.tx),this._colors.delete(i))})),this._lastCleanupFrame=t)}reuseTexture(t){if(this.cleanup(t),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}class Ht extends Ot{constructor(t){super(t),this.tintManager=new Ut(t),this.setupC2d(this.stage.c2d.canvas)}destroy(){this.tintManager.destroy()}_createDefaultShader(t){return new Dt(t)}_getShaderBaseType(){return Bt}_getShaderAlternative(t){return t.getC2d&&t.getC2d()}createCoreQuadList(t){return new kt(t)}createCoreQuadOperation(t,e,i,r,s,n){return new zt(t,e,i,r,s,n)}createCoreRenderExecutor(t){return new Mt(t)}createCoreRenderState(t){return new Et(t)}createRenderTexture(t,e,i,r){const s=document.createElement("canvas");return s.width=i,s.height=r,this.setupC2d(s),s}freeRenderTexture(t){this.tintManager.delete(t)}gc(t){this.tintManager.gc(t)}uploadTextureSource(t,e){if(e.source.buffer){const t=document.createElement("canvas");t.width=e.w,t.height=e.h;const i=new ImageData(new Uint8ClampedArray(e.source.buffer),e.w,e.h);return t.getContext("2d").putImageData(i,0,0),t}return e.source}freeTextureSource(t){this.tintManager.delete(t.nativeTexture)}addQuad(t,e,i){const r=e.quadElements[i];e.setRenderContext(i,r._renderContext),e.setWhite(i,r.isWhite()),e.setSimpleTc(i,r.hasSimpleTexCoords())}isRenderTextureReusable(t,e){return!1}finishRenderState(t){}setupC2d(t){const e=t.getContext("2d");t.ctx=e,e._scissor=null,t.ctx.save()}}class jt extends Pt{enableAttribs(){let t=this.gl;t.vertexAttribPointer(this._attrib("aVertexPosition"),2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&(t.vertexAttribPointer(this._attrib("aTextureCoord"),2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(this._attrib("aTextureCoord"))),-1!==this._attrib("aColor")&&(t.vertexAttribPointer(this._attrib("aColor"),4,t.UNSIGNED_BYTE,!0,20,16),t.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let t=this.gl;t.disableVertexAttribArray(this._attrib("aVertexPosition")),-1!==this._attrib("aTextureCoord")&&t.disableVertexAttribArray(this._attrib("aTextureCoord")),-1!==this._attrib("aColor")&&t.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(t){this._setUniform("projection",this._getProjection(t),this.gl.uniform2fv,!1)}draw(t){let e=this.gl,i=t.length;if(i){let r=t.getTexture(0),s=0;for(let n=0;n<i;n++){let i=t.getTexture(n);if(r!==i){if(r.options&&r.options.imageRef){let i=n>0?n-1:n;const s=this.ctx.stage.getOption("precision");let o=t.getElementCore(i);this.ctx.stage.platform.paint(e,r.options.imageRef,o._worldContext.px*s,o._worldContext.py*s,o._colorUl,o)}else e.bindTexture(e.TEXTURE_2D,r),e.drawElements(e.TRIANGLES,6*(n-s),e.UNSIGNED_SHORT,6*(s+t.index)*2);r=i,s=n}}if(s<i)if(r.options&&r.options.imageRef){const i=this.ctx.stage.getOption("precision");let n=t.getElementCore(s);this.ctx.stage.platform.paint(e,r.options.imageRef,n._worldContext.px*i,n._worldContext.py*i,n._colorUl,n)}else e.bindTexture(e.TEXTURE_2D,r),e.drawElements(e.TRIANGLES,6*(i-s),e.UNSIGNED_SHORT,6*(s+t.index)*2)}}}jt.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",jt.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n    }\n";class Nt extends Ft{constructor(t){super(t)}_createDefaultShader(t){return new jt(t)}createCoreRenderExecutor(t){global.beginDrawing();let e=super.createCoreRenderExecutor(t);return global.endDrawing(),e}}class Xt{constructor(t={}){this._items=new Map,this._id=0,this._initWorker()}destroy(){this._worker&&this._worker.terminate()}_initWorker(){const t=`(${Yt.toString()})()`,e=new Blob([t.replace('"use strict";',"")]),i=(window.URL?URL:webkitURL).createObjectURL(e,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(i),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=t=>{if(t.data&&t.data.id){const e=t.data.id,i=this._items.get(e);i&&("data"==t.data.type?this.finish(i,t.data.info):this.error(i,t.data.info))}}}create(t){const e=++this._id,i=new Gt(this,e,t);return this._items.set(e,i),this._worker.postMessage({type:"add",id:e,src:t}),i}cancel(t){this._worker.postMessage({type:"cancel",id:t.id}),this._items.delete(t.id)}error(t,e){t.error(e),this._items.delete(t.id)}finish(t,e){t.load(e),this._items.delete(t.id)}}class Gt{constructor(t,e,i){this._manager=t,this._id=e,this._src=i,this._onError=null,this._onLoad=null}get id(){return this._id}get src(){return this._src}set onError(t){this._onError=t}set onLoad(t){this._onLoad=t}cancel(){this._manager.cancel(this)}load(t){this._onLoad&&this._onLoad(t)}error(t){this._onError&&this._onError(t)}}const Yt=function(){function t(){this.items=new Map;var t=this;onmessage=function(e){t._receiveMessage(e)}}function e(t,e){this._onError=void 0,this._onFinish=void 0,this._id=t,this._src=e,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}t.isPathAbsolute=function(t){return/^(?:\/|[a-z]+:\/\/)/.test(t)||"data:"==t.substr(0,5)},t.prototype._receiveMessage=function(t){if("config"===t.data.type){this.config=t.data.config;var e=this.config.path;/#.*?\//.test(e)&&(e=e.replace(/#.*$/,""));var i=e.split("/");i.pop(),this._relativeBase=i.join("/")+"/"}else"add"===t.data.type?this.add(t.data.id,t.data.src):"cancel"===t.data.type&&this.cancel(t.data.id)},t.prototype.add=function(i,r){t.isPathAbsolute(r)||(r=this._relativeBase+r),"//"===r.substr(0,2)&&(r=this.config.protocol+r);var s=new e(i,r),n=this;s.onFinish=function(t){n.finish(s,t)},s.onError=function(t){n.error(s,t)},this.items.set(i,s),s.start()},t.prototype.cancel=function(t){var e=this.items.get(t);e&&(e.cancel(),this.items.delete(t))},t.prototype.finish=function(t,{imageBitmap:e,hasAlphaChannel:i}){postMessage({type:"data",id:t.id,info:{imageBitmap:e,hasAlphaChannel:i}},[e]),this.items.delete(t.id)},t.prototype.error=function(t,{type:e,message:i}){postMessage({type:"error",id:t.id,info:{type:e,message:i}}),this.items.delete(t.id)},t.isWPEBrowser=function(){return-1!==navigator.userAgent.indexOf("WPE")},Object.defineProperty(e.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(e.prototype,"onFinish",{get:function(){return this._onFinish},set:function(t){this._onFinish=t}}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t}}),e.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var t=this;this._xhr.onerror=function(e){t.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(e){var i=t._xhr.response;t._mimeType=i.type,t._createImageBitmap(i)},this._xhr.send()},e.prototype._createImageBitmap=function(t){var e=this;createImageBitmap(t,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then((function(t){e.finish({imageBitmap:t,hasAlphaChannel:e._hasAlphaChannel()})})).catch((function(t){e.error({type:"parse",message:"Error parsing image data"})}))},e.prototype._hasAlphaChannel=function(){return!!t.isWPEBrowser()||-1!==this._mimeType.indexOf("image/png")},e.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},e.prototype.error=function(t,e){!this._canceled&&this._onError&&this._onError({type:t,message:e})},e.prototype.finish=function(t){!this._canceled&&this._onFinish&&this._onFinish(t)},new t};class Vt{init(t){this.stage=t,this._looping=!1,this._awaitingLoop=!1,this._loopHandler=null,this._idleLoopCounter=0,this._idleLoopDelay=60,this.stage.getOption("useImageWorker")&&(window.createImageBitmap&&window.Worker?this._imageWorker=new Xt:console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support")),this._registerVisibilityChangeHandler()}destroy(){this._imageWorker&&this._imageWorker.destroy(),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler(),this._removeVisibilityChangeHandler()}startLoop(){this._looping=!0,this._awaitingLoop||this.loop()}stopLoop(){this._looping=!1}switchLoop(){this._idleLoopCounter<this._idleLoopDelay?this._idleLoopCounter++:this.stage.ctx.hasRenderUpdates()?this._idleLoopCounter=0:(this.stopLoop(),this._loopHandler=setInterval((()=>{this.stage.updateFrame(),this.stage.idleFrame(),this.stage.ctx.hasRenderUpdates()&&(clearInterval(this._loopHandler),this.startLoop())}),1e3/60))}loop(){let t=this,e=function(){t._awaitingLoop=!1,t._looping&&(t.stage.updateFrame(),t.stage.getOption("pauseRafLoopOnIdle")&&t.switchLoop(),t.stage.renderFrame(),requestAnimationFrame(e),t._awaitingLoop=!0)};requestAnimationFrame(e)}uploadGlTexture(t,e,i,r){if(i instanceof ImageData||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||window.ImageBitmap&&i instanceof ImageBitmap)t.texImage2D(t.TEXTURE_2D,0,r.internalFormat,r.format,r.type,i);else if(i instanceof HTMLCanvasElement){if(W.isZiggo||this.stage.getOption("forceTxCanvasSource"))t.texImage2D(t.TEXTURE_2D,0,r.internalFormat,r.format,r.type,i);else if(i.width>0&&i.height>0){const e=i.getContext("2d");t.texImage2D(t.TEXTURE_2D,0,r.internalFormat,r.format,r.type,e.getImageData(0,0,i.width,i.height))}}else t.texImage2D(t.TEXTURE_2D,0,r.internalFormat,e.w,e.h,0,r.format,r.type,i)}loadSrcTexture({src:t,hasAlpha:e},i){let r,s=t.indexOf(".png")>=0||"data:image/png;base64"==t.substr(0,21);if(this._imageWorker){const e=this._imageWorker.create(t);e.onError=function(t){return i("Image load error")},e.onLoad=function({imageBitmap:e,hasAlphaChannel:r}){i(null,{source:e,renderInfo:{src:t},hasAlpha:r,premultiplyAlpha:!0})},r=function(){e.cancel()}}else{let n=new Image;"data:"==t.substr(0,5)||W.isPS4||(n.crossOrigin="Anonymous"),n.onerror=function(t){if(n.src)return i("Image load error")},n.onload=function(){i(null,{source:n,renderInfo:{src:t},hasAlpha:s||e})},n.src=t,r=function(){n.onerror=null,n.onload=null,n.removeAttribute("src")}}return r}createWebGLContext(t,e){let i=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(i.width=t,i.height=e);let r={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},s=i.getContext("webgl",r)||i.getContext("experimental-webgl",r);if(!s)throw new Error("This browser does not support webGL.");return s}createCanvasContext(t,e){let i=this.stage.getOption("canvas")||document.createElement("canvas");t&&e&&(i.width=t,i.height=e);let r=i.getContext("2d");if(!r)throw new Error("This browser does not support 2d canvas.");return r}getHrTime(){return window.performance?window.performance.now():(new Date).getTime()}getDrawingCanvas(){return document.createElement("canvas")}getTextureOptionsForDrawingCanvas(t){let e={};return e.source=t,e}nextFrame(t){}registerKeydownHandler(t){this._keydownListener=e=>{t(e)},window.addEventListener("keydown",this._keydownListener)}registerKeyupHandler(t){this._keyupListener=e=>{t(e)},window.addEventListener("keyup",this._keyupListener)}_removeKeyHandler(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}registerClickHandler(t){this._clickListener=e=>{t(e)},window.addEventListener("mousedown",this._clickListener)}_removeClickHandler(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}registerHoverHandler(t){this._hoverListener=e=>{t(e)},window.addEventListener("mousemove",this._hoverListener)}_removeHoverHandler(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}registerScrollWheelHandler(t){this._scrollWheelListener=e=>{t(e)},window.addEventListener("wheel",this._scrollWheelListener)}_removeScrollWheelHandler(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}_registerVisibilityChangeHandler(){this._visibilityChangeHandler=()=>{"visible"===document.visibilityState&&(this.stage.root.core.setHasRenderUpdates(2),this.stage.renderFrame())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}_removeVisibilityChangeHandler(){this._visibilityChangeHandler&&document.removeEventListener("visibilitychange",this._visibilityChangeHandler)}}class $t{static isFunction(t){return"function"==typeof t}static isNumber(t){return"number"==typeof t}static isInteger(t){return"number"==typeof t&&t%1==0}static isBoolean(t){return!0===t||!1===t}static isString(t){return"string"==typeof t}static isObject(t){let e=typeof t;return!!t&&("object"==e||"function"==e)}static isPlainObject(t){return!!t&&"object"==typeof t}static isObjectLiteral(t){return"object"==typeof t&&t&&t.constructor===Object}static getArrayIndex(t,e){return $t.getModuloIndex(t,e.length)}static equalValues(t,e){return typeof t==typeof e&&($t.isObjectLiteral(t)?$t.isObjectLiteral(e)&&$t.equalObjectLiterals(t,e):Array.isArray(t)?Array.isArray(e)&&$t.equalArrays(t,e):t===e)}static equalObjectLiterals(t,e){let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let s=0,n=i.length;s<n;s++){const n=i[s],o=r[s];if(n!==o)return!1;const a=t[n],h=e[o];if(!$t.equalValues(a,h))return!1}return!0}static equalArrays(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(!this.equalValues(t[i],e[i]))return!1;return!0}}class qt{constructor(t,e){this._id=t,this._gl=e,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=e.TEXTURE0,this._pixelStorei=new Array(5)}_getDefaultFlag(t){return t===this._gl.DITHER}setFlag(t,e){return e===this._getDefaultFlag(t)?this._nonDefaultFlags.delete(t):!this._nonDefaultFlags.has(t)&&(this._nonDefaultFlags.add(t),!0)}setBuffer(t,e){const i=this._buffers.get(t)!==e;return this._buffers.set(t,e),i&&t===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),i}setFramebuffer(t,e){const i=this._framebuffers.get(t)!==e;return this._framebuffers.set(t,e),i}setRenderbuffer(t,e){const i=this._renderbuffers.get(t)!==e;return this._renderbuffers.set(t,e),i}setProgram(t){const e=this._program!==t;return this._program=t,e}setSetting(t,e){const i=this._settings.get(t),r=!i||!$t.equalValues(i,e);return this._settings.set(t,e),r}disableVertexAttribArray(t){const e=this._vertexAttribs[t];return!(!e||!e[5]||(e[5]=!1,0))}enableVertexAttribArray(t){const e=this._vertexAttribs[t];return e?!e[0]&&(e[0]=!0,!0):(this._vertexAttribs[t]=[0,0,0,0,0,!0],!0)}vertexAttribPointer(t,e){let i=this._vertexAttribs[t],r=!1;return i&&(r=i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]),!r&&(e[5]=!!i&&i[5],!0)}setActiveTexture(t){const e=this._activeTexture!==t;return this._activeTexture=t,e}bindTexture(t,e){const i=qt._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,i+1);const r=this._textures[i],s=qt._getTextureTargetIndex(t);return r?r[s]!==e&&(r[s]=e,!0):!!e&&(this._textures[i]=[],this._textures[i][s]=e,!0)}setPixelStorei(t,e){const i=qt._getPixelStoreiIndex(t),r=!$t.equalValues(this._pixelStorei[i],e);return this._pixelStorei[i]=e,r}migrate(t){const e=this;this._migrateFlags(e,t),t._program!==e._program&&this._gl._useProgram(t._program),this._migrateFramebuffers(e,t),this._migrateRenderbuffers(e,t);const i=this._migrateBuffers(e,t);this._migrateAttributes(e,t,i),this._migrateFlags(e,t),this._migrateSettings(e,t),this._migratePixelStorei(e,t),this._migrateTextures(e,t)}_migratePixelStorei(t,e){for(let i=0,r=t._pixelStorei.length;i<r;i++)if(t._pixelStorei[i]!==e._pixelStorei[i]){const t=void 0!==e._pixelStorei[i]?e._pixelStorei[i]:qt._getDefaultPixelStoreiByIndex(i);this._gl._pixelStorei(qt._getPixelStoreiByIndex(i),t)}}_migrateTextures(t,e){const i=Math.max(t._maxTexture,e._maxTexture);let r=t._activeTexture;for(let s=0;s<i;s++){const i=e._textures[s],n=t._textures[s],o=qt._getTextureByIndex(s);for(let t=0,e=Math.max(n?n.length:0,i?i.length:0);t<e;t++){const e=qt._getTextureTargetByIndex(t);r!==o&&(this._gl._activeTexture(o),r=o);const s=i&&i[t]||null;this._gl._bindTexture(e,s)}}e._activeTexture!==r&&this._gl._activeTexture(e._activeTexture)}_migrateBuffers(t,e){return e._buffers.forEach(((e,i)=>{t._buffers.get(i)!==e&&this._gl._bindBuffer(i,e)})),t._buffers.forEach(((t,i)=>{void 0===e._buffers.get(i)&&this._gl._bindBuffer(i,null)})),e._buffers.get(this._gl.ARRAY_BUFFER)!==t._buffers.get(this._gl.ARRAY_BUFFER)}_migrateFramebuffers(t,e){e._framebuffers.forEach(((e,i)=>{t._framebuffers.get(i)!==e&&this._gl._bindFramebuffer(i,e)})),t._framebuffers.forEach(((t,i)=>{void 0===e._framebuffers.get(i)&&this._gl._bindFramebuffer(i,null)}))}_migrateRenderbuffers(t,e){e._renderbuffers.forEach(((e,i)=>{t._renderbuffers.get(i)!==e&&this._gl._bindRenderbuffer(i,e)})),t._renderbuffers.forEach(((t,i)=>{void 0===e._renderbuffers.get(i)&&this._gl._bindRenderbuffer(i,null)}))}_migrateAttributes(t,e,i){i?e._vertexAttribs.forEach(((t,e)=>{t[0]&&this._gl._vertexAttribPointer(e,t[0],t[1],t[2],t[3],t[4]),t[5]&&this._gl._enableVertexAttribArray(e)})):(t._vertexAttribs.forEach(((t,i)=>{e._vertexAttribs[i]||this._gl._disableVertexAttribArray(i)})),e._vertexAttribs.forEach(((t,e)=>{this._gl._vertexAttribPointer(e,t[0],t[1],t[2],t[4]),t[5]?this._gl._enableVertexAttribArray(e):this._gl._disableVertexAttribArray(e)})))}_migrateSettings(t,e){const i=this.constructor.getDefaultSettings();t._settings.forEach(((t,r)=>{const s=r.name||r.xname;if(!e._settings.has(r)){let t=i.get(s);$t.isFunction(t)&&(t=t(this._gl)),e._settings.set(r,t),r.apply(this._gl,t)}})),e._settings.forEach(((e,i)=>{const r=t._settings.get(i);r&&$t.equalValues(r,e)||i.apply(this._gl,e)}))}_migrateFlags(t,e){t._nonDefaultFlags.forEach((t=>{e._nonDefaultFlags.has(t)||(this._getDefaultFlag(t)?this._gl._enable(t):this._gl._disable(t))})),e._nonDefaultFlags.forEach((e=>{t._nonDefaultFlags.has(e)||(this._getDefaultFlag(e)?this._gl._disable(e):this._gl._enable(e))}))}static getDefaultSettings(){if(!this._defaultSettings){this._defaultSettings=new Map;const t=this._defaultSettings,e=WebGLRenderingContext.prototype;t.set("viewport",(function(t){return[0,0,t.canvas.width,t.canvas.height]})),t.set("scissor",(function(t){return[0,0,t.canvas.width,t.canvas.height]})),t.set("blendColor",[0,0,0,0]),t.set("blendEquation",[e.FUNC_ADD]),t.set("blendEquationSeparate",[e.FUNC_ADD,e.FUNC_ADD]),t.set("blendFunc",[e.ONE,e.ZERO]),t.set("blendFuncSeparate",[e.ONE,e.ZERO,e.ONE,e.ZERO]),t.set("clearColor",[0,0,0,0]),t.set("clearDepth",[1]),t.set("clearStencil",[0]),t.set("colorMask",[!0,!0,!0,!0]),t.set("cullFace",[e.BACK]),t.set("depthFunc",[e.LESS]),t.set("depthMask",[!0]),t.set("depthRange",[0,1]),t.set("frontFace",[e.CCW]),t.set("lineWidth",[1]),t.set("polygonOffset",[0,0]),t.set("sampleCoverage",[1,!1]),t.set("stencilFunc",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFront",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateBack",[e.ALWAYS,0,1]),t.set("_stencilFuncSeparateFrontAndBack",[e.ALWAYS,0,1]),t.set("stencilMask",[1]),t.set("_stencilMaskSeparateFront",[1]),t.set("_stencilMaskSeparateBack",[1]),t.set("_stencilMaskSeparateFrontAndBack",[1]),t.set("stencilOp",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFront",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("_stencilOpSeparateFrontAndBack",[e.KEEP,e.KEEP,e.KEEP]),t.set("vertexAttrib1f",[]),t.set("vertexAttrib1fv",[]),t.set("vertexAttrib2f",[]),t.set("vertexAttrib2fv",[]),t.set("vertexAttrib3f",[]),t.set("vertexAttrib3fv",[]),t.set("vertexAttrib4f",[]),t.set("vertexAttrib4fv",[])}return this._defaultSettings}static _getTextureTargetIndex(t){switch(t){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+t)}}static _getTextureTargetByIndex(t){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[t]}static _getTextureIndex(t){return t-33984}static _getTextureByIndex(t){return t+33984}static _getPixelStoreiIndex(t){switch(t){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+t)}}static _getPixelStoreiByIndex(t){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[t]}static _getDefaultPixelStoreiByIndex(t){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[t]}}class Qt{_initStateManager(t="default"){this._states={},this._state=this._getState(t)}_getState(t){return this._states[t]||(this._states[t]=new qt(t,this)),this._states[t]}switchState(t="default"){if(this._state._id!==t){const e=this._getState(t);this._state.migrate(e),this._state=e}}$useProgram(t){this._state.setProgram(t)&&this._useProgram(t)}$bindBuffer(t,e){this._state.setBuffer(t,e)&&this._bindBuffer(t,e)}$bindFramebuffer(t,e){this._state.setFramebuffer(t,e)&&this._bindFramebuffer(t,e)}$bindRenderbuffer(t,e){this._state.setRenderbuffer(t,e)&&this._bindRenderbuffer(t,e)}$enable(t){this._state.setFlag(t,!0)&&this._enable(t)}$disable(t){this._state.setFlag(t,!1)&&this._disable(t)}$viewport(t,e,i,r){this._state.setSetting(this._viewport,[t,e,i,r])&&this._viewport(t,e,i,r)}$scissor(t,e,i,r){this._state.setSetting(this._scissor,[t,e,i,r])&&this._scissor(t,e,i,r)}$disableVertexAttribArray(t){this._state.disableVertexAttribArray(t)&&this._disableVertexAttribArray(t)}$enableVertexAttribArray(t){this._state.enableVertexAttribArray(t)&&this._enableVertexAttribArray(t)}$vertexAttribPointer(t,e,i,r,s,n){this._state.vertexAttribPointer(t,[e,i,r,s,n])&&this._vertexAttribPointer(t,e,i,r,s,n)}$activeTexture(t){this._state.setActiveTexture(t)&&this._activeTexture(t)}$bindTexture(t,e){this._state.bindTexture(t,e)&&this._bindTexture(t,e)}$pixelStorei(t,e){this._state.setPixelStorei(t,e)&&this._pixelStorei(t,e)}$stencilFuncSeparate(t,e,i,r){let s;switch(t){case this.FRONT:s=this._stencilFuncSeparateFront;break;case this.BACK:s=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:s=this._stencilFuncSeparateFrontAndBack}this._state.setSetting(s,[e,i,r])&&s.apply(this,[e,i,r])}_stencilFuncSeparateFront(t,e,i){this._stencilFuncSeparate(this.FRONT,t,e,i)}_stencilFuncSeparateBack(t,e,i){this._stencilFuncSeparate(this.BACK,t,e,i)}_stencilFuncSeparateFrontAndBack(t,e,i){this._stencilFuncSeparate(this.FRONT_AND_BACK,t,e,i)}$stencilMaskSeparate(t,e){let i;switch(t){case this.FRONT:i=this._stencilMaskSeparateFront;break;case this.BACK:i=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:i=this._stencilMaskSeparateFrontAndBack}this._state.setSetting(i,[e])&&i.apply(this,[e])}_stencilMaskSeparateFront(t){this._stencilMaskSeparate(this.FRONT,t)}_stencilMaskSeparateBack(t){this._stencilMaskSeparate(this.BACK,t)}_stencilMaskSeparateFrontAndBack(t){this._stencilMaskSeparate(this.FRONT_AND_BACK,t)}$stencilOpSeparate(t,e,i,r){let s;switch(t){case this.FRONT:s=this._stencilOpSeparateFront;break;case this.BACK:s=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:s=this._stencilOpSeparateFrontAndBack}this._state.setSetting(s,[e,i,r])&&s.apply(this,[e,i,r])}_stencilOpSeparateFront(t,e,i){this._stencilOpSeparate(this.FRONT,t,e,i)}_stencilOpSeparateBack(t,e,i){this._stencilOpSeparate(this.BACK,t,e,i)}_stencilOpSeparateFrontAndBack(t,e,i){this._stencilOpSeparate(this.FRONT_AND_BACK,t,e,i)}$blendColor(t,e,i,r){this._state.setSetting(this._blendColor,[t,e,i,r])&&this._blendColor(t,e,i,r)}$blendEquation(t){this._state.setSetting(this._blendEquation,[t])&&this._blendEquation(t)}$blendEquationSeparate(t,e){this._state.setSetting(this._blendEquationSeparate,[t,e])&&this._blendEquationSeparate(t,e)}$blendFunc(t,e){this._state.setSetting(this._blendFunc,[t,e])&&this._blendFunc(t,e)}$blendFuncSeparate(t,e,i,r){this._state.setSetting(this._blendFuncSeparate,[t,e,i,r])&&this._blendFuncSeparate(t,e,i,r)}$clearColor(t,e,i,r){this._state.setSetting(this._clearColor,[t,e,i,r])&&this._clearColor(t,e,i,r)}$clearDepth(t){this._state.setSetting(this._clearDepth,[t])&&this._clearDepth(t)}$clearStencil(t){this._state.setSetting(this._clearStencil,[t])&&this._clearStencil(t)}$colorMask(t,e,i,r){this._state.setSetting(this._colorMask,[t,e,i,r])&&this._colorMask(t,e,i,r)}$cullFace(t){this._state.setSetting(this._cullFace,[t])&&this._cullFace(t)}$depthFunc(t){this._state.setSetting(this._depthFunc,[t])&&this._depthFunc(t)}$depthMask(t){this._state.setSetting(this._depthMask,[t])&&this._depthMask(t)}$depthRange(t,e){this._state.setSetting(this._depthRange,[t,e])&&this._depthRange(t,e)}$frontFace(t){this._state.setSetting(this._frontFace,[t])&&this._frontFace(t)}$lineWidth(t){this._state.setSetting(this._lineWidth,[t])&&this._lineWidth(t)}$polygonOffset(t,e){this._state.setSetting(this._polygonOffset,[t,e])&&this._polygonOffset(t,e)}$sampleCoverage(t,e){this._state.setSetting(this._sampleCoverage,[t,e])&&this._sampleCoverage(t,e)}$stencilFunc(t,e,i){this._state.setSetting(this._stencilFunc,[t,e,i])&&this._stencilFunc(t,e,i)}$stencilMask(t){this._state.setSetting(this._stencilMask,[t])&&this._stencilMask(t)}$stencilOp(t,e,i){this._state.setSetting(this._stencilOp,[t,e,i])&&this._stencilOp(t,e,i)}$vertexAttrib1f(t,e){this._state.setSetting(this._vertexAttrib1f,[t,e])&&this._vertexAttrib1f(t,e)}$vertexAttrib1fv(t,e){this._state.setSetting(this._vertexAttrib1fv,[t,e])&&this._vertexAttrib1fv(t,e)}$vertexAttrib2f(t,e,i){this._state.setSetting(this._vertexAttrib2f,[t,e,i])&&this._vertexAttrib2f(t,e,i)}$vertexAttrib2fv(t,e){this._state.setSetting(this._vertexAttrib2fv,[t,e])&&this._vertexAttrib2fv(t,e)}$vertexAttrib3f(t,e,i,r){this._state.setSetting(this._vertexAttrib3f,[t,e,i,r])&&this._vertexAttrib3f(t,e,i,r)}$vertexAttrib3fv(t,e){this._state.setSetting(this._vertexAttrib3fv,[t,e])&&this._vertexAttrib3fv(t,e)}$vertexAttrib4f(t,e,i,r,s){this._state.setSetting(this._vertexAttrib4f,[t,e,i,r,s])&&this._vertexAttrib4f(t,e,i,r,s)}$vertexAttrib4fv(t,e){this._state.setSetting(this._vertexAttrib4fv,[t,e])&&this._vertexAttrib4fv(t,e)}static enable(t,e="default"){const i=Object.getOwnPropertyNames(Qt.prototype);return t.__proto__,i.forEach((e=>{if("constructor"!==e){const i=Qt.prototype[e];"$"===e.charAt(0)&&(e=e.substr(1)),t[e]!==i&&(t[e]&&(t[e].name||(t[e].xname=e),t["_"+e]=t[e]),t[e]=i)}})),Qt.prototype._initStateManager.call(t,e),t}}const Kt=Qt;class Zt{constructor(t){this.stage=t,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}get usedMemory(){return this._usedMemory}destroy(){for(let t=0,e=this._uploadedTextureSources.length;t<e;t++)this._nativeFreeTextureSource(this._uploadedTextureSources[t]);this.textureSourceHashmap.clear(),this._usedMemory=0}getReusableTextureSource(t){return this.textureSourceHashmap.get(t)}getTextureSource(t,e){let i=e?this.textureSourceHashmap.get(e):null;return i||(i=new it(this,t),e&&(i.lookupId=e,this.textureSourceHashmap.set(e,i))),i}uploadTextureSource(t,e){if(t.isLoaded())return;this._addMemoryUsage(t.w*t.h);const i=this._nativeUploadTextureSource(t,e);t._nativeTexture=i,i.w=t.w,i.h=t.h,i.update=this.stage.frameCounter,this._uploadedTextureSources.push(t),this.addToLookupMap(t)}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}addToLookupMap(t){const e=t.lookupId;e&&(this.textureSourceHashmap.has(e)||this.textureSourceHashmap.set(e,t))}gc(){this.freeUnusedTextureSources(),this._cleanupLookupMap()}freeUnusedTextureSources(){let t=[];for(let e=0,i=this._uploadedTextureSources.length;e<i;e++){let i=this._uploadedTextureSources[e];i.allowCleanup()?this._freeManagedTextureSource(i):t.push(i)}this._uploadedTextureSources=t,this._cleanupLookupMap()}_freeManagedTextureSource(t){t.isLoaded()&&(this._nativeFreeTextureSource(t),this._addMemoryUsage(-t.w*t.h)),t.loadingSince=null}_cleanupLookupMap(){this.textureSourceHashmap.forEach(((t,e)=>{t.isLoaded()||t.isLoading()||t.isUsed()||this.textureSourceHashmap.delete(e)}))}freeTextureSource(t){const e=this._uploadedTextureSources.indexOf(t),i=-1!==e;t.isLoaded()&&(i&&(this._addMemoryUsage(-t.w*t.h),this._uploadedTextureSources.splice(e,1)),this._nativeFreeTextureSource(t)),t.loadingSince=null}_nativeUploadTextureSource(t,e){return this.stage.renderer.uploadTextureSource(t,e)}_nativeFreeTextureSource(t){this.stage.renderer.freeTextureSource(t),t.clearNativeTexture()}}class Jt{constructor(t){this.stage=t,this.genericCancelCb=t=>{this._remove(t)},this._sources=[],this._data=[]}destroy(){this._sources=[],this._data=[]}processSome(){if(this._sources.length){const t=Date.now();do{this._processItem()}while(this._sources.length&&Date.now()-t<Jt.MAX_UPLOAD_TIME_PER_FRAME)}}_processItem(){const t=this._sources.pop(),e=this._data.pop();t.isLoading()&&t.processLoadedSource(e)}add(t,e){this._sources.push(t),this._data.push(e)}_remove(t){const e=this._sources.indexOf(t);e>=0&&(this._sources.splice(e,1),this._data.splice(e,1))}}Jt.MAX_UPLOAD_TIME_PER_FRAME=10;class te{constructor(t){this.stage=t,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[],this.renderToTextureCount=0}get usedMemory(){return this._usedMemory}destroy(){this._renderTexturePool.forEach((t=>this._freeRenderTexture(t))),this._usedMemory=0}hasRenderUpdates(){return!!this.root._parent._hasRenderUpdates}render(){this.root._parent._hasRenderUpdates=0,this._render()}update(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}_performForcedZSorts(){if(this._zSorts.length){for(let t=0,e=this._zSorts.length;t<e;t++)this._zSorts[t].zSort&&this._zSorts[t].sortZIndexedChildren();this._zSorts=[]}}_update(){this.updateTreeOrder=0,this.root.update()}_render(){const t=this.stage.getOption("debugFrame");this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")&&this._readPixels(),this._performRender(),t&&console.log(`[Lightning] RTT Renders in frame: ${this.renderToTextureCount}`),this.stage.getOption("readPixelsAfterDraw")&&this.renderToTextureCount>=this.stage.getOption("readPixelsAfterDrawThreshold")&&(t&&console.log("[Lightning] readPixelsAfterDraw behavior triggered"),this._readPixels()),this.renderToTextureCount=0}_readPixels(){const t=new Uint8Array(4),e=this.stage.gl;e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,t)}_fillRenderState(){this.renderState.reset(),this.root.render(),this.renderState.finish()}_performRender(){this.renderExec.execute()}_addMemoryUsage(t){this._usedMemory+=t,this.stage.addMemoryUsage(t)}allocateRenderTexture(t,e){let i=this.stage.getRenderPrecision(),r=Math.max(1,Math.round(t*i)),s=Math.max(1,Math.round(e*i));for(let t=this._renderTexturePool.length-1;t>=0;t--){const e=this._renderTexturePool[t];if(e.w===r&&e.h===s&&e.update!==this.stage.frameCounter)return e.f=this.stage.frameCounter,this._renderTexturePool.splice(t,1),e}const n=this._createRenderTexture(t,e,r,s);return n.precision=i,n}releaseRenderTexture(t){this._renderTexturePool.push(t)}freeUnusedRenderTextures(t=60){let e=this.stage.frameCounter-t;this._renderTexturePool=this._renderTexturePool.filter((t=>!(t.f<=e&&(this._freeRenderTexture(t),1))))}_createRenderTexture(t,e,i,r){this._addMemoryUsage(i*r);const s=this.stage.renderer.createRenderTexture(t,e,i,r);return s.id=this._renderTextureId++,s.f=this.stage.frameCounter,s.ow=t,s.oh=e,s.w=i,s.h=r,s}_freeRenderTexture(t){this.stage.renderer.freeRenderTexture(t),this._addMemoryUsage(-t.w*t.h)}copyRenderTexture(t,e,i){this.stage.renderer.copyRenderTexture(t,e,i)}forceZSort(t){this._zSorts.push(t)}}class ee{constructor(t){this.stage=t,this._timingFunction="ease",this._timingFunctionImpl=U.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}get timingFunction(){return this._timingFunction}set timingFunction(t){this._timingFunction=t,this._timingFunctionImpl=U.getTimingFunction(t)}get timingFunctionImpl(){return this._timingFunctionImpl}patch(t){H.patchObject(this,t)}}ee.prototype.isTransitionSettings=!0;class ie{constructor(t){this.stage=t,this.stage.on("frameStart",(()=>this.progress())),this.active=new Set,this.defaultTransitionSettings=new ee(this.stage)}progress(){if(this.active.size){let t=this.stage.dt,e=!1;this.active.forEach((function(i){i.progress(t),i.isRunning()||(e=!0)})),e&&(this.active=new Set([...this.active].filter((t=>t.isRunning()))))}}createSettings(t){const e=new ee;return H.patchObject(e,t),e}addActive(t){this.active.add(t)}removeActive(t){this.active.delete(t)}}class re{constructor(){this._clear()}_clear(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}parse(t,e){let i,r;W.isObjectLiteral(e)||(e={0:e});let s=.5,n=[];for(let t in e)if(e.hasOwnProperty(t)){let i=e[t];W.isObjectLiteral(i)||(i={v:i});let r=parseFloat(t);"sm"===t?s=i.v:!isNaN(r)&&r>=0&&r<=2&&(i.p=r,i.f=W.isFunction(i.v),i.lv=i.f?i.v(0,0):i.v,n.push(i))}for(n=n.sort((function(t,e){return t.p-e.p})),r=n.length,i=0;i<r;i++){let t=i===r-1;if(n[i].hasOwnProperty("pe")){const t=i<r-1?n[i+1].p:1;n[i].pe>t&&(n[i].pe=t)}else n[i].pe=t?n[i].p<=1?1:2:n[i+1].p;n[i].pe===n[i].p?n[i].idp=0:n[i].idp=1/(n[i].pe-n[i].p)}for(i=0;i<r;i++)if(n[i].hasOwnProperty("sm")||(n[i].sm=s),!n[i].hasOwnProperty("s"))if(0===i||i===r-1||1===n[i].p)n[i].s=t?[0,0,0,0]:0;else{const e=n[i-1],r=n[i+1];if(e.p===r.p)n[i].s=t?[0,0,0,0]:0;else if(t){const t=re.getRgbaComponents(r.lv),s=re.getRgbaComponents(e.lv),o=1/(r.p-e.p);n[i].s=[o*(t[0]-s[0]),o*(t[1]-s[1]),o*(t[2]-s[2]),o*(t[3]-s[3])]}else n[i].s=(r.lv-e.lv)/(r.p-e.p)}for(i=0;i<r-1;i++)if(!n[i].f){let e=i===r-1;n[i].hasOwnProperty("ve")||(n[i].ve=e?n[i].lv:n[i+1].lv),W.isNumber(n[i].v)&&W.isNumber(n[i].lv)&&(n[i].hasOwnProperty("sme")||(n[i].sme=e?s:n[i+1].sm),n[i].hasOwnProperty("se")||(n[i].se=e?t?[0,0,0,0]:0:n[i+1].s),n[i].v=t?re.getSplineRgbaValueFunction(n[i].v,n[i].ve,n[i].p,n[i].pe,n[i].sm,n[i].sme,n[i].s,n[i].se):re.getSplineValueFunction(n[i].v,n[i].ve,n[i].p,n[i].pe,n[i].sm,n[i].sme,n[i].s,n[i].se),n[i].f=!0)}for(this.length&&this._clear(),i=0,r=n.length;i<r;i++)this._add(n[i])}_add(t){this._p.push(t.p||0),this._pe.push(t.pe||0),this._idp.push(t.idp||0),this._f.push(t.f||!1),this._v.push(t.hasOwnProperty("v")?t.v:0),this._lv.push(t.lv||0),this._sm.push(t.sm||0),this._s.push(t.s||0),this._ve.push(t.ve||0),this._sme.push(t.sme||0),this._se.push(t.se||0),this._length++}_getItem(t){const e=this._length;if(!e)return-1;if(t<this._p[0])return 0;for(let i=0;i<e;i++)if(this._p[i]<=t&&t<this._pe[i])return i;return e-1}getValue(t){const e=this._getItem(t);if(-1!==e){if(this._f[e]){const i=Math.min(1,Math.max(0,(t-this._p[e])*this._idp[e]));return this._v[e](i)}return this._v[e]}}get length(){return this._length}static getRgbaComponents(t){return[(t/65536|0)%256,(t/256|0)%256,t%256,t/16777216|0]}static getSplineValueFunction(t,e,i,r,s,n,o,a){let h=r-i;o*=h,a*=h;let l=re.getSplineHelpers(t,e,s,n,o,a);return l?function(i){return 0===i?t:1===i?e:re.calculateSpline(l,i)}:function(i){return 0===i?t:1===i?e:e*i+t*(1-i)}}static getSplineRgbaValueFunction(t,e,i,r,s,n,o,a){let h=r-i;o[0]*=h,o[1]*=h,o[2]*=h,o[3]*=h,a[0]*=h,a[1]*=h,a[2]*=h,a[3]*=h;let l=re.getRgbaComponents(t),c=re.getRgbaComponents(e),u=[re.getSplineHelpers(l[0],c[0],s,n,o[0],a[0]),re.getSplineHelpers(l[1],c[1],s,n,o[1],a[1]),re.getSplineHelpers(l[2],c[2],s,n,o[2],a[2]),re.getSplineHelpers(l[3],c[3],s,n,o[3],a[3])];return u[0]?function(i){return 0===i?t:1===i?e:re.getArgbNumber([Math.min(255,re.calculateSpline(u[0],i)),Math.min(255,re.calculateSpline(u[1],i)),Math.min(255,re.calculateSpline(u[2],i)),Math.min(255,re.calculateSpline(u[3],i))])}:function(i){return 0===i?t:1===i?e:re.mergeColors(e,t,i)}}static getSplineHelpers(t,e,i,r,s,n){if(!i&&!r)return null;let o=t+s*i,a=1-r,h=e-n*r;return[3*i-3*a+1,-6*i+3*a,3*i,3*o-3*h+e-t,3*(h+t)-6*o,3*(o-t),t]}static calculateSpline(t,e){let i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],h=t[6];if(-2===i&&-2===n&&0===s&&0===a)return e;let l,c,u=.5;for(let t=0;t<20;t++){if(l=u*(u*(u*i+r)+s),c=e-l,c>-1e-8&&c<1e-8)return u*(u*(u*n+o)+a)+h;let t=u*(u*(3*i)+2*r)+s;if(t>1e-10&&t<1e-10)break;u+=c/t}let d=0,_=1;for(let t=0;t<20;t++){if(u=.5*(d+_),l=u*(u*(u*i+r)+s),c=e-l,c>-1e-8&&c<1e-8)return u*(u*(u*n+o)+a)+h;c<0?_=u:d=u}return u}static mergeColors(t,e,i){let r=(t/65536|0)%256*i+(e/65536|0)%256*(1-i),s=(t/256|0)%256*i+(e/256|0)%256*(1-i),n=t%256*i+e%256*(1-i),o=(t/16777216|0)*i+(e/16777216|0)*(1-i);return 16777216*Math.round(o)+65536*Math.round(r)+256*Math.round(s)+Math.round(n)}static getArgbNumber(t){t[0]=Math.max(0,Math.min(255,t[0])),t[1]=Math.max(0,Math.min(255,t[1])),t[2]=Math.max(0,Math.min(255,t[2])),t[3]=Math.max(0,Math.min(255,t[3]));let e=((0|t[3])<<24)+((0|t[0])<<16)+((0|t[1])<<8)+(0|t[2]);return e<0&&(e=4294967295+e+1),e}}class se{constructor(t){this.animationSettings=t,this._selector="",this._items=new re,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}getResetValue(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}apply(t,e,i){const r=this.getAnimatedElements(t);let s=this._items.getValue(e);if(void 0===s||!r.length)return;if(1!==i){let t=this.getResetValue();W.isNumber(s)&&W.isNumber(t)&&(s=this.hasColorProperty()?U.mergeColors(s,t,i):U.mergeNumbers(s,t,i))}const n=this._propSetters.length,o=r.length;for(let t=0;t<o;t++)for(let e=0;e<n;e++)this._propSetters[e](r[t],s)}getAnimatedElements(t){return t.select(this._selector)}reset(t){const e=this.getAnimatedElements(t);let i=this.getResetValue();if(void 0===i||!e.length)return;const r=this._propSetters.length,s=e.length;for(let t=0;t<s;t++)for(let s=0;s<r;s++)this._propSetters[s](e[t],i)}set selector(t){this._selector=t}set t(t){this.selector=t}get resetValue(){return this._resetValue}set resetValue(t){this._resetValue=t,this._hasResetValue=void 0!==t}set rv(t){this.resetValue=t}set value(t){this._items.parse(this.hasColorProperty(),t)}set v(t){this.value=t}set properties(t){Array.isArray(t)||(t=[t]),this._props=[],t.forEach((t=>{this._props.push(t),this._propSetters.push(mt.getSetter(t))}))}set property(t){this._hasColorProperty=void 0,this.properties=t}set p(t){this.properties=t}patch(t){H.patchObject(this,t)}hasColorProperty(){return void 0===this._hasColorProperty&&(this._hasColorProperty=!!this._props.length&&mt.isColorProperty(this._props[0])),this._hasColorProperty}}se.prototype.isAnimationActionSettings=!0;class ne{constructor(){this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=ne.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=U.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}get actions(){return this._actions}set actions(t){this._actions=[];for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i.isAnimationActionSettings)this._actions.push(i);else{const t=new se(this);t.patch(i),this._actions.push(t)}}}apply(t,e,i=1){this._actions.forEach((function(r){r.apply(t,e,i)}))}reset(t){this._actions.forEach((function(e){e.reset(t)}))}get stopTimingFunction(){return this._stopTimingFunction}set stopTimingFunction(t){this._stopTimingFunction=t,this._stopTimingFunctionImpl=U.getTimingFunction(t)}get stopTimingFunctionImpl(){return this._stopTimingFunctionImpl}patch(t){H.patchObject(this,t)}}ne.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};class oe extends ot{constructor(t,e,i){super(),this.manager=t,this._settings=e,this._element=i,this._state=oe.STATES.IDLE,this._p=0,this._delayLeft=0,this._repeatsLeft=0,this._stopDelayLeft=0,this._stopP=0}start(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=oe.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}play(){this._state===oe.STATES.PAUSED?(this._state=oe.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==oe.STATES.STOPPING&&this.settings.stopMethod==ne.STOP_METHODS.REVERSE?(this._state=oe.STATES.PLAYING,this.emit("stopContinue")):this._state!=oe.STATES.PLAYING&&this._state!=oe.STATES.FINISHED&&this.start()}pause(){this._state===oe.STATES.PLAYING&&(this._state=oe.STATES.PAUSED,this.emit("pause"))}replay(){this._state==oe.STATES.FINISHED?this.start():this.play()}skipDelay(){this._delayLeft=0,this._stopDelayLeft=0}finish(){this._state===oe.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===oe.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}stop(){this._state!==oe.STATES.STOPPED&&this._state!==oe.STATES.IDLE&&(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===ne.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=oe.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===ne.STOP_METHODS.FADE&&(this._stopP=0),this._state=oe.STATES.STOPPING,this.emit("stop")),this.checkActive())}stopNow(){this._state===oe.STATES.STOPPED&&this._state===oe.STATES.IDLE||(this._state=oe.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=oe.STATES.STOPPED,this.emit("stopFinish"))}isPaused(){return this._state===oe.STATES.PAUSED}isPlaying(){return this._state===oe.STATES.PLAYING}isStopping(){return this._state===oe.STATES.STOPPING}isFinished(){return this._state===oe.STATES.FINISHED}checkActive(){this.isActive()&&this.manager.addActive(this)}isActive(){return(this._state==oe.STATES.PLAYING||this._state==oe.STATES.STOPPING)&&this._element&&this._element.attached}progress(t){this._element&&(this._progress(t),this.apply())}_progress(t){if(this._state!=oe.STATES.STOPPING){if(this._state==oe.STATES.PLAYING){if(this._delayLeft>0){if(this._delayLeft-=t,!(this._delayLeft<0))return;t=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd")}0===this.settings.duration?this._p=1:this.settings.duration>0&&(this._p+=t/this.settings.duration),this._p>=1?-1==this.settings.repeat||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=oe.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}else this._stopProgress(t)}_stopProgress(t){let e=this._getStopDuration();if(this._stopDelayLeft>0){if(this._stopDelayLeft-=t,!(this._stopDelayLeft<0))return;t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd")}this.settings.stopMethod==ne.STOP_METHODS.IMMEDIATE?(this._state=oe.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==ne.STOP_METHODS.REVERSE?(0===e?this._p=0:e>0&&(this._p-=t/e),this._p<=0&&(this._p=0,this._state=oe.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==ne.STOP_METHODS.FADE?(this._progressStopTransition(t),this._stopP>=1&&(this._p=0,this._state=oe.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==ne.STOP_METHODS.ONETOTWO?this._p<2&&(0===e?this._p=2:e>0&&(this._p<1?this._p+=t/this.settings.duration:this._p+=t/e),this._p>=2?(this._p=2,this._state=oe.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==ne.STOP_METHODS.FORWARD&&this._p<1&&(0==this.settings.duration?this._p=1:this._p+=t/this.settings.duration,this._p>=1?this.settings.stopMethod==ne.STOP_METHODS.FORWARD?(this._p=1,this._state=oe.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=oe.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}_progressStopTransition(t){if(this._stopP<1){if(this._stopDelayLeft>0){if(this._stopDelayLeft-=t,!(this._stopDelayLeft<0))return;t=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd")}const e=this._getStopDuration();0==e?this._stopP=1:this._stopP+=t/e,this._stopP>=1&&(this._stopP=1)}}_getStopDuration(){return this.settings.stopDuration||this.settings.duration}apply(){if(this._state===oe.STATES.STOPPED)this.reset();else{let t=1;this._state===oe.STATES.STOPPING&&this.settings.stopMethod===ne.STOP_METHODS.FADE&&(t=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,t)}}reset(){this._settings.reset(this._element)}get state(){return this._state}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get frame(){return Math.round(this._p*this._settings.duration*60)}get settings(){return this._settings}}oe.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};class ae{constructor(t){this.stage=t,this.stage.on("frameStart",(()=>this.progress())),this.active=new Set}progress(){if(this.active.size){let t=this.stage.dt,e=!1;this.active.forEach((function(i){i.isActive()?i.progress(t):e=!0})),e&&(this.active=new Set([...this.active].filter((t=>t.isActive()))))}}createAnimation(t,e){return W.isObjectLiteral(e)&&(e=this.createSettings(e)),new oe(this,e,t)}createSettings(t){const e=new ne;return H.patchObject(e,t),e}addActive(t){this.active.add(t)}}class he extends ht{_getLookupId(){return"__whitepix"}_getSourceLoader(){return function(t){t(null,{source:new Uint8Array([255,255,255,255]),w:1,h:1,permanent:!0})}}isAutosizeTexture(){return!1}}class le extends ot{constructor(t={}){super(),this._setOptions(t),this._usedMemory=0,this._lastGcFrame=0;const e=le.platform?le.platform:class{static load(t){return t.platform?t.platform:Vt}}.load(t);this.platform=new e,this.platform.init&&this.platform.init(this),this.gl=null,this.c2d=null;const i=this.getOption("context");i?i.useProgram?this.gl=i:this.c2d=i:!W.isWeb||le.isWebglSupported()&&!this.getOption("canvas2d")?this.gl=this.platform.createWebGLContext(this.getOption("w"),this.getOption("h")):this.c2d=this.platform.createCanvasContext(this.getOption("w"),this.getOption("h")),this.gl&&Kt.enable(this.gl,"lightning"),this._mode=this.gl?0:1,this.getCanvas()&&(this._options.w=this.getCanvas().width,this._options.h=this.getCanvas().height),0===this._mode?W.isSpark?this._renderer=new Nt(this):this._renderer=new Ft(this):this._renderer=new Ht(this),this.setClearColor(this.getOption("clearColor")),this.frameCounter=0,this.transitions=new ie(this),this.animations=new ae(this),this.textureManager=new Zt(this),this.textureThrottler=new Jt(this),this.startTime=0,this.currentTime=0,this.dt=0,this.rectangleTexture=new he(this),this.rectangleTexture.load(),this.rectangleTexture.source.permanent=!0,this.ctx=new te(this),this._updateSourceTextures=new Set}get renderer(){return this._renderer}static isWebglSupported(){if(W.isNode)return!0;try{return!!window.WebGLRenderingContext}catch(t){return!1}}get mode(){return this._mode}isWebgl(){return 0===this.mode}isC2d(){return 1===this.mode}getOption(t){return this._options[t]}_setOptions(t){this._options={};let e=(e,i)=>{let r=t[e];this._options[e]=void 0===r?i:r};e("canvas",null),e("context",null),e("w",1920),e("h",1080),e("srcBasePath",null),e("memoryPressure",24e6),e("bufferMemory",2e6),e("textRenderIssueMargin",0),e("fontSharp",{precision:.6666666667,fontSize:24}),e("clearColor",[0,0,0,0]),e("defaultFontFace","sans-serif"),e("fixedDt",0),e("useImageWorker",!0),e("autostart",!0),e("precision",1),e("canvas2d",!1),e("platform",null),e("readPixelsBeforeDraw",!1),e("readPixelsAfterDraw",!1),e("readPixelsAfterDrawThreshold",0),e("debugFrame",!1),e("forceTxCanvasSource",!1),e("pauseRafLoopOnIdle",!1)}setApplication(t){this.application=t}init(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}destroy(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy()}stop(){this.platform.stopLoop()}resume(){this.platform.startLoop()}get root(){return this.application}getCanvas(){return this._mode?this.c2d.canvas:this.gl.canvas}getRenderPrecision(){return this._options.precision}addUpdateSourceTexture(t){this._updatingFrame?t._performUpdateSource():this._updateSourceTextures.add(t)}removeUpdateSourceTexture(t){this._updateSourceTextures&&this._updateSourceTextures.delete(t)}hasUpdateSourceTexture(t){return this._updateSourceTextures&&this._updateSourceTextures.has(t)}_performUpdateSource(){this._updateSourceTextures.size&&(this._updateSourceTextures.forEach((t=>{t._performUpdateSource()})),this._updateSourceTextures=new Set)}_calculateDt(){this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02}updateFrame(){this._calculateDt(),this.emit("frameStart"),this._performUpdateSource(),this.emit("update")}idleFrame(){this.textureThrottler.processSome(),this.emit("frameEnd"),this.frameCounter++}renderFrame(){const t=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),t&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(t),this.emit("frameEnd"),this.frameCounter++}isUpdatingFrame(){return this._updatingFrame}drawFrame(){this.updateFrame(),this.renderFrame()}forceRenderUpdate(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}setClearColor(t){this.forceRenderUpdate(),null===t?this._clearColor=null:Array.isArray(t)?this._clearColor=t:this._clearColor=U.getRgbaComponentsNormalized(t)}getClearColor(){return this._clearColor}createElement(t){return t?this.element(t):new mt(this)}createShader(t){return at.create(this,t)}element(t){if(t.isElement)return t;let e;return e=t.type?new t.type(this):new mt(this),e.patch(t),e}c(t){return this.element(t)}get w(){return this._options.w}get h(){return this._options.h}get coordsWidth(){return this.w/this._options.precision}get coordsHeight(){return this.h/this._options.precision}addMemoryUsage(t){this._usedMemory+=t,this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}get usedMemory(){return this._usedMemory}gc(t){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;const e=this._usedMemory;if(this.gcTextureMemory(t),this.gcRenderTextureMemory(t),this.renderer.gc(t),this.application.getOption("debug")){console.log(`[Lightning] GC${t?"[aggressive]":""}! Frame ${this._lastGcFrame} Freed ${((e-this._usedMemory)/1e6).toFixed(2)}MP from GPU memory. Remaining: ${(this._usedMemory/1e6).toFixed(2)}MP`);const i=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log(`[Lightning] Textures: ${(this.textureManager.usedMemory/1e6).toFixed(2)}MP, Render Textures: ${(this.ctx.usedMemory/1e6).toFixed(2)}MP, Renderer caches: ${(i/1e6).toFixed(2)}MP`)}}}gcTextureMemory(t=!1){t&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}gcRenderTextureMemory(t=!1){t&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}getDrawingCanvas(){return this.platform.getDrawingCanvas()}update(){this.ctx.update()}addServiceProvider(t){W.isSpark&&this.platform.addServiceProvider(t)}getChildrenByPosition(t,e){const i=[];return this.root.core.update(),this.root.core.collectAtCoord(t,e,i),i}}class ce extends St{constructor(t={},e){ce._temp_options=t,ce.booting=!0,super(new le(t.stage),e),ce.booting=!1,this.__updateFocusCounter=0,this.__keypressTimers=new Map,this.__hoveredChild=null,this.stage.init(),this.updateFocusSettings(),this.__keymap=this.getOption("keys"),this.__keymap&&(this.stage.platform.registerKeydownHandler((t=>{this._receiveKeydown(t)})),this.stage.platform.registerKeyupHandler((t=>{this._receiveKeyup(t)}))),this.getOption("enablePointer")&&(this.stage.platform.registerClickHandler((t=>{this._receiveClick(t)})),this.stage.platform.registerHoverHandler((t=>{this._receiveHover(t)})),this.stage.platform.registerScrollWheelHandler((t=>{this._recieveScrollWheel(t)})),this.cursor="default")}getOption(t){return this.__options[t]}_setOptions(t){this.__options={};let e=(e,i)=>{let r=t[e];this.__options[e]=void 0===r?i:r};e("debug",!1),e("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),e("enablePointer",!1)}__construct(){this.stage.setApplication(this),this._setOptions(ce._temp_options),delete ce._temp_options,super.__construct()}__init(){super.__init(),this.__updateFocus()}updateFocusPath(){this.__updateFocus()}__updateFocus(){const t=this.__updateFocusRec();!ce.booting&&t&&this.updateFocusSettings()}__updateFocusRec(){const t=++this.__updateFocusCounter;this.__updateFocusId=t;const e=this.__getFocusPath(),i=e[e.length-1],r=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(!r){this._focusPath=[];for(let r=0,s=e.length;r<s;r++)if(this._focusPath.push(e[r]),this._focusPath[r]._focus(i,void 0),this.__updateFocusId!==t)return!1;return!0}{let s,n=Math.min(this._focusPath.length,e.length);for(s=0;s<n&&this._focusPath[s]===e[s];s++);if(this._focusPath.length!==e.length||s!==e.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+i.getLocationString());for(let e=this._focusPath.length-1;e>=s;e--)if(this._focusPath.pop()._unfocus(i,r),this.__updateFocusId!==t)return!1;for(let n=s,o=e.length;n<o;n++)if(this._focusPath.push(e[n]),this._focusPath[n]._focus(i,r),this.__updateFocusId!==t)return!1;for(let t=0;t<s;t++)this._focusPath[t]._focusChange(i,r)}}return!0}updateFocusSettings(){const t=this._focusPath[this._focusPath.length-1],e={},i=St.prototype._setFocusSettings;for(let t=0,r=this._focusPath.length;t<r;t++)this._focusPath[t]._setFocusSettings!==i&&this._focusPath[t]._setFocusSettings(e);const r=St.prototype._handleFocusSettings;for(let i=0,s=this._focusPath.length;i<s;i++)this._focusPath[i]._handleFocusSettings!==r&&this._focusPath[i]._handleFocusSettings(e,this.__prevFocusSettings,t);this.__prevFocusSettings=e}_handleFocusSettings(t,e,i,r){}__getFocusPath(){const t=[this];let e=this;for(;;){const i=e._getFocused();if(!i||i===e)break;let r=i.cparent;if(r===e)t.push(i);else{const s=[i];do{r||e._throwError("Return value for _getFocused must be an attached descendant component but its '"+i.getLocationString()+"'"),s.push(r),r=r.cparent}while(r!==e);for(let e=0,i=s.length;e<i;e++)t.push(s[i-e-1])}e=i}return t}get focusPath(){return this._focusPath}focusTopDownEvent(t,...e){const i=this.focusPath,r=i.length;for(let s=0;s<r;s++){const r=i[s]._getMostSpecificHandledMember(t);if(void 0!==r&&!1!==i[s][r](...e))return!0}return!1}focusBottomUpEvent(t,...e){const i=this.focusPath;for(let r=i.length-1;r>=0;r--){const s=i[r]._getMostSpecificHandledMember(t);if(void 0!==s&&!1!==i[r][s](...e))return!0}return!1}_receiveKeydown(t){const e=t,i=this.__keymap[t.keyCode],r=this.focusPath;let s;if(i&&(s=Array.isArray(i)?i:[i]),s)for(let t=0,i=s.length;t<i;t++){const i=this.__keypressTimers.has(s[t]);if(r[r.length-1].longpress&&i)return;this.stage.application.focusTopDownEvent([`_capture${s[t]}`,"_captureKey"],e)||this.stage.application.focusBottomUpEvent([`_handle${s[t]}`,"_handleKey"],e)}else this.stage.application.focusTopDownEvent(["_captureKey"],e)||this.stage.application.focusBottomUpEvent(["_handleKey"],e);this.updateFocusPath();const n=r[r.length-1];if(s&&n.longpress)for(let t=0,e=s.length;t<e;t++)this._startLongpressTimer(s[t],n)}_receiveKeyup(t){const e=t,i=this.__keymap[t.keyCode];let r;if(i&&(r=Array.isArray(i)?i:[i]),r)for(let t=0,i=r.length;t<i;t++)this.stage.application.focusTopDownEvent([`_capture${r[t]}Release`,"_captureKeyRelease"],e)||this.stage.application.focusBottomUpEvent([`_handle${r[t]}Release`,"_handleKeyRelease"],e);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],e)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],e);if(this.updateFocusPath(),r)for(let t=0,e=r.length;t<e;t++)this.__keypressTimers.has(r[t])&&(clearTimeout(this.__keypressTimers.get(r[t])),this.__keypressTimers.delete(r[t]))}_startLongpressTimer(t,e){const i=e.longpress,r=t.toLowerCase();if(i[r]){const s=i[r];W.isNumber(s)?this.__keypressTimers.set(t,setTimeout((()=>{this.stage.application.focusTopDownEvent([`_capture${t}Long`,"_captureKey"],{})||this.stage.application.focusBottomUpEvent([`_handle${t}Long`,"_handleKey"],{}),this.__keypressTimers.delete(t)}),s||500)):e._throwError("config value for longpress must be a number")}}_recieveScrollWheel(t){const e=t,{clientX:i,clientY:r}=e;i<=this.stage.w&&r<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",e)||this.fireBottomUpScrollWheelHandler("_handleScroll",e))}fireTopDownScrollWheelHandler(t,e){let i=this.stage.application.children,r=this._findChildren([],i).reverse(),s=r.length;for(;s--;){const i=r[s];if(i&&i[t])return i._captureScroll(e),!0}return!1}fireBottomUpScrollWheelHandler(t,e){const{clientX:i,clientY:r}=e;let s=this._getTargetChild(i,r);for(;null!==s;){if(s&&s[t])return s._handleScroll(e),!0;s=s.parent}return!1}_receiveClick(t){const e=t,{clientX:i,clientY:r}=e;i<=this.stage.w&&r<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(e)}fireBottomUpClickHandler(t){const{clientX:e,clientY:i}=t,r=this._getTargetChild(e,i);let s=r;for(;null!==s;){if(s&&s._handleClick){s._handleClick(r);break}s=s.parent}}_receiveHover(t){const e=t,{clientX:i,clientY:r}=e;i<=this.stage.w&&r<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(e)}fireBottomUpHoverHandler(t){const{clientX:e,clientY:i}=t,r=this._getTargetChild(e,i);if(r!==this.__hoveredChild){let t=new Set,e=new Set;if(r&&(e=new Set(r.getAncestors())),this.__hoveredChild){t=new Set(this.__hoveredChild.getAncestors());for(const i of[...t].filter((t=>!e.has(t)))){const t=St.getComponent(i);t._handleUnhover&&t._handleUnhover(i),i.parent&&i.parent.cursor&&(this.stage.getCanvas().style.cursor=i.parent.cursor)}}this.__hoveredChild=r;const i=[...e].filter((e=>!t.has(e)));for(const t of i){const e=St.getComponent(t);e._handleHover&&e._handleHover(t)}const s=i[0];if(s&&s.cursor&&(this.stage.getCanvas().style.cursor=s.cursor),0===i.length&&r){const t=St.getComponent(r);t._handleHover&&t._handleHover(r)}}}_getTargetChild(t,e){let i=this.stage.application.children,r=this._findChildren([],i),s=this._withinClickableRange(r,t,e);return s.sort(((t,e)=>t.zIndex>e.zIndex?1:t.zIndex<e.zIndex?-1:t.id>e.id?1:-1)),s.length?s.slice(-1)[0]:null}_findChildren(t,e){let i=e.length;for(;i--;){const r=e[i];r.__active&&r.collision&&(!0===r.collision&&t.push(r),r.hasChildren()&&this._findChildren(t,r.children))}return t}_withinClickableRange(t,e,i){let r=t.length;const s=[];for(;r--;){const n=t[r],o=this.stage.getRenderPrecision(),a=n.core._worldContext,h=a.px*o,l=a.py*o,c=n.finalW*a.ta*o,u=n.finalH*a.td*o;if(!(h>this.stage.w||l>this.stage.h)){if(n.parent.core._scissor){const t=n.parent.core._scissor.map((t=>t*o));if(!this._testCollision(e,i,...t))continue}this._testCollision(e,i,h,l,c,u)&&s.push(n)}}return s}_testCollision(t,e,i,r,s,n){return t>=i&&t<=i+s&&e>=r&&e<=r+n}destroy(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}_destroy(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){for(const t of this.__keypressTimers.values())clearTimeout(t);this.__keypressTimers.clear()}}getCanvas(){return this.stage.getCanvas()}}class ue extends ht{constructor(t){super(t),this._factory=void 0,this._lookupId=void 0}set content({factory:t,lookupId:e}){this._factory=t,this._lookupId=e,this._changed()}_getIsValid(){return!!this._factory}_getLookupId(){return this._lookupId}_getSourceLoader(){const t=this._factory;return e=>t(((t,i)=>{if(t)return e(t);e(null,this.stage.platform.getTextureOptionsForDrawingCanvas(i))}),this.stage)}}class de{static getCanvasTexture(t,e){return{type:ue,content:{factory:t,lookupId:e}}}static getRoundRect(t,e,i,r,s,n,o){Array.isArray(i)||(i=[i,i,i,i]);let a="rect"+[t,e,r,s,n?1:0,o].concat(i).join(",");return de.getCanvasTexture(((a,h)=>{W.isSpark?h.platform.createRoundRect(a,h,t,e,i,r,s,n,o):a(null,this.createRoundRect(h,t,e,i,r,s,n,o))}),a)}static createRoundRect(t,e,i,r,s,n,o,a){void 0===o&&(o=!0),void 0===s&&(s=0);let h=t.platform.getDrawingCanvas(),l=h.getContext("2d");l.imageSmoothingEnabled=!0,h.width=e+s+2,h.height=i+s+2,l.beginPath();let c=.5*s+1,u=.5*s+1;return l.moveTo(c+r[0],u),l.lineTo(c+e-r[1],u),l.arcTo(c+e,u,c+e,u+r[1],r[1]),l.lineTo(c+e,u+i-r[2]),l.arcTo(c+e,u+i,c+e-r[2],u+i,r[2]),l.lineTo(c+r[3],u+i),l.arcTo(c,u+i,c,u+i-r[3],r[3]),l.lineTo(c,u+r[0]),l.arcTo(c,u,c+r[0],u,r[0]),l.closePath(),o&&(W.isNumber(a)?l.fillStyle=U.getRgbaString(a):l.fillStyle="white",l.fill()),s&&(W.isNumber(n)?l.strokeStyle=U.getRgbaString(n):l.strokeStyle="white",l.lineWidth=s,l.stroke()),h}static getShadowRect(t,e,i=0,r=5,s=2*r){Array.isArray(i)||(i=[i,i,i,i]);let n="shadow"+[t,e,r,s].concat(i).join(",");return de.getCanvasTexture(((n,o)=>{W.isSpark?o.platform.createShadowRect(n,o,t,e,i,r,s):n(null,this.createShadowRect(o,t,e,i,r,s))}),n)}static createShadowRect(t,e,i,r,s,n){let o=t.platform.getDrawingCanvas(),a=o.getContext("2d");a.imageSmoothingEnabled=!0,o.width=e+2*n,o.height=i+2*n,a.globalAlpha=.01,a.fillRect(0,0,.01,.01),a.globalAlpha=1,a.shadowColor=U.getRgbaString(4294967295),a.fillStyle=U.getRgbaString(4294967295),a.shadowBlur=s,a.shadowOffsetX=e+10+n,a.shadowOffsetY=n,a.beginPath();const h=-(e+10);return a.moveTo(h+r[0],0),a.lineTo(h+e-r[1],0),a.arcTo(h+e,0,h+e,0+r[1],r[1]),a.lineTo(h+e,0+i-r[2]),a.arcTo(h+e,0+i,h+e-r[2],0+i,r[2]),a.lineTo(h+r[3],0+i),a.arcTo(h,0+i,h,0+i-r[3],r[3]),a.lineTo(h,0+r[0]),a.arcTo(h,0,h+r[0],0,r[0]),a.closePath(),a.fill(),o}static getSvgTexture(t,e,i){let r="svg"+[e,i,t].join(",");return de.getCanvasTexture(((r,s)=>{W.isSpark?s.platform.createSvg(r,s,t,e,i):this.createSvg(r,s,t,e,i)}),r)}static createSvg(t,e,i,r,s){let n=e.platform.getDrawingCanvas(),o=n.getContext("2d");o.imageSmoothingEnabled=!0;let a=new Image;a.onload=()=>{n.width=r,n.height=s,o.drawImage(a,0,0,n.width,n.height),t(null,n)},a.onError=e=>{t(e)},W.isPS4||(a.crossOrigin="Anonymous"),a.src=i}}class _e{static isMf(t){return W.isFunction(t)&&t.__mf}static mf(t){return t.__mf=!0,t}static merge(t,e){const i=Object.keys(t),r=Object.keys(e);if(!r.length)return t;const s={},n={};for(let t=0,e=r.length;t<e;t++){const e=r[t];s[e]=-1,n[e]=t}for(let t=0,e=i.length;t<e;t++){const e=i[t];s[e]=t,void 0===n[e]&&(n[e]=-1)}const o=i.length,a={};for(let o=0,h=r.length;o<h;o++){const h=r[o],l=s[h];let c=l;for(;--c>=0&&-1===n[i[c]];);for(;++c<l;){const e=i[c];a[e]=t[e]}const u=e[h],d=t[h];let _;_=this.isMf(u)?u(d):W.isObjectLiteral(d)&&W.isObjectLiteral(u)?_e.merge(d,u):u,void 0!==_&&(a[h]=_)}let h=o;for(;--h>=0&&-1===n[i[h]];);for(;++h<o;){const e=i[h];a[e]=t[e]}return a}}class ge extends pt{constructor(t){super(),this._target=t}onAdd(t,e){this._target.addAt(t,e)}onRemove(t,e){this._target.removeAt(e)}onSync(t,e,i){this._target._setByArray(i)}onSet(t,e){this._target.setAt(t,e)}onMove(t,e,i){this._target.setAt(t,i)}createItem(t){return this._target.createItem(t)}isItem(t){return this._target.isItem(t)}}class fe extends ge{constructor(t,e){super(t),this._wrap=e}wrap(t){let e=this._wrap(t);return t._wrapper=e,e}onAdd(t,e){t=this.wrap(t),super.onAdd(t,e)}onRemove(t,e){super.onRemove(t,e)}onSync(t,e,i){e.forEach((t=>this.wrap(t))),i=i.map((t=>t._wrapper)),super.onSync(t,e,i)}onSet(t,e){t=this.wrap(t),super.onSet(t,e)}onMove(t,e,i){super.onMove(t,e,i)}}class pe extends ht{_getLookupId(){return"__noise"}_getSourceLoader(){const t=this.stage.gl;return function(e){const i=new Uint8Array(65536);for(let t=0;t<65536;t+=4){const e=Math.floor(256*Math.random());i[t]=e,i[t+1]=e,i[t+2]=e,i[t+3]=255}const r={};t&&(r[t.TEXTURE_WRAP_S]=t.REPEAT,r[t.TEXTURE_WRAP_T]=t.REPEAT,r[t.TEXTURE_MIN_FILTER]=t.NEAREST,r[t.TEXTURE_MAG_FILTER]=t.NEAREST),e(null,{source:i,w:128,h:128,texParams:r})}}}class xe extends ht{constructor(t){super(t),this._htmlElement=void 0,this._scale=1}set htmlElement(t){this._htmlElement=t,this._changed()}get htmlElement(){return this._htmlElement}set scale(t){this._scale=t,this._changed()}get scale(){return this._scale}set html(t){if(t){const e=document.createElement("div");e.innerHTML="<div>"+t+"</div>",this.htmlElement=e.firstElementChild}else this.htmlElement=void 0}get html(){return this._htmlElement.innerHTML}_getIsValid(){return this.htmlElement}_getLookupId(){return this._scale+":"+this._htmlElement.innerHTML}_getSourceLoader(){const t=this._htmlElement,e=this._scale;return function(i){if(!window.html2canvas)return i(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));const r=xe.getPreloadArea();r.appendChild(t),html2canvas(t,{backgroundColor:null,scale:e}).then((function(e){if(r.removeChild(t),0===e.height)return i(new Error("Canvas height is 0"));i(null,{source:e,width:e.width,height:e.height})})).catch((t=>{console.error("[Lightning]",t)}))}}static getPreloadArea(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}class me extends fe{constructor(t){super(t._wrapper._children,(t=>{let e=t.stage.createElement();return e.add(t),e.visible=!1,e})),this.list=t}onAdd(t,e){super.onAdd(t,e),this.checkStarted(e)}checkStarted(t){this.list._reloadVisibleElements=!0,this.list._started?(1===this.list.length?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}onRemove(t,e){super.onRemove(t,e);let i=this.list.realIndex;i===e?(i===this.list.length&&i--,i>=0&&this.list.setIndex(i)):i>e&&this.list.setIndex(i-1),this.list._reloadVisibleElements=!0}onSet(t,e){super.onSet(t,e),this.checkStarted(e)}onSync(t,e,i){super.onSync(t,e,i),this.checkStarted(0)}get _signalProxy(){return!0}}class ye extends It{constructor(t){super(t),this._direction=new Float32Array([1,0]),this._kernelRadius=1}get x(){return this._direction[0]}set x(t){this._direction[0]=t,this.redraw()}get y(){return this._direction[1]}set y(t){this._direction[1]=t,this.redraw()}get kernelRadius(){return this._kernelRadius}set kernelRadius(t){this._kernelRadius=t,this.redraw()}useDefault(){return 0===this._kernelRadius}setupUniforms(t){super.setupUniforms(t),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);const e=t.getRenderWidth(),i=t.getRenderHeight();this._setUniform("resolution",new Float32Array([e,i]),this.gl.uniform2fv)}}ye.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 resolution;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 direction;\n    uniform int kernelRadius;\n    \n    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n    }\n    \n    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3846153846) * direction;\n        vec2 off2 = vec2(3.2307692308) * direction;\n        color += texture2D(image, uv) * 0.2270270270;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n        return color;\n    }\n    \n    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.411764705882353) * direction;\n        vec2 off2 = vec2(3.2941176470588234) * direction;\n        vec2 off3 = vec2(5.176470588235294) * direction;\n        color += texture2D(image, uv) * 0.1964825501511404;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n        return color;\n    }    \n\n    void main(void){\n        if (kernelRadius == 1) {\n            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else if (kernelRadius == 2) {\n            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;\n        } else {\n            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;\n        }\n    }\n";class ve extends It{setupUniforms(t){super.setupUniforms(t);const e=1/t.getTextureWidth(0),i=1/t.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([e,i]),this.gl.uniform2fv)}}ve.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    uniform vec2 stepTextureCoord;\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec4 vColor;\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoordUl = aTextureCoord - stepTextureCoord;\n        vTextureCoordBr = aTextureCoord + stepTextureCoord;\n        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);\n        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ve.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoordUl;\n    varying vec2 vTextureCoordUr;\n    varying vec2 vTextureCoordBl;\n    varying vec2 vTextureCoordBr;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));\n        gl_FragColor = color * vColor;\n    }\n";class Se extends Dt{constructor(t){super(t),this._kernelRadius=1}get kernelRadius(){return this._kernelRadius}set kernelRadius(t){this._kernelRadius=t,this.redraw()}useDefault(){return 0===this._amount}_beforeDrawEl({target:t}){t.ctx.filter="blur("+this._kernelRadius+"px)"}_afterDrawEl({target:t}){t.ctx.filter="none"}}class Te extends St{static _template(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:Se},Content:{}}}}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._amount=0,this._paddingX=0,this._paddingY=0}static getSpline(){return this._multiSpline||(this._multiSpline=new re,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}get content(){return this.sel("Textwrap>Content")}set content(t){this.sel("Textwrap>Content").patch(t,!0)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,e=this.renderHeight,i=this._paddingX,r=this._paddingY;this._wrapper.x=i,this._textwrap.x=-i,this._wrapper.y=r,this._textwrap.y=-r,this._textwrap.w=t+2*i,this._textwrap.h=e+2*r}get amount(){return this._amount}set amount(t){this._amount=t,this._textwrap.shader.kernelRadius=Te._amountToKernelRadius(t)}static _amountToKernelRadius(t){return Te.getSpline().getValue(Math.min(1,.25*t))}get _signalProxy(){return!0}}class be extends St{static _template(){const t=function(t,e){if(130&e._recalc){const t=e.w,i=e.h;let r=e;do{r=r._children[0],r._element.w=t,r._element.h=i}while(r._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:ve}}},L1:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:ve}}},L2:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:ve}}},L3:{rtt:!0,onUpdate:t,renderOffscreen:!0,visible:!1,Content:{shader:{type:ve}}}},Result:{shader:{type:we},visible:!1}}}get _signalProxy(){return!0}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._layers=this.sel("Layers"),this._output=this.sel("Result"),this._amount=0,this._paddingX=0,this._paddingY=0}_buildLayers(){const t=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map((t=>at.create(this.stage,Object.assign({type:ye},t))));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[t[0],t[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[t[0],t[1],t[2],t[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[t[0],t[1],t[2],t[3]])}_setLayerTexture(t,e,i){if(i.length){const r=i.pop(),s=t.stage.c({rtt:!0,shader:r});this._setLayerTexture(s,e,i),t.childList.add(s)}else t.texture=e;return t}get content(){return this.sel("Textwrap>Content")}set content(t){this.sel("Textwrap>Content").patch(t,!0)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}getLayer(t){return this._layers.sel("L"+t)}getLayerContents(t){return this.getLayer(t).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,e=this.renderHeight,i=this._paddingX,r=this._paddingY,s=t+2*i,n=e+2*r;this._textwrap.w=s,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=s/2,this.getLayer(1).w=this.getLayerContents(1).w=s/4,this.getLayer(2).w=this.getLayerContents(2).w=s/8,this.getLayer(3).w=this.getLayerContents(3).w=s/16,this._output.x=-i,this._textwrap.x=-i,this._output.w=s,this._textwrap.h=n,this._wrapper.y=r,this.getLayer(0).h=this.getLayerContents(0).h=n/2,this.getLayer(1).h=this.getLayerContents(1).h=n/4,this.getLayer(2).h=this.getLayerContents(2).h=n/8,this.getLayer(3).h=this.getLayerContents(3).h=n/16,this._output.y=-r,this._textwrap.y=-r,this._output.h=n,this.w=t,this.h=e}set amount(t){this._amount=t,this._update()}get amount(){return this._amount}_update(){let t=Math.min(4,Math.max(0,this._amount));0===t?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3,t<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=t):t<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=t-1):t<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=t-2):t<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=t-3))}set shader(t){super.shader=t,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._buildLayers()}}class we extends It{constructor(t){super(t),this._a=0,this._otherTextureSource=null}get a(){return this._a}set a(t){this._a=t,this.redraw()}set otherTextureSource(t){this._otherTextureSource=t,this.redraw()}setupUniforms(t){super.setupUniforms(t),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}beforeDraw(t){let e=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,i=this.gl;i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,e),i.activeTexture(i.TEXTURE0)}}we.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uSampler2;\n    uniform float a;\n    void main(void){\n        if (a == 1.0) {\n            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;\n        } else {\n            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;\n        }\n    }\n";class Ce extends It{}Ce.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float m = max(max(color.r, color.g), color.b);\n        float c = max(0.0, (m - 0.80)) * 5.0;\n        color = color * c;\n        gl_FragColor = color;\n    }\n";class Ae extends St{static _template(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:Ae._updateDimensions,Content:{}},Scale:{visible:!1}}}constructor(t){super(t),this._smoothScale=1,this._iterations=0}get content(){return this.tag("Content")}set content(t){this.tag("Content").patch(t,!0)}get smoothScale(){return this._smoothScale}set smoothScale(t){if(this._smoothScale!==t){let e=0;for(;t<.5&&e<12;)e++,t*=2;this.scale=t,this._setIterations(e),this._smoothScale=t}}_setIterations(t){if(this._iterations!==t){const e=this.sel("Scale").childList,i=this.sel("ContentWrap");for(;e.length<t;){const t=0===e.length?i.getTexture():e.last.getTexture();e.a({rtt:!0,renderOffscreen:!0,texture:t})}Ae._updateDimensions(this.tag("ContentWrap"),!0);const r=t>0;this.patch({ContentWrap:{renderToTexture:r},Scale:{visible:r}});for(let i=0,r=e.length;i<r;i++)e.getAt(i).patch({visible:i<t,renderOffscreen:i!==t-1});this._iterations=t}}static _updateDimensions(t,e){const i=t.children[0];let r=i.renderWidth,s=i.renderHeight;if(r!==t.w||s!==t.h||e){t.w=r,t.h=s;const e=t.parent.tag("Scale").children;for(let t=0,i=e.length;t<i;t++)r*=.5,s*=.5,e[t].w=r,e[t].h=s}}get _signalProxy(){return!0}}class Re extends It{constructor(t){super(t),this._amount=1}static getC2d(){return Ee}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return 0===this._amount}setupUniforms(t){super.setupUniforms(t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}Re.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;\n        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);\n    }\n";class Ee extends Dt{constructor(t){super(t),this._amount=1}static getWebGL(){return Re}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return 0===this._amount}_beforeDrawEl({target:t}){t.ctx.filter="grayscale("+this._amount+")"}_afterDrawEl({target:t}){t.ctx.filter="none"}}class Le extends It{constructor(t){super(t),this._noiseTexture=new pe(t.stage),this._graining=1/256,this._random=!1}set graining(t){this._graining=t,this.redraw()}set random(t){this._random=t,this.redraw()}setExtraAttribsInBuffer(t){this._noiseTexture.load();let e=t.extraAttribsDataByteOffset/4,i=t.quads.floats,r=t.length;for(let s=0;s<r;s++){let r=t.getElementWidth(s)/this._noiseTexture.getRenderWidth(),n=t.getElementHeight(s)/this._noiseTexture.getRenderHeight(),o=0,a=0;if(this._random){if(o=Math.random(),a=Math.random(),r+=o,n+=a,Math.random()<.5){const t=o;o=r,r=t}if(Math.random()<.5){const t=a;a=n,n=t}}i[e]=o,i[e+1]=a,i[e+2]=r,i[e+3]=a,i[e+4]=r,i[e+5]=n,i[e+6]=o,i[e+7]=n,e+=8}}beforeDraw(t){let e=this.gl;e.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t));let i=this._noiseTexture.source.nativeTexture;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i),e.activeTexture(e.TEXTURE0)}getExtraAttribBytesPerVertex(){return 8}setupUniforms(t){super.setupUniforms(t),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}useDefault(){return 0===this._graining}afterDraw(t){this._random&&this.redraw()}}Le.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec2 aNoiseTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vNoiseTextureCoord = aNoiseTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Le.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 vNoiseTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform sampler2D uNoiseSampler;\n    uniform float graining;\n    void main(void){\n        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);\n    }\n";class Pe extends It{constructor(t){super(t),this._inputValue=0,this._maxDerivative=.01,this._normalizedValue=0,this._offset=0,this._amount=.1,this._aspectRatio=1,this._offsetX=0,this._offsetY=0,this.buckets=100}get aspectRatio(){return this._aspectRatio}set aspectRatio(t){this._aspectRatio=t,this.redraw()}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t,this.redraw()}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t,this.redraw()}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}set inputValue(t){this._inputValue=t}get inputValue(){return this._inputValue}set maxDerivative(t){this._maxDerivative=t}get maxDerivative(){return this._maxDerivative}set buckets(t){t>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),t=100),this._buckets=t,this._values=new Uint8Array(this._getValues(t)),this.redraw()}get buckets(){return this._buckets}_getValues(t){const e=[];for(let i=0;i<t;i++)e.push(this._inputValue);return e}progress(t){this._offset+=t*this._buckets;const e=Math.floor(this._offset);this._offset-=e,this._shiftBuckets(e),this.redraw()}_shiftBuckets(t){for(let e=this._buckets-1;e>=0;e--){const i=e-t;i<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[e]=255*this._normalizedValue):this._values[e]=this._values[i]}}set offset(t){this._offset=t,this.redraw()}setupUniforms(t){super.setupUniforms(t),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}useDefault(){return 0===this._amount}beforeDraw(t){const e=this.gl;e.activeTexture(e.TEXTURE1),this._valuesTexture?e.bindTexture(e.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._valuesTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),W.isNode&&e.pixelStorei(e.UNPACK_FLIP_BLUE_RED,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this._buckets,1,0,e.ALPHA,e.UNSIGNED_BYTE,this._values),e.activeTexture(e.TEXTURE0)}cleanup(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}Pe.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    uniform float offsetX;\n    uniform float offsetY;\n    uniform float aspectRatio;\n    varying vec2 vTextureCoord;\n    varying vec2 vPos;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vPos = vTextureCoord * 2.0 - 1.0;\n        vPos.y = vPos.y * aspectRatio;\n        vPos.y = vPos.y + offsetY;\n        vPos.x = vPos.x + offsetX;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Pe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vPos;\n    uniform float amount;\n    uniform float offset;\n    uniform float values[100];\n    uniform float buckets;\n    uniform sampler2D uSampler;\n    uniform sampler2D uValueSampler;\n    void main(void){\n        float l = length(vPos);\n        float m = (l * buckets * 0.678 - offset) / buckets;\n        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;\n        vec2 unit = vPos / l;\n        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;\n    }\n";class Ie extends It{constructor(t){super(t),this._amount=1}set amount(t){this._amount=t,this.redraw()}get amount(){return this._amount}useDefault(){return 0===this._amount}setupUniforms(t){super.setupUniforms(t),this._setUniform("amount",this._amount,this.gl.uniform1f)}}Ie.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float amount;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); \n        gl_FragColor = color * vColor;\n    }\n";class Oe extends It{constructor(t){super(t),this._width=5,this._col=4294967295,this._color=[1,1,1,1]}set width(t){this._width=t,this.redraw()}get color(){return this._col}set color(t){if(this._col!==t){const e=U.getRgbaComponentsNormalized(t);e[0]=e[0]*e[3],e[1]=e[1]*e[3],e[2]=e[2]*e[3],this._color=e,this.redraw(),this._col=t}}useDefault(){return 0===this._width||0===this._col[3]}setupUniforms(t){super.setupUniforms(t);let e=this.gl;this._setUniform("color",new Float32Array(this._color),e.uniform4fv)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}setExtraAttribsInBuffer(t){let e=t.extraAttribsDataByteOffset/4,i=t.quads.floats,r=t.length;for(let s=0;s<r;s++){const r=t.getElementCore(s),n=this._width/r.w,o=n/(1-2*n),a=this._width/r.h,h=a/(1-2*a);i[e]=-o,i[e+1]=-h,i[e+2]=1+o,i[e+3]=-h,i[e+4]=1+o,i[e+5]=1+h,i[e+6]=-o,i[e+7]=1+h,e+=8}}beforeDraw(t){let e=this.gl;e.vertexAttribPointer(this._attrib("aCorner"),2,e.FLOAT,!1,8,this.getVertexAttribPointerOffset(t))}getExtraAttribBytesPerVertex(){return 8}}Oe.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aCorner;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec2 vCorner;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vCorner = aCorner;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Oe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vCorner;\n    uniform vec4 color;\n    uniform sampler2D uSampler;\n    void main(void){\n        vec2 m = min(vCorner, 1.0 - vCorner);\n        float value = step(0.0, min(m.x, m.y));\n        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);\n    }\n";class Fe extends It{constructor(t){super(t),this._size=new Float32Array([4,4])}get x(){return this._size[0]}set x(t){this._size[0]=t,this.redraw()}get y(){return this._size[1]}set y(t){this._size[1]=t,this.redraw()}get size(){return this._size[0]}set size(t){this._size[0]=t,this._size[1]=t,this.redraw()}useDefault(){return 0===this._size[0]&&0===this._size[1]}static getWebGLImpl(){return WebGLPixelateShaderImpl}setupUniforms(t){super.setupUniforms(t);let e=this.gl;this._setUniform("size",new Float32Array(this._size),e.uniform2fv)}getExtraAttribBytesPerVertex(){return 8}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}setExtraAttribsInBuffer(t){let e=t.extraAttribsDataByteOffset/4,i=t.quads.floats,r=t.length;for(let s=0;s<r;s++){let r=t.quads.getTextureWidth(t.index+s),n=t.quads.getTextureHeight(t.index+s);i[e]=r,i[e+1]=n,i[e+2]=r,i[e+3]=n,i[e+4]=r,i[e+5]=n,i[e+6]=r,i[e+7]=n,e+=8}}beforeDraw(t){let e=this.gl;e.vertexAttribPointer(this._attrib("aTextureRes"),2,e.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(t))}}Fe.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    attribute vec2 aTextureRes;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        vTextureRes = aTextureRes;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",Fe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec2 vTextureRes;\n\n    uniform vec2 size;\n    uniform sampler2D uSampler;\n    \n    vec2 mapCoord( vec2 coord )\n    {\n        coord *= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 unmapCoord( vec2 coord )\n    {\n        coord /= vTextureRes.xy;\n        return coord;\n    }\n    \n    vec2 pixelate(vec2 coord, vec2 size)\n    {\n        return floor( coord / size ) * size;\n    }\n    \n    void main(void)\n    {\n        vec2 coord = mapCoord(vTextureCoord);\n        coord = pixelate(coord, size);\n        coord = unmapCoord(coord);\n        gl_FragColor = texture2D(uSampler, coord) * vColor;\n    }\n";class ke extends It{constructor(t){super(t),this._radius=0,this._cutoff=1}set radius(t){this._radius=t,this.redraw()}get radius(){return this._radius}set cutoff(t){this._cutoff=t,this.redraw()}get cutoff(){return this._cutoff}useDefault(){return 0===this._radius}setupUniforms(t){super.setupUniforms(t),this._setUniform("radius",2*(this._radius-.5)/t.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*t.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}ke.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 pos;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n        pos = gl_Position.xy;\n    }\n",ke.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec2 pos;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float radius;\n    uniform float cutoff;\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;\n    }\n";class ze extends It{constructor(t){super(t),this._blend=0,this._radius=[1,1,1,1],this._stroke=0,this._fc=16777215,this._fillColor=this._getNormalizedColor(4294967295),this._strokeColor=this._getNormalizedColor(16777215)}set blend(t){this._blend=Math.min(Math.max(t,0),1)}set radius(t){Array.isArray(t)?2===t.length?this._radius=[t[0],t[1],t[0],t[1]]:3===t.length?this._radius=[t[0],t[1],t[2],this._radius[3]]:4===t.length?this._radius=t:this._radius=[t[0],t[0],t[0],t[0]]:this._radius=[t,t,t,t],this.redraw()}get radius(){return this._radius}set topLeft(t){this._radius[0]=t,this.redraw()}get topLeft(){return this._radius[0]}set topRight(t){this._radius[1]=t,this.redraw()}get topRight(){return this._radius[1]}set bottomRight(t){this._radius[2]=t,this.redraw()}get bottomRight(){return this._radius[2]}set bottomLeft(t){this._radius[3]=t,this.redraw()}get bottomLeft(){return this._radius[4]}set strokeColor(t){this._sc=t,this._strokeColor=this._getNormalizedColor(t),this.redraw()}get strokeColor(){return this._sc}set fillColor(t){this._fc=t,this._fillColor=this._getNormalizedColor(t),this.redraw()}get fillColor(){return this._fc}set stroke(t){this._stroke=t,this.redraw()}get stroke(){return this._stroke}_getNormalizedColor(t){const e=U.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),r=this._radius.map((t=>(t+.5)*i));this._setUniform("radius",new Float32Array(r),this.gl.uniform4fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}}ze.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    void main(void){\n        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",ze.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n\n    #define PI 3.14159265359\n\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 radius;\n    uniform float stroke;\n    uniform vec4 strokeColor;\n    uniform vec4 fillColor;\n    uniform float alpha;\n    uniform float fill;\n    uniform float blend;\n    \n    float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    float innerBorderMask(float dist, float width){\n        float alpha1 = clamp(dist + width, 0.0, 1.0);\n        float alpha2 = clamp(dist, 0.0, 1.0);\n        return alpha1 - alpha2;\n    }\n\n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        float r = 0.0;\n        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[0];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {\n            r = radius[1];\n        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {\n            r = radius[2];\n        } else {\n            r = radius[3];\n        }\n        \n        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);\n        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;\n        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     \n        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));\n        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b, stroke));\n    }\n";class Me extends It{constructor(t){super(t),this._fade=[0,0,0,0]}set top(t){this._fade[0]=t,this.redraw()}get top(){return this._fade[0]}set right(t){this._fade[1]=t,this.redraw()}get right(){return this._fade[1]}set bottom(t){this._fade[2]=t,this.redraw()}get bottom(){return this._fade[2]}set left(t){this._fade[3]=t,this.redraw()}get left(){return this._fade[3]}set fade(t){Array.isArray(t)?2===t.length?this._fade=[t[0],t[1],t[0],t[1]]:3===t.length?this._fade=[t[0],t[1],t[2],this._fade[3]]:4===t.length?this._fade=t:this._fade=[t[0],t[0],t[0],t[0]]:this._fade=[t,t,t,t],this.redraw()}get fade(){return this._fade}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision(),r=this._fade.map((t=>t*i));this._setUniform("fade",new Float32Array(r),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}}Me.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 fade;\n    \n    void main() {\n        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 point = vTextureCoord.xy * resolution.xy;\n        \n        vec2 pos1;\n        vec2 pos2;\n        vec2 d;\n        float c;\n        float t = 0.0;\n             \n        if(fade[0] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x, point.y + fade[0]);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[1] > 0.0) {\n            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);\n            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[2] > 0.0) {\n            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);\n            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);\n            d = pos1 - pos2;\n            c = dot(pos2, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        if(fade[3] > 0.0) {\n            pos1 = vec2(point.x, point.y);\n            pos2 = vec2(point.x + fade[3], point.y);\n            d = pos2 - pos1;\n            c = dot(pos1, d) / dot(d, d);\n            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));\n            color = mix(vec4(0.0), color, t);\n        }\n        \n        gl_FragColor = color;\n    }\n";class Be extends It{constructor(t){super(t),this._magnitude=1.3,this._intensity=.7,this._pivot=[.5,.5]}setupUniforms(t){super.setupUniforms(t),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}set pivot(t){Array.isArray(t)?this._pivot=t:this._pivot=[t,t],this.redraw()}get pivotX(){return this._pivot[0]}set pivotX(t){this._pivot[0]=t,this.redraw()}get pivotY(){return this._pivot[1]}set pivotY(t){this._pivot[1]=t,this.redraw()}get intensity(){return this._intensity}set intensity(t){this._intensity=t,this.redraw()}get magnitude(){return this._magnitude}set magnitude(t){this._magnitude=t,this.redraw()}}Be.vertexShaderSource=It.vertexShaderSource,Be.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float magnitude;\n    uniform float intensity;\n    uniform vec2 pivot;\n\n    void main() {\n        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);\n        uv.x = clamp(uv.x, 0.0, 1.0);\n        uv.y = clamp(uv.y, 0.0, 1.0);\n   \n        uv *=  1.00 - uv.yx;\n        float vig = uv.x * uv.y * 25.0 * intensity;\n        vig = pow(vig, 0.45 * magnitude);\n        vec4 fragColor = vec4(vig) * vColor;\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;\n\n    }\n";class De extends It{constructor(t){super(t),this._radius=100,this._width=50,this._period=1,this._angle=.5,this._smooth=.005,this._color=4294967295,this._backgroundColor=4278190080,this._time=Date.now()}set radius(t){this._radius=t,this.redraw()}set width(t){this._width=t,this.redraw()}set period(t){this._period=t,this.redraw()}set angle(t){this._angle=t,this.redraw()}set smooth(t){this._smooth=t,this.redraw()}set color(t){this._color=t,this.redraw()}set backgroundColor(t){this._backgroundColor=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);const i=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*i,this.gl.uniform1f),this._setUniform("width",this._width*i,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(U.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(U.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv),this.redraw()}}De.vertexShaderSource=It.vertexShaderSource,De.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform float iTime;\n    uniform float radius;\n    uniform float width;\n    uniform float period;\n    uniform float angle;\n    uniform float smooth;\n    uniform vec2 resolution;\n\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n\n    float ratio = resolution.y / resolution.x;\n\n    vec2 transpose_pos(vec2 pos) {\n        if (ratio < 1.) {\n            float diff = 0.5 - pos.x;\n            pos.x = 0.5 - diff / ratio;\n        } else {\n            float diff = 0.5 - pos.y;\n            pos.y = 0.5 - diff * ratio;\n        }\n        return pos;\n    }\n\n    float get_angle(vec2 pos) {\n        pos = transpose_pos(pos);\n        float a = atan(pos.y - 0.5, pos.x - 0.5);\n        a = (1.0+a/3.14159)/2.0;\n        \n        return a;\n    }\n\n    float dist(vec2 pos1, vec2 pos2) {\n        pos1 = transpose_pos(pos1);\n        return distance(pos1, pos2);\n    }\n\n    void main()\n    {\n        vec2 fragCoord = vTextureCoord;\n        vec4 fragColor = vColor;\n        \n        vec2 st = vTextureCoord;\n        float pct = dist(st, vec2(0.5));\n\n        float a = get_angle(st);\n        float t = iTime / 1000.0 / period;\n\n        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);\n        float outer = max(radius / resolution.x, radius / resolution.y);\n\n        float x1 = mod(t, 1.0);\n        float x2 = mod(t + angle, 1.0);\n\n        if (x1 < x2) {\n            if (a > x1 && a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        } else {\n            if (a < x2) {\n                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else if (a > x1) {\n                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));\n                fragColor = mix(backgroundColor, color, val);\n            } else {\n                fragColor = backgroundColor;\n            }\n        }\n\n        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));\n        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;\n    }\n";class Ue extends It{constructor(t){super(t),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0}get x(){return this._x}set x(t){this._x=t,this.redraw()}get y(){return this._y}set y(t){this._y=t,this.redraw()}get w(){return this._w}set w(t){this._w=t,this.redraw()}get h(){return this._h}set h(t){this._h=t,this.redraw()}get radius(){return this._radius}set radius(t){this._radius=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}useDefault(){return 0===this._x&&0===this._y&&0===this._w&&0===this._h}}Ue.vertexShaderSource=It.vertexShaderSource,Ue.fragmentShaderSource="\n   #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform float x;\n    uniform float y;\n    uniform float w;\n    uniform float h;\n    uniform vec2 resolution;\n    uniform float radius;\n\n    float roundBox(vec2 p, vec2 b, float r) {\n        float d = length(max(abs(p)-b+r, 0.1))-r;\n        return smoothstep(1.0, 0.0, d);\n    }\n\n    void main(void){\n        vec4 color = texture2D(uSampler, vTextureCoord);\n        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n        vec2 size = vec2(w, h) / 2.0;\n        float b = roundBox(pos, size, radius);\n        gl_FragColor = mix(color, vec4(0.0), b);\n    }\n";class We extends It{constructor(t){super(t),this._pivot=[0,0],this._ic=4294967295,this._normalizedIC=this._getNormalizedColor(this._ic),this._oc=16777215,this._normalizedOC=this._getNormalizedColor(this._oc),this._radius=0}set radiusX(t){this.radius=t}get radiusX(){return this._radius}set radiusY(t){this._radiusY=t,this.redraw()}get radiusY(){return this._radiusY}set radius(t){this._radius=t,this.redraw()}set innerColor(t){this._ic=t,this._normalizedIC=this._getNormalizedColor(t),this.redraw()}get innerColor(){return this._ic}set outerColor(t){this._oc=t,this._normalizedOC=this._getNormalizedColor(t),this.redraw()}set color(t){this.innerColor=t}get color(){return this.innerColor}get outerColor(){return this._ic}set x(t){this._x=t,this.redraw()}set y(t){this._y=t,this.redraw()}set pivot(t){Array.isArray(t)&&2===t.length?this._pivot=t:Array.isArray(t)?this._pivot=[t[0],t[1]||t[0]]:this._pivot=[t,t],this.redraw()}get pivot(){return this._pivot[0]}set pivotY(t){this._pivot[1]=t,this.redraw()}get pivotY(){return this._pivot[1]}set pivotX(t){this._pivot[0]=t,this.redraw()}get pivotX(){return this._pivot[0]}_getNormalizedColor(t){const e=U.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner;this._x&&(this._pivot[0]=this._x/e.w),this._y&&(this._pivot[1]=this._y/e.h),0===this._radius&&(this._radius=.5*e.w),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",U.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}We.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec2 pivot;\n    uniform vec4 innerColor;\n    uniform vec4 outerColor;\n    uniform float radius;\n    uniform float radiusY;\n    uniform float alpha;\n    uniform float fill;\n    uniform float aspectRatio;\n    \n    void main() {\n        vec2 point = vTextureCoord.xy * resolution;\n        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);\n        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));\n        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);\n        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));\n    }\n";class He extends It{constructor(t){super(t),this._strength=.5,this._ambient=.5,this._fudge=.4,this._rx=0,this._ry=0,this._z=0,this._pivotX=NaN,this._pivotY=NaN,this._pivotZ=0,this._lightY=0,this._lightZ=0}setupUniforms(t){super.setupUniforms(t);let e=t.shaderOwner,i=e.element,r=isNaN(this._pivotX)?i.pivotX*e.w:this._pivotX,s=isNaN(this._pivotY)?i.pivotY*e.h:this._pivotY,n=e.getRenderTextureCoords(r,s),o=-Math.atan2(e._renderContext.tc,e._renderContext.ta),a=this.gl;this._setUniform("pivot",new Float32Array([n[0],n[1],this._pivotZ]),a.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,o]),a.uniform3fv),this._setUniform("z",this._z,a.uniform1f),this._setUniform("lightY",this.lightY,a.uniform1f),this._setUniform("lightZ",this.lightZ,a.uniform1f),this._setUniform("strength",this._strength,a.uniform1f),this._setUniform("ambient",this._ambient,a.uniform1f),this._setUniform("fudge",this._fudge,a.uniform1f)}set strength(t){this._strength=t,this.redraw()}get strength(){return this._strength}set ambient(t){this._ambient=t,this.redraw()}get ambient(){return this._ambient}set fudge(t){this._fudge=t,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(t){this._rx=t,this.redraw()}get ry(){return this._ry}set ry(t){this._ry=t,this.redraw()}get z(){return this._z}set z(t){this._z=t,this.redraw()}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX=t+1,this.redraw()}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY=t+1,this.redraw()}get lightY(){return this._lightY}set lightY(t){this._lightY=t,this.redraw()}get pivotZ(){return this._pivotZ}set pivotZ(t){this._pivotZ=t,this.redraw()}get lightZ(){return this._lightZ}set lightZ(t){this._lightZ=t,this.redraw()}useDefault(){return 0===this._rx&&0===this._ry&&0===this._z&&0===this._strength&&1===this._ambient}}He.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float fudge;\n    uniform float strength;\n    uniform float ambient;\n    uniform float z;\n    uniform float lightY;\n    uniform float lightZ;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Set depth perspective\n        float perspective = 1.0 + fudge * pos.z;\n\n        pos.z += lightZ * projection.x;\n\n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, perspective);\n\n        // Correct light source position.\n        pos.y += lightY * abs(projection.y);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",He.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec3 pos;\n    uniform sampler2D uSampler;\n    uniform float ambient;\n    uniform float strength;\n    void main(void){\n        vec4 rgba = texture2D(uSampler, vTextureCoord);\n        float d = length(pos);\n        float n = 1.0 / max(0.1, d);\n        rgba.rgb = rgba.rgb * (strength * n + ambient);\n        gl_FragColor = rgba * vColor;\n    }\n";class je extends It{constructor(t){super(t),this._fudge=.2,this._rx=0,this._ry=0,this._z=1}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=e.element,r=i.pivotX*e.w,s=i.pivotY*e.h,n=e.getRenderTextureCoords(r,s),o=-Math.atan2(e._renderContext.tc,e._renderContext.ta),a=this.gl;this._setUniform("pivot",new Float32Array([n[0],n[1],0]),a.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,o]),a.uniform3fv),this._setUniform("z",this._z,a.uniform1f),this._setUniform("fudge",this._fudge,a.uniform1f)}set fudge(t){this._fudge=t,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(t){this._rx=t,this.redraw()}get ry(){return this._ry}set ry(t){this._ry=t,this.redraw()}get z(){return this._z}set z(t){this._z=t,this.redraw()}useDefault(){return 0===this._rx&&0===this._ry&&0===this._z}}je.vertexShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    attribute vec2 aVertexPosition;\n    attribute vec2 aTextureCoord;\n    attribute vec4 aColor;\n    uniform vec2 projection;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n\n    uniform float z;\n    uniform vec3 pivot;\n    uniform vec3 rot;\n    varying vec3 pos;\n\n    void main(void) {\n        pos = vec3(aVertexPosition.xy, z);\n        \n        pos -= pivot;\n        \n        // Undo XY rotation\n        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), \n                           -sin(rot.z), cos(rot.z));\n        pos.xy = iRotXy * pos.xy;\n        \n        // Perform 3d rotations\n        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;\n        gl_Position.y = pos.y;\n        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;\n        \n        pos.x = gl_Position.x;\n        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;\n        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;\n        \n        // Redo XY rotation\n        iRotXy[0][1] = -iRotXy[0][1];\n        iRotXy[1][0] = -iRotXy[1][0];\n        pos.xy = iRotXy * pos.xy; \n\n        // Undo translate to pivot position\n        pos.xyz += pivot;\n\n        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);\n        \n        // Map coords to gl coordinate space.\n        // Set z to 0 because we don't want to perform z-clipping\n        gl_Position = vec4(pos.xy, 0.0, z);\n\n        vTextureCoord = aTextureCoord;\n        vColor = aColor;\n        \n        gl_Position.y = -sign(projection.y) * gl_Position.y;\n    }\n",je.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    uniform sampler2D uSampler;\n\n    uniform vec3 rot;\n    uniform float fudge;\n\n    void main(void) {\n        vec2 coords = vTextureCoord;\n\n        coords.xy -= vec2(0.5);\n        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;\n        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;\n        coords.xy += vec2(0.5);\n\n        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {\n            gl_FragColor = vec4(0.0);\n        } else {\n            gl_FragColor = texture2D(uSampler, coords) * vColor;\n        }\n    }\n";class Ne extends It{constructor(t){super(t),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0,this._magnification=.6}get x(){return this._x}set x(t){this._x=t,this.redraw()}get y(){return this._y}set y(t){this._y=t,this.redraw()}get w(){return this._w}set w(t){this._w=t,this.redraw()}get h(){return this._h}set h(t){this._h=t,this.redraw()}get magnification(){return this._magnification}set magnification(t){this._magnification=t,this.redraw()}get radius(){return this._radius}set radius(t){this._radius=t,this.redraw()}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([e._w*i,e._h*i]),this.gl.uniform2fv)}useDefault(){return 0===this._w&&0===this._h}}Ne.vertexShaderSource=It.vertexShaderSource,Ne.fragmentShaderSource="\n\t  #ifdef GL_ES\n\t\t# ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp float;\n\t\t# else\n\t\tprecision lowp float;\n\t\t# endif\n\t  #endif\n\n\t  varying vec2 vTextureCoord;\n\t  varying vec4 vColor;\n\t  uniform sampler2D uSampler;\n\t  uniform float x;\n\t  uniform float y;\n\t  uniform float w;\n\t  uniform float h;\n\t  uniform vec2 resolution;\n\t  uniform float radius;\n\t  uniform float magnification;\n  \n\t  float roundBox(vec2 p, vec2 b, float r) {\n\t\t  float d = length(max(abs(p)-b+r, 0.1))-r;\n\t\t  return smoothstep(1.0, 0.0, d);\n\t  }\n\n\t  float inside(vec2 v) {\n\t\tvec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);\n\t\treturn s.x * s.y;   \n      }\n  \n\t  void main(void) {\n\t\tvec4 color = texture2D(uSampler, vTextureCoord);\n\t\tvec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;\n\t\tvec2 size = vec2(w, h) / 2.0;\n\t\tfloat b = roundBox(pos, size, radius);\n\t\tvec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;\n\t\tgl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;\n\t  }\n  ";class Xe extends It{constructor(t){super(t),this._period=1,this._stroke=0,this._showDot=!0,this._clockwise=!0,this._bc=4278190080,this._normalizedBC=this._getNormalizedColor(this._bc),this._c=4294967295,this._normalizedC=this._getNormalizedColor(this._c)}set radius(t){0===t&&(t=1),this._radius=t}set stroke(t){this._stroke=Math.abs(t)}get stroke(){return this._stroke}set color(t){this._c=t,this._normalizedC=this._getNormalizedColor(t)}get color(){return this._c}set backgroundColor(t){this._bc=t,this._normalizedBC=this._getNormalizedColor(t)}get backgroundColor(){return this._sc}set showDot(t){this._showDot=t}get showDot(){return this._showDot}set clockwise(t){this._clockwise=t}get clockwise(){return this._clockwise}set period(t){this._period=t}get period(){return this._period}_getNormalizedColor(t){const e=U.getRgbaComponentsNormalized(t);return e[0]*=e[3],e[1]*=e[3],e[2]*=e[3],new Float32Array(e)}setupUniforms(t){super.setupUniforms(t);const e=t.shaderOwner,i=this._radius||e._w/2;0===this._stroke&&(this._stroke=.33*i),this._setUniform("resolution",new Float32Array([e._w,e._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",i,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-Xe.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",t.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._sc===this._bc&&this._stroke===.5*i||this.redraw()}}Xe.spinSync=Date.now(),Xe.fragmentShaderSource="\n    #ifdef GL_ES\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision lowp float;\n    # endif\n    #endif\n    \n    #define PI 3.14159265359\n    \n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    \n    uniform sampler2D uSampler;\n    uniform vec2 resolution;\n    uniform vec4 color;\n    uniform vec4 backgroundColor;\n    uniform float direction;\n    uniform float radius;\n    uniform float time;\n    uniform float stroke;\n    uniform float showDot;\n    uniform float period;\n    uniform float alpha;\n    \n    float circleDist(vec2 p, float radius){\n        return length(p) - radius;\n    }\n    \n    float fillMask(float dist){\n        return clamp(-dist, 0.0, 1.0);\n    }\n    \n    void main() {\n        vec2 halfRes = 0.5 * resolution.xy;\n        vec2 center = vTextureCoord.xy * resolution - halfRes;\n        \n        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));\n        float rot = -(time / 1000.0 / period) * 6.0 * direction;\n        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));\n        \n        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;\n        \n        float strokeRad = stroke * 0.5;\n        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);\n        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));\n        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);\n    }\n";const Ge={Application:ce,Component:St,Base:H,Utils:W,StageUtils:U,Element:mt,Tools:de,Stage:le,ElementCore:st,ElementTexturizer:rt,Texture:ht,EventEmitter:ot,shaders:{Grayscale:Re,BoxBlur:ve,Dithering:Le,CircularPush:Pe,Inversion:Ie,LinearBlur:ye,Outline:Oe,Pixelate:Fe,RadialFilter:ke,RoundedRectangle:ze,Spinner2:Xe,FadeOut:Me,Hole:Ue,Vignette:Be,Spinner:De,RadialGradient:We,Light3d:He,Perspective:je,Magnifier:Ne,WebGLShader:Pt,WebGLDefaultShader:It,C2dShader:Bt,C2dDefaultShader:Dt,c2d:{Grayscale:Ee,Blur:Se}},textures:{RectangleTexture:he,NoiseTexture:pe,TextTexture:dt,ImageTexture:lt,HtmlTexture:xe,StaticTexture:class extends ht{constructor(t,e){super(t),this._options=e}set options(t){this._options!==t&&(this._options=t,this._changed())}get options(){return this._options}_getIsValid(){return!!this._options}_getSourceLoader(){return t=>{t(null,this._options)}}},StaticCanvasTexture:ue,SourceTexture:gt},components:{FastBlurComponent:class extends St{static _template(){return{}}get wrap(){return this.tag("Wrap")}set content(t){return this.wrap.content=t}get content(){return this.wrap.content}set padding(t){this.wrap._paddingX=t,this.wrap._paddingY=t,this.wrap._updateBlurSize()}set paddingX(t){this.wrap._paddingX=t,this.wrap._updateBlurSize()}set paddingY(t){this.wrap._paddingY=t,this.wrap._updateBlurSize()}set amount(t){return this.wrap.amount=t}get amount(){return this.wrap.amount}_onResize(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}get _signalProxy(){return!0}_build(){this.patch({Wrap:{type:this.stage.gl?be:Te}})}},BloomComponent:class extends St{static _template(){const t=function(t,e){if(130&e._recalc){const t=e.w,i=e.h;let r=e;do{r=r._children[0],r._element.w=t,r._element.h=i}while(r._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:Ce},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:t,scale:2,pivot:0,visible:!1,Content:{shader:{type:ve}}},L1:{rtt:!0,onUpdate:t,scale:4,pivot:0,visible:!1,Content:{shader:{type:ve}}},L2:{rtt:!0,onUpdate:t,scale:8,pivot:0,visible:!1,Content:{shader:{type:ve}}},L3:{rtt:!0,onUpdate:t,scale:16,pivot:0,visible:!1,Content:{shader:{type:ve}}}}}}get _signalProxy(){return!0}constructor(t){super(t),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap.Content"),this._layers=this.sel("Layers"),this._amount=0,this._paddingX=0,this._paddingY=0}_build(){const t=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map((t=>this.stage.createShader(Object.assign({type:ye},t))));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[t[0],t[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[t[0],t[1],t[2],t[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[t[0],t[1],t[2],t[3]])}_setLayerTexture(t,e,i){if(i.length){const r=i.pop(),s=t.stage.c({rtt:!0,shader:r});this._setLayerTexture(s,e,i),t.childList.add(s)}else t.texture=e;return t}get content(){return this.sel("Textwrap.Content")}set content(t){this.sel("Textwrap.Content").patch(t)}set padding(t){this._paddingX=t,this._paddingY=t,this._updateBlurSize()}set paddingX(t){this._paddingX=t,this._updateBlurSize()}set paddingY(t){this._paddingY=t,this._updateBlurSize()}getLayer(t){return this._layers.sel("L"+t)}getLayerContents(t){return this.getLayer(t).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let t=this.renderWidth,e=this.renderHeight,i=this._paddingX,r=this._paddingY,s=t+2*i,n=e+2*r;this._textwrap.w=s,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=s/2,this.getLayer(1).w=this.getLayerContents(1).w=s/4,this.getLayer(2).w=this.getLayerContents(2).w=s/8,this.getLayer(3).w=this.getLayerContents(3).w=s/16,this._textwrap.x=-i,this._textwrap.h=n,this._wrapper.y=r,this.getLayer(0).h=this.getLayerContents(0).h=n/2,this.getLayer(1).h=this.getLayerContents(1).h=n/4,this.getLayer(2).h=this.getLayerContents(2).h=n/8,this.getLayer(3).h=this.getLayerContents(3).h=n/16,this._textwrap.y=-r,this.w=t,this.h=e}set amount(t){this._amount=t,this._update()}get amount(){return this._amount}_update(){let t=Math.min(4,Math.max(0,this._amount));t>0&&(this.getLayer(0).visible=t>0,this.getLayer(1).visible=t>1,this.getLayer(2).visible=t>2,this.getLayer(3).visible=t>3)}set shader(t){super.shader=t,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._build()}},SmoothScaleComponent:Ae,BorderComponent:class extends St{static _template(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}get _signalProxy(){return!0}constructor(t){super(t),this._borderTop=this.tag("Top"),this._borderRight=this.tag("Right"),this._borderBottom=this.tag("Bottom"),this._borderLeft=this.tag("Left"),this.onAfterUpdate=function(t){const e=t.childList.first;let i=t.core.w||e.renderWidth,r=t.core.h||e.renderHeight;t._borderTop.w=i,t._borderBottom.y=r,t._borderBottom.w=i,t._borderLeft.h=r+t._borderTop.h+t._borderBottom.h,t._borderLeft.y=-t._borderTop.h,t._borderRight.x=i,t._borderRight.h=r+t._borderTop.h+t._borderBottom.h,t._borderRight.y=-t._borderTop.h},this.borderWidth=1}get content(){return this.sel("Content")}set content(t){this.sel("Content").patch(t,!0)}get borderWidth(){return this.borderWidthTop}get borderWidthTop(){return this._borderTop.h}get borderWidthRight(){return this._borderRight.w}get borderWidthBottom(){return this._borderBottom.h}get borderWidthLeft(){return this._borderLeft.w}set borderWidth(t){this.borderWidthTop=t,this.borderWidthRight=t,this.borderWidthBottom=t,this.borderWidthLeft=t}set borderWidthTop(t){this._borderTop.h=t,this._borderTop.visible=t>0}set borderWidthRight(t){this._borderRight.w=t,this._borderRight.visible=t>0}set borderWidthBottom(t){this._borderBottom.h=t,this._borderBottom.visible=t>0}set borderWidthLeft(t){this._borderLeft.w=t,this._borderLeft.visible=t>0}get colorBorder(){return this.colorBorderTop}get colorBorderTop(){return this._borderTop.color}get colorBorderRight(){return this._borderRight.color}get colorBorderBottom(){return this._borderBottom.color}get colorBorderLeft(){return this._borderLeft.color}set colorBorder(t){this.colorBorderTop=t,this.colorBorderRight=t,this.colorBorderBottom=t,this.colorBorderLeft=t}set colorBorderTop(t){this._borderTop.color=t}set colorBorderRight(t){this._borderRight.color=t}set colorBorderBottom(t){this._borderBottom.color=t}set colorBorderLeft(t){this._borderLeft.color=t}get borderTop(){return this._borderTop}set borderTop(t){this.borderTop.patch(t)}get borderRight(){return this._borderRight}set borderRight(t){this.borderRight.patch(t)}get borderBottom(){return this._borderBottom}set borderBottom(t){this.borderBottom.patch(t)}get borderLeft(){return this._borderLeft}set borderLeft(t){this.borderLeft.patch(t)}set borders(t){this.borderTop=t,this.borderLeft=t,this.borderBottom=t,this.borderRight=t}},ListComponent:class extends St{constructor(t){super(t),this._wrapper=super._children.a({}),this._reloadVisibleElements=!1,this._visibleItems=new Set,this._index=0,this._started=!1,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._itemSize=100,this._viewportScrollOffset=0,this._itemScrollOffset=0,this._roll=!1,this._rollMin=0,this._rollMax=0,this._progressAnimation=null,this._invertDirection=!1,this._horizontal=!0,this.itemList=new me(this)}_allowChildrenAccess(){return!1}get items(){return this.itemList.get()}set items(t){this.itemList.patch(t)}start(){this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",(t=>this.update())),this.setIndex(0,!0,!0),this._started=!0,this.update()}setIndex(t,e=!1,i=!1){let r=this.length;if(!r)return;if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),i){let e=W.getModuloIndex(t,r)-W.getModuloIndex(this.index,r);e>.5*r?e-=r:e<-.5*r&&(e+=r),this._index+=e}else this._index=t;(this._roll||this.viewportSize>this._itemSize*r)&&(this._index=W.getModuloIndex(this._index,r));let s=this._horizontal^this._invertDirection?-1:1,n=s*this._index*this._itemSize;if(this._roll){let t,e,i;if(1==s)e=(r-1)*this._itemSize,i=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,e-=i,t=this.viewportSize-(this._itemSize+i),this._rollMin&&(t-=this._rollMin),this._rollMax&&(e+=this._rollMax),n=Math.max(Math.min(n,e),t);else{e=r*this._itemSize-this.viewportSize,i=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,e+=i;let t=i;this._rollMin&&(t-=this._rollMin),this._rollMax&&(e+=this._rollMax),n=Math.min(Math.max(-e,n),-t)}}this._scrollTransition.start(n),e&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}getAxisPosition(){let t=-this._scrollTransition._targetValue,e=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(e-t)}update(){if(!this._started)return;let t=this.length;if(!t)return;let e,i,r,s,n=this._horizontal^this._invertDirection?-1:1,o=this._horizontal?this._wrapper.x:this._wrapper.y,a=this.viewportSize,h=this._viewportScrollOffset*a-this._itemScrollOffset*this._itemSize;o+=h,-1==n?(e=Math.floor(-o/this._itemSize),r=1-(-o/this._itemSize-e),i=Math.floor((a-o)/this._itemSize),s=(a-o)/this._itemSize-i):(e=Math.ceil(o/this._itemSize),r=1+o/this._itemSize-e,i=Math.ceil((o-a)/this._itemSize),s=i-(o-a)/this._itemSize),(this._roll||a>this._itemSize*t)&&(i>=t&&(i=t-1,s=1),e>=t&&(e=t-1,r=1),i<=-1&&(i=0,s=1),e<=-1&&(e=0,r=1));let l,c=-n*e*this._itemSize;for(let o=e;-1==n?o<=i:o>=i;-1==n?o++:o--){let n=W.getModuloIndex(o,t),a=this.getElement(n);l=a.parent,this._visibleItems.delete(l),this._horizontal?l.x=c+h:l.y=c+h;let u=l.visible;if(l.visible=!0,u&&!this._reloadVisibleElements||this.emit("visible",o,n),this._progressAnimation){let t=1;o==e?t=r:o==i&&(t=s),this._progressAnimation.apply(a,t)}c+=this._itemSize}let u=this;this._visibleItems.forEach((function(t){t.visible=!1,u._visibleItems.delete(t)}));for(let r=e;-1==n?r<=i:r>=i;-1==n?r++:r--){let e=W.getModuloIndex(r,t);this._visibleItems.add(this.getWrapper(e))}this._reloadVisibleElements=!1}setPrevious(){this.setIndex(this._index-1)}setNext(){this.setIndex(this._index+1)}getWrapper(t){return this._wrapper.children[t]}getElement(t){let e=this._wrapper.children[t];return e?e.children[0]:null}reload(){this._reloadVisibleElements=!0,this.update()}get element(){let t=this._wrapper.children[this.realIndex];return t?t.children[0]:null}get length(){return this._wrapper.children.length}get property(){return this._horizontal?"x":"y"}get viewportSize(){return this._horizontal?this.w:this.h}get index(){return this._index}get realIndex(){return W.getModuloIndex(this._index,this.length)}get itemSize(){return this._itemSize}set itemSize(t){this._itemSize=t,this.update()}get viewportScrollOffset(){return this._viewportScrollOffset}set viewportScrollOffset(t){this._viewportScrollOffset=t,this.update()}get itemScrollOffset(){return this._itemScrollOffset}set itemScrollOffset(t){this._itemScrollOffset=t,this.update()}get scrollTransitionSettings(){return this._scrollTransitionSettings}set scrollTransitionSettings(t){this._scrollTransitionSettings.patch(t)}set scrollTransition(t){this._scrollTransitionSettings.patch(t)}get scrollTransition(){return this._scrollTransition}get progressAnimation(){return this._progressAnimation}set progressAnimation(t){W.isObjectLiteral(t)?this._progressAnimation=this.stage.animations.createSettings(t):this._progressAnimation=t,this.update()}get roll(){return this._roll}set roll(t){this._roll=t,this.update()}get rollMin(){return this._rollMin}set rollMin(t){this._rollMin=t,this.update()}get rollMax(){return this._rollMax}set rollMax(t){this._rollMax=t,this.update()}get invertDirection(){return this._invertDirection}set invertDirection(t){this._started||(this._invertDirection=t)}get horizontal(){return this._horizontal}set horizontal(t){t!==this._horizontal&&(this._started||(this._horizontal=t))}}},tools:{ObjMerger:_e,ObjectListProxy:ge,ObjectListWrapper:fe}};W.isWeb&&(window.lng=Ge);const Ye=Ge,Ve=Ye;Ve.Component;function $e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function qe(t,e){if(t){if("string"==typeof t)return $e(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?$e(t,e):void 0}}function Qe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,s,n=[],o=!0,a=!1;try{for(i=i.call(t);!(o=(r=i.next()).done)&&(n.push(r.value),!e||n.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{o||null==i.return||i.return()}finally{if(a)throw s}}return n}}(t,e)||qe(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ke=/\{\/(.*?)\/([igm]{0,3})\}/g,Ze=/^[!*$]$/,Je=/\/:\w+?@@([0-9]+?)@@/,ti=/^\/:/,ei=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"R";return Ke.test(t)&&(t=t.replace(Ke,e)),t};function ii(t){return function(t){if(Array.isArray(t))return $e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||qe(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ri=function(t){var e=new Map;return[].concat(ii(Object.keys(t)),ii(Object.getOwnPropertySymbols(t))).forEach((function(i){e.set(i,t[i])})),e},si=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;o(this,t),this._hash=e,this._storeCaller=r,this._register=new Map,this._isCreated=!1,this._isSharedInstance=!1,this._cancelled=!1,this._copiedHistoryState=null,Vr(i)?this._register=ri(i):$r(i)&&(this._storeCaller=i),this._register.set(ns.store,this._storeCaller)}return h(t,[{key:"cancel",value:function(){m("[router]:","cancelled ".concat(this._hash)),this._cancelled=!0}},{key:"url",get:function(){return this._hash}},{key:"register",get:function(){return this._register}},{key:"hash",get:function(){return this._hash},set:function(t){this._hash=t}},{key:"route",get:function(){return this._route},set:function(t){this._route=t}},{key:"provider",get:function(){return this._provider},set:function(t){this._provider=t}},{key:"providerType",get:function(){return this._providerType},set:function(t){this._providerType=t}},{key:"page",get:function(){return this._page},set:function(t){this._page=t}},{key:"isCreated",get:function(){return this._isCreated},set:function(t){this._isCreated=t}},{key:"isSharedInstance",get:function(){return this._isSharedInstance},set:function(t){this._isSharedInstance=t}},{key:"isCancelled",get:function(){return this._cancelled}},{key:"copiedHistoryState",get:function(){return this._copiedHistoryState},set:function(t){this._copiedHistoryState=t}}]),t}(),ni=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var i=["on","before","after"].reduce((function(t,i){return Yr(e[i])?i:t}),void 0);this._cfg=e,i&&(this._provider={type:i,request:e[i]})}return h(t,[{key:"path",get:function(){return this._cfg.path}},{key:"component",get:function(){return this._cfg.component}},{key:"options",get:function(){return this._cfg.options}},{key:"widgets",get:function(){return this._cfg.widgets}},{key:"cache",get:function(){return this._cfg.cache}},{key:"hook",get:function(){return this._cfg.hook}},{key:"beforeNavigate",get:function(){return this._cfg.beforeNavigate}},{key:"provider",get:function(){return this._provider}}]),t}();function oi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function ai(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?oi(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):oi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function hi(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return li(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?li(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}function li(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var ci=function(t){return ei(t).split("/").length},ui=function(t){t=t.replace(/^#/,"");var e=/(\/?:?[^/]+)/g,i=function(t){var e,i=[],r=hi(wr.entries());try{for(r.s();!(e=r.n()).done;){var s=Qe(e.value,1)[0];ci(s)===t&&i.push(s)}}catch(t){r.e(t)}finally{r.f()}return i}(ci(t)),r=t.match(e)||[],s=[],n=i.filter((function(t){var i=!0;if(Ke.test(t)){var n=t.match(Ke);n&&n.length&&(t=n.reduce((function(t,e){var i=s.length;return t=t.replace(e,"@@".concat(i,"@@")),s.push(e.substring(1,e.length-1)),t}),t))}for(var o=t.match(e)||[],a=0,h=o.length;a<h;a++){var l=o[a],c=r[a];if(Je.test(l)){var u=Je.exec(l)[1],d=s[u],_=/\/([^\/]+)\/([igm]{0,3})/.exec(d);if(_&&_.length){var g=_[1],f=_[2];new RegExp("^/".concat(g,"$"),f).test(c)||(i=!1)}}else{if(ti.test(l))continue;c&&l.toLowerCase()!==c.toLowerCase()&&(i=!1)}}return i}));if(n.length){if(-1!==n.indexOf(t)){var o=n[n.indexOf(t)];return wr.get(o)}if(n=n.sort((function(t){return ti.test(t)?-1:1})),Wr(n[0]))return wr.get(n[0])}return!1},di=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;e=ei(e,"");var i=/(\/?:?[\w%\s:.-]+)/g,r=t.match(i)||[],s=e.match(i)||[],n=/^\/:([\w-]+)\/?/;return s.reduce((function(t,e,i){var s=n.exec(e);return s&&s.length&&t.set(s[1],decodeURIComponent(r[i].replace(/^\//,""))),t}),new Map)},_i=function(t,e){if(t&&t.hasOwnProperty(e))return t[e]},gi=function(t,e,i){return new si(t,e,i)},fi=function(t){if(!t.to&&!t.name)return!1;var e=pi(t.to||t.name),i=e;return/\/:([\w-]+)\/?/.test(e)&&(t.params&&(i=Object.keys(t.params).reduce((function(e,i){return e.replace(":".concat(i),t.params[i])}),e)),t.query)?"".concat(i).concat(ss(t.query)):i},pi=function(t){var e,i=hi(wr.entries());try{for(i.s();!(e=i.n()).done;){var r=Qe(e.value,2),s=r[0];if(r[1].name===t)return s}}catch(t){i.e(t)}finally{i.f()}return!1};const xi=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Kr(e)||(e=[e]),e.forEach((function(e){var r="_on".concat(Zr(e));Yr(t[r])&&t[r](i)}))};var mi=null,yi=function(){if(ur)return ur.get().reduce((function(t,e){return t[e.ref.toLowerCase()]=e,t}),{})},vi=function(){mi=null,ar._setState("")},Si=function(){return mi},Ti=function(t){mi=t},bi=function(t,e){return t.c({type:e,visible:!1,widgets:yi()})},wi=[],Ci=function(t){var e=zr();if(e){var i=t.register.get(ns.store),r=ui(e),s=_i(r.options,"preventStorage");if($r(i)?i:!s){var n=e.replace(/^\//,""),o=Ai(n),a=Ri(Br(),t),h=Nr();if(-1===o||h.get("storeSameHash"))wi.push({hash:n,state:a});else{var l=wi.splice(o,1)[0];wi.push({hash:l.hash,state:a})}}}},Ai=function(t){for(var e=0;e<wi.length;e++)if(wi[e].hash===t)return e;return-1},Ri=function(t,e){if(e.isSharedInstance){if(e.copiedHistoryState)return e.copiedHistoryState}else if(t&&Yr(t.historyState))return t.historyState();return null},Ei=function(){return wi.slice(0)},Li=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Kr(t)&&(wi=t)};function Pi(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}function Ii(){return Ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=Pi(t,e);if(r){var s=Object.getOwnPropertyDescriptor(r,e);return s.get?s.get.call(arguments.length<3?t:i):s.value}},Ii.apply(this,arguments)}var Oi=i(996),Fi=i.n(Oi);function ki(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function zi(t,e,i){return zi=ki()?Reflect.construct:function(t,e,i){var r=[null];r.push.apply(r,e);var s=new(Function.bind.apply(t,r));return i&&z(s,i.prototype),s},zi.apply(null,arguments)}function Mi(t){var e="function"==typeof Map?new Map:void 0;return Mi=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return zi(t,arguments,D(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),z(r,t)},Mi(t)}var Bi=!1,Di=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==t&&!1!==Bi||console.warn(["The 'Locale'-plugin in the Lightning-SDK is deprecated and will be removed in future releases.","Please consider using the new 'Language'-plugin instead.","https://rdkcentral.github.io/Lightning-SDK/#/plugins/language"].join("\n\n")),Bi=!0},Ui=function(){function t(){o(this,t),this.__enabled=!1}var i;return h(t,[{key:"load",value:(i=e(n().mark((function t(e){var i=this;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.__enabled){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,fetch(e).then((function(t){return t.json()})).then((function(t){i.loadFromObject(t)}));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"setLanguage",value:function(t){Di(),this.__enabled=!0,this.language=t}},{key:"tr",get:function(){return Di(!0),this.__trObj[this.language]}},{key:"loadFromObject",value:function(t){Di();if(-1===Object.keys(t).indexOf(this.language)){if(v("No translations found for: "+this.language),!(Object.keys(t).indexOf("en")>-1)){var e="No translations found for fallback language: en";throw y(e),Error(e)}v("Using fallback language: en"),this.language="en"}this.__trObj=t;for(var i=0,r=Object.values(this.__trObj);i<r.length;i++)for(var s=r[i],n=0,o=Object.keys(s);n<o.length;n++){var a=o[n];s[a]=new Wi(s[a])}}}]),t}(),Wi=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"format",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.reduce((function(t,e,i){return t.split("{".concat(i,"}")).join(e)}),this);return new s(r)}}]),s}(Mi(String));const Hi=new Ui;var ji=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_firstActive",value:function(){this.tag("Text").text="APP - v".concat(this.version,"\nSDK - v").concat(this.sdkVersion),this.tag("Text").loadTexture(),this.w=this.tag("Text").renderWidth+40,this.h=this.tag("Text").renderHeight+5}}],[{key:"_template",value:function(){return{rect:!0,color:3137370284,h:40,w:100,x:function(t){return t-50},y:function(t){return t-50},mount:1,Text:{w:function(t){return t},h:function(t){return t},y:5,x:20,text:{fontSize:22,lineHeight:26}}}}}]),s}(Ve.Component);function Ni(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Xi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ni(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ni(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Gi=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_setup",value:function(){var t=this;this.config=Xi(Xi({},{log:!1,interval:500,threshold:1}),g("platform","showFps")),this.fps=0,this.lastFps=this.fps-this.config.threshold;var e=function(){t.fps=~~(1/t.stage.dt)};this.stage.on("frameStart",e),this.stage.off("framestart",e),this.interval=setInterval(this.showFps.bind(this),this.config.interval)}},{key:"_firstActive",value:function(){this.showFps()}},{key:"_detach",value:function(){clearInterval(this.interval)}},{key:"showFps",value:function(){if(!(Math.abs(this.lastFps-this.fps)<=this.config.threshold)){this.lastFps=this.fps;var t=4278222848;this.fps<=40&&this.fps>20?t=4294944e3:this.fps<=20&&(t=4294901760),this.tag("Background").setSmooth("color",t),this.tag("Counter").text="".concat(this.fps),this.config.log&&x("FPS",this.fps)}}}],[{key:"_template",value:function(){return{rect:!0,color:4294967295,texture:Ve.Tools.getRoundRect(80,80,40),h:80,w:80,x:100,y:100,mount:1,Background:{x:3,y:3,texture:Ve.Tools.getRoundRect(72,72,36),color:4278222848},Counter:{w:function(t){return t},h:function(t){return t},y:10,text:{fontSize:32,textAlign:"center"}},Text:{w:function(t){return t},h:function(t){return t},y:48,text:{fontSize:15,textAlign:"center",text:"FPS"}}}}}]),s}(Ve.Component);function Yi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}var Vi={},$i={},qi=null,Qi=function(t){"meta"in t&&(Vi=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Yi(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Yi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t.meta),delete t.meta),$i=t},Ki=function(t){return qi=null,new Promise((function(e,i){if(t in $i)qi=t;else if("map"in Vi&&t in Vi.map&&Vi.map[t]in $i)qi=Vi.map[t];else if("default"in Vi&&Vi.default in $i){var r="Translations for Language "+qi+" not found. Using default language "+Vi.default;v(r),qi=Vi.default}else{var s="Translations for Language "+qi+" not found.";y(s),i(s)}if(qi){x("Setting language to",qi);var n=$i[qi];if("object"===l(n))e();else if("string"==typeof n){var o=O(n);fetch(o).then((function(t){return t.json()})).then((function(t){$i[qi]=t,e()})).catch((function(t){var e="Error while fetching "+o;y(e,t),i(e)}))}}}))},Zi={eventListeners:[],timeouts:[],intervals:[],targets:[]};const Ji={setTimeout:function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];var n=setTimeout((function(){Zi.timeouts=Zi.timeouts.filter((function(t){return t!==n})),t.apply(null,r)}),e,r);return x("Set Timeout","ID: "+n),Zi.timeouts.push(n),n})),clearTimeout:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){Zi.timeouts.indexOf(t)>-1?(Zi.timeouts=Zi.timeouts.filter((function(e){return e!==t})),x("Clear Timeout","ID: "+t),clearTimeout(t)):y("Clear Timeout","ID "+t+" not found")})),clearTimeouts:function(){var t=this;Zi.timeouts.forEach((function(e){t.clearTimeout(e)}))},setInterval:function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];var n=setInterval((function(){Zi.intervals.filter((function(t){return t!==n})),t.apply(null,r)}),e,r);return x("Set Interval","ID: "+n),Zi.intervals.push(n),n})),clearInterval:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){Zi.intervals.indexOf(t)>-1?(Zi.intervals=Zi.intervals.filter((function(e){return e!==t})),x("Clear Interval","ID: "+t),clearInterval(t)):y("Clear Interval","ID "+t+" not found")})),clearIntervals:function(){var t=this;Zi.intervals.forEach((function(e){t.clearInterval(e)}))},addEventListener:function(t,e,i){t.addEventListener(e,i);var r=Zi.targets.indexOf(t)>-1?Zi.targets.indexOf(t):Zi.targets.push(t)-1;Zi.eventListeners[r]=Zi.eventListeners[r]||{},Zi.eventListeners[r][e]=Zi.eventListeners[r][e]||[],Zi.eventListeners[r][e].push(i),x("Add eventListener","Target:",t,"Event: "+e,"Handler:",i.toString())},removeEventListener:function(t,e,i){var r=Zi.targets.indexOf(t);r>-1&&Zi.eventListeners[r]&&Zi.eventListeners[r][e]&&Zi.eventListeners[r][e].indexOf(i)>-1?(Zi.eventListeners[r][e]=Zi.eventListeners[r][e].filter((function(t){return t!==i})),x("Remove eventListener","Target:",t,"Event: "+e,"Handler:",i.toString()),t.removeEventListener(e,i)):y("Remove eventListener","Not found","Target",t,"Event: "+e,"Handler",i.toString())},removeEventListeners:function(t,e){var i=this;if(t&&e){var r=Zi.targets.indexOf(t);r>-1&&Zi.eventListeners[r][e].forEach((function(r){i.removeEventListener(t,e,r)}))}else if(t){var s=Zi.targets.indexOf(t);s>-1&&Object.keys(Zi.eventListeners[s]).forEach((function(e){i.removeEventListeners(t,e)}))}else Object.keys(Zi.eventListeners).forEach((function(t){i.removeEventListeners(Zi.targets[t])}))},clear:function(){this.clearTimeouts(),this.clearIntervals(),this.removeEventListeners(),Zi.eventListeners=[],Zi.timeouts=[],Zi.intervals=[],Zi.targets=[]}};var tr={white:"#ffffff",black:"#000000",red:"#ff0000",green:"#00ff00",blue:"#0000ff",yellow:"#feff00",cyan:"#00feff",magenta:"#ff00ff"},er={},ir=function(t,e){var i;"object"===l(i=t)&&null!==i?(Object.keys(t).forEach((function(t){return rr(t)})),tr=Object.assign({},tr,t)):function(t){return"string"==typeof t}(t)&&e&&(rr(t),tr[t]=e)},rr=function(t){for(var e in er)e.indexOf(t)>-1&&delete er[e]};const sr="4.8.3";var nr,or,ar,hr,lr,cr,ur,dr,_r,gr={stage:{w:1920,h:1080,clearColor:0,canvas2d:!1},debug:!1,defaultFontFace:"RobotoRegular",keys:{8:"Back",13:"Enter",27:"Menu",37:"Left",38:"Up",39:"Right",40:"Down",174:"ChannelDown",175:"ChannelUp",178:"Stop",250:"PlayPause",191:"Search",409:"Search"}},fr=[];function pr(t,e,i){var r=i.width,s=i.height;return r&&s&&(gr.stage.w=r,gr.stage.h=s,gr.stage.precision=r/1920),r||s||720!==window.innerHeight||(gr.stage.w=1280,gr.stage.h=720,gr.stage.precision=1280/1920),function(e){M(a,e);var r,s,n=(r=a,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(r);if(s){var i=D(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return B(this,t)});function a(t){var e;o(this,a);var i=Fi()(gr,t);return t.stage.canvas&&(i.stage.canvas=t.stage.canvas),(e=n.call(this,i)).config=i,e}return h(a,[{key:"_setup",value:function(){var e=this;Promise.all([this.loadFonts(t.config&&t.config.fonts||t.getFonts&&t.getFonts()||[]),Hi.load(t.config&&t.config.locale||t.getLocale&&t.getLocale()),t.language&&this.loadLanguage(t.language()),t.colors&&this.loadColors(t.colors())]).then((function(){R.app.loaded(),nr=e.stage.c({ref:"App",type:t,zIndex:1,forceZIndexContext:!!i.showVersion||!!i.showFps}),e.childList.a(nr),e._refocus(),x("App version",e.config.version),x("SDK version",sr),i.showVersion&&e.childList.a({ref:"VersionLabel",type:ji,version:e.config.version,sdkVersion:sr,zIndex:1}),i.showFps&&e.childList.a({ref:"FpsCounter",type:Gi,zIndex:1}),Ii(D(a.prototype),"_setup",e).call(e)})).catch(console.error)}},{key:"_handleBack",value:function(){this.closeApp()}},{key:"_handleExit",value:function(){this.closeApp()}},{key:"closeApp",value:function(){x("Signaling App Close"),i.onClose&&"function"==typeof i.onClose?i.onClose.apply(i,arguments):this.close()}},{key:"close",value:function(){x("Closing App"),f(),Ji.clear(),this.childList.remove(this.tag("App")),this.cleanupFonts(),this.stage.gc(),this.destroy()}},{key:"loadFonts",value:function(t){return i.fontLoader&&"function"==typeof i.fontLoader?i.fontLoader(t,fr):function(t,e){return new Promise((function(i,r){t.map((function(t){var i=t.family,r=t.url,s=t.urls,n=t.descriptors;return function(){var t=s?s.map((function(t){return"url("+t+")"})):"url("+r+")",o=new FontFace(i,t,n||{});return e.push(o),x("Loading font",i),document.fonts.add(o),o.load()}})).reduce((function(t,e){return t.then((function(){return e()}))}),Promise.resolve(null)).then(i).catch(r)}))}(t,fr)}},{key:"cleanupFonts",value:function(){"delete"in document.fonts?fr.forEach((function(t){x("Removing font",t.family),document.fonts.delete(t)})):x("No support for removing manually-added fonts")}},{key:"loadLanguage",value:function(t){var e=O("translations.json"),i=t;return"object"===l(i)&&(i=t.language||null,e=t.file||e),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(i,r){fetch(t).then((function(t){return t.json()})).then((function(t){Qi(t),"object"===l(e)&&"then"in e&&"function"==typeof e.then?e.then((function(t){return Ki(t).then(i).catch(r)})).catch((function(t){y(t),r(t)})):Ki(e).then(i).catch(r)})).catch((function(){var e="Language file "+t+" not found";y(e),r(e)}))}))}(e,i)}},{key:"loadColors",value:function(t){var e=O("colors.json");return!t||"string"!=typeof t&&"object"!==l(t)||(e=t),function(t){return new Promise((function(e,i){if("object"===l(t))return ir(t),e();fetch(t).then((function(t){return t.json()})).then((function(t){return ir(t),e()})).catch((function(){var e="Colors file "+t+" not found";return y(e),i(e)}))}))}(e)}},{key:"focus",set:function(t){this._focussed=t,this._refocus()}},{key:"_getFocused",value:function(){return this._focussed||this.tag("App")}}],[{key:"_template",value:function(){return{w:1920,h:1080}}}]),a}(Ve.Application)}function xr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var mr,yr,vr,Sr=!0,Tr=function(){var t=e(n().mark((function t(e,i){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!0);case 1:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),br=function(){},wr=new Map,Cr=new Map,Ar=!1,Rr=null,Er=function(t){Ar||Lr(t),t.routes.forEach((function(t){var e=es(t.path);if(Wr(e))console.error("".concat(e," already exists in routes configuration"));else{var i=function(t){if("$"===t.path){var e={preventStorage:!0};Vr(t.options)&&(e=ai(ai({},t.options),e)),t.options=e,_r&&(t.after=_r)}return new ni(t)}(t);if(wr.set(e,i),i.component){var r=i.component;Qr(r)&&(cr.get("lazyCreate")||(r=bi(lr,r),hr.a(r))),Cr.set(e,r)}}}))},Lr=function(t){dr=t.root,Yr(t.boot)&&(_r=t.boot),$r(t.updateHash)&&(Sr=t.updateHash),Yr(t.beforeEachRoute)&&(Tr=t.beforeEachRoute),Yr(t.afterEachRoute)&&(br=t.afterEachRoute),t.bootComponent&&(console.warn("[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes"),console.warn("[Router]: setting { bootComponent } property will be deprecated in a future release"),qr(t.bootComponent)?t.routes.push({path:"$",component:t.bootComponent,after:_r||null,options:{preventStorage:!0}}):console.error("[Router]: ".concat(t.bootComponent," is not a valid boot component"))),Ar=!0},Pr=function(t,e){Cr.has(t)&&Cr.set(t,e)},Ir=function(t){return Cr.has(t)?Cr.get(t):null},Or=function(){if(!cr||!cr.size)return!1;var t=cr.get("updateHash");return!($r(t)&&!t||$r(Sr)&&!Sr)},Fr=function(t){var e=t.hash,i=t.route,r=t.register,s=t.page;_i(i.options,"clearHistory")?Li([]):e&&!Ze.test(i.path)&&Ci(t),Pr(i.path,s),t.isSharedInstance||!t.isCreated?xi(s,"changed"):t.isCreated&&xi(s,"mounted"),ur&&function(t,e){var i=(t||[]).map((function(t){return t.toLowerCase()}));ur.forEach((function(t){t.visible=-1!==i.indexOf(t.ref.toLowerCase()),t.visible&&xi(t,["activated"],e)})),"Widgets"===ar.state&&mi&&!mi.visible&&ar._setState("")}(i.widgets,s),Br()&&!t.isSharedInstance&&kr(Rr,t),r.get(ns.historyState)&&Yr(s.historyState)&&s.historyState(r.get(ns.historyState)),Mr(s),mr=t.hash,yr=i.path;var n,o=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return xr(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?xr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}(Rs.values());try{for(o.s();!(n=o.n()).done;){var a=n.value;a.isCancelled&&a.hash&&Rs.delete(a.hash)}}catch(t){o.e(t)}finally{o.f()}br(t),x("[route]:",i.path),x("[hash]:",e)},kr=function(t,e){var i=yr,r=e.register,s=cr.get("lazyDestroy"),n=cr.get("destroyOnHistoryBack"),o=r.get("keepAlive"),a=!1;r.get(ns.backtrack)&&(n||s)&&(a=!0),s&&!o&&(a=!0),yr===e.route.path&&(a=!0),a?(Pr(i,t._routedType||t.constructor),hr.remove(t),cr.get("gcOnUnload")&&lr.gc()):t.patch({x:0,y:0,scale:1,alpha:1,visible:!1})},zr=function(){return mr},Mr=function(t){Rr=t},Br=function(){return Rr},Dr=function(){return yr},Ur=function(){return vr},Wr=function(t){return wr.has(t)},Hr=function(){return dr},jr=function(){return _r},Nr=function(){return cr};function Xr(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Gr(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Gr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}function Gr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var Yr=function(t){return"function"==typeof t},Vr=function(t){return"object"===l(t)&&null!==t},$r=function(t){return"boolean"==typeof t},qr=function(t){return!!(t instanceof Ve.Element||Qr(t))},Qr=function(t){return t.prototype&&"isComponent"in t.prototype},Kr=function(t){return Array.isArray(t)},Zr=function(t){return"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1))},Jr=function(t){return"string"==typeof t},ts=function(t){var e;if(Yr(t))try{e=t.apply(null)}catch(t){e=t}else e=t;return Vr(e)&&Yr(e.then)},es=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.replace(/^#/,"").replace(/\/+$/,"")},is=function(){var t=g("platform","router"),e=Vr(t);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash","storeSameHash"].reduce((function(i,r){return i.set(r,e?t[r]:g("platform",r)),i}),new Map)},rs=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zr(),e=Bs();"$"!==t&&t||!e||Jr(e)&&(t=e);var i="",r=/([?&].*)/,s=r.exec(t),n={};if(document.location&&document.location.search&&(i=document.location.search),s&&s.length){var o=s[1];i?(o=o.replace(/^\?/,""),i="".concat(i,"&").concat(o)):i=o}if(i){var a,h=new URLSearchParams(i),l=Xr(h.entries());try{for(l.s();!(a=l.n()).done;){var c=Qe(a.value,2),u=c[0],d=c[1];n[u]=d}}catch(t){l.e(t)}finally{l.f()}return n}return!1},ss=function(t){return Vr(t)?"?"+Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join("&"):""},ns={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack"),historyState:Symbol("historyState"),queryParams:Symbol("queryParams")};function os(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return as(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?as(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}function as(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function hs(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}var ls={on:function(t){return ar.state,ar._setState("Loading"),cs(t)},before:function(t){return cs(t)},after:function(t){try{cs(t,!0)}catch(t){}return Promise.resolve()}},cs=function(t,e){var i=t.route,r=i.provider,s=i.cache?1e3*i.cache:0,n=us(t);return r.request(t.page,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?hs(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):hs(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},n)).then((function(){t.page[ns.expires]=Date.now()+s,e&&xi(t.page,"dataProvided")})).catch((function(e){throw t.page[ns.expires]=Date.now(),e}))},us=function(t){var e,i=t.page,r=t.route,s=t.hash,n=t.register,o=void 0===n?new Map:n,a=di(s,r.path),h=rs(s),l={},c=os(new Map([].concat(ii(a),ii(o))));try{for(c.s();!(e=c.n()).done;){var u=Qe(e.value,2),d=u[0],_=u[1];l[d]=_}}catch(t){c.e(t)}finally{c.f()}if(h&&(l[ns.queryParams]=h),o.size){var g,f={},p=os(o);try{for(p.s();!(g=p.n()).done;){var x=Qe(g.value,2),m=x[0],y=x[1];f[m]=y}}catch(t){p.e(t)}finally{p.f()}i.persist=f}return i.params=l,xi(i,["urlParams"],l),l},ds=function(t){if(!t[ns.expires])return!1;var e=t[ns.expires];return Date.now()>=e},_s=function(t){return!!Wr(t)&&!!wr.get(t).provider},gs=function(t){if(Wr(t.path)){var e=wr.get(t.path).provider;return{type:e.type,provider:e.request}}},fs=function(t,e,i,r){var s="x"===t?1920:1080;return new Promise((function(n){var o,a;i.patch((S(o={},"".concat(t),e?-1*s:s),S(o,"visible",!0),S(o,"smooth",S({},"".concat(t),[0,{duration:.4,delay:.2}])),o)),r&&r.patch((S(a={},"".concat(t),0),S(a,"smooth",S({},"".concat(t),[e?s:-1*s,{duration:.4,delay:.2}])),a)),i.transition(t).on("finish",(function(){n()}))}))};const ps={fade:function(t,e){return new Promise((function(i){t.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),t.transition("alpha").on("finish",(function(){e&&(e.visible=!1),i()}))}))},crossFade:function(t,e){return new Promise((function(i){t.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),e&&e.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),t.transition("alpha").on("finish",(function(){i()}))}))},up:function(t,e){return fs("y",0,t,e)},down:function(t,e){return fs("y",1,t,e)},left:function(t,e){return fs("x",0,t,e)},right:function(t,e){return fs("x",1,t,e)}};var xs=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t.pageTransition||t.easing,r=!!(t.smoothIn||t.smoothInOut||i),s=Nr().get("disableTransitions");if(t.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!r||s)return t.visible=!0,e&&(e.visible=!1),Promise.resolve();if(i){var n;try{n=i.call(t,t,e)}catch(t){n="crossFade"}if(ts(n))return n;if(Jr(n)){var o=ps[n];if(o)return o(t,e)}if(t.smoothIn){var a=function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(s){t.visible=!0,t.setSmooth(e,i,r),t.transition(e).on("finish",(function(){s()}))}))};return t.smoothIn({pageIn:t,smooth:a})}}return ps.crossFade(t,e)},ms=function(){var t=e(n().mark((function t(e){var i,r;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=!1,t.prev=1,t.next=4,ys(e);case 4:if(!(e=t.sent)||e.isCancelled){t.next=12;break}if("Loading"===ar.state&&ar._setState(""),e.isSharedInstance||e.isCancelled){t.next=10;break}return t.next=10,xs(e.page,Br());case 10:t.next=13;break;case 12:i=!0;case 13:if(!i&&!e.isCancelled){t.next=18;break}m("[router]:","Rejected ".concat(e.hash," because route to ").concat(Ur()," started")),e.isCreated&&!e.isSharedInstance&&hr.remove(e.page),t.next=20;break;case 18:return Fr(e),t.abrupt("return",e.page);case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(1),t.t0.route?i||(r=t.t0.route,_i(r.options,"clearHistory")?Li([]):Ze.test(r.path)||Ci(t.t0),t.t0.isCreated&&!t.t0.isSharedInstance&&hr.remove(t.t0.page),vs(t.t0)):console.error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[1,22]])})));return function(e){return t.apply(this,arguments)}}(),ys=function(){var t=e(n().mark((function t(e){var i,r,s,o,a,h,l,c,u,d;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.route,r=e.hash,s=e.register,o=Ir(i.path),a=Qr(o),h=!1,a||s.get(ns.backtrack)||Ss(i)||(o=o.constructor,a=!0),a?(e.page=bi(lr,o),hr.a(e.page),_s(i.path)&&(h=!0),e.isCreated=!0):(e.page=o,_s(i.path)&&(ds(o)||o[ns.hash]!==r)&&(h=!0),l=Br()&&Br()[ns.route],i.path===l&&(e.isSharedInstance=!0,Yr(e.page.historyState)&&(e.copiedHistoryState=e.page.historyState()))),e.page[ns.hash]=r,e.page[ns.route]=i.path,t.prev=10,!h){t.next=25;break}return c=gs(i),u=c.type,d=c.provider,e.provider=d,e.providerType=u,t.next=17,ls[u](e);case 17:if(r===Ur()){t.next=21;break}return t.abrupt("return",!1);case 21:return"after"!==e.providerType&&xi(e.page,"dataProvided"),t.abrupt("return",e);case 23:t.next=27;break;case 25:return us(e),t.abrupt("return",e);case 27:t.next=33;break;case 29:return t.prev=29,t.t0=t.catch(10),e.error=t.t0,t.abrupt("return",Promise.reject(e));case 33:case"end":return t.stop()}}),t,null,[[10,29]])})));return function(e){return t.apply(this,arguments)}}(),vs=function(t){t&&t.error?console.error(t.error):t&&y(t),t.page&&Wr("!")&&Is("!",{request:t},!1)},Ss=function(t){var e=_i(t.options,"reuseInstance"),i=cr.get("reuseInstance");return $r(e)?e:!($r(i)&&!1===i)};function Ts(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=D(t);if(e){var s=D(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return B(this,i)}}var bs=function(t){M(i,t);var e=Ts(i);function i(){return o(this,i),e.apply(this,arguments)}return h(i,[{key:"pages",get:function(){return this.tag("Pages")}},{key:"widgets",get:function(){return this.tag("Widgets")}},{key:"_handleBack",value:function(){}},{key:"_getFocused",value:function(){return Ws.getActivePage()}}],[{key:"_template",value:function(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}},{key:"_states",value:function(){return[function(t){M(i,t);var e=Ts(i);function i(){return o(this,i),e.apply(this,arguments)}return h(i,[{key:"$enter",value:function(){this.tag("Loading").visible=!0}},{key:"$exit",value:function(){this.tag("Loading").visible=!1}}]),i}(this),function(t){M(i,t);var e=Ts(i);function i(){return o(this,i),e.apply(this,arguments)}return h(i,[{key:"$enter",value:function(t,e){this._widget=e,this._refocus()}},{key:"_getFocused",value:function(){return this._widget}},{key:"reload",value:function(t){this._widget=t,this._refocus()}},{key:"_handleKey",value:function(){var t=cr.get("autoRestoreRemote");$r(t)&&!0!==t||Ws.focusPage()}}]),i}(this)]}}]),i}(Ve.Component);function ws(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Cs(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return As(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?As(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,s=function(){};return{s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}function As(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var Rs=new Map,Es="",Ls="",Ps=function(t){Wr("!")?Is("!",{request:{error:t}}):console.error(t)},Is=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;if(!Vr(t)||(t=fi(t))){var r=Ds();!Or()&&Es&&(r=Es),r.replace(/^#/,"")!==t?(Os(t,e,i),Us(t),Or()||(Es=t,Fs(t).then((function(){ar._refocus()})).catch((function(t){console.error(t)})))):e.reload&&(Os(t,e,i),Fs(t).then((function(){ar._refocus()})).catch((function(t){console.error(t)})))}},Os=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;if(t=es(t),!Rs.has(t)){var r,s=Cs(Rs.values());try{for(s.s();!(r=s.n()).done;){var n=r.value;n.cancel()}}catch(t){s.e(t)}finally{s.f()}var o=gi(t,e,i);return Rs.set(decodeURIComponent(t),o),o}return!1},Fs=function(){var t=e(n().mark((function t(e){var i,r,s,o,a,h;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=es(e||Ds()),r=decodeURIComponent(i),(s=Rs.get(r))||Rs.size||(s=Os(i)),o=ui(i)){t.next=8;break}return Wr("*")?Is("*",{failedHash:i}):console.error("Unable to navigate to: ".concat(i)),t.abrupt("return");case 8:return s.hash=i,s.route=o,t.next=12,Tr(zr(),s);case 12:if(!(a=t.sent)||!o.beforeNavigate){t.next=17;break}return t.next=16,o.beforeNavigate(zr(),s);case 16:a=t.sent;case 17:if(!$r(a)){t.next=22;break}if(!a){t.next=20;break}return t.abrupt("return",ks(s));case 20:t.next=25;break;case 22:s.cancel(),Rs.delete(r),Jr(a)?Is(a):Vr(a)&&(h=!0,$r(a.store)&&(h=a.store),Is(a.path,a.params,h));case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ks=function(t){var e=t.hash,i=t.route,r=decodeURIComponent(e);if(function(t){vr=t}(e),i.path){var s=Ir(i.path);if(Yr(i.hook)){var n,o=di(e,i.path),a={},h=Cs(o.keys());try{for(h.s();!(n=h.n()).done;){var l=n.value;a[l]=o.get(l)}}catch(t){h.e(t)}finally{h.f()}i.hook(ar,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ws(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ws(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},a))}if(s){var c=Br();if(c){var u=function(t,e){if(Jr(t)){var i=wr;if(!i.has(t))return!1;t=i.get(t)}var r=e.register,s=t.options;return r.has("keepAlive")?r.get("keepAlive"):!(!s||!s.keepAlive)&&s.keepAlive}(Dr(),t);c&&i.path===Dr()&&!u&&c._setState("")}qr(s,lr)?ms(t).then((function(){ar._refocus(),Rs.delete(r)})):s().then((function(t){return t.default})).then((function(e){return Pr(i.path,e),ms(t)})).then((function(){ar._refocus(),Rs.delete(r)}))}else Rs.delete(r)}},zs=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!t||isNaN(t))return!1;var e=Ei();if((t=Math.abs(t))>e.length)return Yr(ar._handleAppClose)?ar._handleAppClose():ar.application.closeApp();if(e.length){var i,r=e.splice(e.length-t,t)[0];return Li(e),Is(r.hash,(S(i={},ns.backtrack,!0),S(i,ns.historyState,r.state),i),!1)}if(cr.get("backtrack")){var s=/(\/:?[\w%\s-]+)$/,n=ei(Ds()),o=ci(n);if(o>1)for(;o--;)if(n=n.replace(s,""),ui(n))return Is(n,S({},ns.backtrack,!0),!1)}return!1},Ms=function(){if(Rs.size){var t,e=!1,i=Cs(Rs.values());try{for(i.s();!(t=i.n()).done;)t.value.isCancelled||(e=!0)}catch(t){i.e(t)}finally{i.f()}return e}return!1},Bs=function(){return Ls},Ds=function(){return document.location.hash},Us=function(t){document.location.hash=t};const Ws={startRouter:function(t,i){(function(t,e){var i=t.appInstance,r=t.routes;e&&qr(e)&&(ar=e),ar||(ar=i||nr),or=ar.application,hr=or.childList,lr=ar.stage,cr=is(),function(t){t.pages&&(hr=t.pages.childList),t.widgets&&t.widgets.children&&(ur=t.widgets.childList).forEach((function(t){return t.visible=!1})),t._handleBack=function(t){zs(-1),t.preventDefault()}}(ar),Kr(r)?Er(t):Yr(r)&&(console.warn("[Router]: Calling Router.route() directly is deprecated."),console.warn("Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration"))})(t,i),Ji.addEventListener(window,"hashchange",e(n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Or()){t.next=9;break}return t.prev=1,t.next=4,Fs();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.error(t.t0);case 9:case"end":return t.stop()}}),t,null,[[1,6]])})))),function(){var t=(Ds()||"").replace(/^#/,""),e="$",i=rs(t),r=jr(),s=Hr(),n=-1!==t.indexOf(e);Ze.test(t)&&t!==e&&(t=""),Ls=n?s:t||s;var o=function(){!t&&s?Jr(s)?Is(s):Yr(s)&&s().then((function(t){Vr(t)?Is(t.path,t.params):Is(t)})):(Os(t),Fs().then((function(){ar._refocus()})).catch((function(t){console.error(t)})))};if(Wr(e)){if(t&&!n&&!ui(t))return void Is("*",{failedHash:t});Is(e,{resume:Ls,reload:e===t},!1)}else Yr(r)?r(i).then((function(){o()})).catch((function(t){Ps(t)})):o()}()},navigate:Is,resume:function(){Jr(Ls)?(Is(Ls,!1),Ls=""):Yr(Ls)?Ls().then((function(t){Ls="",Vr(t)?Is(t.path,t.params):Is(t)})):console.warn("[Router]: resume() called but no hash found")},step:zs,go:zs,back:zs.bind(null,-1),activePage:Br,getActivePage:function(){return Br()},getActiveRoute:Dr,getActiveHash:zr,focusWidget:function(t){var e=function(t){return t=Zr(t),ur.getByRef(t)||!1}(t);e&&(Ti(e),"Widgets"===ar.state?ar.reload(mi):ar._setState("Widgets",[mi]))},getActiveWidget:Si,restoreFocus:vi,isNavigating:Ms,getHistory:Ei,setHistory:Li,getHistoryState:function(t){var e=null;return wi.length&&(t?-1!==Ai(t)&&(e=wi[Ai(t)].state):e=wi[wi.length-1].state),e},replaceHistoryState:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;if(wi.length){var i=e?Ai(e):wi.length-1;-1!==i&&Vr(t)&&(wi[i].state=t)}},getQueryStringParams:rs,reload:function(){if(!Ms()){var t=zr();Is(t,{reload:!0},!1)}},symbols:ns,App:bs,focusPage:vi,root:function(){var t=Hr();Jr(t)?Is(t):Yr(t)&&t().then((function(t){Vr(t)?Is(t.path,t.params):Is(t)}))},setupRoutes:function(){console.warn("Router: setupRoutes is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},on:function(){console.warn("Router.on() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},before:function(){console.warn("Router.before() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},after:function(){console.warn("Router.after() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")}};var Hs,js=[{number:1,name:"Metro News 1",description:"New York Cable News Channel",entitled:!0,program:{title:"The Morning Show",description:"New York's best morning show",startTime:new Date(new Date-3e5).toUTCString(),duration:1800,ageRating:0}},{number:2,name:"MTV",description:"Music Television",entitled:!0,program:{title:"Beavis and Butthead",description:"American adult animated sitcom created by Mike Judge",startTime:new Date(new Date-12e5).toUTCString(),duration:2700,ageRating:18}},{number:3,name:"NBC",description:"NBC TV Network",entitled:!1,program:{title:"The Tonight Show Starring Jimmy Fallon",description:"Late-night talk show hosted by Jimmy Fallon on NBC",startTime:new Date(new Date-6e5).toUTCString(),duration:3600,ageRating:10}}],Ns=function(){return g("platform","tv",js)},Xs=function(){return Ns()[~~(Ns.length*Math.random())]};function Gs(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Ys(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Gs(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Gs(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Vs={},$s=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];Vs[t]&&Vs[t].forEach((function(t){t.apply(null,i)}))},qs={getChannel:function(){return Hs||(Hs=Xs()),new Promise((function(t,e){if(Hs){var i=Ys({},Hs);delete i.program,t(i)}else e("No channel found")}))},getProgram:function(){return Hs||(Hs=Xs()),new Promise((function(t,e){Hs.program?t(Hs.program):e("No program found")}))},setChannel:function(t){return new Promise((function(e,i){if(t){var r=Ns().find((function(e){return e.number===t}));if(r){var s=Ys({},Hs=r);delete s.program,$s("channelChange",s),e(s)}else i("Channel not found")}else i("No channel number supplied")}))}};function Qs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=D(t);if(e){var s=D(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return B(this,i)}}var Ks=function(t){M(i,t);var e=Qs(i);function i(){return o(this,i),e.apply(this,arguments)}return h(i,[{key:"index",set:function(t){this.x=144*t}},{key:"nr",set:function(t){var e=this;this._timeout&&clearTimeout(this._timeout),t?this.setSmooth("alpha",1):this.setSmooth("alpha",.5),this.tag("Nr").patch({text:{text:t&&t.toString()||"",fontSize:"*"===t?120:80}}),t&&"*"!==t&&(this._timeout=setTimeout((function(){e._timeout=null,e.nr="*"}),750))}}],[{key:"_template",value:function(){return{w:120,h:150,rect:!0,color:4287927187,alpha:.5,shader:{type:Ve.shaders.RoundedRectangle,radius:10},Nr:{w:function(t){return t},y:24,text:{text:"",textColor:4281545523,fontSize:80,textAlign:"center",verticalAlign:"middle"}}}}}]),i}(Ve.Component),Zs=function(t){M(i,t);var e=Qs(i);function i(){return o(this,i),e.apply(this,arguments)}return h(i,[{key:"_init",value:function(){for(var t=[],e=0;e<4;e++)t.push({type:Ks,index:e});this.tag("Code").children=t}},{key:"pin",get:function(){return this._pin||(this._pin=""),this._pin},set:function(t){if(t.length<=4){var e=new Array(Math.max(t.length-1,0)).fill("*",0,t.length-1);t.length&&e.push(t.length>this._pin.length?t.slice(-1):"*");for(var i=0;i<4;i++)this.tag("Code").children[i].nr=e[i]||"";this._pin=t}}},{key:"msg",get:function(){return this._msg||(this._msg=""),this._msg},set:function(t){var e=this;this._timeout&&clearTimeout(this._timeout),this._msg=t,this._msg?(this.tag("Msg").text=this._msg,this.tag("Info").setSmooth("alpha",.5),this.tag("Code").setSmooth("alpha",.5)):(this.tag("Msg").text="",this.tag("Info").setSmooth("alpha",1),this.tag("Code").setSmooth("alpha",1)),this._timeout=setTimeout((function(){e.msg=""}),2e3)}},{key:"_firstActive",value:function(){this.setSmooth("alpha",1)}},{key:"_handleKey",value:function(t){if(this.msg)this.msg=!1;else{var e=parseInt(t.key);e>-1&&(this.pin+=e)}}},{key:"_handleBack",value:function(){this.msg?this.msg=!1:this.pin.length?this.pin=this.pin.slice(0,this.pin.length-1):(on.hide(),this.resolve(!1))}},{key:"_handleEnter",value:function(){var t=this;this.msg?this.msg=!1:on.submit(this.pin).then((function(e){t.msg="Unlocking ...",setTimeout((function(){on.hide()}),1e3),t.resolve(e)})).catch((function(e){t.msg=e,t.reject(e)}))}}],[{key:"_template",value:function(){return{zIndex:1,w:function(t){return t},h:function(t){return t},rect:!0,color:3707764736,alpha:1e-6,Dialog:{w:648,h:320,y:function(t){return(t-320)/2},x:function(t){return(t-648)/2},rect:!0,color:3711120179,shader:{type:Ve.shaders.RoundedRectangle,radius:10},Info:{y:24,x:48,text:{text:"Please enter your PIN",fontSize:32}},Msg:{y:260,x:48,text:{text:"",fontSize:28,textColor:4294967295}},Code:{x:48,y:96}}}}}]),i}(Ve.Component),Js=!1,tn=["purchase","parental"],en=function(t,e){return new Promise((function(e,i){t.toString()===g("platform","pin","0000").toString()?e(Js=!0):i("Incorrect pin")}))},rn=function(t){return new Promise((function(t){t(Js)}))},sn=null,nn=function(t){return void 0===t?(x("Please provide context explicitly"),tn[0]):tn.includes(t)?t:(v("Incorrect context provided"),!1)};const on={show:function(){return new Promise((function(t,e){sn=an.stage.c({ref:"PinDialog",type:Zs,resolve:t,reject:e}),an.childList.a(sn),an.focus=sn}))},hide:function(){an.focus=null,an.children=an.children.map((function(t){return t!==sn&&t})),sn=null},submit:function(t,e){return new Promise((function(i,r){try{(e=nn(e))?en(t,e).then(i).catch(r):r("Incorrect Context provided")}catch(t){r(t)}}))},unlocked:function(t){return new Promise((function(e,i){try{(t=nn(t))?rn(t).then(e).catch(i):i("Incorrect Context provided")}catch(t){i(t)}}))},locked:function(t){return new Promise((function(e,i){try{(t=nn(t))?rn(t).then((function(t){return e(!t)})).catch(i):i("Incorrect Context provided")}catch(t){i(t)}}))}};var an;const hn=function(t,e,i,r){var s;!function(t,e){u.app=t,u.platform=e,u.user={}}(e,i),s=i,P=F(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",e=arguments.length>1?arguments[1]:void 0;return e="/"!==e.charAt(e.length-1)?e+"/":e,/^(?:https?:)?(?:\/\/)/.test(e)||"/"===e.charAt(0)?e:(t=k(t))+(e="/"!==(e="."===e.charAt(0)?e.substr(1):e).charAt(0)?"/"+e:e)}(window.location.pathname,s.path||"/")),s.proxyUrl&&F(s.proxyUrl),g("platform","id"),new class{constructor(t){return t=t||{},this.forceCookies=t.forceCookies||!1,!0===this._checkIfLocalStorageWorks()&&!0!==t.forceCookies?{getItem:this._getItemLocalStorage,setItem:this._setItemLocalStorage,removeItem:this._removeItemLocalStorage,clear:this._clearLocalStorage,keys:this._getLocalStorageKeys}:{getItem:this._getItemCookie,setItem:this._setItemCookie,removeItem:this._removeItemCookie,clear:this._clearCookies,keys:this._getCookieKeys}}_checkIfLocalStorageWorks(){if("undefined"==typeof localStorage)return!1;try{return localStorage.setItem("feature_test","yes"),"yes"===localStorage.getItem("feature_test")&&(localStorage.removeItem("feature_test"),!0)}catch(t){return!1}}_getItemLocalStorage(t){return window.localStorage.getItem(t)}_setItemLocalStorage(t,e){return window.localStorage.setItem(t,e)}_removeItemLocalStorage(t){return window.localStorage.removeItem(t)}_clearLocalStorage(){return window.localStorage.clear()}_getLocalStorageKeys(){return Object.keys(window.localStorage)}_getItemCookie(t){var e=document.cookie.match(RegExp("(?:^|;\\s*)"+function(t){return t.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}(t)+"=([^;]*)"));return e&&""===e[1]&&(e[1]=null),e?e[1]:null}_setItemCookie(t,e){var i=new Date,r=new Date(i.getTime()+15768e7);document.cookie=`${t}=${e}; expires=${r.toUTCString()};`}_removeItemCookie(t){document.cookie=`${t}=;Max-Age=-99999999;`}_clearCookies(){document.cookie.split(";").forEach((t=>{document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires=Max-Age=-99999999")}))}_getCookieKeys(){return document.cookie.split(";").map((t=>t.split("=")[0]))}},i.plugins&&(i.plugins.profile&&function(t){t.getInfo,t.setInfo}(i.plugins.profile),i.plugins.metrics&&function(t){w=t.sendMetric}(i.plugins.metrics),i.plugins.mediaPlayer&&function(t){t.mediaUrl&&t.mediaUrl}(i.plugins.mediaPlayer),i.plugins.mediaPlayer&&xn(i.plugins.mediaPlayer),i.plugins.ads&&In(i.plugins.ads),i.plugins.router&&function(t){t.getHash&&(Ds=t.getHash),t.setHash&&(Us=t.setHash)}(i.plugins.router),i.plugins.tv&&function(t){qs={},t.getChannel&&"function"==typeof t.getChannel&&(qs.getChannel=t.getChannel),t.getProgram&&"function"==typeof t.getProgram&&(qs.getProgram=t.getProgram),t.setChannel&&"function"==typeof t.setChannel&&(qs.setChannel=t.setChannel),t.emit&&"function"==typeof t.emit&&t.emit($s)}(i.plugins.tv),i.plugins.purchase&&function(t){t.billingUrl&&t.billingUrl}(i.plugins.purchase),i.plugins.pin&&function(t){t.submit&&"function"==typeof t.submit&&(en=t.submit),t.check&&"function"==typeof t.check&&(rn=t.check)}(i.plugins.pin));var n=pr(t,0,i);return an=new n(e)};var ln,cn,un,dn,_n=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"videoEl",get:function(){return this._videoEl},set:function(t){this._videoEl=t}},{key:"videoView",get:function(){return this.tag("Video")}},{key:"videoTexture",get:function(){return this.videoView.texture}},{key:"isVisible",get:function(){return 1===this.videoView.alpha&&!0===this.videoView.visible}},{key:"_init",value:function(){this._createVideoTexture()}},{key:"_createVideoTexture",value:function(){var t=this.stage.gl,e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.videoTexture.options={source:e,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}},{key:"start",value:function(){var t=this,e=this.stage;this._lastTime=0,this._updateVideoTexture||(this._updateVideoTexture=function(){if(t.videoTexture.options.source&&t.videoEl.videoWidth&&t.active){var i=e.gl,r=(new Date).getTime(),s=t.videoEl.getVideoPlaybackQuality(),n=s?s.totalVideoFrames:t.videoEl.webkitDecodedFrameCount;if(n?t._lastFrame!==n:t._lastTime<r-30){t._lastTime=r,t._lastFrame=n;try{i.bindTexture(i.TEXTURE_2D,t.videoTexture.options.source),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.videoEl),t._lastFrame=t.videoEl.webkitDecodedFrameCount,t.videoView.visible=!0,t.videoTexture.options.w=t.videoEl.width,t.videoTexture.options.h=t.videoEl.height;var o=t.videoView.w/t.videoView.h,a=t.videoEl.width/t.videoEl.height;o>a?(t.videoView.scaleX=a/o,t.videoView.scaleY=1):(t.videoView.scaleY=o/a,t.videoView.scaleX=1)}catch(e){y("texImage2d video",e),t.stop()}t.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(e.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}},{key:"stop",value:function(){var t=this.stage;if(t.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){var e=t.gl;e.bindTexture(e.TEXTURE_2D,this.videoTexture.options.source),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}}},{key:"position",value:function(t,e){this.videoView.patch({smooth:{x:e,y:t}})}},{key:"size",value:function(t,e){this.videoView.patch({smooth:{w:t,h:e}})}},{key:"show",value:function(){this.videoView.setSmooth("alpha",1)}},{key:"hide",value:function(){this.videoView.setSmooth("alpha",0)}}],[{key:"_template",value:function(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:Ve.textures.StaticTexture,options:{}}}}}}]),s}(Ve.Component),gn=function(t){return t},fn=1,pn=!1,xn=function(t){t.mediaUrl&&(gn=t.mediaUrl)},mn={},yn={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(t){this._playingAds!==t&&(this._playingAds=t,Tn(!0===t?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},vn={play:function(){yn.playing=!0},pause:function(){yn.playing=!1},seeked:function(){!0===yn.playAfterSeek&&En.play(),yn.playAfterSeek=null},abort:function(){Rn()}},Sn=function(t){return Math.round(fn*t)+"px"},Tn=function(t,e){dn&&(dn.fire("$videoPlayer"+t,e,ln.currentTime),dn.fire("$videoPlayerEvent",t,e,ln.currentTime))},bn=null,wn=null,Cn=function(t,e,i){return bn&&"function"==typeof bn?bn(t,e,i):new Promise((function(i){t=gn(t),e.setAttribute("src",t),e.load(),i()}))},An=function(){x("VideoPlayer","Registering event listeners"),Object.keys(L).forEach((function(t){var e=function(e){un&&un[t]&&"function"==typeof un[t]&&un[t]({currentTime:ln.currentTime}),function(t,e){vn[t]&&"function"==typeof vn[t]&&vn[t].call(null,t,e)}(t,{videoElement:ln,event:e}),Tn(L[t],{videoElement:ln,event:e})};mn[t]=e,ln.addEventListener(t,e)}))},Rn=function(){x("VideoPlayer","Deregistering event listeners"),Object.keys(mn).forEach((function(t){ln.removeEventListener(t,mn[t])})),mn={}},En={consumer:function(t){dn=t},loader:function(t){bn=t},unloader:function(t){wn=t},position:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;ln.style.left=Sn(e),ln.style.top=Sn(t),!0===pn&&cn.position(t,e)},size:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1920,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1080;ln.style.width=Sn(t),ln.style.height=Sn(e),ln.width=parseFloat(ln.style.width),ln.height=parseFloat(ln.style.height),!0===pn&&cn.size(t,e)},area:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1920,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1080,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.position(t,r),this.size(e-r,i-t)},open:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.canInteract)if(un=R.media(t),this.hide(),Rn(),this.src==t)this.clear().then(this.open(t,i));else{var r={enabled:yn.adsEnabled,duration:300};i.videoId&&(r.caid=i.videoId),Mn.get(r,dn).then((function(r){yn.playingAds=!0,r.prerolls().then((function(){yn.playingAds=!1,Cn(t,ln,i).then((function(){An(),e.show(),e.play()})).catch((function(t){Tn("error",{videoElement:ln,event:t})}))}))}))}},reload:function(){if(this.canInteract){var t=ln.getAttribute("src");this.close(),this.open(t)}},close:function(){var t=this;Mn.cancel(),yn.playingAds&&(yn.playingAds=!1,Mn.stop(),setTimeout((function(){t.close()}))),this.canInteract&&(this.clear(),this.hide(),Rn())},clear:function(){if(this.canInteract)return this.pause(),!0===pn&&cn.stop(),function(t){return wn&&"function"==typeof wn?wn(t):new Promise((function(e){t.removeAttribute("src"),t.load(),e()}))}(ln).then((function(){Tn("Clear",{videoElement:ln})}))},play:function(){this.canInteract&&(!0===pn&&cn.start(),function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t&&"function"==typeof t)try{e=t.apply(r,i)}catch(t){e=t}else e=t;return null!==e&&"object"===l(e)&&e.then&&"function"==typeof e.then?e:new Promise((function(t,i){e instanceof Error?i(e):t(e)}))}(ln.play,null,ln).catch((function(t){Tn("error",{videoElement:ln,event:t})})))},pause:function(){this.canInteract&&ln.pause()},playPause:function(){this.canInteract&&(!0===this.playing?this.pause():this.play())},mute:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.canInteract&&(ln.muted=t)},loop:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ln.loop=t},seek:function(t){this.canInteract&&this.src&&(null===yn.playAfterSeek&&(yn.playAfterSeek=!!yn.playing),this.pause(),ln.currentTime=Math.max(0,Math.min(t,this.duration-.1)))},skip:function(t){var e,i=this;this.canInteract&&this.src&&(yn.skipTime=(yn.skipTime||ln.currentTime)+t,e=function(){i.seek(yn.skipTime),yn.skipTime=!1},300,clearTimeout(I),I=setTimeout((function(){e()}),300))},show:function(){this.canInteract&&(!0===pn?cn.show():(ln.style.display="block",ln.style.visibility="visible"))},hide:function(){this.canInteract&&(!0===pn?cn.hide():(ln.style.display="none",ln.style.visibility="hidden"))},enableAds:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];yn.adsEnabled=t},get duration(){return ln&&(isNaN(ln.duration)?1/0:ln.duration)},get currentTime(){return ln&&ln.currentTime},get muted(){return ln&&ln.muted},get looped(){return ln&&ln.loop},get src(){return ln&&ln.getAttribute("src")},get playing(){return yn.playing},get playingAds(){return yn.playingAds},get canInteract(){return!1===yn.playingAds},get top(){return ln&&parseFloat(ln.style.top)},get left(){return ln&&parseFloat(ln.style.left)},get bottom(){return ln&&parseFloat(ln.style.top-ln.style.height)},get right(){return ln&&parseFloat(ln.style.left-ln.style.width)},get width(){return ln&&parseFloat(ln.style.width)},get height(){return ln&&parseFloat(ln.style.height)},get visible(){return!0===pn?cn.isVisible:ln&&"block"===ln.style.display},get adsEnabled(){return yn.adsEnabled},get _videoEl(){return ln},get _consumer(){return dn}};!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=!1,r=function(){!1===i&&(e(),i=!0)};Object.keys(t).reduce((function(e,i){return"function"==typeof t[i]?e[i]=function(){return r(),t[i].apply(t,arguments)}:"function"==typeof Object.getOwnPropertyDescriptor(t,i).get?e.__defineGetter__(i,(function(){return r(),Object.getOwnPropertyDescriptor(t,i).get.apply(t)})):"function"==typeof Object.getOwnPropertyDescriptor(t,i).set?e.__defineSetter__(i,(function(){return r(),Object.getOwnPropertyDescriptor(t,i).set.sourceObject[i].apply(t,arguments)})):e[i]=t[i],e}),{})}(En,(function(){fn=an&&an.stage&&an.stage.getRenderPrecision()||fn,ln=function(){var t=document.getElementsByTagName("video");if(t&&t.length)return t[0];var e=document.createElement("video"),i=g("platform","width")?g("platform","width"):1920,r=g("platform","height")?g("platform","height"):1080;return e.setAttribute("id","video-player"),e.setAttribute("width",Sn(i)),e.setAttribute("height",Sn(r)),e.style.position="absolute",e.style.zIndex="1",e.style.display="none",e.style.visibility="hidden",e.style.top=Sn(0),e.style.left=Sn(0),e.style.width=Sn(i),e.style.height=Sn(r),document.body.appendChild(e),e}(),!0===(pn=g("platform","textureMode",!1))&&(ln.setAttribute("crossorigin","anonymous"),cn=function(){if(!an.tag("VideoTexture")){var t=an.stage.c({type:_n,ref:"VideoTexture",zIndex:0,videoEl:ln});an.childList.addAt(t,0)}return an.tag("VideoTexture")}())}));var Ln,Pn=function(){return Promise.resolve({prerolls:[],midrolls:[],postrolls:[]})},In=function(t){t.getAds&&(Pn=t.getAds)},On={active:!1},Fn=function(t){return new Promise((function(e){if(!1===On.active)return x("Ad","Skipping add due to inactive state"),e();var i=document.getElementsByTagName("video")[0];i.style.display="block",i.style.visibility="visible",i.src=gn(t.url),i.load();var r,s=null,n=function(){Object.keys(o).forEach((function(t){return i.removeEventListener(t,o[t])})),e()},o={play:function(){x("Ad","Play ad",t.url),zn("Play",t),kn(t.callbacks,"defaultImpression")},ended:function(){zn("Ended",t),kn(t.callbacks,"complete"),n()},timeupdate:function(){!s&&i.duration&&(s={firstQuartile:i.duration/4,midPoint:i.duration/2,thirdQuartile:i.duration/4*3},x("Ad","Calculated quartiles times",{timeEvents:s})),s&&s.firstQuartile&&i.currentTime>=s.firstQuartile&&(zn("FirstQuartile",t),delete s.firstQuartile,kn(t.callbacks,"firstQuartile")),s&&s.midPoint&&i.currentTime>=s.midPoint&&(zn("MidPoint",t),delete s.midPoint,kn(t.callbacks,"midPoint")),s&&s.thirdQuartile&&i.currentTime>=s.thirdQuartile&&(zn("ThirdQuartile",t),delete s.thirdQuartile,kn(t.callbacks,"thirdQuartile"))},stalled:function(){zn("Stalled",t),r=setTimeout((function(){n()}),5e3)},canplay:function(){r&&clearTimeout(r)},error:function(){zn("Error",t),n()},abort:function(){n()}};Object.keys(o).forEach((function(t){return i.addEventListener(t,o[t])})),i.play()}))},kn=function(t,e){if(t&&t[e])return x("Ad","Sending beacon",e,t[e]),t[e].reduce((function(t,i){return t.then((function(){return fetch(i).then((function(t){200===t.status?zn("Beacon"+e+"Sent"):zn("Beacon"+e+"Failed"+t.status),Promise.resolve(null)})).catch((function(){Promise.resolve(null)}))}))}),Promise.resolve(null));x("Ad","No callback found for "+e)},zn=function(t,e){Ln&&(Ln.fire("$ad"+t,e),Ln.fire("$adEvent",t,e))};const Mn={get:function(t,e){return!1===t.enabled?Promise.resolve({prerolls:function(){return Promise.resolve()}}):(Ln=e,new Promise((function(e){x("Ad","Starting session"),Pn(t).then((function(t){x("Ad","API result",t),e({prerolls:function(){return t.preroll?(On.active=!0,zn("PrerollSlotImpression",t),kn(t.preroll.callbacks,"slotImpression"),function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(t,e){return t.then((function(){return Fn(e)}))}),Promise.resolve(null))}(t.preroll.ads).then((function(){zn("PrerollSlotEnd",t),kn(t.preroll.callbacks,"slotEnd"),On.active=!1}))):Promise.resolve()},midrolls:function(){return Promise.resolve()},postrolls:function(){return Promise.resolve()}})}))})))},cancel:function(){x("Ad","Cancel Ad"),On.active=!1},stop:function(){x("Ad","Stop Ad"),On.active=!1;var t=document.getElementsByTagName("video")[0];t.pause(),t.removeAttribute("src")}};Ve.textures.ImageTexture;var Bn={"XFINITYSans-Bold":"fonts/XFINITYSans-Bold.otf","XFINITYSans-ExLgt":"fonts/XFINITYSans-ExLgt.otf","XFINITYSans-Lgt":"fonts/XFINITYSans-Lgt.otf","XFINITYSans-Med":"fonts/XFINITYSans-Med.otf","XFINITYSans-Reg":"fonts/XFINITYSans-Reg.otf",XfinityBrownBold:"fonts/xfinitybrown-bold.woff",XfinityStandardRegular:"fonts/xfinitystandard-regular.woff",XfinityStandardMedium:"fonts/xfinitystandard-medium.woff"},Dn="XFINITYSans-ExLgt",Un="XFINITYSans-Lgt",Wn="XfinityBrownBold",Hn="XfinityStandardMedium",jn="XfinityStandardRegular",Nn={position:"fixed",top:0,left:0,width:"100%",height:"100%",border:"none","z-index":"3000000"};var Xn=16,Gn=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this.tag("Dots").patch({x:this.xPos,y:this.yPos});var t=this.tag("Dots").children;this.animations=[];for(var e=0;e<t.length;++e)this.animations[e]=t[e].animation(this.getAnimation(e))}},{key:"_enable",value:function(){for(var t=0;t<this.animations.length;++t)this.animations[t].start()}},{key:"_disable",value:function(){for(var t=0;t<this.animations.length;++t)this.animations[t].stop()}},{key:"mode",set:function(t){if("CONSENT"===t){this.tag("Dots").patch({shader:{radius:0},w:480,h:180});var e=this.tag("Dots").w/2,i=this.tag("Dots").h/1.8;this.tag("Dots").children[0].x=e-48,this.tag("Dots").children[1].x=e,this.tag("Dots").children[2].x=e+48,this.tag("Dots").children[0].y=i,this.tag("Dots").children[1].y=i,this.tag("Dots").children[2].y=i,this.tag("SpinnerText").patch({x:this.xPos,y:this.yPos-20,visible:!0,text:{text:"Hold tight!",textColor:4293256677}})}}},{key:"getAnimation",value:function(t){var e={duration:1.6,repeat:-1};switch(t){case 0:e.actions=[{p:"scale",v:{0:1,.025:1,.125:1.5,.225:1,1:1}},{p:"alpha",v:{0:.5,.025:.5,.125:1,.225:.5,1:.5}}];break;case 1:e.actions=[{p:"scale",v:{0:1,.275:1,.375:1.5,.475:1,1:1}},{p:"alpha",v:{0:.5,.275:.5,.375:1,.475:.5,1:.5}}];break;case 2:e.actions=[{p:"scale",v:{0:1,.525:1,.625:1.5,.725:1,1:1}},{p:"alpha",v:{0:.5,.525:.5,.625:1,.725:.5,1:.5}}]}return e}}],[{key:"_template",value:function(){return{rect:!0,color:4278190080,x:0,y:0,zIndex:1500,Dots:{rect:!0,w:130,h:130,mount:.5,color:4194304e3,shader:{type:Ve.shaders.RoundedRectangle,radius:64},children:[{x:26,y:58,rect:!0,w:Xn,h:Xn,color:4293256677,shader:{type:Ve.shaders.RoundedRectangle,radius:8},scale:2},{x:58,y:58,rect:!0,w:Xn,h:Xn,color:4293256677,shader:{type:Ve.shaders.RoundedRectangle,radius:8}},{x:90,y:58,rect:!0,w:Xn,h:Xn,color:4293256677,shader:{type:Ve.shaders.RoundedRectangle,radius:8}}]},SpinnerText:{rect:!0,w:240,h:75,mount:.5,zIndex:1500,visible:!1,text:{fontSize:42,text:"",textAlign:"center"}}}}}]),s}(Ve.Component);const Yn={getWidth(t,e={}){const{padding:i,paddingLeft:r,paddingRight:s,strokeWidth:n}={padding:0,paddingLeft:0,paddingRight:0,strokeWidth:0,...e};return t?t-(r||i)-(s||i)-n:0},getHeight(t,e={}){const{padding:i,paddingBottom:r,paddingTop:s,strokeWidth:n}={padding:0,paddingBottom:0,paddingTop:0,strokeWidth:0,...e};return t?t-(r||i)-(s||i)-n:0}};function Vn(t,e){const i={...t};if(!e||t===e)return i;for(const r in e){const s=e[r];t.hasOwnProperty(r)?i[r]=$n(r,t,e):i[r]=s}return i}function $n(t,e,i){const r=e[t],s=i[t],n=typeof s;return typeof r!==n||"function"===n||Array.isArray(s)?s:s&&"object"===n?Vn(r,s):s}function qn(...t){return t.find(Number.isFinite)}function Qn(t,e){if(!e)return 0;const i=e.transition(t);return i.isRunning()?i.targetValue:e[t]}Qn.bind(null,"x"),Qn.bind(null,"y");const Kn=(t,e)=>"function"==typeof t?t(e):t,Zn={none:0,xsmall:4,small:8,medium:16,large:24};function Jn(t,e=100){if(!t)return 0;"number"==typeof t&&(t=t.toString(16).slice(2)),t=t.replace("#","");const i=Math.round(e/100*255).toString(16);return Number(`0x${i}${t}`)}const to={0:Jn("#FFFFFF"),5:Jn("#F6F6F9"),10:Jn("#ECECF2"),20:Jn("#CECEDA"),30:Jn("#B1B1BD"),40:Jn("#8B8B97"),50:Jn("#62626C"),60:Jn("#3E3E45"),70:Jn("#232328"),80:Jn("#141417"),90:Jn("#0D0D0F"),100:Jn("#000000"),__isColor:!0},eo={hover:Jn("#8BAFF9"),default:Jn("#4784FF"),pressed:Jn("#3376FF"),indicator:Jn("#2970FF"),shade:Jn("#111A32"),__isColor:!0},io={hover:Jn("#78E3BF"),default:Jn("#0AC284"),pressed:Jn("#009965"),indicator:Jn("#008F5E"),shade:Jn("#0A1F18"),__isColor:!0},ro={hover:Jn("#FFD88A"),default:Jn("#FFC95C"),pressed:Jn("#FFB829"),indicator:Jn("#FFAA00"),shade:Jn("#1F180A"),__isColor:!0},so={hover:Jn("#FF99BA"),default:Jn("#FF6194"),pressed:Jn("#FF3878"),indicator:Jn("#F0004D"),shade:Jn("#2A120E"),__isColor:!0},no={base:Jn("#6138F5"),hover:Jn("#BAA8FA"),default:Jn("#9378F8"),pressed:Jn("#805FF6"),indicator:Jn("#704BF7"),shade:Jn("#1E1236"),__isColor:!0},oo={getHexColor:Jn,black:to[100],white:to[0],grey:to,blue:eo,green:io,yellow:ro,red:so,purple:no,opacity:{0:0,1:16,2:32,3:48,4:64,5:80,6:96},__isColor:!0,background:{default:to[80],stroke:0,float:0,fill:to[70],focus:to[10],ghost:Jn(to[70],48),__isColor:!0},text:{light:{primary:Jn(to[0],95),secondary:Jn(to[0],80),tertiary:Jn(to[0],60),__isColor:!0},dark:{primary:Jn(to[100],95),secondary:Jn(to[100],80),tertiary:Jn(to[100],60),__isColor:!0},focus:Jn(to[100],95),__isColor:!0},badge:{default:Jn(to[70],60),__isColor:!0},focusRing:{primary:Jn(to[10],96),secondary:Jn(to[0],8),__isColor:!0}},ao={display1:{fontFace:"XfinityBrownBold",fontSize:56,fontWeight:700,letterSpacing:-.4,lineHeight:72,verticalAlign:"middle"},display2:{fontFace:"XfinityBrownBold",fontSize:48,fontWeight:700,letterSpacing:-.4,lineHeight:64,verticalAlign:"middle"},headline1:{fontFace:"XfinityBrownBold",fontSize:36,fontWeight:700,letterSpacing:-.2,lineHeight:48,verticalAlign:"middle"},headline2:{fontFace:"XfinityBrownBold",fontSize:32,fontWeight:700,letterSpacing:-.2,lineHeight:40,verticalAlign:"middle"},headline3:{fontFace:"XfinityBrownBold",fontSize:28,fontWeight:700,letterSpacing:-.2,lineHeight:40,verticalAlign:"middle"},body1:{fontFace:"XfinityStandardMedium",fontSize:32,fontWeight:500,letterSpacing:0,lineHeight:40,verticalAlign:"middle"},body2:{fontFace:"XfinityStandardMedium",fontSize:28,fontWeight:500,letterSpacing:0,lineHeight:40,verticalAlign:"middle"},body3:{fontFace:"XfinityStandardMedium",fontSize:24,fontWeight:500,letterSpacing:0,lineHeight:32,verticalAlign:"middle"},button1:{fontFace:"XfinityBrownBold",fontSize:28,fontWeight:700,letterSpacing:-.2,lineHeight:40,verticalAlign:"middle"},button2:{fontFace:"XfinityBrownBold",fontSize:24,fontWeight:700,letterSpacing:-.2,lineHeight:32,verticalAlign:"middle"},callout1:{fontFace:"XfinityStandardMedium",fontSize:24,fontWeight:700,letterSpacing:2,lineHeight:32,verticalAlign:"middle"},caption:{fontFace:"XfinityStandardMedium",fontSize:20,fontWeight:700,letterSpacing:0,lineHeight:24,verticalAlign:"middle"}},ho={glow:function({w:t,h:e,color:i=4294967295,borderRadius:r=Zn.small,blur:s=lo(2)}){return{color:i,mount:.5,x:t/2,y:e/2+s/2,zIndex:1,texture:Ye.Tools.getShadowRect(t-lo(2),e-lo(2),r,s)}},luminance:function({w:t,h:e,blur:i=3,padding:r=lo(8),texture:s=null,radius:n=0}){let o={};return n&&(o={type:Ye.shaders.RoundedRectangle,radius:n}),{type:Ye.components.FastBlurComponent,x:t/2,y:e/2+lo(3),mount:.5,w:t,h:e,amount:i,padding:r,content:{Image:{w:t,h:e,texture:s,shader:o}},zIndex:1}},shadow:function({w:t,h:e,color:i=Jn(oo.grey[100],60),borderRadius:r=Zn.small,blur:s=lo(3)}){return{color:i,mount:.5,x:t/2,y:e/2+lo(3),zIndex:1,texture:Ye.Tools.getShadowRect(t-lo(2),e-lo(2),r,s)}}};function lo(t){return 8*t}function co(t=0,e=0){const i=Math.max(t,e);let r=5;switch(!0){case i>=260:r=5;break;case i>=185:r=4;break;case i>=140:r=3;break;default:r=2}return(i+lo(r))/i}const uo=oo.grey[5],_o={duration:.6,actions:[{p:"colorUl",v:{0:Jn(uo,72),1:Jn(uo,56)}},{p:"colorUr",v:{0:Jn(uo,24),1:Jn(uo,16)}},{p:"colorBr",v:{0:0,1:Jn(uo,0)}},{p:"colorBl",v:{0:Jn(uo,24),1:Jn(uo,16)}}]},go={icon:{small:32,medium:40,large:48}};function fo(t,e,i){const r=i||t.theme||Ye.uiTheme,s=t.styles?Vn(t.styles,Kn(e,r)):Kn(e,r);return class extends t{static get name(){return t.name}static get styles(){return s}get styles(){return s}}}Ye.uiTheme=Ye.uiTheme||{getFocusScale:co,spacing:lo,materials:ho,palette:oo,sizes:go,typography:ao,border:{focused:{width:2},radius:Zn},animations:{gradient:_o}};const po=40,xo=80,mo={w:1920,h:1080};function yo(t){const e=mo.w-2*xo;return t?(e-(t-1)*po)/t:e}var vo=i(296);function So(t){return t.charAt(0).toUpperCase()+t.slice(1)}class To extends Ye.Component{_construct(){this._whenEnabled=new Promise((t=>this._whenEnabledResolver=t)),this._getFocusScale=this.styles.getFocusScale||function(){},this._getUnfocusScale=this.styles.getUnfocusScale||function(){}}_firstEnable(){this._whenEnabledResolver()}_init(){this._requestUpdateDebounce()}_update(){}_focus(){void 0===this._smooth&&(this._smooth=!0),this._requestUpdateDebounce()}_unfocus(){this._requestUpdateDebounce()}get announce(){return this._announce}set announce(t){this._announce=t}isFullyOnScreen(){return function(t){if(!t)return!1;const{w:e,h:i,core:{renderContext:{px:r,py:s},_scissor:n=[]}={}}=t,o=t.stage.h/t.stage.getRenderPrecision(),a=t.stage.w/t.stage.getRenderPrecision();if(!(r>=0&&r+e<=a&&s>=0&&s+i<=o))return!1;if(n&&n.length){const[t=null,o=null,a=null,h=null]=n,l=Math.round(r+e)>=Math.round(t),c=Math.round(r)<=Math.round(t+a),u=Math.round(s+i)>=Math.round(o),d=Math.round(s+i)<=Math.round(o+h);return l&&c&&u&&d}return!0}(this)}}const bo=function(t){return class extends t{get itemLayout(){return this._itemLayout}set itemLayout(t){if(e=this._itemLayout,i=t,JSON.stringify(e)!==JSON.stringify(i)){this._itemLayout=t;const{w:e,h:i}=function(t={},e={}){const{w:i,h:r,ratioX:s,ratioY:n,upCount:o}=t,a=e.w||0,h=e.h||0;let l={};return l=i&&r?{w:i,h:r}:r&&s&&n?{w:Math.round(r*s/n),h:r}:s&&n&&o?function(t,e,i){let r,s;return t&&e&&i?(r=Math.round(yo(i)),s=Math.round(r/t*e)):(r=0,s=0),{w:r,h:s}}(s,n,o):r&&o?{w:Math.round(yo(o)),h:r}:r?{w:a,h:r}:i?{w:i,h}:{w:a,h},l={...l,ratioX:s,ratioY:n,upCount:o},l}(t);if(i||e){const{w:t,h:r}=mo;this.h=i||e*(r/t),this.w=e||i*(t/r),super._update&&super._update()}}var e,i}}}(function(t){return class extends t{static get name(){return t.name}_construct(){(this.constructor.properties||[]).forEach((t=>{const e=function(t,e){return{get(){const i=this[`_get${So(t)}`];if(i&&"function"==typeof i){const t=i.call(this,this[e]);this[e]=t}return this[e]},set(i){if(i!==this[e]){const r=this[`_set${So(t)}`];r&&"function"==typeof r&&(i=r.call(this,i)),this[e]=i,this._requestUpdateDebounce()}},configurable:!0,enumerable:!0}}(t,"_"+t);void 0!==e&&Object.defineProperty(Object.getPrototypeOf(this),t,e)})),this._whenEnabled=new Promise((t=>{this._whenEnabledResolver=t})),this._requestUpdateDebounce=(0,vo.debounce)(this._requestUpdate.bind(this),0),super._construct&&super._construct()}_firstEnable(){this._readyForUpdates=!0,this._whenEnabledResolver(),this._requestUpdateDebounce.clear(),this._update(),super._firstEnable&&super._firstEnable()}_detach(){super._detach(),this._requestUpdateDebounce.clear()}_requestUpdate(){this._readyForUpdates&&this._update()}}}(function(t){return class extends t{static get name(){return t.name}_construct(){(this.constructor.tags||[]).forEach((t=>{if("object"==typeof t)var{name:e,path:i}=t;else var e=t,i=t;const r="_"+e,s=function(t){return{get(){return this.tag(t)},configurable:!0,enumerable:!0}}(i);Object.defineProperty(Object.getPrototypeOf(this),r,s)})),super._construct&&super._construct()}}}(function(t){return class extends t{static get name(){return t.name}_handleKey(t){return this._processEvent(t)}_handleKeyRelease(t){return this._processEvent(t,"Release")}_processEvent(t,e=""){let i=(this.stage.application.__keymap||{})[t.keyCode];return i||(i=t.key),i&&"function"==typeof this[`on${i}${e}`]?this[`on${i}${e}`].call(this,this,t)||!1:(this.fireAncestors(`$on${i}${e}`,this,t),!1)}}}(fo(To,(t=>({getUnfocusScale:()=>1,getFocusScale:t.getFocusScale})))))));class wo extends bo{static _template(){return{color:4294967295,w:0,h:0}}static get properties(){return["icon"]}_init(){this.on("txError",this._handleTxtError.bind(this))}_detach(){this.off("txError",this._handleTxtError.bind(this))}_handleTxtError(t){this._icon=null,this.texture=null}_update(){if(!this._icon)return void(this.texture=null);const{icon:t,w:e,h:i}=this,r=function(t,e,i){const r={w:e,h:i};switch(!0){case Co(t):r.texture=Ye.Tools.getSvgTexture(`data:image/svg+xml,${encodeURIComponent(t)}`,e,i);break;case Ao(t):r.texture=Ye.Tools.getSvgTexture(t,e,i);break;case Ro(t):default:r.src=t}return r}(t,e,i);this.patch(r)}}const[Co,Ao,Ro]=[/^<svg.*<\/svg>$/,/\.svg$/,/\.(a?png|bmp|gif|ico|cur|jpe?g|pjp(eg)?|jfif|tiff?|webp)$/].map((t=>RegExp.prototype.test.bind(t))),Eo={minWidth:150,h:40,radius:0,background:{color:4280229663},icon:{color:4294967295},text:{fontSize:20,color:4294967295},padding:50,stroke:{color:0,weight:2},focused:{background:{color:4294967295},text:{color:4280229663},icon:{color:4280229663}},fixedText:{wordWrap:!1,textOverflow:"ellipsis",maxLinesSuffix:"..."}};class Lo extends(fo(bo,Eo)){static get properties(){return["fixed","icon","label","minWidth","radius","stroke","strokeColor","strokeWeight","title"]}static get tags(){return["Content",{name:"Title",path:"Content.Title"},{name:"Icon",path:"Content.Icon"},"Stroke"]}static _template(){return{w:this.styles.w||0,minWidth:this.styles.minWidth,h:this.styles.h,radius:this.styles.radius,strokeColor:this.styles.stroke.color,strokeWeight:this.styles.stroke.weight,Content:{mount:.5,zIndex:2,x:t=>t/2,y:t=>t/2,flex:{direction:"row",alignContent:"center",alignItems:"center"},Title:{y:2}},Stroke:{zIndex:1,mount:.5,x:t=>t/2,y:t=>t/2}}}_construct(){this._fixed=!1,this._minWidth=0,this._strokeWeight=2,this._strokeColor=0,this._focusedBackgroundColor=this.styles.focused.background.color,this._backgroundColor=this.styles.background.color,this._textStyles=this.styles.text,this._stylesRadius=this.styles.radius,this._padding=this.styles.padding,this._fixedTextStyles=this.styles.fixedText,this._iconColorFocused=this.styles.focused.icon.color,this._iconStyles=this.styles.icon,this._textColorFocused=this.styles.focused.text.color,super._construct&&super._construct()}_init(){this._setIconError()}_setIconError(){this._Icon&&this._Icon.on("txError",(()=>{this.icon.src=null,this._update()}))}_focus(){void 0===this._smooth&&(this._smooth=!0),this._update()}_unfocus(){this._update()}_updateColor(){const t=this.hasFocus()?qn(this.focusedBackground,this._focusedBackgroundColor):qn(this.background,this._backgroundColor);this._smooth?this.smooth={color:t}:this.color=t}_updateTitle(){if(this.title){this._Title.text={...this._textStyles,fontColor:this._textStyles.color,fontSize:this.fontSize||this._textStyles.fontSize,fontFamily:this._textStyles.fontFace||this._textStyles.fontFamily||this.stage._options.defaultFontFace,text:this.title};const t=this.hasFocus()?qn(this.focusedTextColor,this._textColorFocused):qn(this.textColor,this._textStyles.color);this._smooth?this._Title.smooth={color:t}:this._Title.color=t}else this._Title.texture=!1}_updateIcon(){if(this.icon&&this.icon.src){const{color:t,size:e,spacing:i,src:r}=this.icon;this._Icon?this._Icon.patch({w:e,h:e,icon:r,visible:1,flexItem:{marginRight:!this._fixed&&this.title?i:0}}):(this._Content.childList.addAt(this.stage.c({ref:"Icon",type:wo,w:e,h:e,icon:r,visible:1,flexItem:{marginRight:!this._fixed&&this.title?i:0}}),0),this._setIconError());const s=this.hasFocus()?qn(this.focusedIconColor,this._iconColorFocused):qn(t,this._iconStyles.color);this._smooth?this._Icon.smooth={color:s}:this._Icon.color=s}else this._Icon&&this._Icon.patch({w:0,h:0,visible:0,texture:!1,flexItem:!1})}_updateStroke(){if(this.stroke&&!this.hasFocus()){const t=this.radius||this._stylesRadius;this.texture=Ye.Tools.getRoundRect(Yn.getWidth(this.w),Yn.getHeight(this.h),t,0,!0,4294967295),this._Stroke.color=this.strokeColor,this._Stroke.texture=Ye.Tools.getRoundRect(Yn.getWidth(this.w),Yn.getHeight(this.h),t,this.strokeWeight,4294967295,!0,this.background)}else{const t=this.radius||this._stylesRadius;this.texture=Ye.Tools.getRoundRect(Yn.getWidth(this.w),Yn.getHeight(this.h),t),this._Stroke.texture=!1}}_calcPreTextWidth(){return this.icon&&this.icon.src?this.icon.size+this.icon.spacing:0}_updateWidth(){const t=this._calcPreTextWidth(),e=qn(this.padding,this._padding,10);if(this.fixed)this._Title.patch({text:{...this._fixedTextStyles,wordWrapWidth:this.w-2*e-t}});else{const i=function(t={}){const e=document.createElement("canvas").getContext("2d"),{fontStyle:i,fontWeight:r,fontSize:s,fontFamily:n=t.fontFace||"sans-serif"}=t,o=[i,r,s?`${s}px`:"0",`'${n}'`].filter(Boolean).join(" ");e.font=o;const a=e.measureText(t.text||"");return Math.round(a.width)}(this._Title.text||{})+2*e+t;i&&i>this.minWidth?(this.w=i,this.fireAncestors("$itemChanged"),this.signal("buttonWidthChanged",{w:this.w})):this._w=this.w}}_update(){this._readyForUpdates&&(this._updateColor(),this._updateTitle(),this._updateIcon(),this._updateStroke(),this._updateWidth())}_setIcon({src:t,size:e=20,spacing:i=5,color:r=4294967295}){return t?{src:t,size:e,spacing:i,color:r}:null}_getLabel(){return this._label||this._title}get w(){return this.fixed?this._w:this.minWidth>this._w?this.minWidth:this._w}set w(t){this._w!==t&&(this._w=t,this._update())}set announce(t){super._announce=t}get announce(){return this._announce?this._announce:this.label+", Button"}}const Po=t=>({w:54,h:54,background:{color:Jn("#018558",100)},unchecked:{background:Jn("#141417",30)},stroke:{color:t.palette.grey[0],width:2},check:{w:23,h:16,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAFKADAAQAAAABAAAADgAAAACYjX/eAAABKElEQVQ4EbXSO04DMRAGYHtlWaJYpYMcgSBxAUhFi1KkoUrBJVLmENR0XIDUFOQSCTT0SJEziLXzFOzwD3lIWbLahIAby/b42xnPavUHw3t/OJvxPaj3aF9vjqkOszqDVdL7gCGEo+mUH5n5RGvds1Zd/NoTbDDwPecSxtyVTP8Hg36Fr9S31ReZPeVmhoMANHUuXBehhRiAKIp0E4+KN+VbomEtDwVWRgPQTa4sGxDHcX9jPDJsSQnO+RFRUs0GCYaz59wysxdkDfRmfiF5Iwqny5hdsdV/KGUDvQPUUEq/GmPOjfkcTybcUYqPC8tcZLACZQ3UEPk2/vpLLF8Af+yCibEGygbQA5T8gPn7LbfNTO7K+AHKJhGX0jS00Xlrra7ndlOCM+MLVJf04NpHPKcAAAAASUVORK5CYII="}});class Io extends(fo(bo,Po)){static _template(){return{w:this.styles.w,h:this.styles.h,Check:{w:this.styles.check.w,h:this.styles.check.h,mount:.5,x:t=>t/2,y:t=>t/2,alpha:0,src:this.styles.check.src}}}static get tags(){return["Check"]}_init(){this._update()}toggle(){return this.checked=!this.checked,this._update(),this}_handleEnter(){this.toggle()}_update(){this._updateCheck(),this._updateColor()}_updateCheck(){this.w&&this.w!==this.styles.w&&this.h&&this.h!==this.styles.h&&this._Check.patch({w:this.styles.check.w*(this.w/this.styles.w),h:this.styles.check.h*(this.h/this.styles.h)}),this._Check.smooth={alpha:this.checked?1:0}}_updateColor(){const t=this.checked?this.styles.background.color:this.styles.unchecked.background;this.patch({texture:Ye.Tools.getRoundRect(this.w,this.h,this.w/2,this.styles.stroke.width,this.styles.stroke.color,!0,t)})}}const Oo=t=>({minWidth:410,h:72,background:{color:t.palette.background.float},backgrounds:t.palette.background,radius:t.border.radius.small,text:{...t.typography.button1,color:t.palette.text.light.primary},padding:t.spacing(2),shadow:t.materials.glow,icon:{color:t.palette.text.light.primary,size:t.sizes.icon.medium,spacing:t.spacing(1)},loading:{color:Jn("ffffff",24)},stroke:{weight:2,color:t.palette.grey[10]},focused:{background:{color:t.palette.background.focus},icon:{color:t.palette.text.dark.primary},text:{color:t.palette.text.dark.primary}},getFocusScale:t.getFocusScale,checkbox:{size:28,spacing:8}});class Fo extends(fo(Lo,Oo)){static _template(){return{...super._template(),minWidth:this.styles.minWidth,h:this.styles.h,padding:this.styles.padding,radius:this.styles.radius,text:this.styles.text,focus:this.styles.focus,unfocus:this.styles.unfocus,backgroundType:"float",Loader:{color:this.styles.loading.color},DropShadow:{alpha:0}}}static get properties(){return[...super.properties,"backgroundType","checkbox"]}static get tags(){return[...super.tags,"Loader","DropShadow",{name:"Checkbox",path:"Content.Checkbox"}]}_construct(){super._construct(),this._createDropShadow=this.styles.shadow,this._checkboxSize=this.styles.checkbox.size}_setIcon(t){return t?{...this._iconStyles,src:t}:null}_setCheckbox(t){if(t&&"boolean"==typeof t.checked){const{checked:e,spacing:i=this.styles.checkbox.spacing}=t;return{checked:e,spacing:i}}return null}_updateDropShadow(){const t=this._createDropShadow({w:this.w,h:this.h,borderRadius:this._stylesRadius});this._DropShadow.patch(t);const e=Number(this.hasFocus());this._smooth?this._DropShadow.smooth={alpha:e}:this._DropShadow.alpha=e}_updateScale(){const t=this.hasFocus()?this.styles.getFocusScale(this.w,this.h):1;this._smooth?this.smooth={scale:t}:this.scale=t}_updateLoader(){this.title||this.icon?(this._Loader.patch({texture:!1}),this._loading&&this._loading.stop()):(this.patch({color:0}),this._Title.patch({texture:!1}),this._Stroke.patch({texture:!1}),this._Loader.patch({texture:Ye.Tools.getRoundRect(Yn.getWidth(this.w),Yn.getHeight(this.h-2),this._stylesRadius)}),this._loading&&this._loading.start())}_update(){this._readyForUpdates&&(this._updateDropShadow(),this._updateScale(),this._updateLoader(),this._updateCheckbox(),(this.title||this.icon)&&super._update())}_updateCheckbox(){if(this.checkbox){const t={w:this._checkboxSize,h:this._checkboxSize,checked:this.checkbox.checked,visible:1,flexItem:{marginRight:!this._fixed&&this.title?this.checkbox.spacing:0}};this._Checkbox?this._Checkbox.patch(t):this._Content.childList.addAt(this.stage.c({...t,type:Io,ref:"Checkbox"}),0)}else this._Checkbox&&this._Checkbox.patch({w:0,h:0,visible:0,texture:!1,flexItem:!1})}_firstEnable(){this._loading=this._Loader.animation({duration:2,repeat:-1,stopMethod:"immediate",actions:[{p:"alpha",v:{0:.5,.5:1,1:.5}}]}),this._loading.start(),super._firstEnable&&super._firstEnable()}_calcPreTextWidth(){return super._calcPreTextWidth()+(this._Checkbox&&this._Checkbox.w?this._Checkbox.w+this.checkbox.spacing:0)}_setBackgroundType(t){if(this._backgroundType!==t){if(this.styles){const e=this.styles.backgrounds[t]||this.styles.backgrounds.float;this.background=e,this.stroke="stroke"===t,this.stroke&&(this.strokeWeight=this.styles.stroke.weight,this.strokeColor=this.styles.stroke.color)}return t}}}class ko extends Fo{}const zo=class extends ko{};var Mo=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this._setState("UserOption")}},{key:"_getFocused",value:function(){return this.upperButtonConfig&&(this.tag("ButtonCancelFocus").patch({title:this.upperButtonConfig?this.upperButtonConfig.btnText:"Cancel",stroke:this.stroke,strokeWeight:this.strokeWeight,fontSize:this.fontSize,fontFace:this.fontNames,y:this.upperButtonConfig.y,h:this.upperButtonConfig.h,w:this.upperButtonConfig.w}),this.tag("ButtonConfirmUnFocus").patch({title:this.lowerButtonConfig?this.lowerButtonConfig.btnText:"Confirm",stroke:this.stroke,strokeWeight:this.strokeWeight,fontSize:this.fontSize,fontFace:this.fontNames,y:this.lowerButtonConfig.y,h:this.lowerButtonConfig.h,w:this.lowerButtonConfig.w})),this.tag("UserOption").children[this.buttonIndex]}}],[{key:"_template",value:function(){return{UserOption:{flex:{direction:"column",alignItems:"center"},flexItem:{marginBottom:15,maxWidth:1060},ButtonCancelFocus:{type:zo,y:10,minWidth:310,radius:8,backgroundType:"fill",padding:8,title:"Cancel"},ButtonConfirmUnFocus:{type:zo,y:28,minWidth:310,radius:8,backgroundType:"fill",padding:8,title:"Confirm"}}}}}]),s}(Ve.Component);var Bo=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this._setState("UserChoicePlatCo")}},{key:"_getFocused",value:function(){return this.tag("UserChoicePlatCo")}},{key:"actionDirection",set:function(t){"up"===t?this.tag("UserChoicePlatCo").patch({buttonIndex:0}):this.tag("UserChoicePlatCo").patch({buttonIndex:1}),this._refocus()}},{key:"updatePLCOverlay",value:function(t){var e=t.wInfo-250,i=e+20,r=t.ot.length,s=[{flexItem:{marginTop:20},text:{text:t.ot[0].text,fontFace:Wn,fontSize:56,fontWeight:"semibold",letterSpacing:-.4,lineHeight:72,verticalAlign:"middle",wordWrapWidth:i}},{w:e,y:-28,flexItem:{marginTop:0,maxWidth:e},text:{text:t.ot[1].text,fontFace:jn,fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,verticalAlign:"middle",textAlign:"center"}},{w:e,flexItem:{marginTop:5,maxWidth:e},text:{text:t.ot[2].text,fontFace:jn,fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,verticalAlign:"middle",textAlign:"center"}}];t.ot[3].text&&s.push({w:e,flexItem:{marginTop:20,maxWidth:e},text:{text:t.ot[3].text,fontFace:jn,fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,verticalAlign:"middle",textAlign:"center"}}),"unsubscribe"===t.orderType?(this.tag("TermsAndConditions").patch({visible:!1}),this.tag("ProductDetails").patch({flexItem:{marginTop:300}})):this.patch({TermsAndConditions:{flexItem:{marginTop:50,maxWidth:e},children:[{text:{text:t.ot[r-1].children[1].children[0].text,fontFace:"XFINITYSans-Reg",fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,wordWrapWidth:i,verticalAlign:"middle",textAlign:"center"}}]}}),this.patch({ProductDetails:{children:s}}),this.patch({UserChoicePlatCo:{visible:!0}})}},{key:"productData",set:function(t){this.updatePLCOverlay(t)}}],[{key:"_template",value:function(){return{ProductDetails:{flex:{direction:"column",padding:20,alignItems:"center"},flexItem:{marginTop:100},rect:!0,color:4278190080},UserChoicePlatCo:{flex:{direction:"column",alignContent:"center"},type:Mo,stroke:!0,strokeWeight:3,fontSize:28,fontFace:Wn,visible:!1,buttonIndex:0,upperButtonConfig:{btnText:"Cancel",y:10,h:80,w:500},lowerButtonConfig:{btnText:"Confirm",y:48,h:80,w:500}},TermsAndConditions:{flex:{direction:"column",padding:20},rect:!0,color:4278190080}}}}]),s}(Ve.Component);const Do=new(function(){function t(){o(this,t),this.listeners={}}return h(t,[{key:"on",value:function(t,e){var i=this;(t instanceof Array?t:[t]).forEach((function(t){i.listeners[t]||(i.listeners[t]=[]),i.listeners[t].push(e)}))}},{key:"off",value:function(t,e){var i=this;(t instanceof Array?t:[t]).forEach((function(t){if(void 0!==e){var r=i.listeners[t];r&&(i.listeners[t]=r.filter((function(t){return t!==e})))}else delete i.listeners[t]}))}},{key:"clear",value:function(){this.listeners={}}},{key:"emit",value:function(t){for(var e=this,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var n=this.listeners[t];n&&n.forEach((function(i){try{i.apply(void 0,r)}catch(i){if("error"===t)throw i;e.emit("error",new Error("Uncaught error occurred in SDK"))}}))}}]),t}());function Uo(t){if(!t)return"";var e=t.substring(1);return"0xFF".concat(e)}var Wo=110,Ho=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this.tag("TextCancel").patch({text:{text:this.canText,textColor:this.canTextColor}}),this.tag("TextConfirm").patch({text:{text:this.conText,textColor:this.conTextColor}})}},{key:"userRight",value:function(){this.tag("HighlightAbove").setSmooth("x",140,{duration:.5}),this.tag("HighlightBelow").setSmooth("x",140,{duration:.5}),this.tag("HighlightAbove").w=121,this.tag("HighlightBelow").w=121,this.tag("TextCancel").text.textColor=Uo("#E5E5E5"),this.tag("TextConfirm").text.textColor=Uo("#2B9CD8"),Do.emit("key:right")}},{key:"userLeft",value:function(){this.tag("HighlightAbove").setSmooth("x",0,{duration:.5}),this.tag("HighlightBelow").setSmooth("x",0,{duration:.5}),this.tag("HighlightAbove").w=Wo,this.tag("HighlightBelow").w=Wo,this.tag("TextCancel").text.textColor=Uo("#2B9CD8"),this.tag("TextConfirm").text.textColor=Uo("#E5E5E5"),Do.emit("key:left")}},{key:"actionDirection",set:function(t){"left"===t?this.userLeft():this.userRight()}}],[{key:"_template",value:function(){return{LineAbove:{flexItem:{marginTop:20,maxWidth:760},w:780,h:1.3,y:.5,color:Uo("#E5E5E5"),rect:!0},HighlightAbove:{flexItem:{marginBottom:10,maxWidth:760},w:Wo,h:6,color:4294967295,rect:!0},UserOption:{flex:{direction:"row"},flexItem:{marginBottom:5,maxWidth:760},TextCancel:{text:{fontSize:34,fontFace:Un}},TextConfirm:{x:40,text:{fontSize:34,fontFace:Un}}},HighlightBelow:{flexItem:{maxWidth:760},w:Wo,h:6,color:4294967295,rect:!0},LineBelow:{flexItem:{maxWidth:760},w:780,h:1.3,y:.5,color:Uo("#E5E5E5"),rect:!0}}}}]),s}(Ve.Component);var jo={background:{color:4284507754},text:{fontSize:34,fontFace:Un}},No={background:{color:4284507754},text:{fontSize:34,fontFace:Un}},Xo={background:{color:4280822572},text:{color:4287928991,fontSize:34,fontFace:Un}},Go={background:{color:4280822572},text:{color:4287928991,fontSize:34,fontFace:Un}},Yo=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"actionLeft",value:function(){this.tag("ButtonCancelFocus").patch({visible:!0}),this.tag("ButtonCancelUnFocus").patch({visible:!1}),this.tag("ButtonConfirmFocus").patch({visible:!1}),this.tag("ButtonConfirmUnFocus").patch({visible:!0}),Do.emit("key:left")}},{key:"actionRight",value:function(){this.tag("ButtonCancelFocus").patch({visible:!1}),this.tag("ButtonCancelUnFocus").patch({visible:!0}),this.tag("ButtonConfirmFocus").patch({visible:!0}),this.tag("ButtonConfirmUnFocus").patch({visible:!1}),Do.emit("key:right")}},{key:"actionDirection",set:function(t){"left"===t?this.actionLeft():this.actionRight()}}],[{key:"_template",value:function(){return{UserOption:{flex:{direction:"row"},flexItem:{marginBottom:30,maxWidth:760},ButtonCancelFocus:{type:fo(Lo,jo),y:10,minWidth:210,radius:8,backgroundType:"fill",padding:8,h:90,title:"Cancel"},ButtonCancelUnFocus:{type:fo(Lo,Xo),y:18,minWidth:180,radius:8,backgroundType:"fill",padding:8,h:70,title:"Cancel",visible:!1},ButtonConfirmFocus:{type:fo(Lo,No),x:25,y:10,minWidth:210,radius:8,backgroundType:"fill",padding:8,h:90,title:"Confirm",visible:!1},ButtonConfirmUnFocus:{type:fo(Lo,Go),x:25,y:18,minWidth:180,radius:8,backgroundType:"fill",padding:8,h:70,title:"Confirm",visible:!0}}}}}]),s}(Ve.Component),Vo=i(303),$o=i.n(Vo),qo=i(601),Qo=i.n(qo);var Ko=1920,Zo=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this._setState("ButtonSection")}},{key:"_getFocused",value:function(){return this.tag("ButtonSection")}},{key:"templateError",set:function(t){this.tag("HeaderSectionText").patch({text:{text:t[0].text}}),this.tag("LeftOptionHeader").patch({text:{text:t[1].children[0].text}}),this.tag("LFirstLine").patch({text:{text:t[1].children[1].text}}),this.tag("LSecondLine").patch({text:{text:t[1].children[2].text}}),this.tag("RightOptionHeader").patch({text:{text:t[3].children[0].text}}),this.tag("TextBeforeImg").patch({text:{text:t[3].children[1].children[0].text}}),this.tag("TextAfterImg").patch({text:{text:t[3].children[1].children[2].text}}),this.tag("RSecondLine").patch({text:{text:t[3].children[2].text}}),this.tag("RThirdLine").patch({text:{text:t[3].children[3].text}})}},{key:"actionDirection",set:function(t){"up"===t?this.tag("ButtonSection").patch({buttonIndex:0}):this.tag("ButtonSection").patch({buttonIndex:1}),this._refocus()}}],[{key:"_template",value:function(){return{LayoutBackground:{w:Ko,h:1080,color:4278190080,rect:!0},LayoutSection:{flex:{direction:"row",wrap:!0},HeaderSection:{w:Ko,x:960,y:170,mount:.5,flex:{direction:"column",padding:20,alignItems:"center"},HeaderSectionText:{flexItem:{marginTop:10,marginBottom:20},text:{fontSize:55,fontFace:Hn,textAlign:"center",text:"",textColor:4294967295}}},ResolveOption:{w:Ko,x:960,y:320,mount:.5,flex:{direction:"row",wrap:!0},LeftOptionBG:{w:864,h:400,flex:{direction:"row",padding:20,wrap:!0},LeftOptionHeader:{w:864,h:70,flexItem:{marginLeft:10,marginRight:10},text:{fontSize:38,fontFace:Hn,textAlign:"center",text:"",textColor:4294967295}},LeftOptionBody:{w:864,h:70,y:-10,flex:{direction:"row",alignItems:"center",wrap:!0},LFirstLine:{w:864,h:40,flexItem:{marginLeft:10,marginRight:10},text:{fontSize:26,fontFace:Hn,textAlign:"center",text:""}},LSecondLine:{w:864,h:40,flexItem:{marginLeft:10,marginRight:10},text:{fontSize:24,fontFace:Hn,textAlign:"center",text:""}},ImageArea:{w:864,h:30,x:360,flexItem:{marginTop:40},RoundRectangle:{zIndex:2,QRImage:{w:180,h:180,src:$o()}}}}},SplitterBG:{w:72,h:400,x:36,y:20,flex:{direction:"row",padding:20,wrap:!0},Splitter:{flex:{direction:"column",alignItems:"center"},MidUpperLine:{w:3,h:140,x:17,rect:!0,color:2745410467},MidText:{flexItem:{marginBottom:55,marginTop:15},Text:{text:{fontSize:24,fontFace:Hn,text:"OR",textColor:4294967295}}},MidLowerLine:{w:3,h:140,x:17,rect:!0,color:2745410467}}},RightOptionBG:{w:864,h:400,flex:{direction:"row",padding:20,wrap:!0},RightOptionHeader:{w:864,h:70,flexItem:{marginLeft:10,marginRight:10},text:{fontSize:38,fontFace:Hn,textAlign:"center",text:"",textColor:4294967295}},RightOptionBody:{w:864,h:70,y:-10,flex:{direction:"row",alignItems:"center",wrap:!0},RFirstLine:{w:864,h:40,flex:{direction:"row",justifyContent:"center",paddingLeft:10},TextBeforeImg:{flexItem:{marginLeft:10,marginRight:6},text:{fontFace:Hn,fontSize:27,text:""}},SettingLogo:{flexItem:{marginRight:25},zIndex:2,SImage:{w:40,h:40,y:-5,src:Qo()}},TextAfterImg:{flexItem:{marginLeft:20,marginRight:10},text:{fontFace:Hn,fontSize:27,text:""}}},RSecondLine:{w:864,h:40,flexItem:{marginLeft:10,marginRight:10},text:{fontSize:25,fontFace:Hn,textAlign:"center",text:""}},RThirdLine:{w:864,h:40,flexItem:{marginLeft:10,marginRight:10},text:{fontSize:25,fontFace:Hn,textAlign:"center",text:""}}}}},ButtonSection:{w:Ko,x:975,y:150,mount:.5,flex:{direction:"column",alignContent:"center"},type:Mo,stroke:!0,strokeWeight:3,fontSize:40,fontFace:Hn,buttonIndex:0,upperButtonConfig:{btnText:"Continue",y:10,h:80,w:500},lowerButtonConfig:{btnText:"Cancel",y:48,h:80,w:500}}}}}}]),s}(Ve.Component);var Jo=760,ta=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this.tag("SuccessRect").patch({x:this.xPos,y:this.yPos})}}],[{key:"_template",value:function(){return{SuccessRect:{w:780,mount:.5,zIndex:1500,flex:{direction:"column",padding:20},flexItem:{marginLeft:40,marginTop:25,maxWidth:760},rect:!0,color:4278190080,children:[{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",textColor:Uo("#2B9CD8"),fontFace:Un,fontSize:42}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",fontFace:Dn,wordWrapWidth:Jo,fontSize:24,textColor:Uo("#E5E5E5")}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",fontFace:Dn,wordWrapWidth:Jo,fontSize:24,textColor:Uo("#E5E5E5")}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",fontFace:Dn,wordWrapWidth:Jo,fontSize:24,textColor:Uo("#E5E5E5")}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},LineAbove:{w:740,h:1.3,color:Uo("#E5E5E5"),rect:!0},LineIndicatorAbove:{w:110,h:6,color:Uo("#E5E5E5"),rect:!0}},{flexItem:{marginTop:10,marginLeft:20,maxWidth:760},text:{text:"Close",fontFace:Dn,wordWrapWidth:Jo,fontSize:42,textColor:Uo("#2B9CD8")}},{flexItem:{marginLeft:20,marginBottom:40,maxWidth:760},LineIndicatorBelow:{y:-3,w:110,h:6,color:Uo("#E5E5E5"),rect:!0},LineBelow:{w:740,h:1.3,y:.5,color:Uo("#E5E5E5"),rect:!0}}]}}}}]),s}(Ve.Component);var ea=1060,ia={backgrounds:{fill:4293717234},text:{color:4279505943}},ra=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this.tag("SuccessRect").patch({x:this.xPos,y:this.yPos})}}],[{key:"_template",value:function(){return{SuccessRect:{w:ea,mount:.5,flex:{alignItems:"center",direction:"column",padding:20},flexItem:{marginTop:25,maxWidth:ea},rect:!0,color:4278190080,children:[{flexItem:{marginTop:20,maxWidth:ea},text:{text:"",fontFace:Wn,fontSize:56,fontWeight:"semibold",letterSpacing:-.4,lineHeight:72,textAlign:"center"}},{flexItem:{marginTop:20,maxWidth:ea},y:-50,text:{text:"",fontFace:jn,fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,verticalAlign:"middle",textAlign:"center"}},{flexItem:{marginTop:20,maxWidth:ea},y:-50,text:{text:"",fontFace:jn,fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,verticalAlign:"middle",textAlign:"center",wordWrapWidth:1080}},{flexItem:{marginTop:20,maxWidth:ea},y:-50,text:{text:"",fontFace:jn,fontSize:32,fontWeight:"regular",letterSpacing:0,lineHeight:40,verticalAlign:"middle",textAlign:"center",wordWrapWidth:1080}},{flex:{direction:"column",alignContent:"center"},flexItem:{marginTop:10,maxWidth:ea},ButtonCloseFocus:{type:fo(zo,ia),y:-30,minWidth:310,radius:8,backgroundType:"fill",padding:8,title:"Close"}}]}}}}]),s}(Ve.Component);var sa={background:{color:4284507754},text:{fontSize:34,fontFace:Un}},na=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this.tag("FLXSuccessRect").patch({x:this.xPos,y:this.yPos})}}],[{key:"_template",value:function(){return{FLXSuccessRect:{w:780,mount:.5,zIndex:1500,flex:{direction:"column",padding:20},flexItem:{marginLeft:40,marginTop:25,maxWidth:760},rect:!0,color:4278190080,children:[{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",textColor:Uo("#8C8C8C"),fontFace:Un,fontSize:42}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",fontFace:Dn,wordWrapWidth:760,fontSize:24,textColor:Uo("#E5E5E5")}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",fontFace:Dn,wordWrapWidth:760,fontSize:24,textColor:Uo("#E5E5E5")}},{flexItem:{marginTop:20,marginLeft:20,maxWidth:760},text:{text:"",fontFace:Dn,wordWrapWidth:760,fontSize:24,textColor:Uo("#E5E5E5")}},{flexItem:{marginTop:10,marginLeft:20,marginBottom:30,maxWidth:760},type:fo(Lo,sa),y:10,minWidth:210,radius:8,backgroundType:"fill",padding:8,h:90,title:"Close"}]}}}}]),s}(Ve.Component),oa={X1D:"STBOverlay",FLX:"STBOverlay",PLC:"XClassOverlay"},aa={X1D:{Success:{xPos:0,yPos:0,type:ta,zIndex:1500}},PLC:{Success:{xPos:0,yPos:-110,type:ra,zIndex:1500,flex:{direction:"column",padding:20,alignItems:"center"}}},FLX:{Success:{xPos:0,yPos:0,type:na,zIndex:1500}}},ha={X1D:{LEFT:"left",LEFTBTN:0,RIGHT:"right",RIGHTBTN:1,TandCScrollValue:25},FLX:{LEFT:"left",LEFTBTN:0,RIGHT:"right",RIGHTBTN:1,TandCScrollValue:25},PLC:{LEFT:"",LEFTBTN:2,RIGHT:"",RIGHTBTN:2,DOWN:"down",DOWNBTN:1,UP:"up",UPBTN:0,TandCScrollValue:null,isXClassOverlay:!0}};function la(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function ca(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?la(Object(i),!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):la(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var ua=10,da=!1,_a=function(t){M(s,t);var e,i,r=(e=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=D(e);if(i){var s=D(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return B(this,t)});function s(){return o(this,s),r.apply(this,arguments)}return h(s,[{key:"_init",value:function(){this._setState("UserChoiceX1D"),this.mode="manage",this.flowStep="first",this.tag("STBOverlay").visible=!1,this.button=0,this.platformTypeAction="UserChoiceX1D",this.overlayType="STBOverlay"}},{key:"_build",value:function(){this.tag("Spinner").visible=!0,this.platformType=this.tag("PTData").data}},{key:"_firstEnable",value:function(){Do.emit("Lng:ready")}},{key:"_getFocused",value:function(){return da?(this.platformTypeAction="XClassError",this.tag("XClassError")):this.platformFocus()[this.platformType]}},{key:"showSpinner",value:function(){this.tag("Spinner").visible=!0}},{key:"hideSpinner",value:function(){this.tag("Spinner").visible=!1}},{key:"hideOverlay",value:function(){this.tag("Spinner").visible=!1}},{key:"updateOverlay",value:function(t,e,i){this.platformType=i;var r=t.length,s={textColor:Uo(t[0].styles.color),fontFace:Un,fontSize:42},n={fontFace:Dn,wordWrapWidth:780,fontSize:24,textColor:Uo("#E5E5E5")};if("PLC"===this.platformType)return this.patch({XClassOverlay:{type:Bo,productData:{ot:t,orderType:e,wInfo:this.tag("PTData").wInfo}}}),this._refocus(),this.mode=e,this.showOverlay(),void(this.platformTypeAction="XClassOverlay");var o="UserChoice".concat(this.platformType);this.tag(o).visible=!0,this.platformTypeAction=o;var a=[{text:ca(ca({text:t[0].text},s),{},{wordWrapWidth:780})},{flexItem:{marginTop:20,maxWidth:760},text:ca({text:t[1].text},n)},{flexItem:{marginTop:20,maxWidth:760},text:ca({text:t[2].text},n)}];t[3].text&&a.push({flexItem:{marginTop:20,maxWidth:760},text:ca({text:t[3].text},n)}),"unsubscribe"===e?(this.tag("RectTermsAndConditions").visible=!1,this.tag("UserChoiceX1D").children[4].patch({flexItem:{marginBottom:60}})):this.tag("TandC").patch({text:{text:t[r-1].children[1].children[0].text}}),this.tag("ProductDetails").children=a,this._refocus(),this.mode=e,this.showOverlay()}},{key:"updateSuccessDialog",value:function(t,e){aa[this.platformType].Success.x=this.tag("Success").xPos,aa[this.platformType].Success.y=this.tag("Success").yPos,this.patch({Success:void 0}),this.patch(ca({},aa[this.platformType])),this.tag("Success").children[0].children[0].text.text=t[0].text,this.tag("Success").children[0].children[1].text.text=t[1].text,t[2].text?this.tag("Success").children[0].children[2].text.text=t[2].text:this.tag("Success").children[0].children[2].flexItem.marginTop=0,this.tag("Success").children[0].children[3].text.text=t[3].text,this.tag("Success").visible=!0,this.flowStep=e,this._refocus()}},{key:"updateErrorDialog",value:function(t,e){if(da=!0,ha[this.platformType].isXClassOverlay)return this.button=1,this.tag("OverlayBackground").patch({visible:!1}),this.patch({XClassError:void 0}),this.patch({XClassError:{type:Zo,templateError:t,visible:!0}}),void this._refocus();aa[this.platformType].Success.x=this.tag("Success").xPos,aa[this.platformType].Success.y=this.tag("Success").yPos,this.patch({Success:void 0}),this.patch(ca({},aa[this.platformType])),this.tag("Success").children[0].children[0].text.text=t[0].text,this.tag("Success").children[0].children[1].text.text=t[1].text,t[2].text?this.tag("Success").children[0].children[2].text.text=t[2].text:this.tag("Success").children[0].children[2].flexItem.marginTop=0,this.tag("Success").children[0].children[3].text.text="",this.tag("Success").visible=!0,this.flowStep=e,this._refocus()}},{key:"showOverlay",value:function(){this.overlayType=oa[this.platformType],this.tag(this.overlayType).visible=!0}},{key:"handlerArrow",value:function(){this.tag("TandC").y<0?this.tag("ArrowUp").visible=!0:this.tag("ArrowUp").visible=!1,this.tag("TandC").renderHeight-10+this.tag("TandC").y>75?this.tag("ArrowDown").visible=!0:this.tag("ArrowDown").visible=!1}},{key:"reset",value:function(){this.mode="manage",this.flowStep="first",da=!1}},{key:"lngAppKeyHandler",value:function(t){switch(t){case 13:this.lngAppEnter();break;case 8:this.lngAppBack();break;case 38:this.lngAppUp();break;case 40:this.lngAppDown();break;case 37:this.lngAppLeft();break;case 39:this.lngAppRight()}}},{key:"lngAppLeft",value:function(){this.tag(this.platformTypeAction).patch({actionDirection:ha[this.platformType].LEFT}),this.button=ha[this.platformType].LEFTBTN}},{key:"lngAppRight",value:function(){this.tag(this.platformTypeAction).patch({actionDirection:ha[this.platformType].RIGHT}),this.button=ha[this.platformType].RIGHTBTN}},{key:"lngAppDown",value:function(){this.tag("TandC").renderHeight-10+this.tag("TandC").y>75&&(this.tag("TandC").y-=ha[this.platformType].TandCScrollValue),this.handlerArrow(),null===ha[this.platformType].TandCScrollValue&&(this.tag(this.platformTypeAction).patch({actionDirection:ha[this.platformType].DOWN}),Do.emit("key:down",{button:ha[this.platformType].DOWNBTN}),this.button=ha[this.platformType].DOWNBTN)}},{key:"lngAppUp",value:function(){this.tag("TandC").y<0&&(this.tag("TandC").y+=ha[this.platformType].TandCScrollValue),this.handlerArrow(),null===ha[this.platformType].TandCScrollValue&&(this.tag(this.platformTypeAction).patch({actionDirection:ha[this.platformType].UP}),Do.emit("key:down",{button:ha[this.platformType].UPBTN}),this.button=ha[this.platformType].UPBTN)}},{key:"lngAppEnter",value:function(){return da&&ha[this.platformType].isXClassOverlay?(da=!1,this.tag("OverlayBackground").patch({visible:!0}),this.tag("XClassError").patch({visible:!1}),this.patch({XClassError:void 0}),void Do.emit("key:select")):"last"===this.flowStep?(this.tag("Success").visible=!1,Do.emit("key:back"),void this.reset()):("CONSENT"===this.mode&&(this.patch({Spinner:{type:Gn,mode:this.mode}}),this.reset()),this.tag("Spinner").visible=!0,this.tag(this.overlayType).visible=!1,void(1===this.button?Do.emit("key:select"):Do.emit("key:back")))}},{key:"lngAppBack",value:function(){!0===this.tag(this.overlayType).visible&&(this.tag(this.overlayType).visible=!1),Do.emit("key:back"),this.button=0}},{key:"platformFocus",value:function(){return{X1D:this.tag("UserChoiceX1D"),PLC:this.tag("XClassOverlay"),FLX:this.tag("UserChoiceFLX")}}}],[{key:"getFonts",value:function(){var t=[];for(var e in Bn)t.push({family:e,url:O(Bn[e])});return t}},{key:"initApp",value:function(t,e){this.dimension=t,this.ptfmData=e,this.backgroundAlpha=.7,this.backgroundColor=4285427310,"PLC"===e&&(this.backgroundAlpha=1,this.backgroundColor=4278190080)}},{key:"_template",value:function(){var t=this._getArrowTexture.bind(this.styles);return{OverlayBackground:{w:this.dimension[0],h:this.dimension[1],rect:!0,color:this.backgroundColor,alpha:this.backgroundAlpha,zIndex:1490},Spinner:{type:Gn,xPos:this.dimension[0]/2,yPos:this.dimension[1]/2},STBOverlay:{w:880,x:this.dimension[0]/2,y:this.dimension[1]/2,mount:.5,flex:{direction:"column"},rect:!0,color:4278190080,alpha:1,zIndex:1500,ProductDetails:{flex:{direction:"column",padding:20},flexItem:{marginTop:25,maxWidth:760,marginLeft:40},rect:!0,color:4278190080},RectFooterArea:{flex:{direction:"column"},flexItem:{maxWidth:760,marginLeft:60},UserChoiceX1D:{flex:{direction:"column"},type:Ho,canText:"Cancel",canTextColor:Uo("#2B9CD8"),conText:"Confirm",conTextColor:Uo("#E5E5E5"),actionType:"",visible:!1},UserChoiceFLX:{flex:{direction:"column"},type:Yo,visible:!1},RectTermsAndConditions:{flexItem:{marginTop:30,marginBottom:50,maxWidth:1060},ArrowUp:{texture:Ve.Tools.getCanvasTexture(t),w:21,h:ua,y:-18,visible:!1},w:880,h:75,ScrollWrapper:{clipping:!0,w:function(t){return t},h:75,TandC:{rect:!0,text:{fontSize:20,lineHeight:25,text:"Terms and Conditions",textColor:Uo("#8C8C8C"),wordWrapWidth:750}}},ArrowDown:{texture:Ve.Tools.getCanvasTexture(t),rotation:Math.PI,w:21,h:ua,y:85}}}},XClassOverlay:{type:Bo,w:this.dimension[0],h:this.dimension[1],x:this.dimension[0]/2,y:this.dimension[1]/2,mount:.5,rect:!0,color:4278190080,alpha:1,zIndex:1500,visible:!1,flex:{direction:"column",padding:5,alignItems:"center"}},Success:{xPos:this.dimension[0]/2,yPos:this.dimension[1]/2,visible:!1},XClassError:{},PTData:{data:this.ptfmData,wInfo:this.dimension[0],inEligible:!1}}}},{key:"_getArrowTexture",value:function(t,e){var i=e.platform.getDrawingCanvas();i.width=21,i.height=ua;var r=i.getContext("2d");r.imageSmoothingEnabled=!0,r.fillStyle=Ve.StageUtils.getRgbaString(4283453520);var s=new Path2D;s.moveTo(0,ua),s.lineTo(20,ua),s.lineTo(ua,0),s.lineTo(0,ua),r.fill(s),t(null,i)}}]),s}(Ve.Component),ga={all:0,trace:1,debug:2,info:3,warn:4,error:5,none:6};Object.keys(ga).forEach((function(t){ga[t.toUpperCase()]=ga[t]})),Object.freeze(ga);var fa={toBrowserConsole:function(t,e){for(var i,r=t.toUpperCase()+" -> "+e,s=arguments.length,n=new Array(s>2?s-2:0),o=2;o<s;o++)n[o-2]=arguments[o];(i=window.console).log.apply(i,[r].concat(n))},log:function(t,e){if(this.currentLogLevel<ga.none&&ga[t]>=this.currentLogLevel){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];fa.toBrowserConsole.apply(fa,[t,e].concat(r))}},validateLogLevel:function(t){if("string"==typeof t&&void 0!==ga[t])return ga[t];if("number"==typeof t&&t>=ga.all&&t<=ga.none)return t;throw new Error("Invalid Log level "+t)}};const pa=new(function(){function t(e){o(this,t),this.setCurrentLogLevel(e)}return h(t,[{key:"getCurrentLogLevel",value:function(){return this.currentLogLevel}},{key:"setCurrentLogLevel",value:function(t){this.currentLogLevel=fa.validateLogLevel(t)}},{key:"trace",value:function(t){for(var e,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];(e=fa.log).call.apply(e,[this,"trace",t].concat(r))}},{key:"debug",value:function(t){for(var e,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];(e=fa.log).call.apply(e,[this,"debug",t].concat(r))}},{key:"info",value:function(t){for(var e,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];(e=fa.log).call.apply(e,[this,"info",t].concat(r))}},{key:"warn",value:function(t){for(var e,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];(e=fa.log).call.apply(e,[this,"warn",t].concat(r))}},{key:"error",value:function(t){for(var e,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];(e=fa.log).call.apply(e,[this,"error",t].concat(r))}}]),t}())(3);var xa={stage:{clearColor:"0x00000000",useImageWorker:!1,forceTxCanvasSource:!0},debug:!0},ma={path:".static/comcast/commerce/resources/lng-static",log:!0,showVersion:!1},ya=function(){function t(e){o(this,t),this.canvasId=e,this.app={},this.$frame=document.createElement("iframe"),this.$frame.id="commerceFrame",this.$frame.src="about:blank",function(t,e){for(var i=Object.entries(e),r=i.length,s=0;s<r;s++){var n=i[s];t.style[n[0]]=n[1]}}(this.$frame,Nn)}var i,r;return h(t,[{key:"render",value:function(t,e,i,r){pa.info("Lightning Renderer"),this.app.tag("App").hideSpinner(),this.cleanUp&&this.cleanUp(),this.cleanUp=e,"success"!==i&&"ineligible"!==i?this.app.tag("App").updateOverlay(t.children,i,r):"success"===i?this.app.tag("App").updateSuccessDialog(t.children,"last"):"ineligible"===i&&this.app.tag("App").updateErrorDialog(t.children,"last")}},{key:"mount",value:(r=e(n().mark((function t(e){var i,r;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(pa.info("mounting Lightning Renderer"),document.contains(this.$frame)){t.next=15;break}return t.next=4,this.createCommerceIFrame();case 4:return _a.initApp([1920,1080],e),this.app=hn(_a,xa,ma),i=new Promise((function(t){Do.on("Lng:ready",(function(){t()}))})),t.next=9,i;case 9:document.body.appendChild(this.$frame),(r=this.app.stage.getCanvas()).style="position: fixed; top: 0; left: 0;",r.id=this.canvasId,this.$frame.contentDocument.body.appendChild(r),this.enableOnDocument(this.$frame.contentDocument,this.app.tag("App"));case 15:this.$frame.focus();case 16:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"getConsentLoadingSpinner",value:function(){return{render:function(){},stop:function(){}}}},{key:"wait",value:function(){this.app.tag("App").showSpinner()}},{key:"continue",value:function(){this.app.tag("App").hideSpinner()}},{key:"unmount",value:function(){this.app.tag("App").reset(),this.app.tag("App").hideSpinner(),this.disableOnDocument(this.$frame.contentDocument,this.app.tag("App")),this.app.stage.destroy(),this.cleanUp&&this.cleanUp(),this.cleanUp=void 0,this.app={},this.$frame.contentDocument.getElementById(this.canvasId).remove(),document.contains(this.$frame)&&document.body.removeChild(this.$frame)}},{key:"onKeyDown",value:function(t,e){e.lngAppKeyHandler(t.keyCode)}},{key:"enableOnDocument",value:function(t,e){var i=this;this.disableOnDocument(t,e),t.addEventListener("keydown",(function(t){i.onKeyDown(t,e)}))}},{key:"disableOnDocument",value:function(t,e){var i=this;t.removeEventListener("keydown",(function(t){i.onKeyDown(t,e)}))}},{key:"createCommerceIFrame",value:(i=e(n().mark((function t(){var e,i=this;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Promise((function(t,e){var r=setTimeout((function(){e(new Error("Timed out waiting for iframe to load"))}),1e3);i.$frame.onload=function(){clearTimeout(r),t()}})),document.body.appendChild(this.$frame),t.next=4,e;case 4:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})}]),t}();const va={renderer:new ya("CommerceDisplayLng"),renderEB:Do,render:function(){var t=this;return e(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.renderer.render();case 1:case"end":return e.stop()}}),e)})))()},mount:function(t){var i=this;return e(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.renderer.mount(t);case 2:case"end":return e.stop()}}),e)})))()},unmount:function(){this.renderer.unmount()}}})(),r.default})()));
//# sourceMappingURL=commerce-render-lightning.min.js.map
